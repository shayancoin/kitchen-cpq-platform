{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/renderingGroup.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/renderingGroup.ts"],"sourcesContent":["import { SmartArray, SmartArrayNoDuplicate } from \"../Misc/smartArray\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport type { Nullable, DeepImmutable } from \"../types\";\r\nimport { Vector3 } from \"../Maths/math.vector\";\r\nimport type { IParticleSystem } from \"../Particles/IParticleSystem\";\r\nimport type { IEdgesRenderer } from \"./edgesRenderer\";\r\nimport type { ISpriteManager } from \"../Sprites/spriteManager\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { Material } from \"../Materials/material\";\r\nimport type { Scene } from \"../scene\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\n\r\n/**\r\n * This represents the object necessary to create a rendering group.\r\n * This is exclusively used and created by the rendering manager.\r\n * To modify the behavior, you use the available helpers in your scene or meshes.\r\n * @internal\r\n */\r\nexport class RenderingGroup {\r\n    private static _ZeroVector: DeepImmutable<Vector3> = Vector3.Zero();\r\n    private _scene: Scene;\r\n    private _opaqueSubMeshes = new SmartArray<SubMesh>(256);\r\n    private _transparentSubMeshes = new SmartArray<SubMesh>(256);\r\n    private _alphaTestSubMeshes = new SmartArray<SubMesh>(256);\r\n    private _depthOnlySubMeshes = new SmartArray<SubMesh>(256);\r\n    private _particleSystems = new SmartArray<IParticleSystem>(256);\r\n    private _spriteManagers = new SmartArray<ISpriteManager>(256);\r\n\r\n    private _opaqueSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number>;\r\n    private _alphaTestSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number>;\r\n    private _transparentSortCompareFn: (a: SubMesh, b: SubMesh) => number;\r\n\r\n    private _renderOpaque: (subMeshes: SmartArray<SubMesh>) => void;\r\n    private _renderAlphaTest: (subMeshes: SmartArray<SubMesh>) => void;\r\n    private _renderTransparent: (subMeshes: SmartArray<SubMesh>) => void;\r\n\r\n    /** @internal */\r\n    public _empty = true;\r\n\r\n    /** @internal */\r\n    public _edgesRenderers = new SmartArrayNoDuplicate<IEdgesRenderer>(16);\r\n\r\n    public onBeforeTransparentRendering: () => void;\r\n\r\n    public disableDepthPrePass = false;\r\n\r\n    /**\r\n     * Set the opaque sort comparison function.\r\n     * If null the sub meshes will be render in the order they were created\r\n     */\r\n    public set opaqueSortCompareFn(value: Nullable<(a: SubMesh, b: SubMesh) => number>) {\r\n        if (value) {\r\n            this._opaqueSortCompareFn = value;\r\n        } else {\r\n            this._opaqueSortCompareFn = RenderingGroup.PainterSortCompare;\r\n        }\r\n        this._renderOpaque = this._renderOpaqueSorted;\r\n    }\r\n\r\n    /**\r\n     * Set the alpha test sort comparison function.\r\n     * If null the sub meshes will be render in the order they were created\r\n     */\r\n    public set alphaTestSortCompareFn(value: Nullable<(a: SubMesh, b: SubMesh) => number>) {\r\n        if (value) {\r\n            this._alphaTestSortCompareFn = value;\r\n        } else {\r\n            this._alphaTestSortCompareFn = RenderingGroup.PainterSortCompare;\r\n        }\r\n        this._renderAlphaTest = this._renderAlphaTestSorted;\r\n    }\r\n\r\n    /**\r\n     * Set the transparent sort comparison function.\r\n     * If null the sub meshes will be render in the order they were created\r\n     */\r\n    public set transparentSortCompareFn(value: Nullable<(a: SubMesh, b: SubMesh) => number>) {\r\n        if (value) {\r\n            this._transparentSortCompareFn = value;\r\n        } else {\r\n            this._transparentSortCompareFn = RenderingGroup.defaultTransparentSortCompare;\r\n        }\r\n        this._renderTransparent = this._renderTransparentSorted;\r\n    }\r\n\r\n    /**\r\n     * Creates a new rendering group.\r\n     * @param index The rendering group index\r\n     * @param scene\r\n     * @param opaqueSortCompareFn The opaque sort comparison function. If null no order is applied\r\n     * @param alphaTestSortCompareFn The alpha test sort comparison function. If null no order is applied\r\n     * @param transparentSortCompareFn The transparent sort comparison function. If null back to front + alpha index sort is applied\r\n     */\r\n    constructor(\r\n        public index: number,\r\n        scene: Scene,\r\n        opaqueSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null,\r\n        alphaTestSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null,\r\n        transparentSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null\r\n    ) {\r\n        this._scene = scene;\r\n\r\n        this.opaqueSortCompareFn = opaqueSortCompareFn;\r\n        this.alphaTestSortCompareFn = alphaTestSortCompareFn;\r\n        this.transparentSortCompareFn = transparentSortCompareFn;\r\n    }\r\n\r\n    /**\r\n     * Render all the sub meshes contained in the group.\r\n     * @param customRenderFunction Used to override the default render behaviour of the group.\r\n     * @param renderSprites\r\n     * @param renderParticles\r\n     * @param activeMeshes\r\n     */\r\n    public render(\r\n        customRenderFunction: Nullable<\r\n            (\r\n                opaqueSubMeshes: SmartArray<SubMesh>,\r\n                transparentSubMeshes: SmartArray<SubMesh>,\r\n                alphaTestSubMeshes: SmartArray<SubMesh>,\r\n                depthOnlySubMeshes: SmartArray<SubMesh>\r\n            ) => void\r\n        >,\r\n        renderSprites: boolean,\r\n        renderParticles: boolean,\r\n        activeMeshes: Nullable<AbstractMesh[]>\r\n    ): void {\r\n        if (customRenderFunction) {\r\n            customRenderFunction(this._opaqueSubMeshes, this._alphaTestSubMeshes, this._transparentSubMeshes, this._depthOnlySubMeshes);\r\n            return;\r\n        }\r\n\r\n        const engine = this._scene.getEngine();\r\n\r\n        // Depth only\r\n        if (this._depthOnlySubMeshes.length !== 0) {\r\n            engine.setColorWrite(false);\r\n            this._renderAlphaTest(this._depthOnlySubMeshes);\r\n            engine.setColorWrite(true);\r\n        }\r\n\r\n        // Opaque\r\n        if (this._opaqueSubMeshes.length !== 0) {\r\n            this._renderOpaque(this._opaqueSubMeshes);\r\n        }\r\n\r\n        // Alpha test\r\n        if (this._alphaTestSubMeshes.length !== 0) {\r\n            this._renderAlphaTest(this._alphaTestSubMeshes);\r\n        }\r\n\r\n        const stencilState = engine.getStencilBuffer();\r\n        engine.setStencilBuffer(false);\r\n\r\n        // Sprites\r\n        if (renderSprites) {\r\n            this._renderSprites();\r\n        }\r\n\r\n        // Particles\r\n        if (renderParticles) {\r\n            this._renderParticles(activeMeshes);\r\n        }\r\n\r\n        if (this.onBeforeTransparentRendering) {\r\n            this.onBeforeTransparentRendering();\r\n        }\r\n\r\n        // Transparent\r\n        if (this._transparentSubMeshes.length !== 0 || this._scene.useOrderIndependentTransparency) {\r\n            engine.setStencilBuffer(stencilState);\r\n            if (this._scene.useOrderIndependentTransparency) {\r\n                const excludedMeshes = this._scene.depthPeelingRenderer!.render(this._transparentSubMeshes);\r\n                if (excludedMeshes.length) {\r\n                    // Render leftover meshes that could not be processed by depth peeling\r\n                    this._renderTransparent(excludedMeshes);\r\n                }\r\n            } else {\r\n                this._renderTransparent(this._transparentSubMeshes);\r\n            }\r\n            engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n        }\r\n\r\n        // Set back stencil to false in case it changes before the edge renderer.\r\n        engine.setStencilBuffer(false);\r\n\r\n        // Edges\r\n        if (this._edgesRenderers.length) {\r\n            for (let edgesRendererIndex = 0; edgesRendererIndex < this._edgesRenderers.length; edgesRendererIndex++) {\r\n                this._edgesRenderers.data[edgesRendererIndex].render();\r\n            }\r\n\r\n            engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n        }\r\n\r\n        // Restore Stencil state.\r\n        engine.setStencilBuffer(stencilState);\r\n    }\r\n\r\n    /**\r\n     * Renders the opaque submeshes in the order from the opaqueSortCompareFn.\r\n     * @param subMeshes The submeshes to render\r\n     */\r\n    private _renderOpaqueSorted(subMeshes: SmartArray<SubMesh>): void {\r\n        RenderingGroup._RenderSorted(subMeshes, this._opaqueSortCompareFn, this._scene.activeCamera, false, this.disableDepthPrePass);\r\n    }\r\n\r\n    /**\r\n     * Renders the opaque submeshes in the order from the alphatestSortCompareFn.\r\n     * @param subMeshes The submeshes to render\r\n     */\r\n    private _renderAlphaTestSorted(subMeshes: SmartArray<SubMesh>): void {\r\n        RenderingGroup._RenderSorted(subMeshes, this._alphaTestSortCompareFn, this._scene.activeCamera, false, this.disableDepthPrePass);\r\n    }\r\n\r\n    /**\r\n     * Renders the opaque submeshes in the order from the transparentSortCompareFn.\r\n     * @param subMeshes The submeshes to render\r\n     */\r\n    private _renderTransparentSorted(subMeshes: SmartArray<SubMesh>): void {\r\n        RenderingGroup._RenderSorted(subMeshes, this._transparentSortCompareFn, this._scene.activeCamera, true, this.disableDepthPrePass);\r\n    }\r\n\r\n    /**\r\n     * Renders the submeshes in a specified order.\r\n     * @param subMeshes The submeshes to sort before render\r\n     * @param sortCompareFn The comparison function use to sort\r\n     * @param camera The camera position use to preprocess the submeshes to help sorting\r\n     * @param transparent Specifies to activate blending if true\r\n     * @param disableDepthPrePass Specifies to disable depth pre-pass if true (default: false)\r\n     */\r\n    private static _RenderSorted(\r\n        subMeshes: SmartArray<SubMesh>,\r\n        sortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number>,\r\n        camera: Nullable<Camera>,\r\n        transparent: boolean,\r\n        disableDepthPrePass?: boolean\r\n    ): void {\r\n        let subIndex = 0;\r\n        let subMesh: SubMesh;\r\n        const cameraPosition = camera ? camera.globalPosition : RenderingGroup._ZeroVector;\r\n\r\n        if (transparent) {\r\n            for (; subIndex < subMeshes.length; subIndex++) {\r\n                subMesh = subMeshes.data[subIndex];\r\n                subMesh._alphaIndex = subMesh.getMesh().alphaIndex;\r\n                subMesh._distanceToCamera = Vector3.Distance(subMesh.getBoundingInfo().boundingSphere.centerWorld, cameraPosition);\r\n            }\r\n        }\r\n\r\n        const sortedArray = subMeshes.length === subMeshes.data.length ? subMeshes.data : subMeshes.data.slice(0, subMeshes.length);\r\n\r\n        if (sortCompareFn) {\r\n            sortedArray.sort(sortCompareFn);\r\n        }\r\n\r\n        const scene = sortedArray[0].getMesh().getScene();\r\n        for (subIndex = 0; subIndex < sortedArray.length; subIndex++) {\r\n            subMesh = sortedArray[subIndex];\r\n\r\n            if (scene._activeMeshesFrozenButKeepClipping && !subMesh.isInFrustum(scene._frustumPlanes)) {\r\n                continue;\r\n            }\r\n\r\n            if (transparent) {\r\n                const material = subMesh.getMaterial();\r\n\r\n                if (material && material.needDepthPrePass && !disableDepthPrePass) {\r\n                    const engine = material.getScene().getEngine();\r\n                    engine.setColorWrite(false);\r\n                    engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n                    subMesh.render(false);\r\n                    engine.setColorWrite(true);\r\n                }\r\n            }\r\n\r\n            subMesh.render(transparent);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Build in function which can be applied to ensure meshes of a special queue (opaque, alpha test, transparent)\r\n     * are rendered back to front if in the same alpha index.\r\n     *\r\n     * @param a The first submesh\r\n     * @param b The second submesh\r\n     * @returns The result of the comparison\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static defaultTransparentSortCompare(a: SubMesh, b: SubMesh): number {\r\n        // Alpha index first\r\n        if (a._alphaIndex > b._alphaIndex) {\r\n            return 1;\r\n        }\r\n        if (a._alphaIndex < b._alphaIndex) {\r\n            return -1;\r\n        }\r\n\r\n        // Then distance to camera\r\n        return RenderingGroup.backToFrontSortCompare(a, b);\r\n    }\r\n\r\n    /**\r\n     * Build in function which can be applied to ensure meshes of a special queue (opaque, alpha test, transparent)\r\n     * are rendered back to front.\r\n     *\r\n     * @param a The first submesh\r\n     * @param b The second submesh\r\n     * @returns The result of the comparison\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static backToFrontSortCompare(a: SubMesh, b: SubMesh): number {\r\n        // Then distance to camera\r\n        if (a._distanceToCamera < b._distanceToCamera) {\r\n            return 1;\r\n        }\r\n        if (a._distanceToCamera > b._distanceToCamera) {\r\n            return -1;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Build in function which can be applied to ensure meshes of a special queue (opaque, alpha test, transparent)\r\n     * are rendered front to back (prevent overdraw).\r\n     *\r\n     * @param a The first submesh\r\n     * @param b The second submesh\r\n     * @returns The result of the comparison\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    public static frontToBackSortCompare(a: SubMesh, b: SubMesh): number {\r\n        // Then distance to camera\r\n        if (a._distanceToCamera < b._distanceToCamera) {\r\n            return -1;\r\n        }\r\n        if (a._distanceToCamera > b._distanceToCamera) {\r\n            return 1;\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    /**\r\n     * Build in function which can be applied to ensure meshes of a special queue (opaque, alpha test, transparent)\r\n     * are grouped by material then geometry.\r\n     *\r\n     * @param a The first submesh\r\n     * @param b The second submesh\r\n     * @returns The result of the comparison\r\n     */\r\n    public static PainterSortCompare(a: SubMesh, b: SubMesh): number {\r\n        const meshA = a.getMesh();\r\n        const meshB = b.getMesh();\r\n\r\n        if (meshA.material && meshB.material) {\r\n            return meshA.material.uniqueId - meshB.material.uniqueId;\r\n        }\r\n\r\n        return meshA.uniqueId - meshB.uniqueId;\r\n    }\r\n\r\n    /**\r\n     * Resets the different lists of submeshes to prepare a new frame.\r\n     */\r\n    public prepare(): void {\r\n        this._opaqueSubMeshes.reset();\r\n        this._transparentSubMeshes.reset();\r\n        this._alphaTestSubMeshes.reset();\r\n        this._depthOnlySubMeshes.reset();\r\n        this._particleSystems.reset();\r\n        this.prepareSprites();\r\n        this._edgesRenderers.reset();\r\n        this._empty = true;\r\n    }\r\n\r\n    /**\r\n     * Resets the different lists of sprites to prepare a new frame.\r\n     */\r\n    public prepareSprites(): void {\r\n        this._spriteManagers.reset();\r\n    }\r\n\r\n    public dispose(): void {\r\n        this._opaqueSubMeshes.dispose();\r\n        this._transparentSubMeshes.dispose();\r\n        this._alphaTestSubMeshes.dispose();\r\n        this._depthOnlySubMeshes.dispose();\r\n        this._particleSystems.dispose();\r\n        this._spriteManagers.dispose();\r\n        this._edgesRenderers.dispose();\r\n    }\r\n\r\n    /**\r\n     * Inserts the submesh in its correct queue depending on its material.\r\n     * @param subMesh The submesh to dispatch\r\n     * @param [mesh] Optional reference to the submeshes's mesh. Provide if you have an exiting reference to improve performance.\r\n     * @param [material] Optional reference to the submeshes's material. Provide if you have an exiting reference to improve performance.\r\n     */\r\n    public dispatch(subMesh: SubMesh, mesh?: AbstractMesh, material?: Nullable<Material>): void {\r\n        // Get mesh and materials if not provided\r\n        if (mesh === undefined) {\r\n            mesh = subMesh.getMesh();\r\n        }\r\n        if (material === undefined) {\r\n            material = subMesh.getMaterial();\r\n        }\r\n\r\n        if (material === null || material === undefined) {\r\n            return;\r\n        }\r\n\r\n        if (material.needAlphaBlendingForMesh(mesh)) {\r\n            // Transparent\r\n            this._transparentSubMeshes.push(subMesh);\r\n        } else if (material.needAlphaTestingForMesh(mesh)) {\r\n            // Alpha test\r\n            if (material.needDepthPrePass && !this.disableDepthPrePass) {\r\n                this._depthOnlySubMeshes.push(subMesh);\r\n            }\r\n\r\n            this._alphaTestSubMeshes.push(subMesh);\r\n        } else {\r\n            if (material.needDepthPrePass && !this.disableDepthPrePass) {\r\n                this._depthOnlySubMeshes.push(subMesh);\r\n            }\r\n\r\n            this._opaqueSubMeshes.push(subMesh); // Opaque\r\n        }\r\n\r\n        mesh._renderingGroup = this;\r\n\r\n        if (mesh._edgesRenderer && mesh.isEnabled() && mesh.isVisible && mesh._edgesRenderer.isEnabled) {\r\n            this._edgesRenderers.pushNoDuplicate(mesh._edgesRenderer);\r\n        }\r\n\r\n        this._empty = false;\r\n    }\r\n\r\n    public dispatchSprites(spriteManager: ISpriteManager) {\r\n        this._spriteManagers.push(spriteManager);\r\n        this._empty = false;\r\n    }\r\n\r\n    public dispatchParticles(particleSystem: IParticleSystem) {\r\n        this._particleSystems.push(particleSystem);\r\n        this._empty = false;\r\n    }\r\n\r\n    private _renderParticles(activeMeshes: Nullable<AbstractMesh[]>): void {\r\n        if (this._particleSystems.length === 0) {\r\n            return;\r\n        }\r\n\r\n        // Particles\r\n        const activeCamera = this._scene.activeCamera;\r\n        this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);\r\n        for (let particleIndex = 0; particleIndex < this._particleSystems.length; particleIndex++) {\r\n            const particleSystem = this._particleSystems.data[particleIndex];\r\n\r\n            if ((activeCamera && activeCamera.layerMask & particleSystem.layerMask) === 0) {\r\n                continue;\r\n            }\r\n\r\n            const emitter: any = particleSystem.emitter;\r\n            if (!emitter.position || !activeMeshes || activeMeshes.indexOf(emitter) !== -1) {\r\n                this._scene._activeParticles.addCount(particleSystem.render(), false);\r\n            }\r\n        }\r\n        this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene);\r\n    }\r\n\r\n    private _renderSprites(): void {\r\n        if (!this._scene.spritesEnabled || this._spriteManagers.length === 0) {\r\n            return;\r\n        }\r\n\r\n        // Sprites\r\n        const activeCamera = this._scene.activeCamera;\r\n        this._scene.onBeforeSpritesRenderingObservable.notifyObservers(this._scene);\r\n        for (let id = 0; id < this._spriteManagers.length; id++) {\r\n            const spriteManager = this._spriteManagers.data[id];\r\n\r\n            if ((activeCamera && activeCamera.layerMask & spriteManager.layerMask) !== 0) {\r\n                spriteManager.render();\r\n            }\r\n        }\r\n        this._scene.onAfterSpritesRenderingObservable.notifyObservers(this._scene);\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA,OAAO,EAAE,UAAU,EAAE,qBAAqB,EAAE,MAAM,oBAAoB,CAAC;AAIvE,OAAO,EAAE,OAAO,EAAE,MAAM,sBAAsB,CAAC;;;AAezC,MAAO,cAAc;IA4BvB;;;OAGG,CACH,IAAW,mBAAmB,CAAC,KAAmD,EAAA;QAC9E,IAAI,KAAK,EAAE,CAAC;YACR,IAAI,CAAC,oBAAoB,GAAG,KAAK,CAAC;QACtC,CAAC,MAAM,CAAC;YACJ,IAAI,CAAC,oBAAoB,GAAG,cAAc,CAAC,kBAAkB,CAAC;QAClE,CAAC;QACD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAC,mBAAmB,CAAC;IAClD,CAAC;IAED;;;OAGG,CACH,IAAW,sBAAsB,CAAC,KAAmD,EAAA;QACjF,IAAI,KAAK,EAAE,CAAC;YACR,IAAI,CAAC,uBAAuB,GAAG,KAAK,CAAC;QACzC,CAAC,MAAM,CAAC;YACJ,IAAI,CAAC,uBAAuB,GAAG,cAAc,CAAC,kBAAkB,CAAC;QACrE,CAAC;QACD,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,sBAAsB,CAAC;IACxD,CAAC;IAED;;;OAGG,CACH,IAAW,wBAAwB,CAAC,KAAmD,EAAA;QACnF,IAAI,KAAK,EAAE,CAAC;YACR,IAAI,CAAC,yBAAyB,GAAG,KAAK,CAAC;QAC3C,CAAC,MAAM,CAAC;YACJ,IAAI,CAAC,yBAAyB,GAAG,cAAc,CAAC,6BAA6B,CAAC;QAClF,CAAC;QACD,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC,wBAAwB,CAAC;IAC5D,CAAC;IAED;;;;;;;OAOG,CACH,YACW,KAAa,EACpB,KAAY,EACZ,sBAAoE,IAAI,EACxE,yBAAuE,IAAI,EAC3E,2BAAyE,IAAI,CAAA;QAJtE,IAAA,CAAA,KAAK,GAAL,KAAK,CAAQ;QAzEhB,IAAA,CAAA,gBAAgB,GAAG,IAAI,wOAAU,CAAU,GAAG,CAAC,CAAC;QAChD,IAAA,CAAA,qBAAqB,GAAG,IAAI,wOAAU,CAAU,GAAG,CAAC,CAAC;QACrD,IAAA,CAAA,mBAAmB,GAAG,IAAI,wOAAU,CAAU,GAAG,CAAC,CAAC;QACnD,IAAA,CAAA,mBAAmB,GAAG,IAAI,wOAAU,CAAU,GAAG,CAAC,CAAC;QACnD,IAAA,CAAA,gBAAgB,GAAG,IAAI,wOAAU,CAAkB,GAAG,CAAC,CAAC;QACxD,IAAA,CAAA,eAAe,GAAG,IAAI,wOAAU,CAAiB,GAAG,CAAC,CAAC;QAU9D,cAAA,EAAgB,CACT,IAAA,CAAA,MAAM,GAAG,IAAI,CAAC;QAErB,cAAA,EAAgB,CACT,IAAA,CAAA,eAAe,GAAG,IAAI,mPAAqB,CAAiB,EAAE,CAAC,CAAC;QAIhE,IAAA,CAAA,mBAAmB,GAAG,KAAK,CAAC;QAwD/B,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QAEpB,IAAI,CAAC,mBAAmB,GAAG,mBAAmB,CAAC;QAC/C,IAAI,CAAC,sBAAsB,GAAG,sBAAsB,CAAC;QACrD,IAAI,CAAC,wBAAwB,GAAG,wBAAwB,CAAC;IAC7D,CAAC;IAED;;;;;;OAMG,CACI,MAAM,CACT,oBAOC,EACD,aAAsB,EACtB,eAAwB,EACxB,YAAsC,EAAA;QAEtC,IAAI,oBAAoB,EAAE,CAAC;YACvB,oBAAoB,CAAC,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,mBAAmB,EAAE,IAAI,CAAC,qBAAqB,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAC5H,OAAO;QACX,CAAC;QAED,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC;QAEvC,aAAa;QACb,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACxC,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;YAC5B,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;YAChD,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAC/B,CAAC;QAED,SAAS;QACT,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACrC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,CAAC,CAAC;QAC9C,CAAC;QAED,aAAa;QACb,IAAI,IAAI,CAAC,mBAAmB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACxC,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC;QACpD,CAAC;QAED,MAAM,YAAY,GAAG,MAAM,CAAC,gBAAgB,EAAE,CAAC;QAC/C,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;QAE/B,UAAU;QACV,IAAI,aAAa,EAAE,CAAC;YAChB,IAAI,CAAC,cAAc,EAAE,CAAC;QAC1B,CAAC;QAED,YAAY;QACZ,IAAI,eAAe,EAAE,CAAC;YAClB,IAAI,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;QACxC,CAAC;QAED,IAAI,IAAI,CAAC,4BAA4B,EAAE,CAAC;YACpC,IAAI,CAAC,4BAA4B,EAAE,CAAC;QACxC,CAAC;QAED,cAAc;QACd,IAAI,IAAI,CAAC,qBAAqB,CAAC,MAAM,KAAK,CAAC,IAAI,IAAI,CAAC,MAAM,CAAC,+BAA+B,EAAE,CAAC;YACzF,MAAM,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;YACtC,IAAI,IAAI,CAAC,MAAM,CAAC,+BAA+B,EAAE,CAAC;gBAC9C,MAAM,cAAc,GAAG,IAAI,CAAC,MAAM,CAAC,oBAAqB,CAAC,MAAM,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;gBAC5F,IAAI,cAAc,CAAC,MAAM,EAAE,CAAC;oBACxB,sEAAsE;oBACtE,IAAI,CAAC,kBAAkB,CAAC,cAAc,CAAC,CAAC;gBAC5C,CAAC;YACL,CAAC,MAAM,CAAC;gBACJ,IAAI,CAAC,kBAAkB,CAAC,IAAI,CAAC,qBAAqB,CAAC,CAAC;YACxD,CAAC;YACD,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;QACjD,CAAC;QAED,yEAAyE;QACzE,MAAM,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC;QAE/B,QAAQ;QACR,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,CAAC;YAC9B,IAAK,IAAI,kBAAkB,GAAG,CAAC,EAAE,kBAAkB,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,kBAAkB,EAAE,CAAE,CAAC;gBACtG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,kBAAkB,CAAC,CAAC,MAAM,EAAE,CAAC;YAC3D,CAAC;YAED,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;QACjD,CAAC;QAED,yBAAyB;QACzB,MAAM,CAAC,gBAAgB,CAAC,YAAY,CAAC,CAAC;IAC1C,CAAC;IAED;;;OAGG,CACK,mBAAmB,CAAC,SAA8B,EAAA;QACtD,cAAc,CAAC,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;IAClI,CAAC;IAED;;;OAGG,CACK,sBAAsB,CAAC,SAA8B,EAAA;QACzD,cAAc,CAAC,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,uBAAuB,EAAE,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,KAAK,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;IACrI,CAAC;IAED;;;OAGG,CACK,wBAAwB,CAAC,SAA8B,EAAA;QAC3D,cAAc,CAAC,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,yBAAyB,EAAE,IAAI,CAAC,MAAM,CAAC,YAAY,EAAE,IAAI,EAAE,IAAI,CAAC,mBAAmB,CAAC,CAAC;IACtI,CAAC;IAED;;;;;;;OAOG,CACK,MAAM,CAAC,aAAa,CACxB,SAA8B,EAC9B,aAA2D,EAC3D,MAAwB,EACxB,WAAoB,EACpB,mBAA6B,EAAA;QAE7B,IAAI,QAAQ,GAAG,CAAC,CAAC;QACjB,IAAI,OAAgB,CAAC;QACrB,MAAM,cAAc,GAAG,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,cAAc,CAAC,CAAC,CAAC,cAAc,CAAC,WAAW,CAAC;QAEnF,IAAI,WAAW,EAAE,CAAC;YACd,MAAO,QAAQ,GAAG,SAAS,CAAC,MAAM,EAAE,QAAQ,EAAE,CAAE,CAAC;gBAC7C,OAAO,GAAG,SAAS,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBACnC,OAAO,CAAC,WAAW,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC,UAAU,CAAC;gBACnD,OAAO,CAAC,iBAAiB,GAAG,0OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,eAAe,EAAE,CAAC,cAAc,CAAC,WAAW,EAAE,cAAc,CAAC,CAAC;YACvH,CAAC;QACL,CAAC;QAED,MAAM,WAAW,GAAG,SAAS,CAAC,MAAM,KAAK,SAAS,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE,SAAS,CAAC,MAAM,CAAC,CAAC;QAE5H,IAAI,aAAa,EAAE,CAAC;YAChB,WAAW,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACpC,CAAC;QAED,MAAM,KAAK,GAAG,WAAW,CAAC,CAAC,CAAC,CAAC,OAAO,EAAE,CAAC,QAAQ,EAAE,CAAC;QAClD,IAAK,QAAQ,GAAG,CAAC,EAAE,QAAQ,GAAG,WAAW,CAAC,MAAM,EAAE,QAAQ,EAAE,CAAE,CAAC;YAC3D,OAAO,GAAG,WAAW,CAAC,QAAQ,CAAC,CAAC;YAEhC,IAAI,KAAK,CAAC,kCAAkC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,KAAK,CAAC,cAAc,CAAC,EAAE,CAAC;gBACzF,SAAS;YACb,CAAC;YAED,IAAI,WAAW,EAAE,CAAC;gBACd,MAAM,QAAQ,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;gBAEvC,IAAI,QAAQ,IAAI,QAAQ,CAAC,gBAAgB,IAAI,CAAC,mBAAmB,EAAE,CAAC;oBAChE,MAAM,MAAM,GAAG,QAAQ,CAAC,QAAQ,EAAE,CAAC,SAAS,EAAE,CAAC;oBAC/C,MAAM,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;oBAC5B,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,aAAa,CAAC,CAAC;oBAC7C,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;oBACtB,MAAM,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;gBAC/B,CAAC;YACL,CAAC;YAED,OAAO,CAAC,MAAM,CAAC,WAAW,CAAC,CAAC;QAChC,CAAC;IACL,CAAC;IAED;;;;;;;OAOG,CACH,gEAAgE;IACzD,MAAM,CAAC,6BAA6B,CAAC,CAAU,EAAE,CAAU,EAAA;QAC9D,oBAAoB;QACpB,IAAI,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,EAAE,CAAC;YAChC,OAAO,CAAC,CAAC;QACb,CAAC;QACD,IAAI,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,WAAW,EAAE,CAAC;YAChC,OAAO,CAAC,CAAC,CAAC;QACd,CAAC;QAED,0BAA0B;QAC1B,OAAO,cAAc,CAAC,sBAAsB,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;IACvD,CAAC;IAED;;;;;;;OAOG,CACH,gEAAgE;IACzD,MAAM,CAAC,sBAAsB,CAAC,CAAU,EAAE,CAAU,EAAA;QACvD,0BAA0B;QAC1B,IAAI,CAAC,CAAC,iBAAiB,GAAG,CAAC,CAAC,iBAAiB,EAAE,CAAC;YAC5C,OAAO,CAAC,CAAC;QACb,CAAC;QACD,IAAI,CAAC,CAAC,iBAAiB,GAAG,CAAC,CAAC,iBAAiB,EAAE,CAAC;YAC5C,OAAO,CAAC,CAAC,CAAC;QACd,CAAC;QAED,OAAO,CAAC,CAAC;IACb,CAAC;IAED;;;;;;;OAOG,CACH,gEAAgE;IACzD,MAAM,CAAC,sBAAsB,CAAC,CAAU,EAAE,CAAU,EAAA;QACvD,0BAA0B;QAC1B,IAAI,CAAC,CAAC,iBAAiB,GAAG,CAAC,CAAC,iBAAiB,EAAE,CAAC;YAC5C,OAAO,CAAC,CAAC,CAAC;QACd,CAAC;QACD,IAAI,CAAC,CAAC,iBAAiB,GAAG,CAAC,CAAC,iBAAiB,EAAE,CAAC;YAC5C,OAAO,CAAC,CAAC;QACb,CAAC;QAED,OAAO,CAAC,CAAC;IACb,CAAC;IAED;;;;;;;OAOG,CACI,MAAM,CAAC,kBAAkB,CAAC,CAAU,EAAE,CAAU,EAAA;QACnD,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,CAAC;QAC1B,MAAM,KAAK,GAAG,CAAC,CAAC,OAAO,EAAE,CAAC;QAE1B,IAAI,KAAK,CAAC,QAAQ,IAAI,KAAK,CAAC,QAAQ,EAAE,CAAC;YACnC,OAAO,KAAK,CAAC,QAAQ,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC,QAAQ,CAAC;QAC7D,CAAC;QAED,OAAO,KAAK,CAAC,QAAQ,GAAG,KAAK,CAAC,QAAQ,CAAC;IAC3C,CAAC;IAED;;OAEG,CACI,OAAO,GAAA;QACV,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;QAC9B,IAAI,CAAC,qBAAqB,CAAC,KAAK,EAAE,CAAC;QACnC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,CAAC,mBAAmB,CAAC,KAAK,EAAE,CAAC;QACjC,IAAI,CAAC,gBAAgB,CAAC,KAAK,EAAE,CAAC;QAC9B,IAAI,CAAC,cAAc,EAAE,CAAC;QACtB,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;QAC7B,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,CAAC;IAED;;OAEG,CACI,cAAc,GAAA;QACjB,IAAI,CAAC,eAAe,CAAC,KAAK,EAAE,CAAC;IACjC,CAAC;IAEM,OAAO,GAAA;QACV,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC;QAChC,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,CAAC;QACrC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;QACnC,IAAI,CAAC,mBAAmB,CAAC,OAAO,EAAE,CAAC;QACnC,IAAI,CAAC,gBAAgB,CAAC,OAAO,EAAE,CAAC;QAChC,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;QAC/B,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;IACnC,CAAC;IAED;;;;;OAKG,CACI,QAAQ,CAAC,OAAgB,EAAE,IAAmB,EAAE,QAA6B,EAAA;QAChF,yCAAyC;QACzC,IAAI,IAAI,KAAK,SAAS,EAAE,CAAC;YACrB,IAAI,GAAG,OAAO,CAAC,OAAO,EAAE,CAAC;QAC7B,CAAC;QACD,IAAI,QAAQ,KAAK,SAAS,EAAE,CAAC;YACzB,QAAQ,GAAG,OAAO,CAAC,WAAW,EAAE,CAAC;QACrC,CAAC;QAED,IAAI,QAAQ,KAAK,IAAI,IAAI,QAAQ,KAAK,SAAS,EAAE,CAAC;YAC9C,OAAO;QACX,CAAC;QAED,IAAI,QAAQ,CAAC,wBAAwB,CAAC,IAAI,CAAC,EAAE,CAAC;YAC1C,cAAc;YACd,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC7C,CAAC,MAAM,IAAI,QAAQ,CAAC,uBAAuB,CAAC,IAAI,CAAC,EAAE,CAAC;YAChD,aAAa;YACb,IAAI,QAAQ,CAAC,gBAAgB,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBACzD,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC3C,CAAC;YAED,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;QAC3C,CAAC,MAAM,CAAC;YACJ,IAAI,QAAQ,CAAC,gBAAgB,IAAI,CAAC,IAAI,CAAC,mBAAmB,EAAE,CAAC;gBACzD,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAC3C,CAAC;YAED,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS;QAClD,CAAC;QAED,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAE5B,IAAI,IAAI,CAAC,cAAc,IAAI,IAAI,CAAC,SAAS,EAAE,IAAI,IAAI,CAAC,SAAS,IAAI,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,CAAC;YAC7F,IAAI,CAAC,eAAe,CAAC,eAAe,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC9D,CAAC;QAED,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,CAAC;IAEM,eAAe,CAAC,aAA6B,EAAA;QAChD,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;QACzC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,CAAC;IAEM,iBAAiB,CAAC,cAA+B,EAAA;QACpD,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,cAAc,CAAC,CAAC;QAC3C,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;IACxB,CAAC;IAEO,gBAAgB,CAAC,YAAsC,EAAA;QAC3D,IAAI,IAAI,CAAC,gBAAgB,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACrC,OAAO;QACX,CAAC;QAED,YAAY;QACZ,MAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC;QAC9C,IAAI,CAAC,MAAM,CAAC,oCAAoC,CAAC,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC9E,IAAK,IAAI,aAAa,GAAG,CAAC,EAAE,aAAa,GAAG,IAAI,CAAC,gBAAgB,CAAC,MAAM,EAAE,aAAa,EAAE,CAAE,CAAC;YACxF,MAAM,cAAc,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC;YAEjE,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,SAAS,GAAG,cAAc,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC;gBAC5E,SAAS;YACb,CAAC;YAED,MAAM,OAAO,GAAQ,cAAc,CAAC,OAAO,CAAC;YAC5C,IAAI,CAAC,OAAO,CAAC,QAAQ,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,CAAC;gBAC7E,IAAI,CAAC,MAAM,CAAC,gBAAgB,CAAC,QAAQ,CAAC,cAAc,CAAC,MAAM,EAAE,EAAE,KAAK,CAAC,CAAC;YAC1E,CAAC;QACL,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,mCAAmC,CAAC,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IACjF,CAAC;IAEO,cAAc,GAAA;QAClB,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,cAAc,IAAI,IAAI,CAAC,eAAe,CAAC,MAAM,KAAK,CAAC,EAAE,CAAC;YACnE,OAAO;QACX,CAAC;QAED,UAAU;QACV,MAAM,YAAY,GAAG,IAAI,CAAC,MAAM,CAAC,YAAY,CAAC;QAC9C,IAAI,CAAC,MAAM,CAAC,kCAAkC,CAAC,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QAC5E,IAAK,IAAI,EAAE,GAAG,CAAC,EAAE,EAAE,GAAG,IAAI,CAAC,eAAe,CAAC,MAAM,EAAE,EAAE,EAAE,CAAE,CAAC;YACtD,MAAM,aAAa,GAAG,IAAI,CAAC,eAAe,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;YAEpD,IAAI,CAAC,YAAY,IAAI,YAAY,CAAC,SAAS,GAAG,aAAa,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC;gBAC3E,aAAa,CAAC,MAAM,EAAE,CAAC;YAC3B,CAAC;QACL,CAAC;QACD,IAAI,CAAC,MAAM,CAAC,iCAAiC,CAAC,eAAe,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAC/E,CAAC;;AAtdc,eAAA,WAAW,GAA2B,0OAAO,CAAC,IAAI,EAAE,AAAzC,CAA0C"}},
    {"offset": {"line": 374, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/renderingManager.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/renderingManager.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport type { SmartArray } from \"../Misc/smartArray\";\r\nimport type { ISpriteManager } from \"../Sprites/spriteManager\";\r\nimport type { IParticleSystem } from \"../Particles/IParticleSystem\";\r\nimport { RenderingGroup } from \"./renderingGroup\";\r\n\r\nimport type { Scene } from \"../scene\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport type { Material } from \"../Materials/material\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\n\r\n/**\r\n * Interface describing the different options available in the rendering manager\r\n * regarding Auto Clear between groups.\r\n */\r\nexport interface IRenderingManagerAutoClearSetup {\r\n    /**\r\n     * Defines whether or not autoclear is enable.\r\n     */\r\n    autoClear: boolean;\r\n    /**\r\n     * Defines whether or not to autoclear the depth buffer.\r\n     */\r\n    depth: boolean;\r\n    /**\r\n     * Defines whether or not to autoclear the stencil buffer.\r\n     */\r\n    stencil: boolean;\r\n}\r\n\r\n/**\r\n * This class is used by the onRenderingGroupObservable\r\n */\r\nexport class RenderingGroupInfo {\r\n    /**\r\n     * The Scene that being rendered\r\n     */\r\n    scene: Scene;\r\n\r\n    /**\r\n     * The camera currently used for the rendering pass\r\n     */\r\n    camera: Nullable<Camera>;\r\n\r\n    /**\r\n     * The ID of the renderingGroup being processed\r\n     */\r\n    renderingGroupId: number;\r\n\r\n    /**\r\n     * The rendering manager\r\n     */\r\n    renderingManager: RenderingManager;\r\n}\r\n\r\n/**\r\n * This is the manager responsible of all the rendering for meshes sprites and particles.\r\n * It is enable to manage the different groups as well as the different necessary sort functions.\r\n * This should not be used directly aside of the few static configurations\r\n */\r\nexport class RenderingManager {\r\n    /**\r\n     * The max id used for rendering groups (not included)\r\n     */\r\n    public static MAX_RENDERINGGROUPS = 4;\r\n\r\n    /**\r\n     * The min id used for rendering groups (included)\r\n     */\r\n    public static MIN_RENDERINGGROUPS = 0;\r\n\r\n    /**\r\n     * Used to globally prevent autoclearing scenes.\r\n     */\r\n    public static AUTOCLEAR = true;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _useSceneAutoClearSetup = false;\r\n\r\n    private _disableDepthPrePass = false;\r\n    /**\r\n     * Specifies to disable depth pre-pass if true (default: false)\r\n     */\r\n    public get disableDepthPrePass() {\r\n        return this._disableDepthPrePass;\r\n    }\r\n\r\n    public set disableDepthPrePass(value: boolean) {\r\n        this._disableDepthPrePass = value;\r\n        for (const group of this._renderingGroups) {\r\n            group.disableDepthPrePass = value;\r\n        }\r\n    }\r\n\r\n    private _scene: Scene;\r\n    private _renderingGroups = new Array<RenderingGroup>();\r\n    private _depthStencilBufferAlreadyCleaned: boolean;\r\n\r\n    private _autoClearDepthStencil: { [id: number]: IRenderingManagerAutoClearSetup } = {};\r\n    private _customOpaqueSortCompareFn: { [id: number]: Nullable<(a: SubMesh, b: SubMesh) => number> } = {};\r\n    private _customAlphaTestSortCompareFn: { [id: number]: Nullable<(a: SubMesh, b: SubMesh) => number> } = {};\r\n    private _customTransparentSortCompareFn: { [id: number]: Nullable<(a: SubMesh, b: SubMesh) => number> } = {};\r\n    private _renderingGroupInfo: Nullable<RenderingGroupInfo> = new RenderingGroupInfo();\r\n\r\n    private _maintainStateBetweenFrames = false;\r\n    /**\r\n     * Gets or sets a boolean indicating that the manager will not reset between frames.\r\n     * This means that if a mesh becomes invisible or transparent it will not be visible until this boolean is set to false again.\r\n     * By default, the rendering manager will dispatch all active meshes per frame (moving them to the transparent, opaque or alpha testing lists).\r\n     * By turning this property on, you will accelerate the rendering by keeping all these lists unchanged between frames.\r\n     */\r\n    public get maintainStateBetweenFrames() {\r\n        return this._maintainStateBetweenFrames;\r\n    }\r\n\r\n    public set maintainStateBetweenFrames(value: boolean) {\r\n        if (value === this._maintainStateBetweenFrames) {\r\n            return;\r\n        }\r\n\r\n        this._maintainStateBetweenFrames = value;\r\n        if (!this._maintainStateBetweenFrames) {\r\n            this.restoreDispachedFlags();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restore wasDispatched flags on the lists of elements to render.\r\n     */\r\n    public restoreDispachedFlags() {\r\n        for (const mesh of this._scene.meshes) {\r\n            if (mesh.subMeshes) {\r\n                for (const subMesh of mesh.subMeshes) {\r\n                    subMesh._wasDispatched = false;\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._scene.spriteManagers) {\r\n            for (const spriteManager of this._scene.spriteManagers) {\r\n                spriteManager._wasDispatched = false;\r\n            }\r\n        }\r\n\r\n        for (const particleSystem of this._scene.particleSystems) {\r\n            particleSystem._wasDispatched = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instantiates a new rendering group for a particular scene\r\n     * @param scene Defines the scene the groups belongs to\r\n     */\r\n    constructor(scene: Scene) {\r\n        this._scene = scene;\r\n\r\n        for (let i = RenderingManager.MIN_RENDERINGGROUPS; i < RenderingManager.MAX_RENDERINGGROUPS; i++) {\r\n            this._autoClearDepthStencil[i] = { autoClear: true, depth: true, stencil: true };\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns the rendering group with the specified id.\r\n     * @param id the id of the rendering group (0 by default)\r\n     */\r\n    public getRenderingGroup(id: number): RenderingGroup {\r\n        const renderingGroupId = id || 0;\r\n\r\n        this._prepareRenderingGroup(renderingGroupId);\r\n\r\n        return this._renderingGroups[renderingGroupId];\r\n    }\r\n\r\n    private _clearDepthStencilBuffer(depth = true, stencil = true): void {\r\n        if (this._depthStencilBufferAlreadyCleaned) {\r\n            return;\r\n        }\r\n\r\n        this._scene.getEngine().clear(null, false, depth, stencil);\r\n        this._depthStencilBufferAlreadyCleaned = true;\r\n    }\r\n\r\n    /**\r\n     * Renders the entire managed groups. This is used by the scene or the different render targets.\r\n     * @internal\r\n     */\r\n    public render(\r\n        customRenderFunction: Nullable<\r\n            (\r\n                opaqueSubMeshes: SmartArray<SubMesh>,\r\n                transparentSubMeshes: SmartArray<SubMesh>,\r\n                alphaTestSubMeshes: SmartArray<SubMesh>,\r\n                depthOnlySubMeshes: SmartArray<SubMesh>\r\n            ) => void\r\n        >,\r\n        activeMeshes: Nullable<AbstractMesh[]>,\r\n        renderParticles: boolean,\r\n        renderSprites: boolean\r\n    ): void {\r\n        // Update the observable context (not null as it only goes away on dispose)\r\n        const info = this._renderingGroupInfo!;\r\n        info.scene = this._scene;\r\n        info.camera = this._scene.activeCamera;\r\n        info.renderingManager = this;\r\n\r\n        // Dispatch sprites\r\n        if (this._scene.spriteManagers && renderSprites) {\r\n            for (let index = 0; index < this._scene.spriteManagers.length; index++) {\r\n                const manager = this._scene.spriteManagers[index];\r\n                this.dispatchSprites(manager);\r\n            }\r\n        }\r\n\r\n        // Render\r\n        for (let index = RenderingManager.MIN_RENDERINGGROUPS; index < RenderingManager.MAX_RENDERINGGROUPS; index++) {\r\n            this._depthStencilBufferAlreadyCleaned = index === RenderingManager.MIN_RENDERINGGROUPS;\r\n            const renderingGroup = this._renderingGroups[index];\r\n            if (!renderingGroup || renderingGroup._empty) {\r\n                continue;\r\n            }\r\n\r\n            const renderingGroupMask = 1 << index;\r\n            info.renderingGroupId = index;\r\n\r\n            // Before Observable\r\n            this._scene.onBeforeRenderingGroupObservable.notifyObservers(info, renderingGroupMask);\r\n\r\n            // Clear depth/stencil if needed\r\n            if (RenderingManager.AUTOCLEAR) {\r\n                const autoClear = this._useSceneAutoClearSetup ? this._scene.getAutoClearDepthStencilSetup(index) : this._autoClearDepthStencil[index];\r\n\r\n                if (autoClear && autoClear.autoClear) {\r\n                    this._clearDepthStencilBuffer(autoClear.depth, autoClear.stencil);\r\n                }\r\n            }\r\n\r\n            // Render\r\n            for (const step of this._scene._beforeRenderingGroupDrawStage) {\r\n                step.action(index);\r\n            }\r\n            renderingGroup.render(customRenderFunction, renderSprites, renderParticles, activeMeshes);\r\n            for (const step of this._scene._afterRenderingGroupDrawStage) {\r\n                step.action(index);\r\n            }\r\n\r\n            // After Observable\r\n            this._scene.onAfterRenderingGroupObservable.notifyObservers(info, renderingGroupMask);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the different information of the group to prepare a new frame\r\n     * @internal\r\n     */\r\n    public reset(): void {\r\n        if (this.maintainStateBetweenFrames) {\r\n            return;\r\n        }\r\n\r\n        for (let index = RenderingManager.MIN_RENDERINGGROUPS; index < RenderingManager.MAX_RENDERINGGROUPS; index++) {\r\n            const renderingGroup = this._renderingGroups[index];\r\n            if (renderingGroup) {\r\n                renderingGroup.prepare();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Resets the sprites information of the group to prepare a new frame\r\n     * @internal\r\n     */\r\n    public resetSprites(): void {\r\n        if (this.maintainStateBetweenFrames) {\r\n            return;\r\n        }\r\n\r\n        for (let index = RenderingManager.MIN_RENDERINGGROUPS; index < RenderingManager.MAX_RENDERINGGROUPS; index++) {\r\n            const renderingGroup = this._renderingGroups[index];\r\n            if (renderingGroup) {\r\n                renderingGroup.prepareSprites();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dispose and release the group and its associated resources.\r\n     * @internal\r\n     */\r\n    public dispose(): void {\r\n        this.freeRenderingGroups();\r\n        this._renderingGroups.length = 0;\r\n        this._renderingGroupInfo = null;\r\n    }\r\n\r\n    /**\r\n     * Clear the info related to rendering groups preventing retention points during dispose.\r\n     */\r\n    public freeRenderingGroups(): void {\r\n        for (let index = RenderingManager.MIN_RENDERINGGROUPS; index < RenderingManager.MAX_RENDERINGGROUPS; index++) {\r\n            const renderingGroup = this._renderingGroups[index];\r\n            if (renderingGroup) {\r\n                renderingGroup.dispose();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _prepareRenderingGroup(renderingGroupId: number): void {\r\n        if (this._renderingGroups[renderingGroupId] === undefined) {\r\n            this._renderingGroups[renderingGroupId] = new RenderingGroup(\r\n                renderingGroupId,\r\n                this._scene,\r\n                this._customOpaqueSortCompareFn[renderingGroupId],\r\n                this._customAlphaTestSortCompareFn[renderingGroupId],\r\n                this._customTransparentSortCompareFn[renderingGroupId]\r\n            );\r\n            this._renderingGroups[renderingGroupId].disableDepthPrePass = this._disableDepthPrePass;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a sprite manager to the rendering manager in order to render it this frame.\r\n     * @param spriteManager Define the sprite manager to render\r\n     */\r\n    public dispatchSprites(spriteManager: ISpriteManager) {\r\n        if (this.maintainStateBetweenFrames && spriteManager._wasDispatched) {\r\n            return;\r\n        }\r\n        spriteManager._wasDispatched = true;\r\n        this.getRenderingGroup(spriteManager.renderingGroupId).dispatchSprites(spriteManager);\r\n    }\r\n\r\n    /**\r\n     * Add a particle system to the rendering manager in order to render it this frame.\r\n     * @param particleSystem Define the particle system to render\r\n     */\r\n    public dispatchParticles(particleSystem: IParticleSystem) {\r\n        if (this.maintainStateBetweenFrames && particleSystem._wasDispatched) {\r\n            return;\r\n        }\r\n        particleSystem._wasDispatched = true;\r\n        this.getRenderingGroup(particleSystem.renderingGroupId).dispatchParticles(particleSystem);\r\n    }\r\n\r\n    /**\r\n     * Add a submesh to the manager in order to render it this frame\r\n     * @param subMesh The submesh to dispatch\r\n     * @param mesh Optional reference to the submeshes's mesh. Provide if you have an exiting reference to improve performance.\r\n     * @param material Optional reference to the submeshes's material. Provide if you have an exiting reference to improve performance.\r\n     */\r\n    public dispatch(subMesh: SubMesh, mesh?: AbstractMesh, material?: Nullable<Material>): void {\r\n        if (mesh === undefined) {\r\n            mesh = subMesh.getMesh();\r\n        }\r\n        if (this.maintainStateBetweenFrames && subMesh._wasDispatched) {\r\n            return;\r\n        }\r\n        subMesh._wasDispatched = true;\r\n        this.getRenderingGroup(mesh.renderingGroupId).dispatch(subMesh, mesh, material);\r\n    }\r\n\r\n    /**\r\n     * Overrides the default sort function applied in the rendering group to prepare the meshes.\r\n     * This allowed control for front to back rendering or reversely depending of the special needs.\r\n     *\r\n     * @param renderingGroupId The rendering group id corresponding to its index\r\n     * @param opaqueSortCompareFn The opaque queue comparison function use to sort.\r\n     * @param alphaTestSortCompareFn The alpha test queue comparison function use to sort.\r\n     * @param transparentSortCompareFn The transparent queue comparison function use to sort.\r\n     */\r\n    public setRenderingOrder(\r\n        renderingGroupId: number,\r\n        opaqueSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null,\r\n        alphaTestSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null,\r\n        transparentSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null\r\n    ) {\r\n        this._customOpaqueSortCompareFn[renderingGroupId] = opaqueSortCompareFn;\r\n        this._customAlphaTestSortCompareFn[renderingGroupId] = alphaTestSortCompareFn;\r\n        this._customTransparentSortCompareFn[renderingGroupId] = transparentSortCompareFn;\r\n\r\n        if (this._renderingGroups[renderingGroupId]) {\r\n            const group = this._renderingGroups[renderingGroupId];\r\n            group.opaqueSortCompareFn = this._customOpaqueSortCompareFn[renderingGroupId];\r\n            group.alphaTestSortCompareFn = this._customAlphaTestSortCompareFn[renderingGroupId];\r\n            group.transparentSortCompareFn = this._customTransparentSortCompareFn[renderingGroupId];\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Specifies whether or not the stencil and depth buffer are cleared between two rendering groups.\r\n     *\r\n     * @param renderingGroupId The rendering group id corresponding to its index\r\n     * @param autoClearDepthStencil Automatically clears depth and stencil between groups if true.\r\n     * @param depth Automatically clears depth between groups if true and autoClear is true.\r\n     * @param stencil Automatically clears stencil between groups if true and autoClear is true.\r\n     */\r\n    public setRenderingAutoClearDepthStencil(renderingGroupId: number, autoClearDepthStencil: boolean, depth = true, stencil = true): void {\r\n        this._autoClearDepthStencil[renderingGroupId] = {\r\n            autoClear: autoClearDepthStencil,\r\n            depth: depth,\r\n            stencil: stencil,\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Gets the current auto clear configuration for one rendering group of the rendering\r\n     * manager.\r\n     * @param index the rendering group index to get the information for\r\n     * @returns The auto clear setup for the requested rendering group\r\n     */\r\n    public getAutoClearDepthStencilSetup(index: number): IRenderingManagerAutoClearSetup {\r\n        return this._autoClearDepthStencil[index];\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 659, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/objectRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/objectRenderer.ts"],"sourcesContent":["import type {\r\n    Nullable,\r\n    Immutable,\r\n    Camera,\r\n    Scene,\r\n    AbstractMesh,\r\n    SubMesh,\r\n    Material,\r\n    IParticleSystem,\r\n    InstancedMesh,\r\n    BoundingBox,\r\n    BoundingBoxRenderer,\r\n    UniformBuffer,\r\n    AbstractEngine,\r\n    ClusteredLightContainer,\r\n} from \"core/index\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport { RenderingManager } from \"../Rendering/renderingManager\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport { _ObserveArray } from \"../Misc/arrayTools\";\r\nimport { _RetryWithInterval } from \"../Misc/timingTools\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport { SmartArray } from \"../Misc/smartArray\";\r\nimport { LightConstants } from \"../Lights/lightConstants\";\r\n\r\n/**\r\n * Defines the options of the object renderer\r\n */\r\n// eslint-disable-next-line @typescript-eslint/naming-convention\r\nexport interface ObjectRendererOptions {\r\n    /** The number of passes the renderer will support (1 by default) */\r\n    numPasses?: number;\r\n\r\n    /** True (default) to not change the aspect ratio of the scene in the RTT */\r\n    doNotChangeAspectRatio?: boolean;\r\n\r\n    /** True to enable clustered lights (default: false) */\r\n    enableClusteredLights?: boolean;\r\n}\r\n\r\n/**\r\n * A class that renders objects to the currently bound render target.\r\n * This class only renders objects, and is not concerned with the output texture or post-processing.\r\n */\r\nexport class ObjectRenderer {\r\n    /**\r\n     * Objects will only be rendered once which can be useful to improve performance if everything in your render is static for instance.\r\n     */\r\n    public static readonly REFRESHRATE_RENDER_ONCE: number = 0;\r\n    /**\r\n     * Objects will be rendered every frame and is recommended for dynamic contents.\r\n     */\r\n    public static readonly REFRESHRATE_RENDER_ONEVERYFRAME: number = 1;\r\n    /**\r\n     * Objects will be rendered every 2 frames which could be enough if your dynamic objects are not\r\n     * the central point of your effect and can save a lot of performances.\r\n     */\r\n    public static readonly REFRESHRATE_RENDER_ONEVERYTWOFRAMES: number = 2;\r\n\r\n    /**\r\n     * Use this predicate to dynamically define the list of mesh you want to render.\r\n     * If set, the renderList property will be overwritten.\r\n     */\r\n    public renderListPredicate: (AbstractMesh: AbstractMesh) => boolean;\r\n\r\n    private _renderList: Nullable<Array<AbstractMesh>>;\r\n    private _unObserveRenderList: Nullable<() => void> = null;\r\n\r\n    /**\r\n     * Use this list to define the list of mesh you want to render.\r\n     */\r\n    public get renderList(): Nullable<Array<AbstractMesh>> {\r\n        return this._renderList;\r\n    }\r\n\r\n    public set renderList(value: Nullable<Array<AbstractMesh>>) {\r\n        if (this._renderList === value) {\r\n            return;\r\n        }\r\n        if (this._unObserveRenderList) {\r\n            this._unObserveRenderList();\r\n            this._unObserveRenderList = null;\r\n        }\r\n\r\n        if (value) {\r\n            this._unObserveRenderList = _ObserveArray(value, this._renderListHasChanged);\r\n        }\r\n\r\n        this._renderList = value;\r\n    }\r\n\r\n    private _renderListHasChanged = (_functionName: string, previousLength: number) => {\r\n        const newLength = this._renderList ? this._renderList.length : 0;\r\n        if ((previousLength === 0 && newLength > 0) || newLength === 0) {\r\n            for (const mesh of this._scene.meshes) {\r\n                mesh._markSubMeshesAsLightDirty();\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Define the list of particle systems to render. If not provided, will render all the particle systems of the scene.\r\n     * Note that the particle systems are rendered only if renderParticles is set to true.\r\n     */\r\n    public particleSystemList: Nullable<Array<IParticleSystem>> = null;\r\n\r\n    /**\r\n     * Use this function to overload the renderList array at rendering time.\r\n     * Return null to render with the current renderList, else return the list of meshes to use for rendering.\r\n     * For 2DArray, layerOrFace is the index of the layer that is going to be rendered, else it is the faceIndex of\r\n     * the cube (if the RTT is a cube, else layerOrFace=0).\r\n     * The renderList passed to the function is the current render list (the one that will be used if the function returns null).\r\n     * The length of this list is passed through renderListLength: don't use renderList.length directly because the array can\r\n     * hold dummy elements!\r\n     */\r\n    public getCustomRenderList: Nullable<(layerOrFace: number, renderList: Nullable<Immutable<Array<AbstractMesh>>>, renderListLength: number) => Nullable<Array<AbstractMesh>>> =\r\n        null;\r\n\r\n    /**\r\n     * Define if particles should be rendered.\r\n     */\r\n    public renderParticles = true;\r\n\r\n    /**\r\n     * Define if sprites should be rendered.\r\n     */\r\n    public renderSprites = false;\r\n\r\n    /**\r\n     * Force checking the layerMask property even if a custom list of meshes is provided (ie. if renderList is not undefined)\r\n     */\r\n    public forceLayerMaskCheck = false;\r\n\r\n    /**\r\n     * Enables the rendering of bounding boxes for meshes (still subject to Mesh.showBoundingBox or scene.forceShowBoundingBoxes). Default is false.\r\n     */\r\n    public enableBoundingBoxRendering = false;\r\n\r\n    /**\r\n     * Enables the rendering of outline/overlay for meshes (still subject to Mesh.renderOutline/Mesh.renderOverlay). Default is true.\r\n     */\r\n    public enableOutlineRendering = true;\r\n\r\n    /**\r\n     * Define the camera used to render the objects.\r\n     */\r\n    public activeCamera: Nullable<Camera>;\r\n\r\n    /**\r\n     * Define the camera used to calculate the LOD of the objects.\r\n     * If not defined, activeCamera will be used. If not defined nor activeCamera, scene's active camera will be used.\r\n     */\r\n    public cameraForLOD: Nullable<Camera>;\r\n\r\n    private _disableImageProcessing = false;\r\n    /**\r\n     * If true, the object renderer will render all objects without any image processing applied.\r\n     * If false (default value), the renderer will use the current setting of the scene's image processing configuration.\r\n     */\r\n    public get disableImageProcessing() {\r\n        return this._disableImageProcessing;\r\n    }\r\n\r\n    public set disableImageProcessing(value: boolean) {\r\n        if (value === this._disableImageProcessing) {\r\n            return;\r\n        }\r\n\r\n        this._disableImageProcessing = value;\r\n        this._scene.markAllMaterialsAsDirty(Constants.MATERIAL_ImageProcessingDirtyFlag);\r\n    }\r\n\r\n    /**\r\n     * If true, the object renderer will not set the view/projection/transformation matrices for the active camera (default: false).\r\n     * By default, the view/projection/transformation matrices are set from the active camera (either ObjectRenderer.activeCamera or scene.activeCamera).\r\n     * Sets this property to true if you want to define your own transformation matrices (use the onInitRenderingObservable observable\r\n     * to set your own matrices, to be sure they will be correctly taken into account)\r\n     */\r\n    public dontSetTransformationMatrix = false;\r\n\r\n    private _disableDepthPrePass = false;\r\n    /**\r\n     * Specifies to disable depth pre-pass if true (default: false)\r\n     */\r\n    public get disableDepthPrePass() {\r\n        return this._disableDepthPrePass;\r\n    }\r\n\r\n    public set disableDepthPrePass(value: boolean) {\r\n        this._disableDepthPrePass = value;\r\n        this._renderingManager.disableDepthPrePass = value;\r\n    }\r\n\r\n    /**\r\n     * Override the mesh isReady function with your own one.\r\n     */\r\n    public customIsReadyFunction: (mesh: AbstractMesh, refreshRate: number, preWarm?: boolean) => boolean;\r\n\r\n    /**\r\n     * Override the render function with your own one.\r\n     */\r\n    public customRenderFunction: (\r\n        opaqueSubMeshes: SmartArray<SubMesh>,\r\n        alphaTestSubMeshes: SmartArray<SubMesh>,\r\n        transparentSubMeshes: SmartArray<SubMesh>,\r\n        depthOnlySubMeshes: SmartArray<SubMesh>,\r\n        beforeTransparents?: () => void\r\n    ) => void;\r\n\r\n    /**\r\n     * An event triggered before rendering the objects\r\n     */\r\n    public readonly onBeforeRenderObservable = new Observable<number>();\r\n\r\n    /**\r\n     * An event triggered after rendering the objects\r\n     */\r\n    public readonly onAfterRenderObservable = new Observable<number>();\r\n\r\n    /**\r\n     * An event triggered before the rendering group is processed\r\n     */\r\n    public readonly onBeforeRenderingManagerRenderObservable = new Observable<number>();\r\n\r\n    /**\r\n     * An event triggered after the rendering group is processed\r\n     */\r\n    public readonly onAfterRenderingManagerRenderObservable = new Observable<number>();\r\n\r\n    /**\r\n     * An event triggered when initRender is called\r\n     */\r\n    public readonly onInitRenderingObservable = new Observable<ObjectRenderer>();\r\n\r\n    /**\r\n     * An event triggered when finishRender is called\r\n     */\r\n    public readonly onFinishRenderingObservable = new Observable<ObjectRenderer>();\r\n\r\n    /**\r\n     * An event triggered when fast path rendering is used\r\n     */\r\n    public readonly onFastPathRenderObservable = new Observable<number>();\r\n\r\n    protected _engine: AbstractEngine;\r\n    protected _scene: Scene;\r\n    protected _renderingManager: RenderingManager;\r\n    /** @internal */\r\n    public _waitingRenderList?: string[];\r\n    protected _currentRefreshId = -1;\r\n    protected _refreshRate = 1;\r\n    protected _currentApplyByPostProcessSetting = false;\r\n    protected _activeMeshes = new SmartArray<AbstractMesh>(256);\r\n    protected _activeBoundingBoxes = new SmartArray<BoundingBox>(32);\r\n    protected _useUBO: boolean;\r\n    protected _sceneUBOs: UniformBuffer[]; // It's an array because we may need multiple ubos per frame if the object renderer is used several times in a frame (e.g. for rigged cameras)\r\n    protected _currentSceneUBO: UniformBuffer;\r\n    protected _currentFrameId = -1;\r\n    protected _currentSceneUBOIndex = 0;\r\n\r\n    /**\r\n     * The options used by the object renderer\r\n     */\r\n    public options: Required<ObjectRendererOptions>;\r\n\r\n    private _name: string;\r\n    /**\r\n     * Friendly name of the object renderer\r\n     */\r\n    public get name() {\r\n        return this._name;\r\n    }\r\n\r\n    public set name(value: string) {\r\n        if (this._name === value) {\r\n            return;\r\n        }\r\n\r\n        this._name = value;\r\n        if (this._sceneUBOs) {\r\n            for (let i = 0; i < this._sceneUBOs.length; ++i) {\r\n                this._sceneUBOs[i].name = `Scene ubo #${i} for ${this.name}`;\r\n            }\r\n        }\r\n\r\n        if (!this._scene) {\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < this._renderPassIds.length; ++i) {\r\n            const renderPassId = this._renderPassIds[i];\r\n            this._engine._renderPassNames[renderPassId] = `${this._name}#${i}`;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Current render pass id. Note it can change over the rendering as there's a separate id for each face of a cube / each layer of an array layer!\r\n     */\r\n    public renderPassId: number;\r\n    private readonly _renderPassIds: number[];\r\n    /**\r\n     * Gets the render pass ids used by the object renderer.\r\n     */\r\n    public get renderPassIds(): readonly number[] {\r\n        return this._renderPassIds;\r\n    }\r\n\r\n    /**\r\n     * Gets the current value of the refreshId counter\r\n     */\r\n    public get currentRefreshId() {\r\n        return this._currentRefreshId;\r\n    }\r\n\r\n    /**\r\n     * Gets the array of active meshes\r\n     * @returns an array of AbstractMesh\r\n     */\r\n    public getActiveMeshes(): SmartArray<AbstractMesh> {\r\n        return this._activeMeshes;\r\n    }\r\n\r\n    /**\r\n     * Sets a specific material to be used to render a mesh/a list of meshes with this object renderer\r\n     * @param mesh mesh or array of meshes\r\n     * @param material material or array of materials to use for this render pass. If undefined is passed, no specific material will be used but the regular material instead (mesh.material). It's possible to provide an array of materials to use a different material for each rendering pass.\r\n     */\r\n    public setMaterialForRendering(mesh: AbstractMesh | AbstractMesh[], material?: Material | Material[]): void {\r\n        let meshes;\r\n        if (!Array.isArray(mesh)) {\r\n            meshes = [mesh];\r\n        } else {\r\n            meshes = mesh;\r\n        }\r\n        for (let j = 0; j < meshes.length; ++j) {\r\n            for (let i = 0; i < this.options.numPasses; ++i) {\r\n                let mesh = meshes[j];\r\n                if (meshes[j].isAnInstance) {\r\n                    mesh = (meshes[j] as InstancedMesh).sourceMesh;\r\n                }\r\n                mesh.setMaterialForRenderPass(this._renderPassIds[i], material !== undefined ? (Array.isArray(material) ? material[i] : material) : undefined);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _isFrozen = false;\r\n\r\n    /** @internal */\r\n    public _freezeActiveMeshesCancel: Nullable<() => void> = null;\r\n\r\n    /** @internal */\r\n    public _freezeActiveMeshes(freezeMeshes: boolean) {\r\n        this._freezeActiveMeshesCancel = _RetryWithInterval(\r\n            () => {\r\n                return this._checkReadiness();\r\n            },\r\n            () => {\r\n                this._freezeActiveMeshesCancel = null;\r\n                if (freezeMeshes) {\r\n                    for (let index = 0; index < this._activeMeshes.length; index++) {\r\n                        this._activeMeshes.data[index]._freeze();\r\n                    }\r\n                }\r\n                this._prepareRenderingManager(0, true);\r\n                this._isFrozen = true;\r\n            },\r\n            (err, isTimeout) => {\r\n                this._freezeActiveMeshesCancel = null;\r\n                if (!isTimeout) {\r\n                    Logger.Error(\"ObjectRenderer: An unexpected error occurred while waiting for the renderer to be ready.\");\r\n                    if (err) {\r\n                        Logger.Error(err);\r\n                        if (err.stack) {\r\n                            Logger.Error(err.stack);\r\n                        }\r\n                    }\r\n                } else {\r\n                    Logger.Error(`ObjectRenderer: Timeout while waiting for the renderer to be ready.`);\r\n                    if (err) {\r\n                        Logger.Error(err);\r\n                    }\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /** @internal */\r\n    public _unfreezeActiveMeshes() {\r\n        this._freezeActiveMeshesCancel?.();\r\n        this._freezeActiveMeshesCancel = null;\r\n        for (let index = 0; index < this._activeMeshes.length; index++) {\r\n            this._activeMeshes.data[index]._unFreeze();\r\n        }\r\n        this._isFrozen = false;\r\n    }\r\n\r\n    /**\r\n     * Instantiates an object renderer.\r\n     * @param name The friendly name of the object renderer\r\n     * @param scene The scene the renderer belongs to\r\n     * @param options The options used to create the renderer (optional)\r\n     */\r\n    constructor(name: string, scene: Scene, options?: ObjectRendererOptions) {\r\n        this.name = name;\r\n        this._scene = scene;\r\n        this._engine = this._scene.getEngine();\r\n        this._useUBO = this._engine.supportsUniformBuffers;\r\n        if (this._useUBO) {\r\n            this._sceneUBOs = [];\r\n            this._createSceneUBO();\r\n        }\r\n\r\n        this.renderList = [] as AbstractMesh[];\r\n        this._renderPassIds = [];\r\n\r\n        this.options = {\r\n            numPasses: 1,\r\n            doNotChangeAspectRatio: true,\r\n            enableClusteredLights: false,\r\n            ...options,\r\n        };\r\n\r\n        this._createRenderPassId();\r\n\r\n        this.renderPassId = this._renderPassIds[0];\r\n\r\n        // Rendering groups\r\n        this._renderingManager = new RenderingManager(scene);\r\n        this._renderingManager._useSceneAutoClearSetup = true;\r\n\r\n        if (this.options.enableClusteredLights) {\r\n            this.onInitRenderingObservable.add(() => {\r\n                for (const light of this._scene.lights) {\r\n                    if (light.getTypeID() === LightConstants.LIGHTTYPEID_CLUSTERED_CONTAINER && (light as ClusteredLightContainer).isSupported) {\r\n                        (light as ClusteredLightContainer)._updateBatches(this.activeCamera).render();\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        this._scene.addObjectRenderer(this);\r\n    }\r\n\r\n    private _releaseRenderPassId(): void {\r\n        for (let i = 0; i < this.options.numPasses; ++i) {\r\n            this._engine.releaseRenderPassId(this._renderPassIds[i]);\r\n        }\r\n        this._renderPassIds.length = 0;\r\n    }\r\n\r\n    private _createRenderPassId(): void {\r\n        this._releaseRenderPassId();\r\n\r\n        for (let i = 0; i < this.options.numPasses; ++i) {\r\n            this._renderPassIds[i] = this._engine.createRenderPassId(`${this.name}#${i}`);\r\n        }\r\n    }\r\n\r\n    private _createSceneUBO(): void {\r\n        const index = this._sceneUBOs.length;\r\n\r\n        this._sceneUBOs.push(this._scene.createSceneUniformBuffer(`Scene ubo #${index} for ${this.name}`, false));\r\n    }\r\n\r\n    private _getSceneUBO(): UniformBuffer {\r\n        if (this._currentFrameId !== this._engine.frameId) {\r\n            this._currentSceneUBOIndex = 0;\r\n            this._currentFrameId = this._engine.frameId;\r\n        }\r\n\r\n        if (this._currentSceneUBOIndex >= this._sceneUBOs.length) {\r\n            this._createSceneUBO();\r\n        }\r\n\r\n        const ubo = this._sceneUBOs[this._currentSceneUBOIndex++];\r\n        ubo.unbindEffect();\r\n\r\n        return ubo;\r\n    }\r\n\r\n    /**\r\n     * Resets the refresh counter of the renderer and start back from scratch.\r\n     * Could be useful to re-render if it is setup to render only once.\r\n     */\r\n    public resetRefreshCounter(): void {\r\n        this._currentRefreshId = -1;\r\n    }\r\n\r\n    /**\r\n     * Defines the refresh rate of the rendering or the rendering frequency.\r\n     * Use 0 to render just once, 1 to render on every frame, 2 to render every two frames and so on...\r\n     */\r\n    public get refreshRate(): number {\r\n        return this._refreshRate;\r\n    }\r\n    public set refreshRate(value: number) {\r\n        this._refreshRate = value;\r\n        this.resetRefreshCounter();\r\n    }\r\n\r\n    /**\r\n     * Indicates if the renderer should render the current frame.\r\n     * The output is based on the specified refresh rate.\r\n     * @returns true if the renderer should render the current frame\r\n     */\r\n    public shouldRender(): boolean {\r\n        if (this._currentRefreshId === -1) {\r\n            // At least render once\r\n            this._currentRefreshId = 1;\r\n            return true;\r\n        }\r\n\r\n        if (this.refreshRate === this._currentRefreshId) {\r\n            this._currentRefreshId = 1;\r\n            return true;\r\n        }\r\n\r\n        this._currentRefreshId++;\r\n        return false;\r\n    }\r\n\r\n    /**\r\n     * This function will check if the renderer is ready to render (textures are loaded, shaders are compiled)\r\n     * @param viewportWidth defines the width of the viewport\r\n     * @param viewportHeight defines the height of the viewport\r\n     * @returns true if all required resources are ready\r\n     */\r\n    public isReadyForRendering(viewportWidth: number, viewportHeight: number): boolean {\r\n        this.prepareRenderList();\r\n        this.initRender(viewportWidth, viewportHeight);\r\n\r\n        const isReady = this._checkReadiness();\r\n\r\n        this.finishRender();\r\n\r\n        return isReady;\r\n    }\r\n\r\n    /**\r\n     * Makes sure the list of meshes is ready to be rendered\r\n     * You should call this function before \"initRender\", but if you know the render list is ok, you may call \"initRender\" directly\r\n     */\r\n    public prepareRenderList(): void {\r\n        const scene = this._scene;\r\n\r\n        if (this._waitingRenderList) {\r\n            if (!this.renderListPredicate) {\r\n                this.renderList = [];\r\n                for (let index = 0; index < this._waitingRenderList.length; index++) {\r\n                    const id = this._waitingRenderList[index];\r\n                    const mesh = scene.getMeshById(id);\r\n                    if (mesh) {\r\n                        this.renderList.push(mesh);\r\n                    }\r\n                }\r\n            }\r\n            this._waitingRenderList = undefined;\r\n        }\r\n\r\n        // Is predicate defined?\r\n        if (this.renderListPredicate) {\r\n            if (this.renderList) {\r\n                this.renderList.length = 0; // Clear previous renderList\r\n            } else {\r\n                this.renderList = [];\r\n            }\r\n\r\n            const sceneMeshes = this._scene.meshes;\r\n\r\n            for (let index = 0; index < sceneMeshes.length; index++) {\r\n                const mesh = sceneMeshes[index];\r\n                if (this.renderListPredicate(mesh)) {\r\n                    this.renderList.push(mesh);\r\n                }\r\n            }\r\n        }\r\n\r\n        this._currentApplyByPostProcessSetting = this._scene.imageProcessingConfiguration.applyByPostProcess;\r\n        if (this._disableImageProcessing) {\r\n            // we do not use the applyByPostProcess setter to avoid flagging all the materials as \"image processing dirty\"!\r\n            this._scene.imageProcessingConfiguration._applyByPostProcess = this._disableImageProcessing;\r\n        }\r\n    }\r\n\r\n    private _defaultRenderListPrepared: boolean;\r\n    private _currentSceneCamera: Nullable<Camera> = null;\r\n\r\n    /**\r\n     * This method makes sure everything is setup before \"render\" can be called\r\n     * @param viewportWidth Width of the viewport to render to\r\n     * @param viewportHeight Height of the viewport to render to\r\n     */\r\n    public initRender(viewportWidth: number, viewportHeight: number): void {\r\n        const camera: Nullable<Camera> = this.activeCamera ?? this._scene.activeCamera;\r\n\r\n        this._currentSceneCamera = this._scene.activeCamera;\r\n\r\n        if (this._useUBO) {\r\n            this._currentSceneUBO = this._scene.getSceneUniformBuffer();\r\n            this._currentSceneUBO.unbindEffect();\r\n            this._scene.setSceneUniformBuffer(this._getSceneUBO());\r\n        }\r\n\r\n        this.onInitRenderingObservable.notifyObservers(this);\r\n\r\n        if (camera) {\r\n            if (!this.dontSetTransformationMatrix) {\r\n                this._scene.setTransformMatrix(camera.getViewMatrix(), camera.getProjectionMatrix(true));\r\n            }\r\n            this._scene.activeCamera = camera;\r\n            this._engine.setViewport(camera.rigParent ? camera.rigParent.viewport : camera.viewport, viewportWidth, viewportHeight);\r\n        }\r\n\r\n        if (this._useUBO) {\r\n            this._scene.finalizeSceneUbo();\r\n        }\r\n\r\n        this._defaultRenderListPrepared = false;\r\n    }\r\n\r\n    /**\r\n     * This method must be called after the \"render\" call(s), to complete the rendering process.\r\n     */\r\n    public finishRender() {\r\n        const scene = this._scene;\r\n\r\n        if (this._useUBO) {\r\n            this._scene.setSceneUniformBuffer(this._currentSceneUBO);\r\n        }\r\n\r\n        if (this._disableImageProcessing) {\r\n            scene.imageProcessingConfiguration._applyByPostProcess = this._currentApplyByPostProcessSetting;\r\n        }\r\n\r\n        scene.activeCamera = this._currentSceneCamera;\r\n        if (this._currentSceneCamera) {\r\n            if (this.activeCamera && this.activeCamera !== scene.activeCamera) {\r\n                scene.setTransformMatrix(this._currentSceneCamera.getViewMatrix(), this._currentSceneCamera.getProjectionMatrix(true));\r\n            }\r\n            this._engine.setViewport(this._currentSceneCamera.viewport);\r\n        }\r\n\r\n        scene.resetCachedMaterial();\r\n\r\n        this.onFinishRenderingObservable.notifyObservers(this);\r\n    }\r\n\r\n    /**\r\n     * Renders all the objects (meshes, particles systems, sprites) to the currently bound render target texture.\r\n     * @param passIndex defines the pass index to use (default: 0)\r\n     * @param skipOnAfterRenderObservable defines a flag to skip raising the onAfterRenderObservable\r\n     */\r\n    public render(passIndex = 0, skipOnAfterRenderObservable = false): void {\r\n        const currentRenderPassId = this._engine.currentRenderPassId;\r\n\r\n        this._engine.currentRenderPassId = this._renderPassIds[passIndex];\r\n\r\n        this.onBeforeRenderObservable.notifyObservers(passIndex);\r\n\r\n        const fastPath = this._engine.snapshotRendering && this._engine.snapshotRenderingMode === Constants.SNAPSHOTRENDERING_FAST;\r\n\r\n        if (!fastPath) {\r\n            const currentRenderList = this._prepareRenderingManager(passIndex);\r\n\r\n            // The cast to \"any\" is to avoid an error in ES6 in case you don't import outlineRenderer\r\n            const outlineRenderer = (this._scene as any).getOutlineRenderer?.();\r\n            const outlineRendererIsEnabled = outlineRenderer?.enabled;\r\n\r\n            if (outlineRenderer) {\r\n                outlineRenderer.enabled = this.enableOutlineRendering;\r\n            }\r\n\r\n            this.onBeforeRenderingManagerRenderObservable.notifyObservers(passIndex);\r\n\r\n            this._renderingManager.render(this.customRenderFunction, currentRenderList, this.renderParticles, this.renderSprites);\r\n\r\n            this.onAfterRenderingManagerRenderObservable.notifyObservers(passIndex);\r\n\r\n            if (outlineRenderer) {\r\n                outlineRenderer.enabled = outlineRendererIsEnabled;\r\n            }\r\n        } else {\r\n            this.onFastPathRenderObservable.notifyObservers(passIndex);\r\n        }\r\n\r\n        if (!skipOnAfterRenderObservable) {\r\n            this.onAfterRenderObservable.notifyObservers(passIndex);\r\n        }\r\n\r\n        this._engine.currentRenderPassId = currentRenderPassId;\r\n    }\r\n\r\n    /** @internal */\r\n    public _checkReadiness(): boolean {\r\n        const scene = this._scene;\r\n        const currentRenderPassId = this._engine.currentRenderPassId;\r\n\r\n        let returnValue = true;\r\n\r\n        if (!scene.getViewMatrix()) {\r\n            // We probably didn't execute scene.render() yet, so make sure we have a view/projection matrix setup for the scene\r\n            scene.updateTransformMatrix();\r\n        }\r\n\r\n        const numPasses = this.options.numPasses;\r\n        for (let passIndex = 0; passIndex < numPasses && returnValue; passIndex++) {\r\n            let currentRenderList: Nullable<Array<AbstractMesh>> = null;\r\n            const defaultRenderList = this.renderList ? this.renderList : scene.frameGraph ? scene.meshes : scene.getActiveMeshes().data;\r\n            const defaultRenderListLength = this.renderList ? this.renderList.length : scene.frameGraph ? scene.meshes.length : scene.getActiveMeshes().length;\r\n\r\n            this._engine.currentRenderPassId = this._renderPassIds[passIndex];\r\n\r\n            this.onBeforeRenderObservable.notifyObservers(passIndex);\r\n\r\n            if (this.getCustomRenderList) {\r\n                currentRenderList = this.getCustomRenderList(passIndex, defaultRenderList, defaultRenderListLength);\r\n            }\r\n\r\n            if (!currentRenderList) {\r\n                currentRenderList = defaultRenderList;\r\n            }\r\n\r\n            if (!this.options.doNotChangeAspectRatio) {\r\n                scene.updateTransformMatrix(true);\r\n            }\r\n\r\n            for (let i = 0; i < currentRenderList.length && returnValue; ++i) {\r\n                const mesh = currentRenderList[i];\r\n\r\n                if (!mesh.isEnabled() || mesh.isBlocked || !mesh.isVisible || !mesh.subMeshes) {\r\n                    continue;\r\n                }\r\n\r\n                if (this.customIsReadyFunction) {\r\n                    if (!this.customIsReadyFunction(mesh, this.refreshRate, true)) {\r\n                        returnValue = false;\r\n                        continue;\r\n                    }\r\n                } else if (!mesh.isReady(true)) {\r\n                    returnValue = false;\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            this.onAfterRenderObservable.notifyObservers(passIndex);\r\n\r\n            if (numPasses > 1) {\r\n                scene.incrementRenderId();\r\n                scene.resetCachedMaterial();\r\n            }\r\n        }\r\n\r\n        const particleSystems = this.particleSystemList || scene.particleSystems;\r\n        for (const particleSystem of particleSystems) {\r\n            if (!particleSystem.isReady()) {\r\n                returnValue = false;\r\n            }\r\n        }\r\n\r\n        this._engine.currentRenderPassId = currentRenderPassId;\r\n\r\n        return returnValue;\r\n    }\r\n\r\n    private _prepareRenderingManager(passIndex = 0, winterIsComing = false): Array<AbstractMesh> {\r\n        const scene = this._scene;\r\n\r\n        // Get the list of meshes to dispatch to the rendering manager\r\n        let currentRenderList: Nullable<Array<AbstractMesh>> = null;\r\n        let currentRenderListLength = 0;\r\n        let checkLayerMask = false;\r\n\r\n        const defaultRenderList = this.renderList ? this.renderList : scene.frameGraph ? scene.meshes : scene.getActiveMeshes().data;\r\n        const defaultRenderListLength = this.renderList ? this.renderList.length : scene.frameGraph ? scene.meshes.length : scene.getActiveMeshes().length;\r\n\r\n        if (this.getCustomRenderList) {\r\n            currentRenderList = this.getCustomRenderList(passIndex, defaultRenderList, defaultRenderListLength);\r\n        }\r\n\r\n        if (!currentRenderList) {\r\n            // No custom render list provided, we prepare the rendering for the default list, but check\r\n            // first if we did not already performed the preparation (in this frame) before so as to avoid re-doing it several times\r\n            if (this._defaultRenderListPrepared && !winterIsComing) {\r\n                return defaultRenderList;\r\n            }\r\n            this._defaultRenderListPrepared = true;\r\n            currentRenderList = defaultRenderList;\r\n            currentRenderListLength = defaultRenderListLength;\r\n            checkLayerMask = !this.renderList || this.forceLayerMaskCheck;\r\n        } else {\r\n            // Prepare the rendering for the custom render list provided\r\n            currentRenderListLength = currentRenderList.length;\r\n            checkLayerMask = this.forceLayerMaskCheck;\r\n        }\r\n\r\n        const camera = scene.activeCamera; // note that at this point, scene.activeCamera == this.activeCamera if defined, because initRender() has been called before\r\n        const cameraForLOD = this.cameraForLOD ?? camera;\r\n\r\n        // The cast to \"any\" is to avoid an error in ES6 in case you don't import boundingBoxRenderer\r\n        const boundingBoxRenderer = (scene as any).getBoundingBoxRenderer?.() as Nullable<BoundingBoxRenderer>;\r\n\r\n        if (scene._activeMeshesFrozen && this._isFrozen) {\r\n            this._renderingManager.resetSprites();\r\n\r\n            if (this.enableBoundingBoxRendering && boundingBoxRenderer) {\r\n                boundingBoxRenderer.reset();\r\n                for (let i = 0; i < this._activeBoundingBoxes.length; i++) {\r\n                    const boundingBox = this._activeBoundingBoxes.data[i];\r\n                    boundingBoxRenderer.renderList.push(boundingBox);\r\n                }\r\n            }\r\n\r\n            return currentRenderList;\r\n        }\r\n\r\n        this._renderingManager.reset();\r\n        this._activeMeshes.reset();\r\n        this._activeBoundingBoxes.reset();\r\n\r\n        // We do not check option.enableBoundingBoxRendering before resetting the current list of bounding boxes, because:\r\n        // * if bounding box rendering is enabled, we want to start with an empty list and add new bounding boxes to it\r\n        // * if bounding box rendering is disabled, we don't want to render any bounding boxes that may have been generated by previous code\r\n        boundingBoxRenderer && boundingBoxRenderer.reset();\r\n\r\n        const sceneRenderId = scene.getRenderId();\r\n        const currentFrameId = scene.getFrameId();\r\n        for (let meshIndex = 0; meshIndex < currentRenderListLength; meshIndex++) {\r\n            const mesh = currentRenderList[meshIndex];\r\n\r\n            if (mesh && !mesh.isBlocked) {\r\n                if (this.customIsReadyFunction) {\r\n                    if (!this.customIsReadyFunction(mesh, this.refreshRate, false)) {\r\n                        this.resetRefreshCounter();\r\n                        continue;\r\n                    }\r\n                } else if (!mesh.isReady(this.refreshRate === 0)) {\r\n                    this.resetRefreshCounter();\r\n                    continue;\r\n                }\r\n\r\n                let meshToRender: Nullable<AbstractMesh> = null;\r\n\r\n                if (cameraForLOD) {\r\n                    const meshToRenderAndFrameId = mesh._internalAbstractMeshDataInfo._currentLOD.get(cameraForLOD);\r\n                    if (!meshToRenderAndFrameId || meshToRenderAndFrameId[1] !== currentFrameId) {\r\n                        meshToRender = scene.customLODSelector ? scene.customLODSelector(mesh, cameraForLOD) : mesh.getLOD(cameraForLOD);\r\n                        if (!meshToRenderAndFrameId) {\r\n                            mesh._internalAbstractMeshDataInfo._currentLOD.set(cameraForLOD, [meshToRender, currentFrameId]);\r\n                        } else {\r\n                            meshToRenderAndFrameId[0] = meshToRender;\r\n                            meshToRenderAndFrameId[1] = currentFrameId;\r\n                        }\r\n                    } else {\r\n                        meshToRender = meshToRenderAndFrameId[0];\r\n                    }\r\n                } else {\r\n                    meshToRender = mesh;\r\n                }\r\n\r\n                if (!meshToRender) {\r\n                    continue;\r\n                }\r\n\r\n                if (meshToRender !== mesh && meshToRender.billboardMode !== 0) {\r\n                    meshToRender.computeWorldMatrix(); // Compute world matrix if LOD is billboard\r\n                }\r\n\r\n                meshToRender._preActivateForIntermediateRendering(sceneRenderId);\r\n\r\n                let isMasked;\r\n                if (checkLayerMask && camera) {\r\n                    isMasked = (mesh.layerMask & camera.layerMask) === 0;\r\n                } else {\r\n                    isMasked = false;\r\n                }\r\n\r\n                if (mesh.isEnabled() && mesh.isVisible && mesh.subMeshes && !isMasked) {\r\n                    this._activeMeshes.push(mesh);\r\n                    meshToRender._internalAbstractMeshDataInfo._wasActiveLastFrame = true;\r\n\r\n                    if (meshToRender !== mesh) {\r\n                        meshToRender._activate(sceneRenderId, true);\r\n                    }\r\n\r\n                    this.enableBoundingBoxRendering && boundingBoxRenderer && boundingBoxRenderer._preActiveMesh(mesh);\r\n\r\n                    if (mesh._activate(sceneRenderId, true) && mesh.subMeshes.length) {\r\n                        if (!mesh.isAnInstance) {\r\n                            meshToRender._internalAbstractMeshDataInfo._onlyForInstancesIntermediate = false;\r\n                        } else {\r\n                            if (mesh._internalAbstractMeshDataInfo._actAsRegularMesh) {\r\n                                meshToRender = mesh;\r\n                            }\r\n                        }\r\n                        meshToRender._internalAbstractMeshDataInfo._isActiveIntermediate = true;\r\n\r\n                        scene._prepareSkeleton(meshToRender);\r\n\r\n                        for (let subIndex = 0; subIndex < meshToRender.subMeshes.length; subIndex++) {\r\n                            const subMesh = meshToRender.subMeshes[subIndex];\r\n                            this.enableBoundingBoxRendering && boundingBoxRenderer && boundingBoxRenderer._evaluateSubMesh(mesh, subMesh);\r\n                            this._renderingManager.dispatch(subMesh, meshToRender);\r\n                        }\r\n                    }\r\n\r\n                    mesh._postActivate();\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this.enableBoundingBoxRendering && boundingBoxRenderer && winterIsComing) {\r\n            for (let i = 0; i < boundingBoxRenderer.renderList.length; i++) {\r\n                const boundingBox = boundingBoxRenderer.renderList.data[i];\r\n                this._activeBoundingBoxes.push(boundingBox);\r\n            }\r\n        }\r\n\r\n        if (this._scene.particlesEnabled) {\r\n            this._scene.onBeforeParticlesRenderingObservable.notifyObservers(this._scene);\r\n            const particleSystems = this.particleSystemList || scene.particleSystems;\r\n            for (let particleIndex = 0; particleIndex < particleSystems.length; particleIndex++) {\r\n                const particleSystem = particleSystems[particleIndex];\r\n\r\n                const emitter: any = particleSystem.emitter;\r\n\r\n                if (!particleSystem.isStarted() || !emitter || (emitter.position && !emitter.isEnabled())) {\r\n                    continue;\r\n                }\r\n\r\n                this._renderingManager.dispatchParticles(particleSystem);\r\n            }\r\n            this._scene.onAfterParticlesRenderingObservable.notifyObservers(this._scene);\r\n        }\r\n\r\n        return currentRenderList;\r\n    }\r\n\r\n    /**\r\n     * Gets the rendering manager\r\n     */\r\n    public get renderingManager(): RenderingManager {\r\n        return this._renderingManager;\r\n    }\r\n\r\n    /**\r\n     * Overrides the default sort function applied in the rendering group to prepare the meshes.\r\n     * This allowed control for front to back rendering or reversely depending of the special needs.\r\n     *\r\n     * @param renderingGroupId The rendering group id corresponding to its index\r\n     * @param opaqueSortCompareFn The opaque queue comparison function use to sort.\r\n     * @param alphaTestSortCompareFn The alpha test queue comparison function use to sort.\r\n     * @param transparentSortCompareFn The transparent queue comparison function use to sort.\r\n     */\r\n    public setRenderingOrder(\r\n        renderingGroupId: number,\r\n        opaqueSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null,\r\n        alphaTestSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null,\r\n        transparentSortCompareFn: Nullable<(a: SubMesh, b: SubMesh) => number> = null\r\n    ): void {\r\n        this._renderingManager.setRenderingOrder(renderingGroupId, opaqueSortCompareFn, alphaTestSortCompareFn, transparentSortCompareFn);\r\n    }\r\n\r\n    /**\r\n     * Specifies whether or not the stencil and depth buffer are cleared between two rendering groups.\r\n     *\r\n     * @param renderingGroupId The rendering group id corresponding to its index\r\n     * @param autoClearDepthStencil Automatically clears depth and stencil between groups if true.\r\n     * @param depth Automatically clears depth between groups if true and autoClear is true.\r\n     * @param stencil Automatically clears stencil between groups if true and autoClear is true.\r\n     */\r\n    public setRenderingAutoClearDepthStencil(renderingGroupId: number, autoClearDepthStencil: boolean, depth = true, stencil = true): void {\r\n        this._renderingManager.setRenderingAutoClearDepthStencil(renderingGroupId, autoClearDepthStencil, depth, stencil);\r\n        this._renderingManager._useSceneAutoClearSetup = false;\r\n    }\r\n\r\n    /**\r\n     * Clones the renderer.\r\n     * @returns the cloned renderer\r\n     */\r\n    public clone(): ObjectRenderer {\r\n        const newRenderer = new ObjectRenderer(this.name, this._scene, this.options);\r\n\r\n        if (this.renderList) {\r\n            newRenderer.renderList = this.renderList.slice(0);\r\n        }\r\n\r\n        return newRenderer;\r\n    }\r\n\r\n    /**\r\n     * Dispose the renderer and release its associated resources.\r\n     */\r\n    public dispose(): void {\r\n        const renderList = this.renderList ? this.renderList : this._scene.getActiveMeshes().data;\r\n        const renderListLength = this.renderList ? this.renderList.length : this._scene.getActiveMeshes().length;\r\n        for (let i = 0; i < renderListLength; i++) {\r\n            const mesh = renderList[i];\r\n            if (mesh && mesh.getMaterialForRenderPass(this.renderPassId) !== undefined) {\r\n                mesh.setMaterialForRenderPass(this.renderPassId, undefined);\r\n            }\r\n        }\r\n\r\n        this.onInitRenderingObservable.clear();\r\n        this.onFinishRenderingObservable.clear();\r\n        this.onBeforeRenderObservable.clear();\r\n        this.onAfterRenderObservable.clear();\r\n        this.onBeforeRenderingManagerRenderObservable.clear();\r\n        this.onAfterRenderingManagerRenderObservable.clear();\r\n        this.onFastPathRenderObservable.clear();\r\n\r\n        this._releaseRenderPassId();\r\n\r\n        this.renderList = null;\r\n        if (this._sceneUBOs) {\r\n            for (const ubo of this._sceneUBOs) {\r\n                ubo.dispose();\r\n            }\r\n        }\r\n        this._sceneUBOs = undefined as any;\r\n\r\n        this._scene.removeObjectRenderer(this);\r\n    }\r\n\r\n    /** @internal */\r\n    public _rebuild(): void {\r\n        if (this.refreshRate === ObjectRenderer.REFRESHRATE_RENDER_ONCE) {\r\n            this.refreshRate = ObjectRenderer.REFRESHRATE_RENDER_ONCE;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the info related to rendering groups preventing retention point in material dispose.\r\n     */\r\n    public freeRenderingGroups(): void {\r\n        if (this._renderingManager) {\r\n            this._renderingManager.freeRenderingGroups();\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1409, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/depthRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/depthRenderer.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport { Color4 } from \"../Maths/math.color\";\r\nimport type { Mesh } from \"../Meshes/mesh\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport { VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { SmartArray } from \"../Misc/smartArray\";\r\nimport type { Scene } from \"../scene\";\r\nimport { Texture } from \"../Materials/Textures/texture\";\r\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport { Camera } from \"../Cameras/camera\";\r\nimport { Constants } from \"../Engines/constants\";\r\n\r\nimport \"../Shaders/depth.fragment\";\r\nimport \"../Shaders/depth.vertex\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport { AddClipPlaneUniforms, BindClipPlane, PrepareStringDefinesForClipPlanes } from \"../Materials/clipPlaneMaterialHelper\";\r\n\r\nimport type { Material } from \"../Materials/material\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport { BindBonesParameters, BindMorphTargetParameters, PrepareDefinesAndAttributesForMorphTargets, PushAttributesForInstances } from \"../Materials/materialHelper.functions\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { EffectFallbacks } from \"core/Materials/effectFallbacks\";\r\nimport type { IEffectCreationOptions } from \"core/Materials/effect\";\r\n\r\n/**\r\n * This represents a depth renderer in Babylon.\r\n * A depth renderer will render to it's depth map every frame which can be displayed or used in post processing\r\n */\r\nexport class DepthRenderer {\r\n    private _scene: Scene;\r\n    private _depthMap: RenderTargetTexture;\r\n    private readonly _storeNonLinearDepth: boolean;\r\n    private readonly _storeCameraSpaceZ: boolean;\r\n\r\n    /** Shader language used by the material */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this material.\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Force all the depth renderer to compile to glsl even on WebGPU engines.\r\n     * False by default. This is mostly meant for backward compatibility.\r\n     */\r\n    public static ForceGLSL = false;\r\n\r\n    /** Color used to clear the depth texture. Default: (1,0,0,1) */\r\n    public clearColor: Color4;\r\n\r\n    /** Get if the depth renderer is using packed depth or not */\r\n    public readonly isPacked: boolean;\r\n\r\n    private _camera: Nullable<Camera>;\r\n\r\n    /** Enable or disable the depth renderer. When disabled, the depth texture is not updated */\r\n    public enabled = true;\r\n\r\n    /** Force writing the transparent objects into the depth map */\r\n    public forceDepthWriteTransparentMeshes = false;\r\n\r\n    /**\r\n     * Specifies that the depth renderer will only be used within\r\n     * the camera it is created for.\r\n     * This can help forcing its rendering during the camera processing.\r\n     */\r\n    public useOnlyInActiveCamera: boolean = false;\r\n\r\n    /** If true, reverse the culling of materials before writing to the depth texture.\r\n     * So, basically, when \"true\", back facing instead of front facing faces are rasterized into the texture\r\n     */\r\n    public reverseCulling = false;\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public static _SceneComponentInitialization: (scene: Scene) => void = (_) => {\r\n        throw _WarnImport(\"DepthRendererSceneComponent\");\r\n    };\r\n\r\n    /**\r\n     * Sets a specific material to be used to render a mesh/a list of meshes by the depth renderer\r\n     * @param mesh mesh or array of meshes\r\n     * @param material material to use by the depth render when rendering the mesh(es). If undefined is passed, the specific material created by the depth renderer will be used.\r\n     */\r\n    public setMaterialForRendering(mesh: AbstractMesh | AbstractMesh[], material?: Material): void {\r\n        this._depthMap.setMaterialForRendering(mesh, material);\r\n    }\r\n\r\n    /**\r\n     * Instantiates a depth renderer\r\n     * @param scene The scene the renderer belongs to\r\n     * @param type The texture type of the depth map (default: Engine.TEXTURETYPE_FLOAT)\r\n     * @param camera The camera to be used to render the depth map (default: scene's active camera)\r\n     * @param storeNonLinearDepth Defines whether the depth is stored linearly like in Babylon Shadows or directly like glFragCoord.z\r\n     * @param samplingMode The sampling mode to be used with the render target (Linear, Nearest...) (default: TRILINEAR_SAMPLINGMODE)\r\n     * @param storeCameraSpaceZ Defines whether the depth stored is the Z coordinate in camera space. If true, storeNonLinearDepth has no effect. (Default: false)\r\n     * @param name Name of the render target (default: DepthRenderer)\r\n     * @param existingRenderTargetTexture An existing render target texture to use (default: undefined). If not provided, a new render target texture will be created.\r\n     */\r\n    constructor(\r\n        scene: Scene,\r\n        type: number = Constants.TEXTURETYPE_FLOAT,\r\n        camera: Nullable<Camera> = null,\r\n        storeNonLinearDepth = false,\r\n        samplingMode = Texture.TRILINEAR_SAMPLINGMODE,\r\n        storeCameraSpaceZ = false,\r\n        name?: string,\r\n        existingRenderTargetTexture?: RenderTargetTexture\r\n    ) {\r\n        this._scene = scene;\r\n        this._storeNonLinearDepth = storeNonLinearDepth;\r\n        this._storeCameraSpaceZ = storeCameraSpaceZ;\r\n        this.isPacked = type === Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        if (this.isPacked) {\r\n            this.clearColor = new Color4(1.0, 1.0, 1.0, 1.0);\r\n        } else {\r\n            this.clearColor = new Color4(storeCameraSpaceZ ? 0.0 : 1.0, 0.0, 0.0, 1.0);\r\n        }\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this._initShaderSourceAsync();\r\n\r\n        DepthRenderer._SceneComponentInitialization(this._scene);\r\n\r\n        const engine = scene.getEngine();\r\n\r\n        this._camera = camera;\r\n\r\n        if (samplingMode !== Texture.NEAREST_SAMPLINGMODE) {\r\n            if (type === Constants.TEXTURETYPE_FLOAT && !engine._caps.textureFloatLinearFiltering) {\r\n                samplingMode = Texture.NEAREST_SAMPLINGMODE;\r\n            }\r\n            if (type === Constants.TEXTURETYPE_HALF_FLOAT && !engine._caps.textureHalfFloatLinearFiltering) {\r\n                samplingMode = Texture.NEAREST_SAMPLINGMODE;\r\n            }\r\n        }\r\n\r\n        // Render target\r\n        const format = this.isPacked || !engine._features.supportExtendedTextureFormats ? Constants.TEXTUREFORMAT_RGBA : Constants.TEXTUREFORMAT_R;\r\n        this._depthMap =\r\n            existingRenderTargetTexture ??\r\n            new RenderTargetTexture(\r\n                name ?? \"DepthRenderer\",\r\n                { width: engine.getRenderWidth(), height: engine.getRenderHeight() },\r\n                this._scene,\r\n                false,\r\n                true,\r\n                type,\r\n                false,\r\n                samplingMode,\r\n                undefined,\r\n                undefined,\r\n                undefined,\r\n                format\r\n            );\r\n        this._depthMap.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n        this._depthMap.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n        this._depthMap.refreshRate = 1;\r\n        this._depthMap.renderParticles = false;\r\n        this._depthMap.renderList = null;\r\n        this._depthMap.noPrePassRenderer = true;\r\n\r\n        // Camera to get depth map from to support multiple concurrent cameras\r\n        this._depthMap.activeCamera = this._camera;\r\n        this._depthMap.ignoreCameraViewport = true;\r\n        this._depthMap.useCameraPostProcesses = false;\r\n\r\n        // set default depth value to 1.0 (far away)\r\n        this._depthMap.onClearObservable.add((engine) => {\r\n            engine.clear(this.clearColor, true, true, true);\r\n        });\r\n\r\n        this._depthMap.onBeforeBindObservable.add(() => {\r\n            engine._debugPushGroup?.(\"depth renderer\", 1);\r\n        });\r\n\r\n        this._depthMap.onAfterUnbindObservable.add(() => {\r\n            engine._debugPopGroup?.(1);\r\n        });\r\n\r\n        this._depthMap.customIsReadyFunction = (mesh: AbstractMesh, refreshRate: number, preWarm?: boolean) => {\r\n            if ((preWarm || refreshRate === 0) && mesh.subMeshes) {\r\n                for (let i = 0; i < mesh.subMeshes.length; ++i) {\r\n                    const subMesh = mesh.subMeshes[i];\r\n                    const renderingMesh = subMesh.getRenderingMesh();\r\n\r\n                    const batch = renderingMesh._getInstancesRenderList(subMesh._id, !!subMesh.getReplacementMesh());\r\n                    const hardwareInstancedRendering =\r\n                        engine.getCaps().instancedArrays &&\r\n                        ((batch.visibleInstances[subMesh._id] !== null && batch.visibleInstances[subMesh._id] !== undefined) || renderingMesh.hasThinInstances);\r\n\r\n                    if (!this.isReady(subMesh, hardwareInstancedRendering)) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        };\r\n\r\n        // Custom render function\r\n        const renderSubMesh = (subMesh: SubMesh): void => {\r\n            const renderingMesh = subMesh.getRenderingMesh();\r\n            const effectiveMesh = subMesh.getEffectiveMesh();\r\n            const scene = this._scene;\r\n            const engine = scene.getEngine();\r\n            const material = subMesh.getMaterial();\r\n\r\n            effectiveMesh._internalAbstractMeshDataInfo._isActiveIntermediate = false;\r\n\r\n            if (!material || effectiveMesh.infiniteDistance || material.disableDepthWrite || subMesh.verticesCount === 0 || subMesh._renderId === scene.getRenderId()) {\r\n                return;\r\n            }\r\n\r\n            // Culling\r\n            const detNeg = effectiveMesh._getWorldMatrixDeterminant() < 0;\r\n            let sideOrientation = material._getEffectiveOrientation(renderingMesh);\r\n\r\n            if (detNeg) {\r\n                sideOrientation =\r\n                    sideOrientation === Constants.MATERIAL_ClockWiseSideOrientation\r\n                        ? Constants.MATERIAL_CounterClockWiseSideOrientation\r\n                        : Constants.MATERIAL_ClockWiseSideOrientation;\r\n            }\r\n            const reverseSideOrientation = sideOrientation === Constants.MATERIAL_ClockWiseSideOrientation;\r\n\r\n            engine.setState(material.backFaceCulling, 0, false, reverseSideOrientation, this.reverseCulling ? !material.cullBackFaces : material.cullBackFaces);\r\n\r\n            // Managing instances\r\n            const batch = renderingMesh._getInstancesRenderList(subMesh._id, !!subMesh.getReplacementMesh());\r\n\r\n            if (batch.mustReturn) {\r\n                return;\r\n            }\r\n\r\n            const hardwareInstancedRendering =\r\n                engine.getCaps().instancedArrays &&\r\n                ((batch.visibleInstances[subMesh._id] !== null && batch.visibleInstances[subMesh._id] !== undefined) || renderingMesh.hasThinInstances);\r\n\r\n            const camera = this._camera || scene.activeCamera;\r\n            if (this.isReady(subMesh, hardwareInstancedRendering) && camera) {\r\n                subMesh._renderId = scene.getRenderId();\r\n\r\n                const renderingMaterial = effectiveMesh._internalAbstractMeshDataInfo._materialForRenderPass?.[engine.currentRenderPassId];\r\n\r\n                let drawWrapper = subMesh._getDrawWrapper();\r\n                if (!drawWrapper && renderingMaterial) {\r\n                    drawWrapper = renderingMaterial._getDrawWrapper();\r\n                }\r\n                const cameraIsOrtho = camera.mode === Camera.ORTHOGRAPHIC_CAMERA;\r\n\r\n                if (!drawWrapper) {\r\n                    return;\r\n                }\r\n\r\n                const effect = drawWrapper.effect!;\r\n\r\n                engine.enableEffect(drawWrapper);\r\n\r\n                if (!hardwareInstancedRendering) {\r\n                    renderingMesh._bind(subMesh, effect, material.fillMode);\r\n                }\r\n\r\n                if (!renderingMaterial) {\r\n                    effect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n                    effect.setMatrix(\"world\", effectiveMesh.getWorldMatrix());\r\n                    if (this._storeCameraSpaceZ) {\r\n                        effect.setMatrix(\"view\", scene.getViewMatrix());\r\n                    }\r\n                } else {\r\n                    renderingMaterial.bindForSubMesh(effectiveMesh.getWorldMatrix(), effectiveMesh as Mesh, subMesh);\r\n                }\r\n\r\n                let minZ: number, maxZ: number;\r\n\r\n                if (cameraIsOrtho) {\r\n                    minZ = !engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? 0 : 1;\r\n                    maxZ = engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? 0 : 1;\r\n                } else {\r\n                    minZ = engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? camera.minZ : engine.isNDCHalfZRange ? 0 : camera.minZ;\r\n                    maxZ = engine.useReverseDepthBuffer && engine.isNDCHalfZRange ? 0 : camera.maxZ;\r\n                }\r\n\r\n                effect.setFloat2(\"depthValues\", minZ, minZ + maxZ);\r\n\r\n                if (!renderingMaterial) {\r\n                    // Alpha test\r\n                    if (material.needAlphaTestingForMesh(effectiveMesh)) {\r\n                        const alphaTexture = material.getAlphaTestTexture();\r\n\r\n                        if (alphaTexture) {\r\n                            effect.setTexture(\"diffuseSampler\", alphaTexture);\r\n                            effect.setMatrix(\"diffuseMatrix\", alphaTexture.getTextureMatrix());\r\n                        }\r\n                    }\r\n\r\n                    // Bones\r\n                    BindBonesParameters(renderingMesh, effect);\r\n\r\n                    // Clip planes\r\n                    BindClipPlane(effect, material, scene);\r\n\r\n                    // Morph targets\r\n                    BindMorphTargetParameters(renderingMesh, effect);\r\n                    if (renderingMesh.morphTargetManager && renderingMesh.morphTargetManager.isUsingTextureForTargets) {\r\n                        renderingMesh.morphTargetManager._bind(effect);\r\n                    }\r\n\r\n                    // Baked vertex animations\r\n                    const bvaManager = subMesh.getMesh().bakedVertexAnimationManager;\r\n                    if (bvaManager && bvaManager.isEnabled) {\r\n                        bvaManager.bind(effect, hardwareInstancedRendering);\r\n                    }\r\n\r\n                    // Points cloud rendering\r\n                    if (material.pointsCloud) {\r\n                        effect.setFloat(\"pointSize\", material.pointSize);\r\n                    }\r\n                }\r\n\r\n                // Draw\r\n                renderingMesh._processRendering(effectiveMesh, subMesh, effect, material.fillMode, batch, hardwareInstancedRendering, (isInstance, world) =>\r\n                    effect.setMatrix(\"world\", world)\r\n                );\r\n            }\r\n        };\r\n\r\n        this._depthMap.customRenderFunction = (\r\n            opaqueSubMeshes: SmartArray<SubMesh>,\r\n            alphaTestSubMeshes: SmartArray<SubMesh>,\r\n            transparentSubMeshes: SmartArray<SubMesh>,\r\n            depthOnlySubMeshes: SmartArray<SubMesh>\r\n        ): void => {\r\n            let index;\r\n\r\n            if (depthOnlySubMeshes.length) {\r\n                for (index = 0; index < depthOnlySubMeshes.length; index++) {\r\n                    renderSubMesh(depthOnlySubMeshes.data[index]);\r\n                }\r\n            }\r\n\r\n            for (index = 0; index < opaqueSubMeshes.length; index++) {\r\n                renderSubMesh(opaqueSubMeshes.data[index]);\r\n            }\r\n\r\n            for (index = 0; index < alphaTestSubMeshes.length; index++) {\r\n                renderSubMesh(alphaTestSubMeshes.data[index]);\r\n            }\r\n\r\n            if (this.forceDepthWriteTransparentMeshes) {\r\n                for (index = 0; index < transparentSubMeshes.length; index++) {\r\n                    renderSubMesh(transparentSubMeshes.data[index]);\r\n                }\r\n            } else {\r\n                for (index = 0; index < transparentSubMeshes.length; index++) {\r\n                    transparentSubMeshes.data[index].getEffectiveMesh()._internalAbstractMeshDataInfo._isActiveIntermediate = false;\r\n                }\r\n            }\r\n        };\r\n    }\r\n\r\n    private _shadersLoaded = false;\r\n    private async _initShaderSourceAsync(forceGLSL = false) {\r\n        const engine = this._scene.getEngine();\r\n\r\n        if (engine.isWebGPU && !forceGLSL && !DepthRenderer.ForceGLSL) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n\r\n            await Promise.all([import(\"../ShadersWGSL/depth.vertex\"), import(\"../ShadersWGSL/depth.fragment\")]);\r\n        } else {\r\n            await Promise.all([import(\"../Shaders/depth.vertex\"), import(\"../Shaders/depth.fragment\")]);\r\n        }\r\n\r\n        this._shadersLoaded = true;\r\n    }\r\n\r\n    /**\r\n     * Creates the depth rendering effect and checks if the effect is ready.\r\n     * @param subMesh The submesh to be used to render the depth map of\r\n     * @param useInstances If multiple world instances should be used\r\n     * @returns if the depth renderer is ready to render the depth map\r\n     */\r\n    public isReady(subMesh: SubMesh, useInstances: boolean): boolean {\r\n        if (!this._shadersLoaded) {\r\n            return false;\r\n        }\r\n\r\n        const engine = this._scene.getEngine();\r\n        const mesh = subMesh.getMesh();\r\n        const scene = mesh.getScene();\r\n\r\n        const renderingMaterial = mesh._internalAbstractMeshDataInfo._materialForRenderPass?.[engine.currentRenderPassId];\r\n\r\n        if (renderingMaterial) {\r\n            return renderingMaterial.isReadyForSubMesh(mesh, subMesh, useInstances);\r\n        }\r\n\r\n        const material = subMesh.getMaterial();\r\n        if (!material || material.disableDepthWrite) {\r\n            return false;\r\n        }\r\n\r\n        const defines = [];\r\n\r\n        const attribs = [VertexBuffer.PositionKind];\r\n\r\n        let uv1 = false;\r\n        let uv2 = false;\r\n        const color = false;\r\n\r\n        // Alpha test\r\n        if (material.needAlphaTestingForMesh(mesh) && material.getAlphaTestTexture()) {\r\n            defines.push(\"#define ALPHATEST\");\r\n            if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n                defines.push(\"#define UV1\");\r\n                uv1 = true;\r\n            }\r\n            if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind)) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n                defines.push(\"#define UV2\");\r\n                uv2 = true;\r\n            }\r\n        }\r\n\r\n        // Bones\r\n        const fallbacks = new EffectFallbacks();\r\n        if (mesh.useBones && mesh.computeBonesUsingShaders && mesh.skeleton) {\r\n            attribs.push(VertexBuffer.MatricesIndicesKind);\r\n            attribs.push(VertexBuffer.MatricesWeightsKind);\r\n            if (mesh.numBoneInfluencers > 4) {\r\n                attribs.push(VertexBuffer.MatricesIndicesExtraKind);\r\n                attribs.push(VertexBuffer.MatricesWeightsExtraKind);\r\n            }\r\n            defines.push(\"#define NUM_BONE_INFLUENCERS \" + mesh.numBoneInfluencers);\r\n            if (mesh.numBoneInfluencers > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            const skeleton = mesh.skeleton;\r\n            if (skeleton.isUsingTextureForMatrices) {\r\n                defines.push(\"#define BONETEXTURE\");\r\n            } else {\r\n                defines.push(\"#define BonesPerMesh \" + (skeleton.bones.length + 1));\r\n            }\r\n        } else {\r\n            defines.push(\"#define NUM_BONE_INFLUENCERS 0\");\r\n        }\r\n\r\n        // Morph targets\r\n        const numMorphInfluencers = mesh.morphTargetManager\r\n            ? PrepareDefinesAndAttributesForMorphTargets(\r\n                  mesh.morphTargetManager,\r\n                  defines,\r\n                  attribs,\r\n                  mesh,\r\n                  true, // usePositionMorph\r\n                  false, // useNormalMorph\r\n                  false, // useTangentMorph\r\n                  uv1, // useUVMorph\r\n                  uv2, // useUV2Morph\r\n                  color // useColorMorph\r\n              )\r\n            : 0;\r\n\r\n        // Points cloud rendering\r\n        if (material.pointsCloud) {\r\n            defines.push(\"#define POINTSIZE\");\r\n        }\r\n\r\n        // Instances\r\n        if (useInstances) {\r\n            defines.push(\"#define INSTANCES\");\r\n            PushAttributesForInstances(attribs);\r\n            if (subMesh.getRenderingMesh().hasThinInstances) {\r\n                defines.push(\"#define THIN_INSTANCES\");\r\n            }\r\n        }\r\n\r\n        // Baked vertex animations\r\n        const bvaManager = mesh.bakedVertexAnimationManager;\r\n        if (bvaManager && bvaManager.isEnabled) {\r\n            defines.push(\"#define BAKED_VERTEX_ANIMATION_TEXTURE\");\r\n            if (useInstances) {\r\n                attribs.push(\"bakedVertexAnimationSettingsInstanced\");\r\n            }\r\n        }\r\n\r\n        // None linear depth\r\n        if (this._storeNonLinearDepth) {\r\n            defines.push(\"#define NONLINEARDEPTH\");\r\n        }\r\n\r\n        // Store camera space Z coordinate instead of NDC Z\r\n        if (this._storeCameraSpaceZ) {\r\n            defines.push(\"#define STORE_CAMERASPACE_Z\");\r\n        }\r\n\r\n        // Float Mode\r\n        if (this.isPacked) {\r\n            defines.push(\"#define PACKED\");\r\n        }\r\n\r\n        // Clip planes\r\n        PrepareStringDefinesForClipPlanes(material, scene, defines);\r\n\r\n        // Get correct effect\r\n        const drawWrapper = subMesh._getDrawWrapper(undefined, true)!;\r\n        const cachedDefines = drawWrapper.defines;\r\n        const join = defines.join(\"\\n\");\r\n        if (cachedDefines !== join) {\r\n            const uniforms = [\r\n                \"world\",\r\n                \"mBones\",\r\n                \"boneTextureWidth\",\r\n                \"pointSize\",\r\n                \"viewProjection\",\r\n                \"view\",\r\n                \"diffuseMatrix\",\r\n                \"depthValues\",\r\n                \"morphTargetInfluences\",\r\n                \"morphTargetCount\",\r\n                \"morphTargetTextureInfo\",\r\n                \"morphTargetTextureIndices\",\r\n                \"bakedVertexAnimationSettings\",\r\n                \"bakedVertexAnimationTextureSizeInverted\",\r\n                \"bakedVertexAnimationTime\",\r\n                \"bakedVertexAnimationTexture\",\r\n            ];\r\n            const samplers = [\"diffuseSampler\", \"morphTargets\", \"boneSampler\", \"bakedVertexAnimationTexture\"];\r\n\r\n            AddClipPlaneUniforms(uniforms);\r\n\r\n            drawWrapper.setEffect(\r\n                engine.createEffect(\r\n                    \"depth\",\r\n                    <IEffectCreationOptions>{\r\n                        attributes: attribs,\r\n                        uniformsNames: uniforms,\r\n                        uniformBuffersNames: [],\r\n                        samplers: samplers,\r\n                        defines: join,\r\n                        fallbacks: fallbacks,\r\n                        onCompiled: null,\r\n                        onError: null,\r\n                        indexParameters: { maxSimultaneousMorphTargets: numMorphInfluencers },\r\n                        shaderLanguage: this._shaderLanguage,\r\n                    },\r\n                    engine\r\n                ),\r\n                join\r\n            );\r\n        }\r\n\r\n        return drawWrapper.effect!.isReady();\r\n    }\r\n\r\n    /**\r\n     * Gets the texture which the depth map will be written to.\r\n     * @returns The depth map texture\r\n     */\r\n    public getDepthMap(): RenderTargetTexture {\r\n        return this._depthMap;\r\n    }\r\n\r\n    /**\r\n     * Disposes of the depth renderer.\r\n     */\r\n    public dispose(): void {\r\n        const keysToDelete = [];\r\n        for (const key in this._scene._depthRenderer) {\r\n            const depthRenderer = this._scene._depthRenderer[key];\r\n            if (depthRenderer === this) {\r\n                keysToDelete.push(key);\r\n            }\r\n        }\r\n\r\n        if (keysToDelete.length > 0) {\r\n            this._depthMap.dispose();\r\n\r\n            for (const key of keysToDelete) {\r\n                delete this._scene._depthRenderer[key];\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1849, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/utilityLayerRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/utilityLayerRenderer.ts"],"sourcesContent":["import type { IDisposable } from \"../scene\";\r\nimport { Scene } from \"../scene\";\r\nimport type { Nullable } from \"../types\";\r\nimport type { Observer } from \"../Misc/observable\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport type { PointerInfoPre } from \"../Events/pointerEvents\";\r\nimport { PointerInfo, PointerEventTypes } from \"../Events/pointerEvents\";\r\nimport { PickingInfo } from \"../Collisions/pickingInfo\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport { HemisphericLight } from \"../Lights/hemisphericLight\";\r\nimport { Vector3 } from \"../Maths/math.vector\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport { Color3 } from \"../Maths/math.color\";\r\nimport type { IPointerEvent } from \"../Events/deviceInputEvents\";\r\n\r\n/**\r\n * Renders a layer on top of an existing scene\r\n */\r\nexport class UtilityLayerRenderer implements IDisposable {\r\n    private _pointerCaptures: { [pointerId: number]: boolean } = {};\r\n    private _lastPointerEvents: { [pointerId: number]: boolean } = {};\r\n    /** @internal */\r\n    public static _DefaultUtilityLayer: Nullable<UtilityLayerRenderer> = null;\r\n    /** @internal */\r\n    public static _DefaultKeepDepthUtilityLayer: Nullable<UtilityLayerRenderer> = null;\r\n    private _sharedGizmoLight: Nullable<HemisphericLight> = null;\r\n\r\n    private _renderCamera: Nullable<Camera> = null;\r\n\r\n    /**\r\n     * Gets the camera that is used to render the utility layer (when not set, this will be the last active camera)\r\n     * @param getRigParentIfPossible if the current active camera is a rig camera, should its parent camera be returned\r\n     * @returns the camera that is used when rendering the utility layer\r\n     */\r\n    public getRenderCamera(getRigParentIfPossible?: boolean) {\r\n        if (this._renderCamera) {\r\n            return this._renderCamera;\r\n        } else {\r\n            let activeCam: Camera;\r\n            if (this.originalScene.activeCameras && this.originalScene.activeCameras.length > 1) {\r\n                activeCam = this.originalScene.activeCameras[this.originalScene.activeCameras.length - 1];\r\n            } else {\r\n                activeCam = this.originalScene.activeCamera!;\r\n            }\r\n\r\n            if (getRigParentIfPossible && activeCam && activeCam.isRigCamera) {\r\n                return activeCam.rigParent!;\r\n            }\r\n            return activeCam;\r\n        }\r\n    }\r\n    /**\r\n     * Sets the camera that should be used when rendering the utility layer (If set to null the last active camera will be used)\r\n     * @param cam the camera that should be used when rendering the utility layer\r\n     */\r\n    public setRenderCamera(cam: Nullable<Camera>) {\r\n        this._renderCamera = cam;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Light which used by gizmos to get light shading\r\n     */\r\n    public _getSharedGizmoLight(): HemisphericLight {\r\n        if (!this._sharedGizmoLight) {\r\n            this._sharedGizmoLight = new HemisphericLight(\"shared gizmo light\", new Vector3(0, 1, 0), this.utilityLayerScene);\r\n            this._sharedGizmoLight.intensity = 2;\r\n            this._sharedGizmoLight.groundColor = Color3.Gray();\r\n        }\r\n        return this._sharedGizmoLight;\r\n    }\r\n\r\n    /**\r\n     * If the picking should be done on the utility layer prior to the actual scene (Default: true)\r\n     */\r\n    public pickUtilitySceneFirst = true;\r\n    /**\r\n     * A shared utility layer that can be used to overlay objects into a scene (Depth map of the previous scene is cleared before drawing on top of it)\r\n     */\r\n    public static get DefaultUtilityLayer(): UtilityLayerRenderer {\r\n        if (UtilityLayerRenderer._DefaultUtilityLayer == null) {\r\n            return UtilityLayerRenderer._CreateDefaultUtilityLayerFromScene(EngineStore.LastCreatedScene!);\r\n        }\r\n\r\n        return UtilityLayerRenderer._DefaultUtilityLayer;\r\n    }\r\n\r\n    /**\r\n     * Creates an utility layer, and set it as a default utility layer\r\n     * @param scene associated scene\r\n     * @internal\r\n     */\r\n    public static _CreateDefaultUtilityLayerFromScene(scene: Scene): UtilityLayerRenderer {\r\n        UtilityLayerRenderer._DefaultUtilityLayer = new UtilityLayerRenderer(scene);\r\n        UtilityLayerRenderer._DefaultUtilityLayer.originalScene.onDisposeObservable.addOnce(() => {\r\n            UtilityLayerRenderer._DefaultUtilityLayer = null;\r\n        });\r\n\r\n        return UtilityLayerRenderer._DefaultUtilityLayer;\r\n    }\r\n    /**\r\n     * A shared utility layer that can be used to embed objects into a scene (Depth map of the previous scene is not cleared before drawing on top of it)\r\n     */\r\n    public static get DefaultKeepDepthUtilityLayer(): UtilityLayerRenderer {\r\n        if (UtilityLayerRenderer._DefaultKeepDepthUtilityLayer == null) {\r\n            UtilityLayerRenderer._DefaultKeepDepthUtilityLayer = new UtilityLayerRenderer(EngineStore.LastCreatedScene!);\r\n            UtilityLayerRenderer._DefaultKeepDepthUtilityLayer.utilityLayerScene.autoClearDepthAndStencil = false;\r\n            UtilityLayerRenderer._DefaultKeepDepthUtilityLayer.originalScene.onDisposeObservable.addOnce(() => {\r\n                UtilityLayerRenderer._DefaultKeepDepthUtilityLayer = null;\r\n            });\r\n        }\r\n        return UtilityLayerRenderer._DefaultKeepDepthUtilityLayer;\r\n    }\r\n\r\n    /**\r\n     * The scene that is rendered on top of the original scene\r\n     */\r\n    public utilityLayerScene: Scene;\r\n\r\n    /**\r\n     *  If the utility layer should automatically be rendered on top of existing scene\r\n     */\r\n    public shouldRender: boolean = true;\r\n    /**\r\n     * If set to true, only pointer down onPointerObservable events will be blocked when picking is occluded by original scene\r\n     */\r\n    public onlyCheckPointerDownEvents = true;\r\n\r\n    /**\r\n     * If set to false, only pointerUp, pointerDown and pointerMove will be sent to the utilityLayerScene (false by default)\r\n     */\r\n    public processAllEvents = false;\r\n\r\n    /**\r\n     * Set to false to disable picking\r\n     */\r\n    public pickingEnabled = true;\r\n\r\n    /**\r\n     * Observable raised when the pointer moves from the utility layer scene to the main scene\r\n     */\r\n    public onPointerOutObservable = new Observable<number>();\r\n\r\n    /** Gets or sets a predicate that will be used to indicate utility meshes present in the main scene */\r\n    public mainSceneTrackerPredicate: (mesh: Nullable<AbstractMesh>) => boolean;\r\n\r\n    private _afterRenderObserver: Nullable<Observer<Camera>>;\r\n    private _sceneDisposeObserver: Nullable<Observer<Scene>>;\r\n    private _originalPointerObserver: Nullable<Observer<PointerInfoPre>>;\r\n    /**\r\n     * Instantiates a UtilityLayerRenderer\r\n     * @param originalScene the original scene that will be rendered on top of\r\n     * @param handleEvents boolean indicating if the utility layer should handle events\r\n     * @param manualRender boolean indicating if the utility layer should render manually.\r\n     */\r\n    constructor(\r\n        /** the original scene that will be rendered on top of */\r\n        public originalScene: Scene,\r\n        public readonly handleEvents: boolean = true,\r\n        manualRender = false\r\n    ) {\r\n        // Create scene which will be rendered in the foreground and remove it from being referenced by engine to avoid interfering with existing app\r\n        this.utilityLayerScene = new Scene(originalScene.getEngine(), { virtual: true, useFloatingOrigin: originalScene.floatingOriginMode });\r\n        this.utilityLayerScene.useRightHandedSystem = originalScene.useRightHandedSystem;\r\n        this.utilityLayerScene._allowPostProcessClearColor = false;\r\n\r\n        // Deactivate post processes\r\n        this.utilityLayerScene.postProcessesEnabled = false;\r\n\r\n        // Detach controls on utility scene, events will be fired by logic below to handle picking priority\r\n        this.utilityLayerScene.detachControl();\r\n\r\n        if (handleEvents) {\r\n            this._originalPointerObserver = originalScene.onPrePointerObservable.add((prePointerInfo) => {\r\n                if (!this.utilityLayerScene.activeCamera) {\r\n                    return;\r\n                }\r\n                if (!this.pickingEnabled) {\r\n                    return;\r\n                }\r\n\r\n                if (!this.processAllEvents) {\r\n                    if (\r\n                        prePointerInfo.type !== PointerEventTypes.POINTERMOVE &&\r\n                        prePointerInfo.type !== PointerEventTypes.POINTERUP &&\r\n                        prePointerInfo.type !== PointerEventTypes.POINTERDOWN &&\r\n                        prePointerInfo.type !== PointerEventTypes.POINTERDOUBLETAP\r\n                    ) {\r\n                        return;\r\n                    }\r\n                }\r\n                this.utilityLayerScene.pointerX = originalScene.pointerX;\r\n                this.utilityLayerScene.pointerY = originalScene.pointerY;\r\n                const pointerEvent = <IPointerEvent>prePointerInfo.event;\r\n                if (originalScene.isPointerCaptured(pointerEvent.pointerId)) {\r\n                    this._pointerCaptures[pointerEvent.pointerId] = false;\r\n                    return;\r\n                }\r\n\r\n                const getNearPickDataForScene = (scene: Scene) => {\r\n                    let scenePick = null;\r\n\r\n                    if (prePointerInfo.nearInteractionPickingInfo) {\r\n                        if (prePointerInfo.nearInteractionPickingInfo.pickedMesh!.getScene() == scene) {\r\n                            scenePick = prePointerInfo.nearInteractionPickingInfo;\r\n                        } else {\r\n                            scenePick = new PickingInfo();\r\n                        }\r\n                    } else if (scene !== this.utilityLayerScene && prePointerInfo.originalPickingInfo) {\r\n                        scenePick = prePointerInfo.originalPickingInfo;\r\n                    } else {\r\n                        let previousActiveCamera: Nullable<Camera> = null;\r\n                        // If a camera is set for rendering with this layer\r\n                        // it will also be used for the ray computation\r\n                        // To preserve back compat and because scene.pick always use activeCamera\r\n                        // it's substituted temporarily and a new scenePick is forced.\r\n                        // otherwise, the ray with previously active camera is always used.\r\n                        // It's set back to previous activeCamera after operation.\r\n                        if (this._renderCamera) {\r\n                            previousActiveCamera = scene._activeCamera;\r\n                            scene._activeCamera = this._renderCamera;\r\n                            prePointerInfo.ray = null;\r\n                        }\r\n                        scenePick = prePointerInfo.ray ? scene.pickWithRay(prePointerInfo.ray) : scene.pick(originalScene.pointerX, originalScene.pointerY);\r\n                        if (previousActiveCamera) {\r\n                            scene._activeCamera = previousActiveCamera;\r\n                        }\r\n                    }\r\n\r\n                    return scenePick;\r\n                };\r\n\r\n                const utilityScenePick = getNearPickDataForScene(this.utilityLayerScene);\r\n\r\n                if (!prePointerInfo.ray && utilityScenePick) {\r\n                    prePointerInfo.ray = utilityScenePick.ray;\r\n                }\r\n\r\n                if (prePointerInfo.originalPickingInfo?.aimTransform && utilityScenePick) {\r\n                    utilityScenePick.aimTransform = prePointerInfo.originalPickingInfo.aimTransform;\r\n                    utilityScenePick.gripTransform = prePointerInfo.originalPickingInfo.gripTransform;\r\n                }\r\n\r\n                // always fire the prepointer observable\r\n                this.utilityLayerScene.onPrePointerObservable.notifyObservers(prePointerInfo);\r\n\r\n                // allow every non pointer down event to flow to the utility layer\r\n                if (this.onlyCheckPointerDownEvents && prePointerInfo.type != PointerEventTypes.POINTERDOWN) {\r\n                    if (!prePointerInfo.skipOnPointerObservable) {\r\n                        this.utilityLayerScene.onPointerObservable.notifyObservers(\r\n                            new PointerInfo(prePointerInfo.type, prePointerInfo.event, utilityScenePick),\r\n                            prePointerInfo.type\r\n                        );\r\n                    }\r\n                    if (prePointerInfo.type === PointerEventTypes.POINTERUP && this._pointerCaptures[pointerEvent.pointerId]) {\r\n                        this._pointerCaptures[pointerEvent.pointerId] = false;\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                if (this.utilityLayerScene.autoClearDepthAndStencil || this.pickUtilitySceneFirst) {\r\n                    // If this layer is an overlay, check if this layer was hit and if so, skip pointer events for the main scene\r\n                    if (utilityScenePick && utilityScenePick.hit) {\r\n                        if (!prePointerInfo.skipOnPointerObservable) {\r\n                            this.utilityLayerScene.onPointerObservable.notifyObservers(\r\n                                new PointerInfo(prePointerInfo.type, prePointerInfo.event, utilityScenePick),\r\n                                prePointerInfo.type\r\n                            );\r\n                        }\r\n                        prePointerInfo.skipOnPointerObservable = true;\r\n                    }\r\n                } else {\r\n                    const originalScenePick = getNearPickDataForScene(originalScene);\r\n                    const pointerEvent = <IPointerEvent>prePointerInfo.event;\r\n\r\n                    // If the layer can be occluded by the original scene, only fire pointer events to the first layer that hit they ray\r\n                    if (originalScenePick && utilityScenePick) {\r\n                        // No pick in utility scene\r\n                        if (utilityScenePick.distance === 0 && originalScenePick.pickedMesh) {\r\n                            if (this.mainSceneTrackerPredicate && this.mainSceneTrackerPredicate(originalScenePick.pickedMesh)) {\r\n                                // We touched an utility mesh present in the main scene\r\n                                this._notifyObservers(prePointerInfo, originalScenePick, pointerEvent);\r\n                                prePointerInfo.skipOnPointerObservable = true;\r\n                            } else if (prePointerInfo.type === PointerEventTypes.POINTERDOWN) {\r\n                                this._pointerCaptures[pointerEvent.pointerId] = true;\r\n                                this._notifyObservers(prePointerInfo, originalScenePick, pointerEvent);\r\n                            } else if (prePointerInfo.type === PointerEventTypes.POINTERMOVE || prePointerInfo.type === PointerEventTypes.POINTERUP) {\r\n                                if (this._lastPointerEvents[pointerEvent.pointerId]) {\r\n                                    // We need to send a last pointerup to the utilityLayerScene to make sure animations can complete\r\n                                    this.onPointerOutObservable.notifyObservers(pointerEvent.pointerId);\r\n                                    delete this._lastPointerEvents[pointerEvent.pointerId];\r\n                                }\r\n                                this._notifyObservers(prePointerInfo, originalScenePick, pointerEvent);\r\n                            }\r\n                        } else if (!this._pointerCaptures[pointerEvent.pointerId] && (utilityScenePick.distance < originalScenePick.distance || originalScenePick.distance === 0)) {\r\n                            // We pick something in utility scene or the pick in utility is closer than the one in main scene\r\n                            this._notifyObservers(prePointerInfo, utilityScenePick, pointerEvent);\r\n                            // If a previous utility layer set this, do not unset this\r\n                            if (!prePointerInfo.skipOnPointerObservable) {\r\n                                prePointerInfo.skipOnPointerObservable = utilityScenePick.distance > 0;\r\n                            }\r\n                        } else if (!this._pointerCaptures[pointerEvent.pointerId] && utilityScenePick.distance >= originalScenePick.distance) {\r\n                            // We have a pick in both scenes but main is closer than utility\r\n\r\n                            // We touched an utility mesh present in the main scene\r\n                            if (this.mainSceneTrackerPredicate && this.mainSceneTrackerPredicate(originalScenePick.pickedMesh)) {\r\n                                this._notifyObservers(prePointerInfo, originalScenePick, pointerEvent);\r\n                                prePointerInfo.skipOnPointerObservable = true;\r\n                            } else {\r\n                                if (prePointerInfo.type === PointerEventTypes.POINTERMOVE || prePointerInfo.type === PointerEventTypes.POINTERUP) {\r\n                                    if (this._lastPointerEvents[pointerEvent.pointerId]) {\r\n                                        // We need to send a last pointerup to the utilityLayerScene to make sure animations can complete\r\n                                        this.onPointerOutObservable.notifyObservers(pointerEvent.pointerId);\r\n                                        delete this._lastPointerEvents[pointerEvent.pointerId];\r\n                                    }\r\n                                }\r\n                                this._notifyObservers(prePointerInfo, utilityScenePick, pointerEvent);\r\n                            }\r\n                        }\r\n\r\n                        if (prePointerInfo.type === PointerEventTypes.POINTERUP && this._pointerCaptures[pointerEvent.pointerId]) {\r\n                            this._pointerCaptures[pointerEvent.pointerId] = false;\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n\r\n            // As a newly added utility layer will be rendered over the screen last, it's pointer events should be processed first\r\n            if (this._originalPointerObserver) {\r\n                originalScene.onPrePointerObservable.makeObserverTopPriority(this._originalPointerObserver);\r\n            }\r\n        }\r\n\r\n        // Render directly on top of existing scene without clearing\r\n        this.utilityLayerScene.autoClear = false;\r\n\r\n        if (!manualRender) {\r\n            this._afterRenderObserver = this.originalScene.onAfterRenderCameraObservable.add((camera) => {\r\n                // Only render when the render camera finishes rendering\r\n                if (this.shouldRender && camera == this.getRenderCamera()) {\r\n                    this.render();\r\n                }\r\n            });\r\n        }\r\n\r\n        this._sceneDisposeObserver = this.originalScene.onDisposeObservable.add(() => {\r\n            this.dispose();\r\n        });\r\n\r\n        this._updateCamera();\r\n    }\r\n\r\n    private _notifyObservers(prePointerInfo: PointerInfoPre, pickInfo: PickingInfo, pointerEvent: IPointerEvent) {\r\n        if (!prePointerInfo.skipOnPointerObservable) {\r\n            this.utilityLayerScene.onPointerObservable.notifyObservers(new PointerInfo(prePointerInfo.type, prePointerInfo.event, pickInfo), prePointerInfo.type);\r\n            this._lastPointerEvents[pointerEvent.pointerId] = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the utility layers scene on top of the original scene\r\n     */\r\n    public render() {\r\n        this._updateCamera();\r\n        if (this.utilityLayerScene.activeCamera) {\r\n            // Set the camera's scene to utility layers scene\r\n            const oldScene = this.utilityLayerScene.activeCamera.getScene();\r\n            const camera = this.utilityLayerScene.activeCamera;\r\n            camera._scene = this.utilityLayerScene;\r\n            if (camera.leftCamera) {\r\n                camera.leftCamera._scene = this.utilityLayerScene;\r\n            }\r\n            if (camera.rightCamera) {\r\n                camera.rightCamera._scene = this.utilityLayerScene;\r\n            }\r\n\r\n            this.utilityLayerScene.render(false);\r\n\r\n            // Reset camera's scene back to original\r\n            camera._scene = oldScene;\r\n            if (camera.leftCamera) {\r\n                camera.leftCamera._scene = oldScene;\r\n            }\r\n            if (camera.rightCamera) {\r\n                camera.rightCamera._scene = oldScene;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disposes of the renderer\r\n     */\r\n    public dispose() {\r\n        this.onPointerOutObservable.clear();\r\n\r\n        if (this._afterRenderObserver) {\r\n            this.originalScene.onAfterCameraRenderObservable.remove(this._afterRenderObserver);\r\n        }\r\n        if (this._sceneDisposeObserver) {\r\n            this.originalScene.onDisposeObservable.remove(this._sceneDisposeObserver);\r\n        }\r\n        if (this._originalPointerObserver) {\r\n            this.originalScene.onPrePointerObservable.remove(this._originalPointerObserver);\r\n        }\r\n        this.utilityLayerScene.dispose();\r\n    }\r\n\r\n    private _updateCamera() {\r\n        this.utilityLayerScene.cameraToUseForPointers = this.getRenderCamera();\r\n        this.utilityLayerScene.activeCamera = this.getRenderCamera();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2187, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/iblCdfGenerator.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/iblCdfGenerator.ts"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\r\nimport type { AbstractEngine } from \"../Engines/abstractEngine\";\r\n\r\nimport type { Scene } from \"../scene\";\r\nimport { Texture } from \"../Materials/Textures/texture\";\r\nimport type { TextureSize } from \"../Materials/Textures/textureCreationOptions\";\r\nimport { ProceduralTexture } from \"../Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IProceduralTextureCreationOptions } from \"../Materials/Textures/Procedurals/proceduralTexture\";\r\nimport { PostProcess } from \"../PostProcesses/postProcess\";\r\nimport type { PostProcessOptions } from \"../PostProcesses/postProcess\";\r\nimport { Vector3, Vector4 } from \"../Maths/math.vector\";\r\nimport { RawTexture } from \"../Materials/Textures/rawTexture\";\r\nimport type { BaseTexture } from \"../Materials/Textures/baseTexture\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport type { CubeTexture } from \"../Materials/Textures/cubeTexture\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { Engine } from \"../Engines/engine\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport type { Nullable } from \"../types\";\r\nimport { EngineStore } from \"../Engines/engineStore\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport { _RetryWithInterval } from \"../Misc/timingTools\";\r\n\r\n/**\r\n * Build cdf maps to be used for IBL importance sampling.\r\n */\r\nexport class IblCdfGenerator {\r\n    private _scene: Nullable<Scene>;\r\n    private _engine: AbstractEngine;\r\n\r\n    private _cdfyPT: ProceduralTexture;\r\n    private _cdfxPT: ProceduralTexture;\r\n    private _icdfPT: ProceduralTexture;\r\n    private _scaledLuminancePT: ProceduralTexture;\r\n    private _dominantDirectionPT: ProceduralTexture;\r\n    private _iblSource: Nullable<BaseTexture>;\r\n    private _dummyTexture: RawTexture;\r\n\r\n    private _cachedDominantDirection: Nullable<Vector3> = null;\r\n\r\n    /**\r\n     * Returns whether the CDF renderer is supported by the current engine\r\n     */\r\n    public get isSupported(): boolean {\r\n        const engine = EngineStore.LastCreatedEngine;\r\n        if (!engine) {\r\n            return false;\r\n        }\r\n        return engine.getCaps().texelFetch;\r\n    }\r\n\r\n    /**\r\n     * Gets the IBL source texture being used by the CDF renderer\r\n     */\r\n    public get iblSource(): Nullable<BaseTexture> {\r\n        return this._iblSource;\r\n    }\r\n\r\n    /**\r\n     * Sets the IBL source texture to be used by the CDF renderer.\r\n     * This will trigger recreation of the CDF assets.\r\n     */\r\n    public set iblSource(source: Nullable<BaseTexture>) {\r\n        if (this._iblSource === source) {\r\n            return;\r\n        }\r\n        this._disposeTextures();\r\n        this._iblSource = source;\r\n        if (!source) {\r\n            return;\r\n        }\r\n        if (source.isCube) {\r\n            if (source.isReadyOrNotBlocking()) {\r\n                this._recreateAssetsFromNewIbl();\r\n            } else {\r\n                (source as CubeTexture).onLoadObservable.addOnce(this._recreateAssetsFromNewIbl.bind(this, source));\r\n            }\r\n        } else {\r\n            if (source.isReadyOrNotBlocking()) {\r\n                this._recreateAssetsFromNewIbl();\r\n            } else {\r\n                (source as Texture).onLoadObservable.addOnce(this._recreateAssetsFromNewIbl.bind(this, source));\r\n            }\r\n        }\r\n    }\r\n\r\n    private _recreateAssetsFromNewIbl() {\r\n        if (this._debugPass) {\r\n            this._debugPass.dispose();\r\n        }\r\n\r\n        this._createTextures();\r\n\r\n        if (this._debugPass) {\r\n            // Recreate the debug pass because of the new textures\r\n            this._createDebugPass();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Return the cumulative distribution function (CDF) texture\r\n     * @returns Return the cumulative distribution function (CDF) texture\r\n     */\r\n    public getIcdfTexture(): Texture {\r\n        return this._icdfPT ? this._icdfPT : this._dummyTexture;\r\n    }\r\n\r\n    /** Enable the debug view for this pass */\r\n    public debugEnabled: boolean = false;\r\n    private _debugPass: PostProcess;\r\n    private _debugSizeParams: Vector4 = new Vector4(0.0, 0.0, 1.0, 1.0);\r\n\r\n    /**\r\n     * Sets params that control the position and scaling of the debug display on the screen.\r\n     * @param x Screen X offset of the debug display (0-1)\r\n     * @param y Screen Y offset of the debug display (0-1)\r\n     * @param widthScale X scale of the debug display (0-1)\r\n     * @param heightScale Y scale of the debug display (0-1)\r\n     */\r\n    public setDebugDisplayParams(x: number, y: number, widthScale: number, heightScale: number) {\r\n        this._debugSizeParams.set(x, y, widthScale, heightScale);\r\n    }\r\n\r\n    /**\r\n     * The name of the debug pass post process\r\n     */\r\n    public get debugPassName(): string {\r\n        return this._debugPassName;\r\n    }\r\n    private _debugPassName: string = \"CDF Debug\";\r\n\r\n    /**\r\n     * Gets the debug pass post process\r\n     * @returns The post process\r\n     */\r\n    public getDebugPassPP(): PostProcess {\r\n        if (!this._debugPass) {\r\n            this._createDebugPass();\r\n        }\r\n        return this._debugPass;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public static _SceneComponentInitialization: (scene: Scene) => void = (_) => {\r\n        throw _WarnImport(\"IblCdfGeneratorSceneComponentSceneComponent\");\r\n    };\r\n\r\n    /**\r\n     * Instanciates the CDF renderer\r\n     * @param sceneOrEngine Scene to attach to\r\n     * @returns The CDF renderer\r\n     */\r\n    constructor(sceneOrEngine: Nullable<Scene | AbstractEngine>) {\r\n        if (sceneOrEngine) {\r\n            if (IblCdfGenerator._IsScene(sceneOrEngine)) {\r\n                this._scene = sceneOrEngine;\r\n            } else {\r\n                this._engine = sceneOrEngine;\r\n            }\r\n        } else {\r\n            this._scene = EngineStore.LastCreatedScene;\r\n        }\r\n        if (this._scene) {\r\n            this._engine = this._scene.getEngine();\r\n        }\r\n        if (!this.isSupported) {\r\n            Logger.Warn(\"CDF renderer is not supported by the current engine.\");\r\n            return;\r\n        }\r\n        const blackPixels = new Uint16Array([0, 0, 0, 255]);\r\n        this._dummyTexture = new RawTexture(blackPixels, 1, 1, Engine.TEXTUREFORMAT_RGBA, sceneOrEngine, false, false, undefined, Constants.TEXTURETYPE_HALF_FLOAT);\r\n        if (this._scene) {\r\n            IblCdfGenerator._SceneComponentInitialization(this._scene);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Observable that triggers when the CDF renderer is ready\r\n     */\r\n    public onGeneratedObservable: Observable<void> = new Observable<void>();\r\n\r\n    private _createTextures() {\r\n        const size: TextureSize = this._iblSource ? { width: this._iblSource.getSize().width, height: this._iblSource.getSize().height } : { width: 1, height: 1 };\r\n        if (!this._iblSource) {\r\n            this._iblSource = RawTexture.CreateRTexture(\r\n                new Uint8Array([255]),\r\n                1,\r\n                1,\r\n                this._engine,\r\n                false,\r\n                false,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                Constants.TEXTURETYPE_UNSIGNED_BYTE\r\n            );\r\n            this._iblSource.name = \"Placeholder IBL Source\";\r\n        }\r\n\r\n        if (this._iblSource.isCube) {\r\n            size.width *= 4;\r\n            size.height *= 2;\r\n            // Force the resolution to be a power of 2 because we rely on the\r\n            // auto-mipmap generation for the scaled luminance texture to produce\r\n            // a 1x1 mip that represents the true average pixel intensity of the IBL.\r\n            size.width = 1 << Math.floor(Math.log2(size.width));\r\n            size.height = 1 << Math.floor(Math.log2(size.height));\r\n        }\r\n\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        // Create CDF maps (Cumulative Distribution Function) to assist in importance sampling\r\n        const cdfOptions: IProceduralTextureCreationOptions = {\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            format: Constants.TEXTUREFORMAT_R,\r\n            type: Constants.TEXTURETYPE_FLOAT,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            gammaSpace: false,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../ShadersWGSL/iblCdfx.fragment\"), import(\"../ShadersWGSL/iblCdfy.fragment\"), import(\"../ShadersWGSL/iblScaledLuminance.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../Shaders/iblCdfx.fragment\"), import(\"../Shaders/iblCdfy.fragment\"), import(\"../Shaders/iblScaledLuminance.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n        const icdfOptions: IProceduralTextureCreationOptions = {\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            gammaSpace: false,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../ShadersWGSL/iblIcdf.fragment\"), import(\"../ShadersWGSL/iblDominantDirection.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../Shaders/iblIcdf.fragment\"), import(\"../Shaders/iblDominantDirection.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n        this._cdfyPT = new ProceduralTexture(\"cdfyTexture\", { width: size.width, height: size.height + 1 }, \"iblCdfy\", this._scene, cdfOptions, false, false);\r\n        this._cdfyPT.autoClear = false;\r\n        this._cdfyPT.setTexture(\"iblSource\", this._iblSource);\r\n        this._cdfyPT.setInt(\"iblHeight\", size.height);\r\n        this._cdfyPT.wrapV = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n        this._cdfyPT.refreshRate = 0;\r\n        if (this._iblSource.isCube) {\r\n            this._cdfyPT.defines = \"#define IBL_USE_CUBE_MAP\\n\";\r\n        }\r\n\r\n        this._cdfxPT = new ProceduralTexture(\"cdfxTexture\", { width: size.width + 1, height: 1 }, \"iblCdfx\", this._scene, cdfOptions, false, false);\r\n        this._cdfxPT.autoClear = false;\r\n        this._cdfxPT.setTexture(\"cdfy\", this._cdfyPT);\r\n        this._cdfxPT.refreshRate = 0;\r\n        this._cdfxPT.wrapU = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n\r\n        this._scaledLuminancePT = new ProceduralTexture(\r\n            \"iblScaledLuminance\",\r\n            { width: size.width, height: size.height },\r\n            \"iblScaledLuminance\",\r\n            this._scene,\r\n            { ...cdfOptions, samplingMode: Constants.TEXTURE_TRILINEAR_SAMPLINGMODE, generateMipMaps: true },\r\n            true,\r\n            false\r\n        );\r\n        this._scaledLuminancePT.autoClear = false;\r\n        this._scaledLuminancePT.setTexture(\"iblSource\", this._iblSource);\r\n        this._scaledLuminancePT.setInt(\"iblHeight\", size.height);\r\n        this._scaledLuminancePT.setInt(\"iblWidth\", size.width);\r\n        this._scaledLuminancePT.refreshRate = 0;\r\n        if (this._iblSource.isCube) {\r\n            this._scaledLuminancePT.defines = \"#define IBL_USE_CUBE_MAP\\n\";\r\n        }\r\n        this._icdfPT = new ProceduralTexture(\"icdfTexture\", { width: size.width, height: size.height }, \"iblIcdf\", this._scene, icdfOptions, false, false);\r\n        this._icdfPT.autoClear = false;\r\n        this._icdfPT.setTexture(\"cdfy\", this._cdfyPT);\r\n        this._icdfPT.setTexture(\"cdfx\", this._cdfxPT);\r\n        this._icdfPT.setTexture(\"iblSource\", this._iblSource);\r\n        this._icdfPT.setTexture(\"scaledLuminanceSampler\", this._scaledLuminancePT);\r\n        this._icdfPT.refreshRate = 0;\r\n        this._icdfPT.wrapV = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n        this._icdfPT.wrapU = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n        if (this._iblSource.isCube) {\r\n            this._icdfPT.defines = \"#define IBL_USE_CUBE_MAP\\n\";\r\n        }\r\n        // Once the textures are generated, notify that they are ready to use.\r\n        this._icdfPT.onGeneratedObservable.addOnce(() => {\r\n            this.onGeneratedObservable.notifyObservers();\r\n        });\r\n\r\n        this._dominantDirectionPT = new ProceduralTexture(\"iblDominantDirection\", { width: 1, height: 1 }, \"iblDominantDirection\", this._scene, icdfOptions, false, false);\r\n        this._dominantDirectionPT.autoClear = false;\r\n        this._dominantDirectionPT.setTexture(\"icdfSampler\", this._icdfPT);\r\n        this._dominantDirectionPT.refreshRate = 0;\r\n        this._dominantDirectionPT.defines = \"#define NUM_SAMPLES 32u\\n\";\r\n    }\r\n\r\n    private _disposeTextures() {\r\n        this._cdfyPT?.dispose();\r\n        this._cdfxPT?.dispose();\r\n        this._icdfPT?.dispose();\r\n        this._scaledLuminancePT?.dispose();\r\n        this._dominantDirectionPT?.dispose();\r\n    }\r\n\r\n    private _createDebugPass() {\r\n        if (this._debugPass) {\r\n            this._debugPass.dispose();\r\n        }\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        const debugOptions: PostProcessOptions = {\r\n            width: this._engine.getRenderWidth(),\r\n            height: this._engine.getRenderHeight(),\r\n            samplingMode: Texture.BILINEAR_SAMPLINGMODE,\r\n            engine: this._engine,\r\n            textureType: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            uniforms: [\"sizeParams\"],\r\n            samplers: [\"cdfy\", \"icdf\", \"cdfx\", \"iblSource\"],\r\n            defines: this._iblSource?.isCube ? \"#define IBL_USE_CUBE_MAP\\n\" : \"\",\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializations: (useWebGPU: boolean, list: Promise<any>[]) => {\r\n                if (useWebGPU) {\r\n                    list.push(import(\"../ShadersWGSL/iblCdfDebug.fragment\"));\r\n                } else {\r\n                    list.push(import(\"../Shaders/iblCdfDebug.fragment\"));\r\n                }\r\n            },\r\n        };\r\n        this._debugPass = new PostProcess(this._debugPassName, \"iblCdfDebug\", debugOptions);\r\n        const debugEffect = this._debugPass.getEffect();\r\n        if (debugEffect) {\r\n            debugEffect.defines = this._iblSource?.isCube ? \"#define IBL_USE_CUBE_MAP\\n\" : \"\";\r\n        }\r\n        if (this._iblSource?.isCube) {\r\n            this._debugPass.updateEffect(\"#define IBL_USE_CUBE_MAP\\n\");\r\n        }\r\n        this._debugPass.onApplyObservable.add((effect) => {\r\n            effect.setTexture(\"cdfy\", this._cdfyPT);\r\n            effect.setTexture(\"icdf\", this._icdfPT);\r\n            effect.setTexture(\"cdfx\", this._cdfxPT);\r\n            effect.setTexture(\"iblSource\", this._iblSource);\r\n            effect.setFloat4(\"sizeParams\", this._debugSizeParams.x, this._debugSizeParams.y, this._debugSizeParams.z, this._debugSizeParams.w);\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Checks if the CDF renderer is ready\r\n     * @returns true if the CDF renderer is ready\r\n     */\r\n    public isReady() {\r\n        return (\r\n            this._iblSource &&\r\n            this._iblSource.name !== \"Placeholder IBL Source\" &&\r\n            this._iblSource.isReady() &&\r\n            this._cdfyPT &&\r\n            this._cdfyPT.isReady() &&\r\n            this._icdfPT &&\r\n            this._icdfPT.isReady() &&\r\n            this._cdfxPT &&\r\n            this._cdfxPT.isReady() &&\r\n            this._scaledLuminancePT &&\r\n            this._scaledLuminancePT.isReady()\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Explicitly trigger generation of CDF maps when they are ready to render.\r\n     * @returns Promise that resolves when the CDF maps are rendered.\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention, @typescript-eslint/promise-function-async\r\n    public renderWhenReady(): Promise<void> {\r\n        this._cachedDominantDirection = null;\r\n\r\n        // Even if a IBL source must be set before calling this function, _icdfPT may not yet be created because the creation may be asynchronous (see @set iblSource).\r\n        const icdfPTPromise = new Promise((resolve, reject) => {\r\n            _RetryWithInterval(\r\n                () => !!this._icdfPT,\r\n                () => resolve(void 0),\r\n                () => reject(new Error(\"Waiting for _icdfPT creation failed\"))\r\n            );\r\n        });\r\n\r\n        // eslint-disable-next-line github/no-then, @typescript-eslint/promise-function-async\r\n        return icdfPTPromise.then(() => {\r\n            // Once the textures are generated, notify that they are ready to use.\r\n            this._icdfPT.onGeneratedObservable.addOnce(() => {\r\n                this.onGeneratedObservable.notifyObservers();\r\n            });\r\n            const promises: Array<Promise<void>> = [];\r\n            const renderTargets: Array<ProceduralTexture> = [this._cdfyPT, this._cdfxPT, this._scaledLuminancePT, this._icdfPT];\r\n            for (const target of renderTargets) {\r\n                promises.push(\r\n                    new Promise((resolve) => {\r\n                        if (target.isReady()) {\r\n                            resolve();\r\n                        } else {\r\n                            target.getEffect().executeWhenCompiled(() => {\r\n                                resolve();\r\n                            });\r\n                        }\r\n                    })\r\n                );\r\n            }\r\n            // eslint-disable-next-line github/no-then\r\n            return Promise.all(promises).then(() => {\r\n                for (const target of renderTargets) {\r\n                    target.render();\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Finds the average direction of the highest intensity areas of the IBL source\r\n     * @returns Async promise that resolves to the dominant direction of the IBL source\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/promise-function-async\r\n    public findDominantDirection(): Promise<Vector3> {\r\n        if (this._cachedDominantDirection) {\r\n            return Promise.resolve(this._cachedDominantDirection);\r\n        }\r\n        return new Promise((resolve) => {\r\n            this._dominantDirectionPT.onGeneratedObservable.addOnce(() => {\r\n                const data = new Float32Array(4);\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\r\n                this._dominantDirectionPT.readPixels(0, 0, data, true)!.then(() => {\r\n                    const dominantDirection = new Vector3(data[0], data[1], data[2]);\r\n                    this._cachedDominantDirection = dominantDirection;\r\n                    resolve(dominantDirection);\r\n                });\r\n            });\r\n            if (this.isReady()) {\r\n                if (this._dominantDirectionPT.isReady()) {\r\n                    this._dominantDirectionPT.render();\r\n                } else {\r\n                    this._dominantDirectionPT.getEffect().executeWhenCompiled(() => {\r\n                        this._dominantDirectionPT.render();\r\n                    });\r\n                }\r\n            } else {\r\n                this.onGeneratedObservable.addOnce(() => {\r\n                    if (this._dominantDirectionPT.isReady()) {\r\n                        this._dominantDirectionPT.render();\r\n                    } else {\r\n                        this._dominantDirectionPT.getEffect().executeWhenCompiled(() => {\r\n                            this._dominantDirectionPT.render();\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Disposes the CDF renderer and associated resources\r\n     */\r\n    public dispose() {\r\n        this._disposeTextures();\r\n        this._dummyTexture.dispose();\r\n        if (this._debugPass) {\r\n            this._debugPass.dispose();\r\n        }\r\n        this.onGeneratedObservable.clear();\r\n    }\r\n\r\n    private static _IsScene(sceneOrEngine: Scene | AbstractEngine): sceneOrEngine is Scene {\r\n        return sceneOrEngine.getClassName() === \"Scene\";\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2630, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/geometryBufferRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/geometryBufferRenderer.ts"],"sourcesContent":["import { Matrix } from \"../Maths/math.vector\";\r\nimport { VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { SmartArray } from \"../Misc/smartArray\";\r\nimport { Texture } from \"../Materials/Textures/texture\";\r\nimport type { InternalTexture } from \"../Materials/Textures/internalTexture\";\r\nimport { MultiRenderTarget } from \"../Materials/Textures/multiRenderTarget\";\r\nimport type { PrePassRenderer } from \"../Rendering/prePassRenderer\";\r\nimport type { Scene } from \"../scene\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport { Color4 } from \"../Maths/math.color\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport type { Observer } from \"../Misc/observable\";\r\nimport type { AbstractEngine } from \"../Engines/abstractEngine\";\r\nimport type { Nullable } from \"../types\";\r\nimport { Material } from \"../Materials/material\";\r\n\r\nimport \"../Shaders/geometry.fragment\";\r\nimport \"../Shaders/geometry.vertex\";\r\nimport { MaterialFlags } from \"../Materials/materialFlags\";\r\nimport { AddClipPlaneUniforms, BindClipPlane, PrepareStringDefinesForClipPlanes } from \"../Materials/clipPlaneMaterialHelper\";\r\nimport { BindMorphTargetParameters, BindSceneUniformBuffer, PrepareDefinesAndAttributesForMorphTargets, PushAttributesForInstances } from \"../Materials/materialHelper.functions\";\r\n\r\nimport \"../Engines/Extensions/engine.multiRender\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport type { OpenPBRMaterial } from \"../Materials/PBR/openpbrMaterial\";\r\n\r\n/** @internal */\r\ninterface ISavedTransformationMatrix {\r\n    world: Matrix;\r\n    viewProjection: Matrix;\r\n}\r\n\r\n/** list the uniforms used by the geometry renderer */\r\nconst Uniforms = [\r\n    \"world\",\r\n    \"mBones\",\r\n    \"viewProjection\",\r\n    \"diffuseMatrix\",\r\n    \"view\",\r\n    \"previousWorld\",\r\n    \"previousViewProjection\",\r\n    \"mPreviousBones\",\r\n    \"bumpMatrix\",\r\n    \"reflectivityMatrix\",\r\n    \"albedoMatrix\",\r\n    \"reflectivityColor\",\r\n    \"albedoColor\",\r\n    \"metallic\",\r\n    \"glossiness\",\r\n    \"vTangentSpaceParams\",\r\n    \"vBumpInfos\",\r\n    \"morphTargetInfluences\",\r\n    \"morphTargetCount\",\r\n    \"morphTargetTextureInfo\",\r\n    \"morphTargetTextureIndices\",\r\n    \"boneTextureWidth\",\r\n];\r\nAddClipPlaneUniforms(Uniforms);\r\n\r\n/**\r\n * This renderer is helpful to fill one of the render target with a geometry buffer.\r\n */\r\nexport class GeometryBufferRenderer {\r\n    /**\r\n     * Force all the standard materials to compile to glsl even on WebGPU engines.\r\n     * False by default. This is mostly meant for backward compatibility.\r\n     */\r\n    public static ForceGLSL = false;\r\n    /**\r\n     * Constant used to retrieve the depth texture index in the G-Buffer textures array\r\n     * using getIndex(GeometryBufferRenderer.DEPTH_TEXTURE_INDEX)\r\n     */\r\n    public static readonly DEPTH_TEXTURE_TYPE = 0;\r\n    /**\r\n     * Constant used to retrieve the normal texture index in the G-Buffer textures array\r\n     * using getIndex(GeometryBufferRenderer.NORMAL_TEXTURE_INDEX)\r\n     */\r\n    public static readonly NORMAL_TEXTURE_TYPE = 1;\r\n    /**\r\n     * Constant used to retrieve the position texture index in the G-Buffer textures array\r\n     * using getIndex(GeometryBufferRenderer.POSITION_TEXTURE_INDEX)\r\n     */\r\n    public static readonly POSITION_TEXTURE_TYPE = 2;\r\n    /**\r\n     * Constant used to retrieve the velocity texture index in the G-Buffer textures array\r\n     * using getIndex(GeometryBufferRenderer.VELOCITY_TEXTURE_INDEX)\r\n     */\r\n    public static readonly VELOCITY_TEXTURE_TYPE = 3;\r\n    /**\r\n     * Constant used to retrieve the reflectivity texture index in the G-Buffer textures array\r\n     * using the getIndex(GeometryBufferRenderer.REFLECTIVITY_TEXTURE_TYPE)\r\n     */\r\n    public static readonly REFLECTIVITY_TEXTURE_TYPE = 4;\r\n\r\n    /**\r\n     * Constant used to retrieve the screen-space depth texture index in the G-Buffer textures array\r\n     * using getIndex(GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE)\r\n     */\r\n    public static readonly SCREENSPACE_DEPTH_TEXTURE_TYPE = 5;\r\n\r\n    /**\r\n     * Constant used to retrieve the linear velocity texture index in the G-Buffer textures array\r\n     * using getIndex(GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE)\r\n     */\r\n    public static readonly VELOCITY_LINEAR_TEXTURE_TYPE = 6;\r\n\r\n    /**\r\n     * Dictionary used to store the previous transformation matrices of each rendered mesh\r\n     * in order to compute objects velocities when enableVelocity is set to \"true\"\r\n     * @internal\r\n     */\r\n    public _previousTransformationMatrices: { [index: number]: ISavedTransformationMatrix } = {};\r\n    /**\r\n     * Dictionary used to store the previous bones transformation matrices of each rendered mesh\r\n     * in order to compute objects velocities when enableVelocity is set to \"true\"\r\n     * @internal\r\n     */\r\n    public _previousBonesTransformationMatrices: { [index: number]: Float32Array } = {};\r\n    /**\r\n     * Array used to store the ignored skinned meshes while computing velocity map (typically used by the motion blur post-process).\r\n     * Avoids computing bones velocities and computes only mesh's velocity itself (position, rotation, scaling).\r\n     */\r\n    public excludedSkinnedMeshesFromVelocity: AbstractMesh[] = [];\r\n\r\n    /** Gets or sets a boolean indicating if transparent meshes should be rendered */\r\n    public renderTransparentMeshes = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if normals should be generated in world space (default: false, meaning normals are generated in view space)\r\n     */\r\n    public generateNormalsInWorldSpace = false;\r\n\r\n    private _normalsAreUnsigned = false;\r\n\r\n    /**\r\n     * Gets a boolean indicating if normals are encoded in the [0,1] range in the render target. If true, you should do `normal = normal_rt * 2.0 - 1.0` to get the right normal\r\n     */\r\n    public get normalsAreUnsigned() {\r\n        return this._normalsAreUnsigned;\r\n    }\r\n\r\n    private _scene: Scene;\r\n    private _resizeObserver: Nullable<Observer<AbstractEngine>> = null;\r\n    private _multiRenderTarget: MultiRenderTarget;\r\n    private _textureTypesAndFormats: { [key: number]: { textureType: number; textureFormat: number } };\r\n    private _ratioOrDimensions: number | { width: number; height: number };\r\n    private _enableDepth: boolean = true;\r\n    private _enableNormal: boolean = true;\r\n    private _enablePosition: boolean = false;\r\n    private _enableVelocity: boolean = false;\r\n    private _enableVelocityLinear: boolean = false;\r\n    private _enableReflectivity: boolean = false;\r\n    private _enableScreenspaceDepth: boolean = false;\r\n    private _depthFormat: number;\r\n    private _clearColor = new Color4(0, 0, 0, 0);\r\n    private _clearDepthColor = new Color4(0, 0, 0, 1); // sets an invalid value by default - depth in the depth texture is view.z, so 0 is not possible because view.z can't be less than camera.minZ\r\n\r\n    private _positionIndex: number = -1;\r\n    private _velocityIndex: number = -1;\r\n    private _velocityLinearIndex: number = -1;\r\n    private _reflectivityIndex: number = -1;\r\n    private _depthIndex: number = -1;\r\n    private _normalIndex: number = -1;\r\n    private _screenspaceDepthIndex: number = -1;\r\n\r\n    private _linkedWithPrePass: boolean = false;\r\n    private _prePassRenderer: PrePassRenderer;\r\n    private _attachmentsFromPrePass: number[];\r\n    private _useUbo: boolean;\r\n\r\n    protected _cachedDefines: string;\r\n\r\n    /**\r\n     * @internal\r\n     * Sets up internal structures to share outputs with PrePassRenderer\r\n     * This method should only be called by the PrePassRenderer itself\r\n     */\r\n    public _linkPrePassRenderer(prePassRenderer: PrePassRenderer) {\r\n        this._linkedWithPrePass = true;\r\n        this._prePassRenderer = prePassRenderer;\r\n\r\n        if (this._multiRenderTarget) {\r\n            // prevents clearing of the RT since it's done by prepass\r\n            this._multiRenderTarget.onClearObservable.clear();\r\n            this._multiRenderTarget.onClearObservable.add(() => {\r\n                // pass\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Separates internal structures from PrePassRenderer so the geometry buffer can now operate by itself.\r\n     * This method should only be called by the PrePassRenderer itself\r\n     */\r\n    public _unlinkPrePassRenderer() {\r\n        this._linkedWithPrePass = false;\r\n        this._createRenderTargets();\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Resets the geometry buffer layout\r\n     */\r\n    public _resetLayout() {\r\n        this._enableDepth = true;\r\n        this._enableNormal = true;\r\n        this._enablePosition = false;\r\n        this._enableReflectivity = false;\r\n        this._enableVelocity = false;\r\n        this._enableVelocityLinear = false;\r\n        this._enableScreenspaceDepth = false;\r\n        this._attachmentsFromPrePass = [];\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Replaces a texture in the geometry buffer renderer\r\n     * Useful when linking textures of the prepass renderer\r\n     */\r\n    public _forceTextureType(geometryBufferType: number, index: number) {\r\n        if (geometryBufferType === GeometryBufferRenderer.POSITION_TEXTURE_TYPE) {\r\n            this._positionIndex = index;\r\n            this._enablePosition = true;\r\n        } else if (geometryBufferType === GeometryBufferRenderer.VELOCITY_TEXTURE_TYPE) {\r\n            this._velocityIndex = index;\r\n            this._enableVelocity = true;\r\n        } else if (geometryBufferType === GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE) {\r\n            this._velocityLinearIndex = index;\r\n            this._enableVelocityLinear = true;\r\n        } else if (geometryBufferType === GeometryBufferRenderer.REFLECTIVITY_TEXTURE_TYPE) {\r\n            this._reflectivityIndex = index;\r\n            this._enableReflectivity = true;\r\n        } else if (geometryBufferType === GeometryBufferRenderer.DEPTH_TEXTURE_TYPE) {\r\n            this._depthIndex = index;\r\n            this._enableDepth = true;\r\n        } else if (geometryBufferType === GeometryBufferRenderer.NORMAL_TEXTURE_TYPE) {\r\n            this._normalIndex = index;\r\n            this._enableNormal = true;\r\n        } else if (geometryBufferType === GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE) {\r\n            this._screenspaceDepthIndex = index;\r\n            this._enableScreenspaceDepth = true;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Sets texture attachments\r\n     * Useful when linking textures of the prepass renderer\r\n     */\r\n    public _setAttachments(attachments: number[]) {\r\n        this._attachmentsFromPrePass = attachments;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Replaces the first texture which is hard coded as a depth texture in the geometry buffer\r\n     * Useful when linking textures of the prepass renderer\r\n     */\r\n    public _linkInternalTexture(internalTexture: InternalTexture) {\r\n        this._multiRenderTarget.setInternalTexture(internalTexture, 0, false);\r\n    }\r\n\r\n    /**\r\n     * Gets the render list (meshes to be rendered) used in the G buffer.\r\n     */\r\n    public get renderList() {\r\n        return this._multiRenderTarget.renderList;\r\n    }\r\n\r\n    /**\r\n     * Set the render list (meshes to be rendered) used in the G buffer.\r\n     */\r\n    public set renderList(meshes: Nullable<AbstractMesh[]>) {\r\n        this._multiRenderTarget.renderList = meshes;\r\n    }\r\n\r\n    /**\r\n     * Gets whether or not G buffer are supported by the running hardware.\r\n     * This requires draw buffer supports\r\n     */\r\n    public get isSupported(): boolean {\r\n        return this._multiRenderTarget.isSupported;\r\n    }\r\n\r\n    /**\r\n     * Returns the index of the given texture type in the G-Buffer textures array\r\n     * @param textureType The texture type constant. For example GeometryBufferRenderer.POSITION_TEXTURE_INDEX\r\n     * @returns the index of the given texture type in the G-Buffer textures array\r\n     */\r\n    public getTextureIndex(textureType: number): number {\r\n        switch (textureType) {\r\n            case GeometryBufferRenderer.POSITION_TEXTURE_TYPE:\r\n                return this._positionIndex;\r\n            case GeometryBufferRenderer.VELOCITY_TEXTURE_TYPE:\r\n                return this._velocityIndex;\r\n            case GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE:\r\n                return this._velocityLinearIndex;\r\n            case GeometryBufferRenderer.REFLECTIVITY_TEXTURE_TYPE:\r\n                return this._reflectivityIndex;\r\n            case GeometryBufferRenderer.DEPTH_TEXTURE_TYPE:\r\n                return this._depthIndex;\r\n            case GeometryBufferRenderer.NORMAL_TEXTURE_TYPE:\r\n                return this._normalIndex;\r\n            case GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE:\r\n                return this._screenspaceDepthIndex;\r\n            default:\r\n                return -1;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns a boolean indicating if object's depths are enabled for the G buffer.\r\n     */\r\n    public get enableDepth(): boolean {\r\n        return this._enableDepth;\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not object's depths are enabled for the G buffer.\r\n     */\r\n    public set enableDepth(enable: boolean) {\r\n        this._enableDepth = enable;\r\n\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns a boolean indicating if object's normals are enabled for the G buffer.\r\n     */\r\n    public get enableNormal(): boolean {\r\n        return this._enableNormal;\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not object's normals are enabled for the G buffer.\r\n     */\r\n    public set enableNormal(enable: boolean) {\r\n        this._enableNormal = enable;\r\n\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns a boolean indicating if objects positions are enabled for the G buffer.\r\n     */\r\n    public get enablePosition(): boolean {\r\n        return this._enablePosition;\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not objects positions are enabled for the G buffer.\r\n     */\r\n    public set enablePosition(enable: boolean) {\r\n        this._enablePosition = enable;\r\n\r\n        // PrePass handles index and texture links\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @returns a boolean indicating if objects velocities are enabled for the G buffer.\r\n     */\r\n    public get enableVelocity(): boolean {\r\n        return this._enableVelocity;\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not objects velocities are enabled for the G buffer.\r\n     */\r\n    public set enableVelocity(enable: boolean) {\r\n        this._enableVelocity = enable;\r\n\r\n        if (!enable) {\r\n            this._previousTransformationMatrices = {};\r\n        }\r\n\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n\r\n        this._scene.needsPreviousWorldMatrices = enable;\r\n    }\r\n\r\n    /**\r\n     * @returns a boolean indicating if object's linear velocities are enabled for the G buffer.\r\n     */\r\n    public get enableVelocityLinear(): boolean {\r\n        return this._enableVelocityLinear;\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not object's linear velocities are enabled for the G buffer.\r\n     */\r\n    public set enableVelocityLinear(enable: boolean) {\r\n        this._enableVelocityLinear = enable;\r\n\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets a boolean indicating if objects reflectivity are enabled in the G buffer.\r\n     */\r\n    public get enableReflectivity(): boolean {\r\n        return this._enableReflectivity;\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not objects reflectivity are enabled for the G buffer.\r\n     * For Metallic-Roughness workflow with ORM texture, we assume that ORM texture is defined according to the default layout:\r\n     * pbr.useRoughnessFromMetallicTextureAlpha = false;\r\n     * pbr.useRoughnessFromMetallicTextureGreen = true;\r\n     * pbr.useMetallnessFromMetallicTextureBlue = true;\r\n     */\r\n    public set enableReflectivity(enable: boolean) {\r\n        this._enableReflectivity = enable;\r\n\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets whether or not objects screenspace depth are enabled for the G buffer.\r\n     */\r\n    public get enableScreenspaceDepth(): boolean {\r\n        return this._enableScreenspaceDepth;\r\n    }\r\n\r\n    public set enableScreenspaceDepth(enable: boolean) {\r\n        this._enableScreenspaceDepth = enable;\r\n\r\n        if (!this._linkedWithPrePass) {\r\n            this.dispose();\r\n            this._createRenderTargets();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * If set to true (default: false), the depth texture will be cleared with the depth value corresponding to the far plane (1 in normal mode, 0 in reverse depth buffer mode)\r\n     * If set to false, the depth texture is always cleared with 0.\r\n     */\r\n    public useSpecificClearForDepthTexture = false;\r\n\r\n    /**\r\n     * Gets the scene associated with the buffer.\r\n     */\r\n    public get scene(): Scene {\r\n        return this._scene;\r\n    }\r\n\r\n    /**\r\n     * Gets the ratio used by the buffer during its creation.\r\n     * How big is the buffer related to the main canvas.\r\n     */\r\n    public get ratio(): number {\r\n        return typeof this._ratioOrDimensions === \"object\" ? 1 : this._ratioOrDimensions;\r\n    }\r\n\r\n    /** Shader language used by the material */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this material.\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public static _SceneComponentInitialization: (scene: Scene) => void = (_) => {\r\n        throw _WarnImport(\"GeometryBufferRendererSceneComponent\");\r\n    };\r\n\r\n    /**\r\n     * Creates a new G Buffer for the scene\r\n     * @param scene The scene the buffer belongs to\r\n     * @param ratioOrDimensions How big is the buffer related to the main canvas (default: 1). You can also directly pass a width and height for the generated textures\r\n     * @param depthFormat Format of the depth texture (default: Constants.TEXTUREFORMAT_DEPTH16)\r\n     * @param textureTypesAndFormats The types and formats of textures to create as render targets. If not provided, all textures will be RGBA and float or half float, depending on the engine capabilities.\r\n     */\r\n    constructor(\r\n        scene: Scene,\r\n        ratioOrDimensions: number | { width: number; height: number } = 1,\r\n        depthFormat = Constants.TEXTUREFORMAT_DEPTH16,\r\n        textureTypesAndFormats?: { [key: number]: { textureType: number; textureFormat: number } }\r\n    ) {\r\n        this._scene = scene;\r\n        this._ratioOrDimensions = ratioOrDimensions;\r\n        this._useUbo = scene.getEngine().supportsUniformBuffers;\r\n        this._depthFormat = depthFormat;\r\n        this._textureTypesAndFormats = textureTypesAndFormats || {};\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this._initShaderSourceAsync();\r\n\r\n        GeometryBufferRenderer._SceneComponentInitialization(this._scene);\r\n\r\n        // Render target\r\n        this._createRenderTargets();\r\n    }\r\n\r\n    private _shadersLoaded = false;\r\n\r\n    private async _initShaderSourceAsync() {\r\n        const engine = this._scene.getEngine();\r\n\r\n        if (engine.isWebGPU && !GeometryBufferRenderer.ForceGLSL) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n\r\n            await Promise.all([import(\"../ShadersWGSL/geometry.vertex\"), import(\"../ShadersWGSL/geometry.fragment\")]);\r\n        } else {\r\n            await Promise.all([import(\"../Shaders/geometry.vertex\"), import(\"../Shaders/geometry.fragment\")]);\r\n        }\r\n\r\n        this._shadersLoaded = true;\r\n    }\r\n\r\n    /**\r\n     * Checks whether everything is ready to render a submesh to the G buffer.\r\n     * @param subMesh the submesh to check readiness for\r\n     * @param useInstances is the mesh drawn using instance or not\r\n     * @returns true if ready otherwise false\r\n     */\r\n    public isReady(subMesh: SubMesh, useInstances: boolean): boolean {\r\n        if (!this._shadersLoaded) {\r\n            return false;\r\n        }\r\n\r\n        const material = <any>subMesh.getMaterial();\r\n\r\n        if (material && material.disableDepthWrite) {\r\n            return false;\r\n        }\r\n\r\n        const defines = [];\r\n        const attribs = [VertexBuffer.PositionKind];\r\n        const mesh = subMesh.getMesh();\r\n        const hasNormals = mesh.isVerticesDataPresent(VertexBuffer.NormalKind);\r\n\r\n        if (hasNormals) {\r\n            defines.push(\"#define HAS_NORMAL_ATTRIBUTE\");\r\n            attribs.push(VertexBuffer.NormalKind);\r\n        }\r\n\r\n        let uv1 = false;\r\n        let uv2 = false;\r\n        const color = false;\r\n\r\n        if (material) {\r\n            let needUv = false;\r\n            // Alpha test\r\n            if (material.needAlphaTestingForMesh(mesh) && material.getAlphaTestTexture()) {\r\n                defines.push(\"#define ALPHATEST\");\r\n                defines.push(`#define ALPHATEST_UV${material.getAlphaTestTexture().coordinatesIndex + 1}`);\r\n                needUv = true;\r\n            }\r\n\r\n            // Normal map texture\r\n            if ((material.bumpTexture || material.normalTexture || material.geometryNormalTexture) && MaterialFlags.BumpTextureEnabled) {\r\n                const texture = material.bumpTexture || material.normalTexture || material.geometryNormalTexture;\r\n                defines.push(\"#define BUMP\");\r\n                defines.push(`#define BUMP_UV${texture.coordinatesIndex + 1}`);\r\n                needUv = true;\r\n            }\r\n\r\n            if (this._enableReflectivity) {\r\n                let metallicWorkflow = false;\r\n                // for PBR materials: cf. https://doc.babylonjs.com/features/featuresDeepDive/materials/using/masterPBR\r\n                if (material.getClassName() === \"PBRMetallicRoughnessMaterial\") {\r\n                    // if it is a PBR material in MetallicRoughness Mode:\r\n                    if (material.metallicRoughnessTexture) {\r\n                        defines.push(\"#define ORMTEXTURE\");\r\n                        defines.push(`#define REFLECTIVITY_UV${material.metallicRoughnessTexture.coordinatesIndex + 1}`);\r\n                        defines.push(\"#define METALLICWORKFLOW\");\r\n                        needUv = true;\r\n                        metallicWorkflow = true;\r\n                    }\r\n                    // null or undefined\r\n                    if (material.metallic != null) {\r\n                        defines.push(\"#define METALLIC\");\r\n                        defines.push(\"#define METALLICWORKFLOW\");\r\n                        metallicWorkflow = true;\r\n                    }\r\n                    // null or undefined\r\n                    if (material.roughness != null) {\r\n                        defines.push(\"#define ROUGHNESS\");\r\n                        defines.push(\"#define METALLICWORKFLOW\");\r\n                        metallicWorkflow = true;\r\n                    }\r\n                    if (metallicWorkflow) {\r\n                        if (material.baseTexture) {\r\n                            defines.push(\"#define ALBEDOTEXTURE\");\r\n                            defines.push(`#define ALBEDO_UV${material.baseTexture.coordinatesIndex + 1}`);\r\n                            if (material.baseTexture.gammaSpace) {\r\n                                defines.push(\"#define GAMMAALBEDO\");\r\n                            }\r\n                            needUv = true;\r\n                        }\r\n                        if (material.baseColor) {\r\n                            defines.push(\"#define ALBEDOCOLOR\");\r\n                        }\r\n                    }\r\n                } else if (material.getClassName() === \"PBRSpecularGlossinessMaterial\") {\r\n                    // if it is a PBR material in Specular/Glossiness Mode:\r\n                    if (material.specularGlossinessTexture) {\r\n                        defines.push(\"#define SPECULARGLOSSINESSTEXTURE\");\r\n                        defines.push(`#define REFLECTIVITY_UV${material.specularGlossinessTexture.coordinatesIndex + 1}`);\r\n                        needUv = true;\r\n                        if (material.specularGlossinessTexture.gammaSpace) {\r\n                            defines.push(\"#define GAMMAREFLECTIVITYTEXTURE\");\r\n                        }\r\n                    } else {\r\n                        if (material.specularColor) {\r\n                            defines.push(\"#define REFLECTIVITYCOLOR\");\r\n                        }\r\n                    }\r\n                    // null or undefined\r\n                    if (material.glossiness != null) {\r\n                        defines.push(\"#define GLOSSINESS\");\r\n                    }\r\n                } else if (material.getClassName() === \"PBRMaterial\") {\r\n                    // if it is the bigger PBRMaterial\r\n                    if (material.metallicTexture) {\r\n                        defines.push(\"#define ORMTEXTURE\");\r\n                        defines.push(`#define REFLECTIVITY_UV${material.metallicTexture.coordinatesIndex + 1}`);\r\n                        defines.push(\"#define METALLICWORKFLOW\");\r\n                        needUv = true;\r\n                        metallicWorkflow = true;\r\n                    }\r\n                    // null or undefined\r\n                    if (material.metallic != null) {\r\n                        defines.push(\"#define METALLIC\");\r\n                        defines.push(\"#define METALLICWORKFLOW\");\r\n                        metallicWorkflow = true;\r\n                    }\r\n\r\n                    // null or undefined\r\n                    if (material.roughness != null) {\r\n                        defines.push(\"#define ROUGHNESS\");\r\n                        defines.push(\"#define METALLICWORKFLOW\");\r\n                        metallicWorkflow = true;\r\n                    }\r\n\r\n                    if (metallicWorkflow) {\r\n                        if (material.albedoTexture) {\r\n                            defines.push(\"#define ALBEDOTEXTURE\");\r\n                            defines.push(`#define ALBEDO_UV${material.albedoTexture.coordinatesIndex + 1}`);\r\n                            if (material.albedoTexture.gammaSpace) {\r\n                                defines.push(\"#define GAMMAALBEDO\");\r\n                            }\r\n                            needUv = true;\r\n                        }\r\n                        if (material.albedoColor) {\r\n                            defines.push(\"#define ALBEDOCOLOR\");\r\n                        }\r\n                    } else {\r\n                        // SpecularGlossiness Model\r\n                        if (material.reflectivityTexture) {\r\n                            defines.push(\"#define SPECULARGLOSSINESSTEXTURE\");\r\n                            defines.push(`#define REFLECTIVITY_UV${material.reflectivityTexture.coordinatesIndex + 1}`);\r\n                            if (material.reflectivityTexture.gammaSpace) {\r\n                                defines.push(\"#define GAMMAREFLECTIVITYTEXTURE\");\r\n                            }\r\n                            needUv = true;\r\n                        } else if (material.reflectivityColor) {\r\n                            defines.push(\"#define REFLECTIVITYCOLOR\");\r\n                        }\r\n                        // null or undefined\r\n                        if (material.microSurface != null) {\r\n                            defines.push(\"#define GLOSSINESS\");\r\n                        }\r\n                    }\r\n                } else if (material.getClassName() === \"StandardMaterial\") {\r\n                    // if StandardMaterial:\r\n                    if (material.specularTexture) {\r\n                        defines.push(\"#define REFLECTIVITYTEXTURE\");\r\n                        defines.push(`#define REFLECTIVITY_UV${material.specularTexture.coordinatesIndex + 1}`);\r\n                        if (material.specularTexture.gammaSpace) {\r\n                            defines.push(\"#define GAMMAREFLECTIVITYTEXTURE\");\r\n                        }\r\n                        needUv = true;\r\n                    }\r\n                    if (material.specularColor) {\r\n                        defines.push(\"#define REFLECTIVITYCOLOR\");\r\n                    }\r\n                } else if (material.getClassName() === \"OpenPBRMaterial\") {\r\n                    const pbrMaterial = material as OpenPBRMaterial;\r\n\r\n                    defines.push(\"#define METALLICWORKFLOW\");\r\n                    metallicWorkflow = true;\r\n                    defines.push(\"#define METALLIC\");\r\n                    defines.push(\"#define ROUGHNESS\");\r\n                    if (pbrMaterial._useRoughnessFromMetallicTextureGreen && pbrMaterial.baseMetalnessTexture) {\r\n                        defines.push(\"#define ORMTEXTURE\");\r\n                        defines.push(`#define REFLECTIVITY_UV${pbrMaterial.baseMetalnessTexture.coordinatesIndex + 1}`);\r\n                        needUv = true;\r\n                    } else if (pbrMaterial.baseMetalnessTexture) {\r\n                        defines.push(\"#define METALLIC_TEXTURE\");\r\n                        defines.push(`#define METALLIC_UV${pbrMaterial.baseMetalnessTexture.coordinatesIndex + 1}`);\r\n                        needUv = true;\r\n                    } else if (pbrMaterial.specularRoughnessTexture) {\r\n                        defines.push(\"#define ROUGHNESS_TEXTURE\");\r\n                        defines.push(`#define ROUGHNESS_UV${pbrMaterial.specularRoughnessTexture.coordinatesIndex + 1}`);\r\n                        needUv = true;\r\n                    }\r\n\r\n                    if (pbrMaterial.baseColorTexture) {\r\n                        defines.push(\"#define ALBEDOTEXTURE\");\r\n                        defines.push(`#define ALBEDO_UV${pbrMaterial.baseColorTexture.coordinatesIndex + 1}`);\r\n                        if (pbrMaterial.baseColorTexture.gammaSpace) {\r\n                            defines.push(\"#define GAMMAALBEDO\");\r\n                        }\r\n                        needUv = true;\r\n                    }\r\n                    if (pbrMaterial.baseColor) {\r\n                        defines.push(\"#define ALBEDOCOLOR\");\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (needUv) {\r\n                defines.push(\"#define NEED_UV\");\r\n                if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\r\n                    attribs.push(VertexBuffer.UVKind);\r\n                    defines.push(\"#define UV1\");\r\n                    uv1 = true;\r\n                }\r\n                if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind)) {\r\n                    attribs.push(VertexBuffer.UV2Kind);\r\n                    defines.push(\"#define UV2\");\r\n                    uv2 = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        // Buffers\r\n        if (this._enableDepth) {\r\n            defines.push(\"#define DEPTH\");\r\n            defines.push(\"#define DEPTH_INDEX \" + this._depthIndex);\r\n        }\r\n\r\n        if (this._enableNormal) {\r\n            defines.push(\"#define NORMAL\");\r\n            defines.push(\"#define NORMAL_INDEX \" + this._normalIndex);\r\n        }\r\n\r\n        if (this._enablePosition) {\r\n            defines.push(\"#define POSITION\");\r\n            defines.push(\"#define POSITION_INDEX \" + this._positionIndex);\r\n        }\r\n\r\n        if (this._enableVelocity) {\r\n            defines.push(\"#define VELOCITY\");\r\n            defines.push(\"#define VELOCITY_INDEX \" + this._velocityIndex);\r\n            if (this.excludedSkinnedMeshesFromVelocity.indexOf(mesh) === -1) {\r\n                defines.push(\"#define BONES_VELOCITY_ENABLED\");\r\n            }\r\n        }\r\n\r\n        if (this._enableVelocityLinear) {\r\n            defines.push(\"#define VELOCITY_LINEAR\");\r\n            defines.push(\"#define VELOCITY_LINEAR_INDEX \" + this._velocityLinearIndex);\r\n            if (this.excludedSkinnedMeshesFromVelocity.indexOf(mesh) === -1) {\r\n                defines.push(\"#define BONES_VELOCITY_ENABLED\");\r\n            }\r\n        }\r\n\r\n        if (this._enableReflectivity) {\r\n            defines.push(\"#define REFLECTIVITY\");\r\n            defines.push(\"#define REFLECTIVITY_INDEX \" + this._reflectivityIndex);\r\n        }\r\n\r\n        if (this._enableScreenspaceDepth) {\r\n            if (this._screenspaceDepthIndex !== -1) {\r\n                defines.push(\"#define SCREENSPACE_DEPTH_INDEX \" + this._screenspaceDepthIndex);\r\n                defines.push(\"#define SCREENSPACE_DEPTH\");\r\n            }\r\n        }\r\n\r\n        if (this.generateNormalsInWorldSpace) {\r\n            defines.push(\"#define NORMAL_WORLDSPACE\");\r\n        }\r\n\r\n        if (this._normalsAreUnsigned) {\r\n            defines.push(\"#define ENCODE_NORMAL\");\r\n        }\r\n\r\n        // Bones\r\n        if (mesh.useBones && mesh.computeBonesUsingShaders && mesh.skeleton) {\r\n            attribs.push(VertexBuffer.MatricesIndicesKind);\r\n            attribs.push(VertexBuffer.MatricesWeightsKind);\r\n            if (mesh.numBoneInfluencers > 4) {\r\n                attribs.push(VertexBuffer.MatricesIndicesExtraKind);\r\n                attribs.push(VertexBuffer.MatricesWeightsExtraKind);\r\n            }\r\n            defines.push(\"#define NUM_BONE_INFLUENCERS \" + mesh.numBoneInfluencers);\r\n            defines.push(\"#define BONETEXTURE \" + mesh.skeleton.isUsingTextureForMatrices);\r\n            defines.push(\"#define BonesPerMesh \" + (mesh.skeleton.bones.length + 1));\r\n        } else {\r\n            defines.push(\"#define NUM_BONE_INFLUENCERS 0\");\r\n            defines.push(\"#define BONETEXTURE false\");\r\n            defines.push(\"#define BonesPerMesh 0\");\r\n        }\r\n\r\n        // Morph targets\r\n        const numMorphInfluencers = mesh.morphTargetManager\r\n            ? PrepareDefinesAndAttributesForMorphTargets(\r\n                  mesh.morphTargetManager,\r\n                  defines,\r\n                  attribs,\r\n                  mesh,\r\n                  true, // usePositionMorph\r\n                  true, // useNormalMorph\r\n                  false, // useTangentMorph\r\n                  uv1, // useUVMorph\r\n                  uv2, // useUV2Morph\r\n                  color // useColorMorph\r\n              )\r\n            : 0;\r\n\r\n        // Instances\r\n        if (useInstances) {\r\n            defines.push(\"#define INSTANCES\");\r\n            PushAttributesForInstances(attribs, this._enableVelocity || this._enableVelocityLinear);\r\n            if (subMesh.getRenderingMesh().hasThinInstances) {\r\n                defines.push(\"#define THIN_INSTANCES\");\r\n            }\r\n        }\r\n\r\n        // Setup textures count\r\n        if (this._linkedWithPrePass) {\r\n            defines.push(\"#define SCENE_MRT_COUNT \" + this._attachmentsFromPrePass.length);\r\n        } else {\r\n            defines.push(\"#define SCENE_MRT_COUNT \" + this._multiRenderTarget.textures.length);\r\n        }\r\n\r\n        PrepareStringDefinesForClipPlanes(material, this._scene, defines);\r\n\r\n        // Get correct effect\r\n        const engine = this._scene.getEngine();\r\n        const drawWrapper = subMesh._getDrawWrapper(undefined, true)!;\r\n        const cachedDefines = drawWrapper.defines;\r\n        const join = defines.join(\"\\n\");\r\n        if (cachedDefines !== join) {\r\n            drawWrapper.setEffect(\r\n                engine.createEffect(\r\n                    \"geometry\",\r\n                    {\r\n                        attributes: attribs,\r\n                        uniformsNames: Uniforms,\r\n                        samplers: [\"diffuseSampler\", \"bumpSampler\", \"reflectivitySampler\", \"albedoSampler\", \"morphTargets\", \"boneSampler\"],\r\n                        defines: join,\r\n                        onCompiled: null,\r\n                        fallbacks: null,\r\n                        onError: null,\r\n                        uniformBuffersNames: [\"Scene\"],\r\n                        indexParameters: { buffersCount: this._multiRenderTarget.textures.length - 1, maxSimultaneousMorphTargets: numMorphInfluencers },\r\n                        shaderLanguage: this.shaderLanguage,\r\n                    },\r\n                    engine\r\n                ),\r\n                join\r\n            );\r\n        }\r\n\r\n        return drawWrapper.effect!.isReady();\r\n    }\r\n\r\n    /**\r\n     * Gets the current underlying G Buffer.\r\n     * @returns the buffer\r\n     */\r\n    public getGBuffer(): MultiRenderTarget {\r\n        return this._multiRenderTarget;\r\n    }\r\n\r\n    /**\r\n     * Gets the number of samples used to render the buffer (anti aliasing).\r\n     */\r\n    public get samples(): number {\r\n        return this._multiRenderTarget.samples;\r\n    }\r\n\r\n    /**\r\n     * Sets the number of samples used to render the buffer (anti aliasing).\r\n     */\r\n    public set samples(value: number) {\r\n        this._multiRenderTarget.samples = value;\r\n    }\r\n\r\n    /**\r\n     * Disposes the renderer and frees up associated resources.\r\n     */\r\n    public dispose(): void {\r\n        if (this._resizeObserver) {\r\n            const engine = this._scene.getEngine();\r\n            engine.onResizeObservable.remove(this._resizeObserver);\r\n            this._resizeObserver = null;\r\n        }\r\n        this.getGBuffer().dispose();\r\n    }\r\n\r\n    private _assignRenderTargetIndices(): [number, string[], Array<{ textureType: number; textureFormat: number } | undefined>] {\r\n        const textureNames: string[] = [];\r\n        const textureTypesAndFormats: Array<{ textureType: number; textureFormat: number } | undefined> = [];\r\n        let count = 0;\r\n\r\n        if (this._enableDepth) {\r\n            this._depthIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_Depth\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.DEPTH_TEXTURE_TYPE]);\r\n        }\r\n\r\n        if (this._enableNormal) {\r\n            this._normalIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_Normal\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.NORMAL_TEXTURE_TYPE]);\r\n        }\r\n\r\n        if (this._enablePosition) {\r\n            this._positionIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_Position\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.POSITION_TEXTURE_TYPE]);\r\n        }\r\n\r\n        if (this._enableVelocity) {\r\n            this._velocityIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_Velocity\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.VELOCITY_TEXTURE_TYPE]);\r\n        }\r\n\r\n        if (this._enableVelocityLinear) {\r\n            this._velocityLinearIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_VelocityLinear\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE]);\r\n        }\r\n\r\n        if (this._enableReflectivity) {\r\n            this._reflectivityIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_Reflectivity\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.REFLECTIVITY_TEXTURE_TYPE]);\r\n        }\r\n\r\n        if (this._enableScreenspaceDepth) {\r\n            this._screenspaceDepthIndex = count;\r\n            count++;\r\n            textureNames.push(\"gBuffer_ScreenspaceDepth\");\r\n            textureTypesAndFormats.push(this._textureTypesAndFormats[GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE]);\r\n        }\r\n\r\n        return [count, textureNames, textureTypesAndFormats];\r\n    }\r\n\r\n    protected _createRenderTargets(): void {\r\n        const engine = this._scene.getEngine();\r\n        const [count, textureNames, textureTypesAndFormat] = this._assignRenderTargetIndices();\r\n\r\n        let type = Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        if (engine._caps.textureFloat && engine._caps.textureFloatLinearFiltering) {\r\n            type = Constants.TEXTURETYPE_FLOAT;\r\n        } else if (engine._caps.textureHalfFloat && engine._caps.textureHalfFloatLinearFiltering) {\r\n            type = Constants.TEXTURETYPE_HALF_FLOAT;\r\n        }\r\n\r\n        const dimensions =\r\n            (this._ratioOrDimensions as any).width !== undefined\r\n                ? (this._ratioOrDimensions as { width: number; height: number })\r\n                : { width: engine.getRenderWidth() * (this._ratioOrDimensions as number), height: engine.getRenderHeight() * (this._ratioOrDimensions as number) };\r\n\r\n        const textureTypes: number[] = [];\r\n        const textureFormats: number[] = [];\r\n\r\n        for (const typeAndFormat of textureTypesAndFormat) {\r\n            if (typeAndFormat) {\r\n                textureTypes.push(typeAndFormat.textureType);\r\n                textureFormats.push(typeAndFormat.textureFormat);\r\n            } else {\r\n                textureTypes.push(type);\r\n                textureFormats.push(Constants.TEXTUREFORMAT_RGBA);\r\n            }\r\n        }\r\n\r\n        this._normalsAreUnsigned =\r\n            textureTypes[GeometryBufferRenderer.NORMAL_TEXTURE_TYPE] === Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV ||\r\n            textureTypes[GeometryBufferRenderer.NORMAL_TEXTURE_TYPE] === Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV;\r\n\r\n        this._multiRenderTarget = new MultiRenderTarget(\r\n            \"gBuffer\",\r\n            dimensions,\r\n            count,\r\n            this._scene,\r\n            { generateMipMaps: false, generateDepthTexture: true, types: textureTypes, formats: textureFormats, depthTextureFormat: this._depthFormat },\r\n            textureNames.concat(\"gBuffer_DepthBuffer\")\r\n        );\r\n        if (!this.isSupported) {\r\n            return;\r\n        }\r\n        this._multiRenderTarget.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n        this._multiRenderTarget.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n        this._multiRenderTarget.refreshRate = 1;\r\n        this._multiRenderTarget.renderParticles = false;\r\n        this._multiRenderTarget.renderList = null;\r\n\r\n        // Depth is always the first texture in the geometry buffer renderer!\r\n        const layoutAttachmentsAll = [true];\r\n        const layoutAttachmentsAllButDepth = [false];\r\n        const layoutAttachmentsDepthOnly = [true];\r\n\r\n        for (let i = 1; i < count; ++i) {\r\n            layoutAttachmentsAll.push(true);\r\n            layoutAttachmentsDepthOnly.push(false);\r\n            layoutAttachmentsAllButDepth.push(true);\r\n        }\r\n\r\n        const attachmentsAll = engine.buildTextureLayout(layoutAttachmentsAll);\r\n        const attachmentsAllButDepth = engine.buildTextureLayout(layoutAttachmentsAllButDepth);\r\n        const attachmentsDepthOnly = engine.buildTextureLayout(layoutAttachmentsDepthOnly);\r\n\r\n        this._multiRenderTarget.onClearObservable.add((engine) => {\r\n            engine.bindAttachments(this.useSpecificClearForDepthTexture ? attachmentsAllButDepth : attachmentsAll);\r\n            engine.clear(this._clearColor, true, true, true);\r\n            if (this.useSpecificClearForDepthTexture) {\r\n                engine.bindAttachments(attachmentsDepthOnly);\r\n                engine.clear(this._clearDepthColor, true, true, true);\r\n            }\r\n            engine.bindAttachments(attachmentsAll);\r\n        });\r\n\r\n        this._resizeObserver = engine.onResizeObservable.add(() => {\r\n            if (this._multiRenderTarget) {\r\n                const dimensions =\r\n                    (this._ratioOrDimensions as any).width !== undefined\r\n                        ? (this._ratioOrDimensions as { width: number; height: number })\r\n                        : { width: engine.getRenderWidth() * (this._ratioOrDimensions as number), height: engine.getRenderHeight() * (this._ratioOrDimensions as number) };\r\n                this._multiRenderTarget.resize(dimensions);\r\n            }\r\n        });\r\n\r\n        // Custom render function\r\n        const renderSubMesh = (subMesh: SubMesh): void => {\r\n            const renderingMesh = subMesh.getRenderingMesh();\r\n            const effectiveMesh = subMesh.getEffectiveMesh();\r\n            const scene = this._scene;\r\n            const engine = scene.getEngine();\r\n            const material = <any>subMesh.getMaterial();\r\n\r\n            if (!material) {\r\n                return;\r\n            }\r\n\r\n            effectiveMesh._internalAbstractMeshDataInfo._isActiveIntermediate = false;\r\n\r\n            // Velocity\r\n            if ((this._enableVelocity || this._enableVelocityLinear) && !this._previousTransformationMatrices[effectiveMesh.uniqueId]) {\r\n                this._previousTransformationMatrices[effectiveMesh.uniqueId] = {\r\n                    world: Matrix.Identity(),\r\n                    viewProjection: scene.getTransformMatrix(),\r\n                };\r\n\r\n                if (renderingMesh.skeleton) {\r\n                    const bonesTransformations = renderingMesh.skeleton.getTransformMatrices(renderingMesh);\r\n                    this._previousBonesTransformationMatrices[renderingMesh.uniqueId] = this._copyBonesTransformationMatrices(\r\n                        bonesTransformations,\r\n                        new Float32Array(bonesTransformations.length)\r\n                    );\r\n                }\r\n            }\r\n\r\n            // Managing instances\r\n            const batch = renderingMesh._getInstancesRenderList(subMesh._id, !!subMesh.getReplacementMesh());\r\n\r\n            if (batch.mustReturn) {\r\n                return;\r\n            }\r\n\r\n            const hardwareInstancedRendering = engine.getCaps().instancedArrays && (batch.visibleInstances[subMesh._id] !== null || renderingMesh.hasThinInstances);\r\n            const world = effectiveMesh.getWorldMatrix();\r\n\r\n            if (this.isReady(subMesh, hardwareInstancedRendering)) {\r\n                const drawWrapper = subMesh._getDrawWrapper();\r\n\r\n                if (!drawWrapper) {\r\n                    return;\r\n                }\r\n\r\n                const effect = drawWrapper.effect!;\r\n\r\n                engine.enableEffect(drawWrapper);\r\n                if (!hardwareInstancedRendering) {\r\n                    renderingMesh._bind(subMesh, effect, material.fillMode);\r\n                }\r\n\r\n                if (!this._useUbo) {\r\n                    effect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n                    effect.setMatrix(\"view\", scene.getViewMatrix());\r\n                } else {\r\n                    BindSceneUniformBuffer(effect, this._scene.getSceneUniformBuffer());\r\n                    this._scene.finalizeSceneUbo();\r\n                }\r\n\r\n                let sideOrientation: Nullable<number>;\r\n                const instanceDataStorage = renderingMesh._instanceDataStorage;\r\n\r\n                if (!instanceDataStorage.isFrozen && (material.backFaceCulling || material.sideOrientation !== null)) {\r\n                    const mainDeterminant = effectiveMesh._getWorldMatrixDeterminant();\r\n                    sideOrientation = material._getEffectiveOrientation(renderingMesh);\r\n\r\n                    if (mainDeterminant < 0) {\r\n                        sideOrientation = sideOrientation === Material.ClockWiseSideOrientation ? Material.CounterClockWiseSideOrientation : Material.ClockWiseSideOrientation;\r\n                    }\r\n                } else {\r\n                    sideOrientation = renderingMesh._effectiveSideOrientation;\r\n                }\r\n\r\n                material._preBind(drawWrapper, sideOrientation);\r\n\r\n                // Alpha test\r\n                if (material.needAlphaTestingForMesh(effectiveMesh)) {\r\n                    const alphaTexture = material.getAlphaTestTexture();\r\n                    if (alphaTexture) {\r\n                        effect.setTexture(\"diffuseSampler\", alphaTexture);\r\n                        effect.setMatrix(\"diffuseMatrix\", alphaTexture.getTextureMatrix());\r\n                    }\r\n                }\r\n\r\n                // Bump\r\n                if (\r\n                    (material.bumpTexture || material.normalTexture || material.geometryNormalTexture) &&\r\n                    scene.getEngine().getCaps().standardDerivatives &&\r\n                    MaterialFlags.BumpTextureEnabled\r\n                ) {\r\n                    const texture = material.bumpTexture || material.normalTexture || material.geometryNormalTexture;\r\n                    effect.setFloat3(\"vBumpInfos\", texture.coordinatesIndex, 1.0 / texture.level, material.parallaxScaleBias);\r\n                    effect.setMatrix(\"bumpMatrix\", texture.getTextureMatrix());\r\n                    effect.setTexture(\"bumpSampler\", texture);\r\n                    effect.setFloat2(\"vTangentSpaceParams\", material.invertNormalMapX ? -1.0 : 1.0, material.invertNormalMapY ? -1.0 : 1.0);\r\n                }\r\n\r\n                // Reflectivity\r\n                if (this._enableReflectivity) {\r\n                    // for PBR materials: cf. https://doc.babylonjs.com/features/featuresDeepDive/materials/using/masterPBR\r\n                    if (material.getClassName() === \"PBRMetallicRoughnessMaterial\") {\r\n                        // if it is a PBR material in MetallicRoughness Mode:\r\n                        if (material.metallicRoughnessTexture !== null) {\r\n                            effect.setTexture(\"reflectivitySampler\", material.metallicRoughnessTexture);\r\n                            effect.setMatrix(\"reflectivityMatrix\", material.metallicRoughnessTexture.getTextureMatrix());\r\n                        }\r\n                        if (material.metallic !== null) {\r\n                            effect.setFloat(\"metallic\", material.metallic);\r\n                        }\r\n                        if (material.roughness !== null) {\r\n                            effect.setFloat(\"glossiness\", 1.0 - material.roughness);\r\n                        }\r\n                        if (material.baseTexture !== null) {\r\n                            effect.setTexture(\"albedoSampler\", material.baseTexture);\r\n                            effect.setMatrix(\"albedoMatrix\", material.baseTexture.getTextureMatrix());\r\n                        }\r\n                        if (material.baseColor !== null) {\r\n                            effect.setColor3(\"albedoColor\", material.baseColor);\r\n                        }\r\n                    } else if (material.getClassName() === \"PBRSpecularGlossinessMaterial\") {\r\n                        // if it is a PBR material in Specular/Glossiness Mode:\r\n                        if (material.specularGlossinessTexture !== null) {\r\n                            effect.setTexture(\"reflectivitySampler\", material.specularGlossinessTexture);\r\n                            effect.setMatrix(\"reflectivityMatrix\", material.specularGlossinessTexture.getTextureMatrix());\r\n                        } else {\r\n                            if (material.specularColor !== null) {\r\n                                effect.setColor3(\"reflectivityColor\", material.specularColor);\r\n                            }\r\n                        }\r\n                        if (material.glossiness !== null) {\r\n                            effect.setFloat(\"glossiness\", material.glossiness);\r\n                        }\r\n                    } else if (material.getClassName() === \"PBRMaterial\") {\r\n                        // if it is the bigger PBRMaterial\r\n                        if (material.metallicTexture !== null) {\r\n                            effect.setTexture(\"reflectivitySampler\", material.metallicTexture);\r\n                            effect.setMatrix(\"reflectivityMatrix\", material.metallicTexture.getTextureMatrix());\r\n                        }\r\n                        if (material.metallic !== null) {\r\n                            effect.setFloat(\"metallic\", material.metallic);\r\n                        }\r\n\r\n                        if (material.roughness !== null) {\r\n                            effect.setFloat(\"glossiness\", 1.0 - material.roughness);\r\n                        }\r\n\r\n                        if (material.roughness !== null || material.metallic !== null || material.metallicTexture !== null) {\r\n                            // MetallicRoughness Model\r\n                            if (material.albedoTexture !== null) {\r\n                                effect.setTexture(\"albedoSampler\", material.albedoTexture);\r\n                                effect.setMatrix(\"albedoMatrix\", material.albedoTexture.getTextureMatrix());\r\n                            }\r\n                            if (material.albedoColor !== null) {\r\n                                effect.setColor3(\"albedoColor\", material.albedoColor);\r\n                            }\r\n                        } else {\r\n                            // SpecularGlossiness Model\r\n                            if (material.reflectivityTexture !== null) {\r\n                                effect.setTexture(\"reflectivitySampler\", material.reflectivityTexture);\r\n                                effect.setMatrix(\"reflectivityMatrix\", material.reflectivityTexture.getTextureMatrix());\r\n                            } else if (material.reflectivityColor !== null) {\r\n                                effect.setColor3(\"reflectivityColor\", material.reflectivityColor);\r\n                            }\r\n                            if (material.microSurface !== null) {\r\n                                effect.setFloat(\"glossiness\", material.microSurface);\r\n                            }\r\n                        }\r\n                    } else if (material.getClassName() === \"StandardMaterial\") {\r\n                        // if StandardMaterial:\r\n                        if (material.specularTexture !== null) {\r\n                            effect.setTexture(\"reflectivitySampler\", material.specularTexture);\r\n                            effect.setMatrix(\"reflectivityMatrix\", material.specularTexture.getTextureMatrix());\r\n                        }\r\n                        if (material.specularColor !== null) {\r\n                            effect.setColor3(\"reflectivityColor\", material.specularColor);\r\n                        }\r\n                    } else if (material.getClassName() === \"OpenPBRMaterial\") {\r\n                        // if it is a OpenPBR material:\r\n                        const openpbrMaterial = material as OpenPBRMaterial;\r\n                        if (openpbrMaterial._useRoughnessFromMetallicTextureGreen && openpbrMaterial.baseMetalnessTexture) {\r\n                            effect.setTexture(\"reflectivitySampler\", openpbrMaterial.baseMetalnessTexture);\r\n                            effect.setMatrix(\"reflectivityMatrix\", openpbrMaterial.baseMetalnessTexture.getTextureMatrix());\r\n                        } else if (openpbrMaterial.baseMetalnessTexture) {\r\n                            effect.setTexture(\"metallicSampler\", openpbrMaterial.baseMetalnessTexture);\r\n                            effect.setMatrix(\"metallicMatrix\", openpbrMaterial.baseMetalnessTexture.getTextureMatrix());\r\n                        } else if (openpbrMaterial.specularRoughnessTexture) {\r\n                            effect.setTexture(\"roughnessSampler\", openpbrMaterial.specularRoughnessTexture);\r\n                            effect.setMatrix(\"roughnessMatrix\", openpbrMaterial.specularRoughnessTexture.getTextureMatrix());\r\n                        }\r\n                        effect.setFloat(\"metallic\", openpbrMaterial.baseMetalness);\r\n                        effect.setFloat(\"glossiness\", 1.0 - openpbrMaterial.specularRoughness);\r\n                        if (openpbrMaterial.baseColorTexture !== null) {\r\n                            effect.setTexture(\"albedoSampler\", openpbrMaterial.baseColorTexture);\r\n                            effect.setMatrix(\"albedoMatrix\", openpbrMaterial.baseColorTexture.getTextureMatrix());\r\n                        }\r\n                        if (openpbrMaterial.baseColor !== null) {\r\n                            effect.setColor3(\"albedoColor\", openpbrMaterial.baseColor);\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // Clip plane\r\n                BindClipPlane(effect, material, this._scene);\r\n\r\n                // Bones\r\n                if (renderingMesh.useBones && renderingMesh.computeBonesUsingShaders && renderingMesh.skeleton) {\r\n                    const skeleton = renderingMesh.skeleton;\r\n\r\n                    if (skeleton.isUsingTextureForMatrices && effect.getUniformIndex(\"boneTextureWidth\") > -1) {\r\n                        const boneTexture = skeleton.getTransformMatrixTexture(renderingMesh);\r\n                        effect.setTexture(\"boneSampler\", boneTexture);\r\n                        effect.setFloat(\"boneTextureWidth\", 4.0 * (skeleton.bones.length + 1));\r\n                    } else {\r\n                        effect.setMatrices(\"mBones\", renderingMesh.skeleton.getTransformMatrices(renderingMesh));\r\n                    }\r\n\r\n                    if (this._enableVelocity || this._enableVelocityLinear) {\r\n                        effect.setMatrices(\"mPreviousBones\", this._previousBonesTransformationMatrices[renderingMesh.uniqueId]);\r\n                    }\r\n                }\r\n\r\n                // Morph targets\r\n                BindMorphTargetParameters(renderingMesh, effect);\r\n                if (renderingMesh.morphTargetManager && renderingMesh.morphTargetManager.isUsingTextureForTargets) {\r\n                    renderingMesh.morphTargetManager._bind(effect);\r\n                }\r\n\r\n                // Velocity\r\n                if (this._enableVelocity || this._enableVelocityLinear) {\r\n                    effect.setMatrix(\"previousWorld\", this._previousTransformationMatrices[effectiveMesh.uniqueId].world);\r\n                    effect.setMatrix(\"previousViewProjection\", this._previousTransformationMatrices[effectiveMesh.uniqueId].viewProjection);\r\n                }\r\n\r\n                if (hardwareInstancedRendering && renderingMesh.hasThinInstances) {\r\n                    effect.setMatrix(\"world\", world);\r\n                }\r\n\r\n                // Draw\r\n                renderingMesh._processRendering(effectiveMesh, subMesh, effect, material.fillMode, batch, hardwareInstancedRendering, (isInstance, w) => {\r\n                    if (!isInstance) {\r\n                        effect.setMatrix(\"world\", w);\r\n                    }\r\n                });\r\n            }\r\n\r\n            // Velocity\r\n            if (this._enableVelocity || this._enableVelocityLinear) {\r\n                this._previousTransformationMatrices[effectiveMesh.uniqueId].world = world.clone();\r\n                this._previousTransformationMatrices[effectiveMesh.uniqueId].viewProjection = this._scene.getTransformMatrix().clone();\r\n                if (renderingMesh.skeleton) {\r\n                    this._copyBonesTransformationMatrices(\r\n                        renderingMesh.skeleton.getTransformMatrices(renderingMesh),\r\n                        this._previousBonesTransformationMatrices[effectiveMesh.uniqueId]\r\n                    );\r\n                }\r\n            }\r\n        };\r\n\r\n        this._multiRenderTarget.customIsReadyFunction = (mesh: AbstractMesh, refreshRate: number, preWarm?: boolean) => {\r\n            if ((preWarm || refreshRate === 0) && mesh.subMeshes) {\r\n                for (let i = 0; i < mesh.subMeshes.length; ++i) {\r\n                    const subMesh = mesh.subMeshes[i];\r\n                    const material = subMesh.getMaterial();\r\n                    const renderingMesh = subMesh.getRenderingMesh();\r\n\r\n                    if (!material) {\r\n                        continue;\r\n                    }\r\n\r\n                    const batch = renderingMesh._getInstancesRenderList(subMesh._id, !!subMesh.getReplacementMesh());\r\n                    const hardwareInstancedRendering = engine.getCaps().instancedArrays && (batch.visibleInstances[subMesh._id] !== null || renderingMesh.hasThinInstances);\r\n\r\n                    if (!this.isReady(subMesh, hardwareInstancedRendering)) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return true;\r\n        };\r\n\r\n        this._multiRenderTarget.customRenderFunction = (\r\n            opaqueSubMeshes: SmartArray<SubMesh>,\r\n            alphaTestSubMeshes: SmartArray<SubMesh>,\r\n            transparentSubMeshes: SmartArray<SubMesh>,\r\n            depthOnlySubMeshes: SmartArray<SubMesh>\r\n        ): void => {\r\n            let index;\r\n\r\n            if (this._linkedWithPrePass) {\r\n                if (!this._prePassRenderer.enabled) {\r\n                    return;\r\n                }\r\n                this._scene.getEngine().bindAttachments(this._attachmentsFromPrePass);\r\n            }\r\n\r\n            if (depthOnlySubMeshes.length) {\r\n                engine.setColorWrite(false);\r\n                for (index = 0; index < depthOnlySubMeshes.length; index++) {\r\n                    renderSubMesh(depthOnlySubMeshes.data[index]);\r\n                }\r\n                engine.setColorWrite(true);\r\n            }\r\n\r\n            for (index = 0; index < opaqueSubMeshes.length; index++) {\r\n                renderSubMesh(opaqueSubMeshes.data[index]);\r\n            }\r\n\r\n            engine.setDepthWrite(false);\r\n            for (index = 0; index < alphaTestSubMeshes.length; index++) {\r\n                renderSubMesh(alphaTestSubMeshes.data[index]);\r\n            }\r\n\r\n            if (this.renderTransparentMeshes) {\r\n                for (index = 0; index < transparentSubMeshes.length; index++) {\r\n                    renderSubMesh(transparentSubMeshes.data[index]);\r\n                }\r\n            }\r\n            engine.setDepthWrite(true);\r\n        };\r\n    }\r\n\r\n    // Copies the bones transformation matrices into the target array and returns the target's reference\r\n    private _copyBonesTransformationMatrices(source: Float32Array, target: Float32Array): Float32Array {\r\n        for (let i = 0; i < source.length; i++) {\r\n            target[i] = source[i];\r\n        }\r\n\r\n        return target;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 3793, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/motionBlurConfiguration.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/motionBlurConfiguration.ts"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\n\r\n/**\r\n * Contains all parameters needed for the prepass to perform\r\n * motion blur\r\n */\r\nexport class MotionBlurConfiguration implements PrePassEffectConfiguration {\r\n    /**\r\n     * Is motion blur enabled\r\n     */\r\n    public enabled = false;\r\n\r\n    /**\r\n     * Name of the configuration\r\n     */\r\n    public name = \"motionBlur\";\r\n\r\n    /**\r\n     * Textures that should be present in the MRT for this effect to work\r\n     */\r\n    public readonly texturesRequired: number[] = [Constants.PREPASS_VELOCITY_TEXTURE_TYPE];\r\n}\r\n"],"names":[],"mappings":"AAGA;;;GAGG;;;;AACG,MAAO,uBAAuB;IAApC,aAAA;QACI;;WAEG,CACI,IAAA,CAAA,OAAO,GAAG,KAAK,CAAC;QAEvB;;WAEG,CACI,IAAA,CAAA,IAAI,GAAG,YAAY,CAAC;QAE3B;;WAEG,CACa,IAAA,CAAA,gBAAgB,GAAa;YAAC;SAAA,OAAS,CAAC,6BAA6B,CAAC,CAAC;IAC3F,CAAC;CAAA"}},
    {"offset": {"line": 3819, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/geometryBufferRendererSceneComponent.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/geometryBufferRendererSceneComponent.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport { Scene } from \"../scene\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport type { SmartArrayNoDuplicate } from \"../Misc/smartArray\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport { GeometryBufferRenderer } from \"./geometryBufferRenderer\";\r\nimport { Constants } from \"../Engines/constants\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _geometryBufferRenderer: Nullable<GeometryBufferRenderer>;\r\n\r\n        /**\r\n         * Gets or Sets the current geometry buffer associated to the scene.\r\n         */\r\n        geometryBufferRenderer: Nullable<GeometryBufferRenderer>;\r\n\r\n        /**\r\n         * Enables a GeometryBufferRender and associates it with the scene\r\n         * @param ratioOrDimensions defines the scaling ratio to apply to the renderer (1 by default which means same resolution). You can also directly pass a width and height for the generated textures\r\n         * @param depthFormat Format of the depth texture (default: Constants.TEXTUREFORMAT_DEPTH16)\r\n         * @param textureTypesAndFormats The types and formats of textures to create as render targets. If not provided, all textures will be RGBA and float or half float, depending on the engine capabilities.\r\n         * @returns the GeometryBufferRenderer\r\n         */\r\n        enableGeometryBufferRenderer(\r\n            ratioOrDimensions?: number | { width: number; height: number },\r\n            depthFormat?: number,\r\n            textureTypesAndFormats?: { [key: number]: { textureType: number; textureFormat: number } }\r\n        ): Nullable<GeometryBufferRenderer>;\r\n\r\n        /**\r\n         * Disables the GeometryBufferRender associated with the scene\r\n         */\r\n        disableGeometryBufferRenderer(): void;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"geometryBufferRenderer\", {\r\n    get: function (this: Scene) {\r\n        return this._geometryBufferRenderer;\r\n    },\r\n    set: function (this: Scene, value: Nullable<GeometryBufferRenderer>) {\r\n        if (value && value.isSupported) {\r\n            this._geometryBufferRenderer = value;\r\n        }\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nScene.prototype.enableGeometryBufferRenderer = function (\r\n    ratio: number | { width: number; height: number } = 1,\r\n    depthFormat = Constants.TEXTUREFORMAT_DEPTH16,\r\n    textureTypesAndFormats?: { [key: number]: { textureType: number; textureFormat: number } }\r\n): Nullable<GeometryBufferRenderer> {\r\n    if (this._geometryBufferRenderer) {\r\n        return this._geometryBufferRenderer;\r\n    }\r\n\r\n    this._geometryBufferRenderer = new GeometryBufferRenderer(this, ratio, depthFormat, textureTypesAndFormats);\r\n    if (!this._geometryBufferRenderer.isSupported) {\r\n        this._geometryBufferRenderer = null;\r\n    }\r\n\r\n    return this._geometryBufferRenderer;\r\n};\r\n\r\nScene.prototype.disableGeometryBufferRenderer = function (): void {\r\n    if (!this._geometryBufferRenderer) {\r\n        return;\r\n    }\r\n\r\n    this._geometryBufferRenderer.dispose();\r\n    this._geometryBufferRenderer = null;\r\n};\r\n\r\n/**\r\n * Defines the Geometry Buffer scene component responsible to manage a G-Buffer useful\r\n * in several rendering techniques.\r\n */\r\nexport class GeometryBufferRendererSceneComponent implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {\r\n        this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_GEOMETRYBUFFERRENDERER, this, this._gatherRenderTargets);\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        // Nothing to do for this component\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources\r\n     */\r\n    public dispose(): void {\r\n        // Nothing to do for this component\r\n    }\r\n\r\n    private _gatherRenderTargets(renderTargets: SmartArrayNoDuplicate<RenderTargetTexture>): void {\r\n        if (this.scene._geometryBufferRenderer) {\r\n            renderTargets.push(this.scene._geometryBufferRenderer.getGBuffer());\r\n        }\r\n    }\r\n}\r\n\r\nGeometryBufferRenderer._SceneComponentInitialization = (scene: Scene) => {\r\n    // Register the G Buffer component to the scene.\r\n    let component = scene._getComponent(SceneComponentConstants.NAME_GEOMETRYBUFFERRENDERER) as GeometryBufferRendererSceneComponent;\r\n    if (!component) {\r\n        component = new GeometryBufferRendererSceneComponent(scene);\r\n        scene._addComponent(component);\r\n    }\r\n};\r\n"],"names":[],"mappings":";;;;AACA,OAAO,EAAE,KAAK,EAAE,MAAM,UAAU,CAAC;AAEjC,OAAO,EAAE,uBAAuB,EAAE,MAAM,mBAAmB,CAAC;AAG5D,OAAO,EAAE,sBAAsB,EAAE,MAAM,0BAA0B,CAAC;;;;AAkClE,MAAM,CAAC,cAAc,CAAC,sNAAK,CAAC,SAAS,EAAE,wBAAwB,EAAE;IAC7D,GAAG,EAAE;QACD,OAAO,IAAI,CAAC,uBAAuB,CAAC;IACxC,CAAC;IACD,GAAG,EAAE,SAAuB,KAAuC;QAC/D,IAAI,KAAK,IAAI,KAAK,CAAC,WAAW,EAAE,CAAC;YAC7B,IAAI,CAAC,uBAAuB,GAAG,KAAK,CAAC;QACzC,CAAC;IACL,CAAC;IACD,UAAU,EAAE,IAAI;IAChB,YAAY,EAAE,IAAI;CACrB,CAAC,CAAC;AAEH,sNAAK,CAAC,SAAS,CAAC,4BAA4B,GAAG,SAC3C,QAAoD,CAAC,EACrD,WAAW,GAAG,EAAA,EAAA,KAAS,CAAC,gBAAA,KAAqB,EAC7C,sBAA0F;IAE1F,IAAI,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAC/B,OAAO,IAAI,CAAC,uBAAuB,CAAC;IACxC,CAAC;IAED,IAAI,CAAC,uBAAuB,GAAG,IAAI,qQAAsB,CAAC,IAAI,EAAE,KAAK,EAAE,WAAW,EAAE,sBAAsB,CAAC,CAAC;IAC5G,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,WAAW,EAAE,CAAC;QAC5C,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;IACxC,CAAC;IAED,OAAO,IAAI,CAAC,uBAAuB,CAAC;AACxC,CAAC,CAAC;AAEF,sNAAK,CAAC,SAAS,CAAC,6BAA6B,GAAG;IAC5C,IAAI,CAAC,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAChC,OAAO;IACX,CAAC;IAED,IAAI,CAAC,uBAAuB,CAAC,OAAO,EAAE,CAAC;IACvC,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC;AACxC,CAAC,CAAC;AAMI,MAAO,oCAAoC;IAW7C;;;OAGG,CACH,YAAY,KAAY,CAAA;QAdxB;;WAEG,CACa,IAAA,CAAA,IAAI,GAAG,iPAAuB,CAAC,2BAA2B,CAAC;QAYvE,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;IACvB,CAAC;IAED;;OAEG,CACI,QAAQ,GAAA;QACX,IAAI,CAAC,KAAK,CAAC,yBAAyB,CAAC,YAAY,CAAC,iPAAuB,CAAC,+CAA+C,EAAE,IAAI,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;IAChK,CAAC;IAED;;;OAGG,CACI,OAAO,GAAA;IACV,mCAAmC;IACvC,CAAC;IAED;;OAEG,CACI,OAAO,GAAA;IACV,mCAAmC;IACvC,CAAC;IAEO,oBAAoB,CAAC,aAAyD,EAAA;QAClF,IAAI,IAAI,CAAC,KAAK,CAAC,uBAAuB,EAAE,CAAC;YACrC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,uBAAuB,CAAC,UAAU,EAAE,CAAC,CAAC;QACxE,CAAC;IACL,CAAC;CACJ;AAED,qQAAsB,CAAC,6BAA6B,GAAG,CAAC,KAAY,EAAE,EAAE;IACpE,gDAAgD;IAChD,IAAI,SAAS,GAAG,KAAK,CAAC,aAAa,CAAC,iPAAuB,CAAC,2BAA2B,CAAyC,CAAC;IACjI,IAAI,CAAC,SAAS,EAAE,CAAC;QACb,SAAS,GAAG,IAAI,oCAAoC,CAAC,KAAK,CAAC,CAAC;QAC5D,KAAK,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;IACnC,CAAC;AACL,CAAC,CAAC"}},
    {"offset": {"line": 3902, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/ssao2Configuration.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/ssao2Configuration.ts"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\n\r\n/**\r\n * Contains all parameters needed for the prepass to perform\r\n * screen space subsurface scattering\r\n */\r\nexport class SSAO2Configuration implements PrePassEffectConfiguration {\r\n    /**\r\n     * Is subsurface enabled\r\n     */\r\n    public enabled = false;\r\n\r\n    /**\r\n     * Name of the configuration\r\n     */\r\n    public name = \"ssao2\";\r\n\r\n    /**\r\n     * Textures that should be present in the MRT for this effect to work\r\n     */\r\n    public readonly texturesRequired: number[] = [Constants.PREPASS_NORMAL_TEXTURE_TYPE, Constants.PREPASS_DEPTH_TEXTURE_TYPE];\r\n}\r\n"],"names":[],"mappings":"AAGA;;;GAGG;;;;AACG,MAAO,kBAAkB;IAA/B,aAAA;QACI;;WAEG,CACI,IAAA,CAAA,OAAO,GAAG,KAAK,CAAC;QAEvB;;WAEG,CACI,IAAA,CAAA,IAAI,GAAG,OAAO,CAAC;QAEtB;;WAEG,CACa,IAAA,CAAA,gBAAgB,GAAa;YAAC;YAAA;SAAA,IAAS,CAAC,2BAA2B,EAAE,SAAS,CAAC,0BAA0B,CAAC,CAAC;IAC/H,CAAC;CAAA"}},
    {"offset": {"line": 3929, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/screenSpaceReflectionsConfiguration.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/screenSpaceReflectionsConfiguration.ts"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\n\r\n/**\r\n * Contains all parameters needed for the prepass to perform\r\n * screen space reflections\r\n */\r\nexport class ScreenSpaceReflectionsConfiguration implements PrePassEffectConfiguration {\r\n    /**\r\n     * Is ssr enabled\r\n     */\r\n    public enabled = false;\r\n\r\n    /**\r\n     * Name of the configuration\r\n     */\r\n    public name = \"screenSpaceReflections\";\r\n\r\n    /**\r\n     * Textures that should be present in the MRT for this effect to work\r\n     */\r\n    public readonly texturesRequired: number[] = [Constants.PREPASS_NORMAL_TEXTURE_TYPE, Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE, Constants.PREPASS_POSITION_TEXTURE_TYPE];\r\n}\r\n"],"names":[],"mappings":"AAGA;;;GAGG;;;;AACG,MAAO,mCAAmC;IAAhD,aAAA;QACI;;WAEG,CACI,IAAA,CAAA,OAAO,GAAG,KAAK,CAAC;QAEvB;;WAEG,CACI,IAAA,CAAA,IAAI,GAAG,wBAAwB,CAAC;QAEvC;;WAEG,CACa,IAAA,CAAA,gBAAgB,GAAa;YAAC;YAAA;YAAA;SAAA,CAAS,CAAC,2BAA2B,EAAE,SAAS,CAAC,iCAAiC,EAAE,SAAS,CAAC,6BAA6B,CAAC,CAAC;IAC/K,CAAC;CAAA"}},
    {"offset": {"line": 3957, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/screenSpaceReflections2Configuration.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/screenSpaceReflections2Configuration.ts"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\n\r\n/**\r\n * Contains all parameters needed for the prepass to perform\r\n * screen space reflections\r\n */\r\nexport class ScreenSpaceReflections2Configuration implements PrePassEffectConfiguration {\r\n    /**\r\n     * Is ssr enabled\r\n     */\r\n    public enabled = false;\r\n\r\n    /**\r\n     * Name of the configuration\r\n     */\r\n    public name = \"screenSpaceReflections2\";\r\n\r\n    /**\r\n     * Textures that should be present in the MRT for this effect to work\r\n     */\r\n    public readonly texturesRequired: number[] = [Constants.PREPASS_NORMAL_TEXTURE_TYPE, Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE];\r\n\r\n    /**\r\n     * @param useScreenspaceDepth If the effect should use the screenspace depth texture instead of a linear one\r\n     */\r\n    constructor(useScreenspaceDepth: boolean = false) {\r\n        this.texturesRequired.push(useScreenspaceDepth ? Constants.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE : Constants.PREPASS_DEPTH_TEXTURE_TYPE);\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAGA;;;GAGG;;;;AACG,MAAO,oCAAoC;IAgB7C;;OAEG,CACH,YAAY,sBAA+B,KAAK,CAAA;QAlBhD;;WAEG,CACI,IAAA,CAAA,OAAO,GAAG,KAAK,CAAC;QAEvB;;WAEG,CACI,IAAA,CAAA,IAAI,GAAG,yBAAyB,CAAC;QAExC;;WAEG,CACa,IAAA,CAAA,gBAAgB,GAAa;YAAC;YAAA;SAAA,IAAS,CAAC,2BAA2B,EAAE,SAAS,CAAC,iCAAiC,CAAC,CAAC;QAM9H,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC,KAAA,IAAS,CAAC,sCAAsC,CAAC,CAAC,CAAC,SAAS,CAAC,0BAA0B,CAAC,CAAC;IAC9I,CAAC;CACJ"}},
    {"offset": {"line": 3987, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/boundingBoxRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/boundingBoxRenderer.ts"],"sourcesContent":["import { Scene } from \"../scene\";\r\nimport { Buffer, VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport { Matrix, Vector3 } from \"../Maths/math.vector\";\r\nimport { SmartArray } from \"../Misc/smartArray\";\r\nimport type { Nullable, FloatArray, IndicesArray } from \"../types\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport { BoundingBox } from \"../Culling/boundingBox\";\r\nimport type { Effect } from \"../Materials/effect\";\r\nimport { Material } from \"../Materials/material\";\r\nimport { ShaderMaterial } from \"../Materials/shaderMaterial\";\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport { Color3 } from \"../Maths/math.color\";\r\nimport { Observable } from \"../Misc/observable\";\r\nimport { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport { UniformBuffer } from \"../Materials/uniformBuffer\";\r\nimport { CreateBoxVertexData } from \"../Meshes/Builders/boxBuilder\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport { _RetryWithInterval } from \"../Misc/timingTools\";\r\nimport { Logger } from \"../Misc/logger\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _boundingBoxRenderer: BoundingBoxRenderer;\r\n\r\n        /** @internal (Backing field) */\r\n        _forceShowBoundingBoxes: boolean;\r\n\r\n        /**\r\n         * Gets or sets a boolean indicating if all bounding boxes must be rendered\r\n         */\r\n        forceShowBoundingBoxes: boolean;\r\n\r\n        /**\r\n         * Gets the bounding box renderer associated with the scene\r\n         * @returns a BoundingBoxRenderer\r\n         */\r\n        getBoundingBoxRenderer(): BoundingBoxRenderer;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"forceShowBoundingBoxes\", {\r\n    get: function (this: Scene) {\r\n        return this._forceShowBoundingBoxes || false;\r\n    },\r\n    set: function (this: Scene, value: boolean) {\r\n        this._forceShowBoundingBoxes = value;\r\n        // Lazyly creates a BB renderer if needed.\r\n        if (value) {\r\n            this.getBoundingBoxRenderer();\r\n        }\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nScene.prototype.getBoundingBoxRenderer = function (): BoundingBoxRenderer {\r\n    if (!this._boundingBoxRenderer) {\r\n        this._boundingBoxRenderer = new BoundingBoxRenderer(this);\r\n    }\r\n\r\n    return this._boundingBoxRenderer;\r\n};\r\n\r\ndeclare module \"../Meshes/abstractMesh\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface AbstractMesh {\r\n        /** @internal (Backing field) */\r\n        _showBoundingBox: boolean;\r\n\r\n        /**\r\n         * Gets or sets a boolean indicating if the bounding box must be rendered as well (false by default)\r\n         */\r\n        showBoundingBox: boolean;\r\n    }\r\n}\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"showBoundingBox\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._showBoundingBox || false;\r\n    },\r\n    set: function (this: AbstractMesh, value: boolean) {\r\n        this._showBoundingBox = value;\r\n        // Lazyly creates a BB renderer if needed.\r\n        if (value) {\r\n            this.getScene().getBoundingBoxRenderer();\r\n        }\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nconst TempMatrix = Matrix.Identity();\r\nconst TempVec1 = new Vector3();\r\nconst TempVec2 = new Vector3();\r\n// `Matrix.asArray` returns its internal array, so it can be directly updated\r\nconst TempMatrixArray = TempMatrix.asArray();\r\n\r\n// BoundingBox copies from it, so it's safe to reuse vectors here\r\nconst DummyBoundingBox = new BoundingBox(TempVec1, TempVec1);\r\n\r\n/**\r\n * Component responsible of rendering the bounding box of the meshes in a scene.\r\n * This is usually used through the mesh.showBoundingBox or the scene.forceShowBoundingBoxes properties\r\n */\r\nexport class BoundingBoxRenderer implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_BOUNDINGBOXRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Color of the bounding box lines placed in front of an object\r\n     */\r\n    public frontColor = new Color3(1, 1, 1);\r\n    /**\r\n     * Color of the bounding box lines placed behind an object\r\n     */\r\n    public backColor = new Color3(0.1, 0.1, 0.1);\r\n    /**\r\n     * Defines if the renderer should show the back lines or not\r\n     */\r\n    public showBackLines = true;\r\n\r\n    /**\r\n     * Observable raised before rendering a bounding box\r\n     * When {@link BoundingBoxRenderer.useInstances} enabled,\r\n     * this would only be triggered once for one rendering, instead of once every bounding box.\r\n     * Events would be triggered with a dummy box to keep backwards compatibility,\r\n     * the passed bounding box has no meaning and should be ignored.\r\n     */\r\n    public onBeforeBoxRenderingObservable = new Observable<BoundingBox>();\r\n\r\n    /**\r\n     * Observable raised after rendering a bounding box\r\n     * When {@link BoundingBoxRenderer.useInstances} enabled,\r\n     * this would only be triggered once for one rendering, instead of once every bounding box.\r\n     * Events would be triggered with a dummy box to keep backwards compatibility,\r\n     * the passed bounding box has no meaning and should be ignored.\r\n     */\r\n    public onAfterBoxRenderingObservable = new Observable<BoundingBox>();\r\n\r\n    /**\r\n     * Observable raised after resources are created\r\n     */\r\n    public onResourcesReadyObservable = new Observable<BoundingBoxRenderer>();\r\n\r\n    /**\r\n     * When false, no bounding boxes will be rendered\r\n     */\r\n    public enabled = true;\r\n\r\n    /** Shader language used by the renderer */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this renderer.\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public renderList = new SmartArray<BoundingBox>(32);\r\n\r\n    private _colorShader: ShaderMaterial;\r\n    private _colorShaderForOcclusionQuery: ShaderMaterial;\r\n    private _vertexBuffers: { [key: string]: Nullable<VertexBuffer> } = {};\r\n    private _indexBuffer: DataBuffer;\r\n    private _fillIndexBuffer: Nullable<DataBuffer> = null;\r\n    private _fillIndexData: Nullable<IndicesArray> = null;\r\n    private _uniformBufferFront: UniformBuffer;\r\n    private _uniformBufferBack: UniformBuffer;\r\n    private _renderPassIdForOcclusionQuery: number;\r\n    /**\r\n     * Internal buffer for instanced rendering\r\n     */\r\n    private _matrixBuffer: Nullable<Buffer> = null;\r\n    private _matrices: Nullable<Float32Array> = null;\r\n\r\n    /**\r\n     * Internal state of whether instanced rendering enabled\r\n     */\r\n    protected _useInstances = false;\r\n\r\n    /** @internal */\r\n    public _drawWrapperFront: Nullable<DrawWrapper> = null;\r\n    /** @internal */\r\n    public _drawWrapperBack: Nullable<DrawWrapper> = null;\r\n\r\n    /**\r\n     * Instantiates a new bounding box renderer in a scene.\r\n     * @param scene the scene the  renderer renders in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n\r\n        const engine = this.scene.getEngine();\r\n        if (engine.isWebGPU) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n        }\r\n\r\n        scene._addComponent(this);\r\n        this._uniformBufferFront = new UniformBuffer(this.scene.getEngine(), undefined, undefined, \"BoundingBoxRendererFront\", true);\r\n        this._buildUniformLayout(this._uniformBufferFront);\r\n        this._uniformBufferBack = new UniformBuffer(this.scene.getEngine(), undefined, undefined, \"BoundingBoxRendererBack\", true);\r\n        this._buildUniformLayout(this._uniformBufferBack);\r\n    }\r\n\r\n    private _buildUniformLayout(ubo: UniformBuffer): void {\r\n        ubo.addUniform(\"color\", 4);\r\n        ubo.addUniform(\"world\", 16);\r\n        ubo.addUniform(\"viewProjection\", 16);\r\n        ubo.addUniform(\"viewProjectionR\", 16);\r\n        ubo.create();\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {\r\n        this.scene._beforeEvaluateActiveMeshStage.registerStep(SceneComponentConstants.STEP_BEFOREEVALUATEACTIVEMESH_BOUNDINGBOXRENDERER, this, this.reset);\r\n\r\n        this.scene._preActiveMeshStage.registerStep(SceneComponentConstants.STEP_PREACTIVEMESH_BOUNDINGBOXRENDERER, this, this._preActiveMesh);\r\n\r\n        this.scene._evaluateSubMeshStage.registerStep(SceneComponentConstants.STEP_EVALUATESUBMESH_BOUNDINGBOXRENDERER, this, this._evaluateSubMesh);\r\n\r\n        this.scene._afterRenderingGroupDrawStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERINGGROUPDRAW_BOUNDINGBOXRENDERER, this, this.render);\r\n    }\r\n\r\n    /**\r\n     * Checks if the renderer is ready asynchronously.\r\n     * @param timeStep Time step in ms between retries (default is 16)\r\n     * @param maxTimeout Maximum time in ms to wait for the graph to be ready (default is 30000)\r\n     * @returns The promise that resolves when the renderer is ready\r\n     */\r\n    public async whenReadyAsync(timeStep = 16, maxTimeout = 30000): Promise<void> {\r\n        this._prepareResources();\r\n        return await new Promise((resolve) => {\r\n            _RetryWithInterval(\r\n                () => {\r\n                    return this._colorShader.isReady();\r\n                },\r\n                () => {\r\n                    resolve();\r\n                },\r\n                (err, isTimeout) => {\r\n                    if (!isTimeout) {\r\n                        Logger.Error(\"BoundingBoxRenderer: An unexpected error occurred while waiting for the renderer to be ready.\");\r\n                        if (err) {\r\n                            Logger.Error(err);\r\n                            if (err.stack) {\r\n                                Logger.Error(err.stack);\r\n                            }\r\n                        }\r\n                    } else {\r\n                        Logger.Error(`BoundingBoxRenderer: Timeout while waiting for the renderer to be ready.`);\r\n                        if (err) {\r\n                            Logger.Error(err);\r\n                        }\r\n                    }\r\n                },\r\n                timeStep,\r\n                maxTimeout\r\n            );\r\n        });\r\n    }\r\n\r\n    /** @internal */\r\n    public _evaluateSubMesh(mesh: AbstractMesh, subMesh: SubMesh): void {\r\n        if (mesh.showSubMeshesBoundingBox) {\r\n            const boundingInfo = subMesh.getBoundingInfo();\r\n            if (boundingInfo !== null && boundingInfo !== undefined) {\r\n                boundingInfo.boundingBox._tag = mesh.renderingGroupId;\r\n                this.renderList.push(boundingInfo.boundingBox);\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _preActiveMesh(mesh: AbstractMesh): void {\r\n        if (mesh.showBoundingBox || this.scene.forceShowBoundingBoxes) {\r\n            const boundingInfo = mesh.getBoundingInfo();\r\n            boundingInfo.boundingBox._tag = mesh.renderingGroupId;\r\n            this.renderList.push(boundingInfo.boundingBox);\r\n        }\r\n    }\r\n\r\n    private _prepareResources(): void {\r\n        if (this._colorShader) {\r\n            return;\r\n        }\r\n\r\n        this._colorShader = new ShaderMaterial(\r\n            \"colorShader\",\r\n            this.scene,\r\n            \"boundingBoxRenderer\",\r\n            {\r\n                attributes: [VertexBuffer.PositionKind, \"world0\", \"world1\", \"world2\", \"world3\"],\r\n\r\n                uniforms: [\"world\", \"viewProjection\", \"viewProjectionR\", \"color\"],\r\n                uniformBuffers: [\"BoundingBoxRenderer\"],\r\n                shaderLanguage: this._shaderLanguage,\r\n                extraInitializationsAsync: async () => {\r\n                    if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                        await Promise.all([import(\"../ShadersWGSL/boundingBoxRenderer.vertex\"), import(\"../ShadersWGSL/boundingBoxRenderer.fragment\")]);\r\n                    } else {\r\n                        await Promise.all([import(\"../Shaders/boundingBoxRenderer.vertex\"), import(\"../Shaders/boundingBoxRenderer.fragment\")]);\r\n                    }\r\n                },\r\n            },\r\n            false\r\n        );\r\n        this._colorShader.setDefine(\"INSTANCES\", this._useInstances);\r\n        this._colorShader.doNotSerialize = true;\r\n\r\n        this._colorShader.reservedDataStore = {\r\n            hidden: true,\r\n        };\r\n\r\n        this._colorShaderForOcclusionQuery = new ShaderMaterial(\r\n            \"colorShaderOccQuery\",\r\n            this.scene,\r\n            \"boundingBoxRenderer\",\r\n            {\r\n                attributes: [VertexBuffer.PositionKind],\r\n                uniforms: [\"world\", \"viewProjection\", \"viewProjectionR\", \"color\"],\r\n                uniformBuffers: [\"BoundingBoxRenderer\"],\r\n                shaderLanguage: this._shaderLanguage,\r\n                extraInitializationsAsync: async () => {\r\n                    if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                        await Promise.all([import(\"../ShadersWGSL/boundingBoxRenderer.vertex\"), import(\"../ShadersWGSL/boundingBoxRenderer.fragment\")]);\r\n                    } else {\r\n                        await Promise.all([import(\"../Shaders/boundingBoxRenderer.vertex\"), import(\"../Shaders/boundingBoxRenderer.fragment\")]);\r\n                    }\r\n                },\r\n            },\r\n            true\r\n        );\r\n        this._colorShaderForOcclusionQuery.doNotSerialize = true;\r\n\r\n        this._colorShaderForOcclusionQuery.reservedDataStore = {\r\n            hidden: true,\r\n        };\r\n\r\n        const engine = this.scene.getEngine();\r\n        const boxdata = CreateBoxVertexData({ size: 1.0 });\r\n        this._vertexBuffers[VertexBuffer.PositionKind] = new VertexBuffer(engine, <FloatArray>boxdata.positions, VertexBuffer.PositionKind, false);\r\n        this._createIndexBuffer();\r\n        this._fillIndexData = boxdata.indices;\r\n        this.onResourcesReadyObservable.notifyObservers(this);\r\n    }\r\n\r\n    private _createIndexBuffer(): void {\r\n        const engine = this.scene.getEngine();\r\n        this._indexBuffer = engine.createIndexBuffer([0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 7, 1, 6, 2, 5, 3, 4]);\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        const vb = this._vertexBuffers[VertexBuffer.PositionKind];\r\n        if (vb) {\r\n            vb._rebuild();\r\n        }\r\n        this._createIndexBuffer();\r\n\r\n        if (this._matrixBuffer) {\r\n            this._matrixBuffer._rebuild();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public reset(): void {\r\n        this.renderList.reset();\r\n    }\r\n\r\n    /**\r\n     * Render the bounding boxes of a specific rendering group\r\n     * @param renderingGroupId defines the rendering group to render\r\n     */\r\n    public render(renderingGroupId: number): void {\r\n        if (this.renderList.length === 0 || !this.enabled) {\r\n            return;\r\n        }\r\n\r\n        if (this._useInstances) {\r\n            this._renderInstanced(renderingGroupId);\r\n            return;\r\n        }\r\n\r\n        this._prepareResources();\r\n\r\n        if (!this._colorShader.isReady()) {\r\n            return;\r\n        }\r\n\r\n        const engine = this.scene.getEngine();\r\n        engine.setDepthWrite(false);\r\n\r\n        const transformMatrix = this.scene.getTransformMatrix();\r\n\r\n        for (let boundingBoxIndex = 0; boundingBoxIndex < this.renderList.length; boundingBoxIndex++) {\r\n            const boundingBox = this.renderList.data[boundingBoxIndex];\r\n            if (boundingBox._tag !== renderingGroupId) {\r\n                continue;\r\n            }\r\n\r\n            this._createWrappersForBoundingBox(boundingBox);\r\n            this.onBeforeBoxRenderingObservable.notifyObservers(boundingBox);\r\n\r\n            const min = boundingBox.minimum;\r\n            const max = boundingBox.maximum;\r\n            const diff = max.subtract(min);\r\n            const median = min.add(diff.scale(0.5));\r\n\r\n            const worldMatrix = Matrix.Scaling(diff.x, diff.y, diff.z)\r\n                .multiply(Matrix.Translation(median.x, median.y, median.z))\r\n                .multiply(boundingBox.getWorldMatrix());\r\n\r\n            const useReverseDepthBuffer = engine.useReverseDepthBuffer;\r\n\r\n            if (this.showBackLines) {\r\n                const drawWrapperBack = boundingBox._drawWrapperBack ?? this._colorShader._getDrawWrapper();\r\n\r\n                this._colorShader._preBind(drawWrapperBack);\r\n\r\n                engine.bindBuffers(this._vertexBuffers, this._indexBuffer, this._colorShader.getEffect());\r\n\r\n                // Back\r\n                if (useReverseDepthBuffer) {\r\n                    engine.setDepthFunctionToLessOrEqual();\r\n                } else {\r\n                    engine.setDepthFunctionToGreaterOrEqual();\r\n                }\r\n                this._uniformBufferBack.bindToEffect(drawWrapperBack.effect!, \"BoundingBoxRenderer\");\r\n                this._uniformBufferBack.updateColor4(\"color\", this.backColor, 1);\r\n                this._uniformBufferBack.updateMatrix(\"world\", worldMatrix);\r\n                this._uniformBufferBack.updateMatrix(\"viewProjection\", transformMatrix);\r\n                this._uniformBufferBack.update();\r\n\r\n                // Draw order\r\n                engine.drawElementsType(Material.LineListDrawMode, 0, 24);\r\n            }\r\n\r\n            const drawWrapperFront = boundingBox._drawWrapperFront ?? this._colorShader._getDrawWrapper();\r\n\r\n            this._colorShader._preBind(drawWrapperFront);\r\n\r\n            engine.bindBuffers(this._vertexBuffers, this._indexBuffer, this._colorShader.getEffect());\r\n\r\n            // Front\r\n            if (useReverseDepthBuffer) {\r\n                engine.setDepthFunctionToGreater();\r\n            } else {\r\n                engine.setDepthFunctionToLess();\r\n            }\r\n            this._uniformBufferFront.bindToEffect(drawWrapperFront.effect!, \"BoundingBoxRenderer\");\r\n            this._uniformBufferFront.updateColor4(\"color\", this.frontColor, 1);\r\n            this._uniformBufferFront.updateMatrix(\"world\", worldMatrix);\r\n            this._uniformBufferFront.updateMatrix(\"viewProjection\", transformMatrix);\r\n            this._uniformBufferFront.update();\r\n\r\n            // Draw order\r\n            engine.drawElementsType(Material.LineListDrawMode, 0, 24);\r\n\r\n            this.onAfterBoxRenderingObservable.notifyObservers(boundingBox);\r\n        }\r\n        this._colorShader.unbind();\r\n        engine.setDepthFunctionToLessOrEqual();\r\n        engine.setDepthWrite(true);\r\n    }\r\n\r\n    private _createWrappersForBoundingBox(boundingBox: BoundingBox | BoundingBoxRenderer): void {\r\n        if (!boundingBox._drawWrapperFront) {\r\n            const engine = this.scene.getEngine();\r\n\r\n            boundingBox._drawWrapperFront = new DrawWrapper(engine);\r\n            boundingBox._drawWrapperBack = new DrawWrapper(engine);\r\n\r\n            boundingBox._drawWrapperFront.setEffect(this._colorShader.getEffect());\r\n            boundingBox._drawWrapperBack.setEffect(this._colorShader.getEffect());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * In case of occlusion queries, we can render the occlusion bounding box through this method\r\n     * @param mesh Define the mesh to render the occlusion bounding box for\r\n     */\r\n    public renderOcclusionBoundingBox(mesh: AbstractMesh): void {\r\n        const engine = this.scene.getEngine();\r\n\r\n        if (this._renderPassIdForOcclusionQuery === undefined) {\r\n            this._renderPassIdForOcclusionQuery = engine.createRenderPassId(`Render pass for occlusion query`);\r\n        }\r\n\r\n        const currentRenderPassId = engine.currentRenderPassId;\r\n\r\n        engine.currentRenderPassId = this._renderPassIdForOcclusionQuery;\r\n\r\n        this._prepareResources();\r\n\r\n        const subMesh = mesh.subMeshes[0];\r\n\r\n        if (!this._colorShaderForOcclusionQuery.isReady(mesh, undefined, subMesh) || !mesh.hasBoundingInfo) {\r\n            engine.currentRenderPassId = currentRenderPassId;\r\n            return;\r\n        }\r\n\r\n        if (!this._fillIndexBuffer) {\r\n            this._fillIndexBuffer = engine.createIndexBuffer(this._fillIndexData!);\r\n        }\r\n\r\n        const useReverseDepthBuffer = engine.useReverseDepthBuffer;\r\n\r\n        engine.setDepthWrite(false);\r\n        engine.setColorWrite(false);\r\n\r\n        const boundingBox = mesh.getBoundingInfo().boundingBox;\r\n        const min = boundingBox.minimum;\r\n        const max = boundingBox.maximum;\r\n        const diff = max.subtract(min);\r\n        const median = min.add(diff.scale(0.5));\r\n\r\n        const worldMatrix = Matrix.Scaling(diff.x, diff.y, diff.z)\r\n            .multiply(Matrix.Translation(median.x, median.y, median.z))\r\n            .multiply(boundingBox.getWorldMatrix());\r\n\r\n        const drawWrapper = subMesh._drawWrapper;\r\n\r\n        this._colorShaderForOcclusionQuery._preBind(drawWrapper);\r\n\r\n        engine.bindBuffers(this._vertexBuffers, this._fillIndexBuffer, <Effect>drawWrapper.effect);\r\n\r\n        if (useReverseDepthBuffer) {\r\n            engine.setDepthFunctionToGreater();\r\n        } else {\r\n            engine.setDepthFunctionToLess();\r\n        }\r\n\r\n        this.scene.resetCachedMaterial();\r\n\r\n        this._uniformBufferFront.bindToEffect(drawWrapper.effect!, \"BoundingBoxRenderer\");\r\n        this._uniformBufferFront.updateMatrix(\"world\", worldMatrix);\r\n        this._uniformBufferFront.updateMatrix(\"viewProjection\", this.scene.getTransformMatrix());\r\n        this._uniformBufferFront.update();\r\n\r\n        engine.drawElementsType(Material.TriangleFillMode, 0, 36);\r\n\r\n        this._colorShaderForOcclusionQuery.unbind();\r\n        engine.setDepthFunctionToLessOrEqual();\r\n        engine.setDepthWrite(true);\r\n        engine.setColorWrite(true);\r\n\r\n        engine.currentRenderPassId = currentRenderPassId;\r\n    }\r\n\r\n    /**\r\n     * Sets whether to use instanced rendering.\r\n     * When not enabled, BoundingBoxRenderer renders in a loop,\r\n     * calling engine.drawElementsType for each bounding box in renderList,\r\n     * making every bounding box 1 or 2 draw call.\r\n     * When enabled, it collects bounding boxes to render,\r\n     * and render all boxes in 1 or 2 draw call.\r\n     * This could make the rendering with many bounding boxes much faster than not enabled,\r\n     * but could result in a difference in rendering result if\r\n     * {@link BoundingBoxRenderer.showBackLines} enabled,\r\n     * because drawing the black/white part of each box one after the other\r\n     * can be different from drawing the black part of all boxes and then the white part.\r\n     * Also, when enabled, events of {@link BoundingBoxRenderer.onBeforeBoxRenderingObservable}\r\n     * and {@link BoundingBoxRenderer.onAfterBoxRenderingObservable} would only be triggered once\r\n     * for one rendering, instead of once every bounding box.\r\n     * Events would be triggered with a dummy box to keep backwards compatibility,\r\n     * the passed bounding box has no meaning and should be ignored.\r\n     * @param val whether to use instanced rendering\r\n     */\r\n    public set useInstances(val: boolean) {\r\n        this._useInstances = val;\r\n        if (this._colorShader) {\r\n            this._colorShader.setDefine(\"INSTANCES\", val);\r\n        }\r\n        if (!val) {\r\n            this._cleanupInstances();\r\n        }\r\n    }\r\n\r\n    public get useInstances(): boolean {\r\n        return this._useInstances;\r\n    }\r\n\r\n    /**\r\n     * Instanced render the bounding boxes of a specific rendering group\r\n     * @param renderingGroupId defines the rendering group to render\r\n     */\r\n    private _renderInstanced(renderingGroupId: number): void {\r\n        if (this.renderList.length === 0 || !this.enabled) {\r\n            return;\r\n        }\r\n        this._prepareResources();\r\n\r\n        if (!this._colorShader.isReady()) {\r\n            return;\r\n        }\r\n\r\n        const colorShader = this._colorShader;\r\n        let matrices = this._matrices;\r\n        const expectedLength = this.renderList.length * 16;\r\n        if (!matrices || matrices.length < expectedLength || matrices.length > expectedLength * 2) {\r\n            matrices = new Float32Array(expectedLength);\r\n            this._matrices = matrices;\r\n        }\r\n\r\n        this.onBeforeBoxRenderingObservable.notifyObservers(DummyBoundingBox);\r\n\r\n        let instancesCount = 0;\r\n        const floatingOriginOffset = this.scene.floatingOriginOffset;\r\n\r\n        for (let boundingBoxIndex = 0; boundingBoxIndex < this.renderList.length; boundingBoxIndex++) {\r\n            const boundingBox = this.renderList.data[boundingBoxIndex];\r\n            if (boundingBox._tag !== renderingGroupId) {\r\n                continue;\r\n            }\r\n\r\n            const min = boundingBox.minimum;\r\n            const max = boundingBox.maximum;\r\n\r\n            const diff = max.subtractToRef(min, TempVec2);\r\n            const median = min.addToRef(diff.scaleToRef(0.5, TempVec1), TempVec1);\r\n\r\n            const m = TempMatrixArray;\r\n\r\n            // Directly update the matrix values in column-major order\r\n            m[0] = diff._x; // Scale X\r\n            m[3] = median._x; // Translate X\r\n\r\n            m[5] = diff._y; // Scale Y\r\n            m[7] = median._y; // Translate Y\r\n\r\n            m[10] = diff._z; // Scale Z\r\n            m[11] = median._z; // Translate Z\r\n\r\n            const offset = instancesCount * 16;\r\n            TempMatrix.multiplyToArray(boundingBox.getWorldMatrix(), matrices, offset);\r\n\r\n            matrices[offset + 12] -= floatingOriginOffset.x;\r\n            matrices[offset + 13] -= floatingOriginOffset.y;\r\n            matrices[offset + 14] -= floatingOriginOffset.z;\r\n            instancesCount++;\r\n        }\r\n\r\n        const engine = this.scene.getEngine();\r\n        // keeps the original depth function and depth write\r\n        const depthFunction = engine.getDepthFunction() ?? Constants.LEQUAL;\r\n        const depthWrite = engine.getDepthWrite();\r\n        engine.setDepthWrite(false);\r\n        const matrixBuffer = this._matrixBuffer;\r\n        if (matrixBuffer?.isUpdatable() && matrixBuffer.getData() === matrices) {\r\n            matrixBuffer.update(matrices);\r\n        } else {\r\n            this._createInstanceBuffer(matrices);\r\n        }\r\n\r\n        this._createWrappersForBoundingBox(this);\r\n\r\n        const useReverseDepthBuffer = engine.useReverseDepthBuffer;\r\n        const transformMatrix = this.scene.getTransformMatrix();\r\n\r\n        if (this.showBackLines) {\r\n            const drawWrapperBack = this._drawWrapperBack ?? colorShader._getDrawWrapper();\r\n\r\n            colorShader._preBind(drawWrapperBack);\r\n\r\n            engine.bindBuffers(this._vertexBuffers, this._indexBuffer, colorShader.getEffect());\r\n\r\n            // Back\r\n            if (useReverseDepthBuffer) {\r\n                engine.setDepthFunctionToLessOrEqual();\r\n            } else {\r\n                engine.setDepthFunctionToGreaterOrEqual();\r\n            }\r\n            const _uniformBufferBack: UniformBuffer = this._uniformBufferBack;\r\n\r\n            _uniformBufferBack.bindToEffect(drawWrapperBack.effect!, \"BoundingBoxRenderer\");\r\n            _uniformBufferBack.updateColor4(\"color\", this.backColor, 1);\r\n            _uniformBufferBack.updateMatrix(\"viewProjection\", transformMatrix);\r\n            _uniformBufferBack.update();\r\n\r\n            // Draw order\r\n            engine.drawElementsType(Material.LineListDrawMode, 0, 24, instancesCount);\r\n        }\r\n\r\n        const drawWrapperFront = colorShader._getDrawWrapper();\r\n\r\n        colorShader._preBind(drawWrapperFront);\r\n\r\n        engine.bindBuffers(this._vertexBuffers, this._indexBuffer, colorShader.getEffect());\r\n\r\n        // Front\r\n        if (useReverseDepthBuffer) {\r\n            engine.setDepthFunctionToGreater();\r\n        } else {\r\n            engine.setDepthFunctionToLess();\r\n        }\r\n        const _uniformBufferFront: UniformBuffer = this._uniformBufferFront;\r\n        _uniformBufferFront.bindToEffect(drawWrapperFront.effect!, \"BoundingBoxRenderer\");\r\n        _uniformBufferFront.updateColor4(\"color\", this.frontColor, 1);\r\n        _uniformBufferFront.updateMatrix(\"viewProjection\", transformMatrix);\r\n        _uniformBufferFront.update();\r\n\r\n        // Draw order\r\n        engine.drawElementsType(Material.LineListDrawMode, 0, 24, instancesCount);\r\n\r\n        this.onAfterBoxRenderingObservable.notifyObservers(DummyBoundingBox);\r\n\r\n        colorShader.unbind();\r\n        engine.setDepthFunction(depthFunction);\r\n        engine.setDepthWrite(depthWrite);\r\n    }\r\n\r\n    /**\r\n     * Creates buffer for instanced rendering\r\n     * @param buffer buffer to set\r\n     */\r\n    private _createInstanceBuffer(buffer: Float32Array): void {\r\n        const vertexBuffers = this._vertexBuffers;\r\n        this._cleanupInstanceBuffer();\r\n        const matrixBuffer = new Buffer(this.scene.getEngine(), buffer, true, 16, false, true);\r\n\r\n        vertexBuffers.world0 = matrixBuffer.createVertexBuffer(\"world0\", 0, 4);\r\n        vertexBuffers.world1 = matrixBuffer.createVertexBuffer(\"world1\", 4, 4);\r\n        vertexBuffers.world2 = matrixBuffer.createVertexBuffer(\"world2\", 8, 4);\r\n        vertexBuffers.world3 = matrixBuffer.createVertexBuffer(\"world3\", 12, 4);\r\n\r\n        this._matrixBuffer = matrixBuffer;\r\n    }\r\n\r\n    /**\r\n     * Clean up buffers for instanced rendering\r\n     */\r\n    private _cleanupInstanceBuffer(): void {\r\n        const vertexBuffers = this._vertexBuffers;\r\n        if (vertexBuffers.world0) {\r\n            vertexBuffers.world0.dispose();\r\n            delete vertexBuffers.world0;\r\n        }\r\n        if (vertexBuffers.world1) {\r\n            vertexBuffers.world1.dispose();\r\n            delete vertexBuffers.world1;\r\n        }\r\n        if (vertexBuffers.world2) {\r\n            vertexBuffers.world2.dispose();\r\n            delete vertexBuffers.world2;\r\n        }\r\n        if (vertexBuffers.world3) {\r\n            vertexBuffers.world3.dispose();\r\n            delete vertexBuffers.world3;\r\n        }\r\n        this._matrices = null;\r\n        if (this._matrixBuffer) {\r\n            this._matrixBuffer.dispose();\r\n            this._matrixBuffer = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clean up resources for instanced rendering\r\n     */\r\n    private _cleanupInstances(): void {\r\n        this._cleanupInstanceBuffer();\r\n        if (this._drawWrapperFront) {\r\n            this._drawWrapperFront.dispose();\r\n            this._drawWrapperFront = null;\r\n        }\r\n        if (this._drawWrapperBack) {\r\n            this._drawWrapperBack.dispose();\r\n            this._drawWrapperBack = null;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Dispose and release the resources attached to this renderer.\r\n     */\r\n    public dispose(): void {\r\n        if (this._renderPassIdForOcclusionQuery !== undefined) {\r\n            this.scene.getEngine().releaseRenderPassId(this._renderPassIdForOcclusionQuery);\r\n            this._renderPassIdForOcclusionQuery = undefined as any;\r\n        }\r\n\r\n        if (!this._colorShader) {\r\n            return;\r\n        }\r\n\r\n        this.onBeforeBoxRenderingObservable.clear();\r\n        this.onAfterBoxRenderingObservable.clear();\r\n        this.onResourcesReadyObservable.clear();\r\n\r\n        this.renderList.dispose();\r\n\r\n        this._colorShader.dispose();\r\n        this._colorShaderForOcclusionQuery.dispose();\r\n\r\n        this._uniformBufferFront.dispose();\r\n        this._uniformBufferBack.dispose();\r\n\r\n        const buffer = this._vertexBuffers[VertexBuffer.PositionKind];\r\n        if (buffer) {\r\n            buffer.dispose();\r\n            this._vertexBuffers[VertexBuffer.PositionKind] = null;\r\n        }\r\n        this.scene.getEngine()._releaseBuffer(this._indexBuffer);\r\n\r\n        if (this._fillIndexBuffer) {\r\n            this.scene.getEngine()._releaseBuffer(this._fillIndexBuffer);\r\n            this._fillIndexBuffer = null;\r\n        }\r\n        this._cleanupInstances();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4666, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/depthRendererSceneComponent.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/depthRendererSceneComponent.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport { Scene } from \"../scene\";\r\nimport type { SmartArrayNoDuplicate } from \"../Misc/smartArray\";\r\nimport { DepthRenderer } from \"./depthRenderer\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _depthRenderer: { [id: string]: DepthRenderer };\r\n\r\n        /**\r\n         * Creates a depth renderer a given camera which contains a depth map which can be used for post processing.\r\n         * @param camera The camera to create the depth renderer on (default: scene's active camera)\r\n         * @param storeNonLinearDepth Defines whether the depth is stored linearly like in Babylon Shadows or directly like glFragCoord.z\r\n         * @param force32bitsFloat Forces 32 bits float when supported (else 16 bits float is prioritized over 32 bits float if supported)\r\n         * @param samplingMode The sampling mode to be used with the render target (Linear, Nearest...)\r\n         * @param storeCameraSpaceZ Defines whether the depth stored is the Z coordinate in camera space. If true, storeNonLinearDepth has no effect. (Default: false)\r\n         * @param existingRenderTargetTexture An existing render target texture to use (default: undefined). If not provided, a new render target texture will be created.\r\n         * @returns the created depth renderer\r\n         */\r\n        enableDepthRenderer(\r\n            camera?: Nullable<Camera>,\r\n            storeNonLinearDepth?: boolean,\r\n            force32bitsFloat?: boolean,\r\n            samplingMode?: number,\r\n            storeCameraSpaceZ?: boolean,\r\n            existingRenderTargetTexture?: RenderTargetTexture\r\n        ): DepthRenderer;\r\n\r\n        /**\r\n         * Disables a depth renderer for a given camera\r\n         * @param camera The camera to disable the depth renderer on (default: scene's active camera)\r\n         */\r\n        disableDepthRenderer(camera?: Nullable<Camera>): void;\r\n    }\r\n}\r\n\r\nScene.prototype.enableDepthRenderer = function (\r\n    camera?: Nullable<Camera>,\r\n    storeNonLinearDepth = false,\r\n    force32bitsFloat: boolean = false,\r\n    samplingMode = Constants.TEXTURE_TRILINEAR_SAMPLINGMODE,\r\n    storeCameraSpaceZ: boolean = false,\r\n    existingRenderTargetTexture?: RenderTargetTexture\r\n): DepthRenderer {\r\n    camera = camera || this.activeCamera;\r\n    if (!camera) {\r\n        // eslint-disable-next-line no-throw-literal\r\n        throw \"No camera available to enable depth renderer\";\r\n    }\r\n    if (!this._depthRenderer) {\r\n        this._depthRenderer = {};\r\n    }\r\n    if (!this._depthRenderer[camera.id]) {\r\n        const supportFullfloat = !!this.getEngine().getCaps().textureFloatRender;\r\n        let textureType = 0;\r\n        if (this.getEngine().getCaps().textureHalfFloatRender && (!force32bitsFloat || !supportFullfloat)) {\r\n            textureType = Constants.TEXTURETYPE_HALF_FLOAT;\r\n        } else if (supportFullfloat) {\r\n            textureType = Constants.TEXTURETYPE_FLOAT;\r\n        } else {\r\n            textureType = Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        }\r\n        this._depthRenderer[camera.id] = new DepthRenderer(this, textureType, camera, storeNonLinearDepth, samplingMode, storeCameraSpaceZ, undefined, existingRenderTargetTexture);\r\n    }\r\n\r\n    return this._depthRenderer[camera.id];\r\n};\r\n\r\nScene.prototype.disableDepthRenderer = function (camera?: Nullable<Camera>): void {\r\n    camera = camera || this.activeCamera;\r\n    if (!camera || !this._depthRenderer || !this._depthRenderer[camera.id]) {\r\n        return;\r\n    }\r\n\r\n    this._depthRenderer[camera.id].dispose();\r\n};\r\n\r\n/**\r\n * Defines the Depth Renderer scene component responsible to manage a depth buffer useful\r\n * in several rendering techniques.\r\n */\r\nexport class DepthRendererSceneComponent implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_DEPTHRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {\r\n        this.scene._gatherRenderTargetsStage.registerStep(SceneComponentConstants.STEP_GATHERRENDERTARGETS_DEPTHRENDERER, this, this._gatherRenderTargets);\r\n        this.scene._gatherActiveCameraRenderTargetsStage.registerStep(\r\n            SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_DEPTHRENDERER,\r\n            this,\r\n            this._gatherActiveCameraRenderTargets\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        // Nothing to do for this component\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources\r\n     */\r\n    public dispose(): void {\r\n        for (const key in this.scene._depthRenderer) {\r\n            this.scene._depthRenderer[key].dispose();\r\n        }\r\n    }\r\n\r\n    private _gatherRenderTargets(renderTargets: SmartArrayNoDuplicate<RenderTargetTexture>): void {\r\n        if (this.scene._depthRenderer) {\r\n            for (const key in this.scene._depthRenderer) {\r\n                const depthRenderer = this.scene._depthRenderer[key];\r\n                if (depthRenderer.enabled && !depthRenderer.useOnlyInActiveCamera) {\r\n                    renderTargets.push(depthRenderer.getDepthMap());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _gatherActiveCameraRenderTargets(renderTargets: SmartArrayNoDuplicate<RenderTargetTexture>): void {\r\n        if (this.scene._depthRenderer) {\r\n            for (const key in this.scene._depthRenderer) {\r\n                const depthRenderer = this.scene._depthRenderer[key];\r\n                if (depthRenderer.enabled && depthRenderer.useOnlyInActiveCamera && this.scene.activeCamera!.id === key) {\r\n                    renderTargets.push(depthRenderer.getDepthMap());\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nDepthRenderer._SceneComponentInitialization = (scene: Scene) => {\r\n    // Register the G Buffer component to the scene.\r\n    let component = scene._getComponent(SceneComponentConstants.NAME_DEPTHRENDERER) as DepthRendererSceneComponent;\r\n    if (!component) {\r\n        component = new DepthRendererSceneComponent(scene);\r\n        scene._addComponent(component);\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 4768, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/depthPeelingRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/depthPeelingRenderer.ts"],"sourcesContent":["/**\r\n * Implementation based on https://medium.com/@shrekshao_71662/dual-depth-peeling-implementation-in-webgl-11baa061ba4b\r\n */\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { AbstractEngine } from \"../Engines/abstractEngine\";\r\nimport type { Effect } from \"../Materials/effect\";\r\nimport { MultiRenderTarget } from \"../Materials/Textures/multiRenderTarget\";\r\nimport type { InternalTextureCreationOptions } from \"../Materials/Textures/textureCreationOptions\";\r\nimport { Color4 } from \"../Maths/math.color\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport { SmartArray } from \"../Misc/smartArray\";\r\nimport type { Scene } from \"../scene\";\r\nimport { ThinTexture } from \"../Materials/Textures/thinTexture\";\r\nimport { EffectRenderer, EffectWrapper } from \"../Materials/effectRenderer\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\nimport type { PrePassRenderer } from \"./prePassRenderer\";\r\nimport type { InternalTexture } from \"../Materials/Textures/internalTexture\";\r\nimport { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport type { IMaterialContext } from \"../Engines/IMaterialContext\";\r\nimport type { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport { Material } from \"../Materials/material\";\r\n\r\nimport \"../Engines/Extensions/engine.multiRender\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\nclass DepthPeelingEffectConfiguration implements PrePassEffectConfiguration {\r\n    /**\r\n     * Is this effect enabled\r\n     */\r\n    public enabled = true;\r\n\r\n    /**\r\n     * Name of the configuration\r\n     */\r\n    public name = \"depthPeeling\";\r\n\r\n    /**\r\n     * Textures that should be present in the MRT for this effect to work\r\n     */\r\n    public readonly texturesRequired: number[] = [Constants.PREPASS_COLOR_TEXTURE_TYPE];\r\n}\r\n\r\n/**\r\n * The depth peeling renderer that performs\r\n * Order independant transparency (OIT).\r\n * This should not be instanciated directly, as it is part of a scene component\r\n */\r\nexport class DepthPeelingRenderer {\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n    private _depthMrts: MultiRenderTarget[];\r\n    private _thinTextures: ThinTexture[] = [];\r\n    private _colorMrts: MultiRenderTarget[];\r\n    private _blendBackMrt: MultiRenderTarget;\r\n    private _outputRT: RenderTargetTexture;\r\n\r\n    private _blendBackEffectWrapper: EffectWrapper;\r\n    private _blendBackEffectWrapperPingPong: EffectWrapper;\r\n    private _finalEffectWrapper: EffectWrapper;\r\n    private _effectRenderer: EffectRenderer;\r\n\r\n    private _currentPingPongState: number = 0;\r\n    private _prePassEffectConfiguration: DepthPeelingEffectConfiguration;\r\n\r\n    private _blendBackTexture: InternalTexture;\r\n    private _layoutCacheFormat = [[true], [true, true], [true, true, true]];\r\n    private _layoutCache: number[][] = [];\r\n    private _renderPassIds: number[];\r\n    private _candidateSubMeshes: SmartArray<SubMesh> = new SmartArray(10);\r\n    private _excludedSubMeshes: SmartArray<SubMesh> = new SmartArray(10);\r\n    private _excludedMeshes: number[] = [];\r\n\r\n    private static _DEPTH_CLEAR_VALUE = -99999.0;\r\n    private static _MIN_DEPTH = 0;\r\n    private static _MAX_DEPTH = 1;\r\n\r\n    private _colorCache = [\r\n        new Color4(DepthPeelingRenderer._DEPTH_CLEAR_VALUE, DepthPeelingRenderer._DEPTH_CLEAR_VALUE, 0, 0),\r\n        new Color4(-DepthPeelingRenderer._MIN_DEPTH, DepthPeelingRenderer._MAX_DEPTH, 0, 0),\r\n        new Color4(0, 0, 0, 0),\r\n    ];\r\n\r\n    private _passCount: number;\r\n    /**\r\n     * Number of depth peeling passes. As we are using dual depth peeling, each pass two levels of transparency are processed.\r\n     */\r\n    public get passCount(): number {\r\n        return this._passCount;\r\n    }\r\n\r\n    public set passCount(count: number) {\r\n        if (this._passCount === count) {\r\n            return;\r\n        }\r\n        this._passCount = count;\r\n        this._createRenderPassIds();\r\n    }\r\n\r\n    private _useRenderPasses: boolean;\r\n    /**\r\n     * Instructs the renderer to use render passes. It is an optimization that makes the rendering faster for some engines (like WebGPU) but that consumes more memory, so it is disabled by default.\r\n     */\r\n    public get useRenderPasses() {\r\n        return this._useRenderPasses;\r\n    }\r\n\r\n    public set useRenderPasses(usePasses: boolean) {\r\n        if (this._useRenderPasses === usePasses) {\r\n            return;\r\n        }\r\n        this._useRenderPasses = usePasses;\r\n        this._createRenderPassIds();\r\n    }\r\n\r\n    /**\r\n     * Add a mesh in the exclusion list to prevent it to be handled by the depth peeling renderer\r\n     * @param mesh The mesh to exclude from the depth peeling renderer\r\n     */\r\n    public addExcludedMesh(mesh: AbstractMesh): void {\r\n        if (this._excludedMeshes.indexOf(mesh.uniqueId) === -1) {\r\n            this._excludedMeshes.push(mesh.uniqueId);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove a mesh from the exclusion list of the depth peeling renderer\r\n     * @param mesh The mesh to remove\r\n     */\r\n    public removeExcludedMesh(mesh: AbstractMesh): void {\r\n        const index = this._excludedMeshes.indexOf(mesh.uniqueId);\r\n        if (index !== -1) {\r\n            this._excludedMeshes.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    /** Shader language used by the renderer */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this renderer\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Instanciates the depth peeling renderer\r\n     * @param scene Scene to attach to\r\n     * @param passCount Number of depth layers to peel\r\n     * @returns The depth peeling renderer\r\n     */\r\n    constructor(scene: Scene, passCount: number = 5) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._passCount = passCount;\r\n\r\n        //  We need a depth texture for opaque\r\n        if (!scene.enablePrePassRenderer()) {\r\n            Logger.Warn(\"Depth peeling for order independant transparency could not enable PrePass, aborting.\");\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < this._layoutCacheFormat.length; ++i) {\r\n            this._layoutCache[i] = this._engine.buildTextureLayout(this._layoutCacheFormat[i]);\r\n        }\r\n\r\n        this._renderPassIds = [];\r\n        this.useRenderPasses = false;\r\n\r\n        if (this._engine.isWebGPU) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n        }\r\n\r\n        this._prePassEffectConfiguration = new DepthPeelingEffectConfiguration();\r\n        this._createTextures();\r\n        this._createEffects();\r\n    }\r\n\r\n    private _createRenderPassIds(): void {\r\n        this._releaseRenderPassIds();\r\n        if (this._useRenderPasses) {\r\n            for (let i = 0; i < this._passCount + 1; ++i) {\r\n                if (!this._renderPassIds[i]) {\r\n                    this._renderPassIds[i] = this._engine.createRenderPassId(`DepthPeelingRenderer - pass #${i}`);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _releaseRenderPassIds(): void {\r\n        for (let i = 0; i < this._renderPassIds.length; ++i) {\r\n            this._engine.releaseRenderPassId(this._renderPassIds[i]);\r\n        }\r\n        this._renderPassIds = [];\r\n    }\r\n\r\n    private _createTextures() {\r\n        const size = {\r\n            width: this._engine.getRenderWidth(),\r\n            height: this._engine.getRenderHeight(),\r\n        };\r\n\r\n        // 2 for ping pong\r\n        this._depthMrts = [\r\n            new MultiRenderTarget(\"depthPeelingDepth0MRT\", size, 3, this._scene, undefined, [\r\n                \"depthPeelingDepth0MRT_depth\",\r\n                \"depthPeelingDepth0MRT_frontColor\",\r\n                \"depthPeelingDepth0MRT_backColor\",\r\n            ]),\r\n            new MultiRenderTarget(\"depthPeelingDepth1MRT\", size, 3, this._scene, undefined, [\r\n                \"depthPeelingDepth1MRT_depth\",\r\n                \"depthPeelingDepth1MRT_frontColor\",\r\n                \"depthPeelingDepth1MRT_backColor\",\r\n            ]),\r\n        ];\r\n        this._colorMrts = [\r\n            new MultiRenderTarget(\"depthPeelingColor0MRT\", size, 2, this._scene, { generateDepthBuffer: false }, [\r\n                \"depthPeelingColor0MRT_frontColor\",\r\n                \"depthPeelingColor0MRT_backColor\",\r\n            ]),\r\n            new MultiRenderTarget(\"depthPeelingColor1MRT\", size, 2, this._scene, { generateDepthBuffer: false }, [\r\n                \"depthPeelingColor1MRT_frontColor\",\r\n                \"depthPeelingColor1MRT_backColor\",\r\n            ]),\r\n        ];\r\n        this._blendBackMrt = new MultiRenderTarget(\"depthPeelingBackMRT\", size, 1, this._scene, { generateDepthBuffer: false }, [\"depthPeelingBackMRT_blendBack\"]);\r\n        this._outputRT = new RenderTargetTexture(\"depthPeelingOutputRTT\", size, this._scene, false);\r\n\r\n        // 0 is a depth texture\r\n        // 1 is a color texture\r\n        const optionsArray = [\r\n            {\r\n                format: Constants.TEXTUREFORMAT_RG, // For MSAA we need RGBA\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                type: this._engine.getCaps().textureFloatLinearFiltering ? Constants.TEXTURETYPE_FLOAT : Constants.TEXTURETYPE_HALF_FLOAT,\r\n                label: \"DepthPeelingRenderer-DepthTexture\",\r\n            } as InternalTextureCreationOptions,\r\n            {\r\n                format: Constants.TEXTUREFORMAT_RGBA,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                type: Constants.TEXTURETYPE_HALF_FLOAT, // For MSAA we need FLOAT\r\n                label: \"DepthPeelingRenderer-ColorTexture\",\r\n            } as InternalTextureCreationOptions,\r\n        ];\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n            const depthTexture = this._engine._createInternalTexture(size, optionsArray[0], false);\r\n            const frontColorTexture = this._engine._createInternalTexture(size, optionsArray[1], false);\r\n            const backColorTexture = this._engine._createInternalTexture(size, optionsArray[1], false);\r\n\r\n            this._depthMrts[i].setInternalTexture(depthTexture, 0);\r\n            this._depthMrts[i].setInternalTexture(frontColorTexture, 1);\r\n            this._depthMrts[i].setInternalTexture(backColorTexture, 2);\r\n            this._colorMrts[i].setInternalTexture(frontColorTexture, 0);\r\n            this._colorMrts[i].setInternalTexture(backColorTexture, 1);\r\n\r\n            this._thinTextures.push(new ThinTexture(depthTexture), new ThinTexture(frontColorTexture), new ThinTexture(backColorTexture));\r\n        }\r\n    }\r\n\r\n    // TODO : explore again MSAA with depth peeling when\r\n    // we are able to fetch individual samples in a multisampled renderbuffer\r\n    // public set samples(value: number) {\r\n    //     for (let i = 0; i < 2; i++) {\r\n    //         this._depthMrts[i].samples = value;\r\n    //         this._colorMrts[i].samples = value;\r\n    //     }\r\n    //     this._scene.prePassRenderer!.samples = value;\r\n    // }\r\n\r\n    private _disposeTextures() {\r\n        for (let i = 0; i < this._thinTextures.length; i++) {\r\n            if (i === 6) {\r\n                // Do not dispose the shared texture with the prepass\r\n                continue;\r\n            }\r\n            this._thinTextures[i].dispose();\r\n        }\r\n\r\n        for (let i = 0; i < 2; i++) {\r\n            this._depthMrts[i].dispose(true);\r\n            this._colorMrts[i].dispose(true);\r\n            this._blendBackMrt.dispose(true);\r\n        }\r\n        this._outputRT.dispose();\r\n\r\n        this._thinTextures = [];\r\n        this._colorMrts = [];\r\n        this._depthMrts = [];\r\n    }\r\n\r\n    private _updateTextures() {\r\n        if (this._depthMrts[0].getSize().width !== this._engine.getRenderWidth() || this._depthMrts[0].getSize().height !== this._engine.getRenderHeight()) {\r\n            this._disposeTextures();\r\n            this._createTextures();\r\n        }\r\n        return this._updateTextureReferences();\r\n    }\r\n\r\n    private _updateTextureReferences() {\r\n        const prePassRenderer = this._scene.prePassRenderer;\r\n\r\n        if (!prePassRenderer) {\r\n            return false;\r\n        }\r\n\r\n        // Retrieve opaque color texture\r\n        const textureIndex = prePassRenderer.getIndex(Constants.PREPASS_COLOR_TEXTURE_TYPE);\r\n        const prePassTexture = prePassRenderer.defaultRT.textures?.length ? prePassRenderer.defaultRT.textures[textureIndex].getInternalTexture() : null;\r\n\r\n        if (!prePassTexture) {\r\n            return false;\r\n        }\r\n\r\n        if (this._blendBackTexture !== prePassTexture) {\r\n            this._blendBackTexture = prePassTexture;\r\n            this._blendBackMrt.setInternalTexture(this._blendBackTexture, 0);\r\n\r\n            if (this._thinTextures[6]) {\r\n                this._thinTextures[6].dispose();\r\n            }\r\n            this._thinTextures[6] = new ThinTexture(this._blendBackTexture);\r\n\r\n            prePassRenderer.defaultRT.renderTarget!.shareDepth(this._depthMrts[0].renderTarget!);\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private _createEffects() {\r\n        this._blendBackEffectWrapper = new EffectWrapper({\r\n            fragmentShader: \"oitBackBlend\",\r\n            useShaderStore: true,\r\n            engine: this._engine,\r\n            samplerNames: [\"uBackColor\"],\r\n            uniformNames: [],\r\n            shaderLanguage: this._shaderLanguage,\r\n            extraInitializationsAsync: async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await import(\"../ShadersWGSL/oitBackBlend.fragment\");\r\n                } else {\r\n                    await import(\"../Shaders/oitBackBlend.fragment\");\r\n                }\r\n            },\r\n        });\r\n        this._blendBackEffectWrapperPingPong = new EffectWrapper({\r\n            fragmentShader: \"oitBackBlend\",\r\n            useShaderStore: true,\r\n            engine: this._engine,\r\n            samplerNames: [\"uBackColor\"],\r\n            uniformNames: [],\r\n            shaderLanguage: this._shaderLanguage,\r\n            extraInitializationsAsync: async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await import(\"../ShadersWGSL/oitBackBlend.fragment\");\r\n                } else {\r\n                    await import(\"../Shaders/oitBackBlend.fragment\");\r\n                }\r\n            },\r\n        });\r\n\r\n        this._finalEffectWrapper = new EffectWrapper({\r\n            fragmentShader: \"oitFinal\",\r\n            useShaderStore: true,\r\n            engine: this._engine,\r\n            samplerNames: [\"uFrontColor\", \"uBackColor\"],\r\n            uniformNames: [],\r\n            shaderLanguage: this._shaderLanguage,\r\n            extraInitializationsAsync: async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await import(\"../ShadersWGSL/oitFinal.fragment\");\r\n                } else {\r\n                    await import(\"../Shaders/oitFinal.fragment\");\r\n                }\r\n            },\r\n        });\r\n\r\n        this._effectRenderer = new EffectRenderer(this._engine);\r\n    }\r\n\r\n    /**\r\n     * Links to the prepass renderer\r\n     * @param prePassRenderer The scene PrePassRenderer\r\n     */\r\n    public setPrePassRenderer(prePassRenderer: PrePassRenderer) {\r\n        prePassRenderer.addEffectConfiguration(this._prePassEffectConfiguration);\r\n    }\r\n\r\n    /**\r\n     * Binds depth peeling textures on an effect\r\n     * @param effect The effect to bind textures on\r\n     */\r\n    public bind(effect: Effect) {\r\n        effect.setTexture(\"oitDepthSampler\", this._thinTextures[this._currentPingPongState * 3]);\r\n        effect.setTexture(\"oitFrontColorSampler\", this._thinTextures[this._currentPingPongState * 3 + 1]);\r\n    }\r\n\r\n    private _renderSubMeshes(transparentSubMeshes: SmartArray<SubMesh>) {\r\n        let mapMaterialContext: { [uniqueId: number]: IMaterialContext | undefined };\r\n        if (this._useRenderPasses) {\r\n            mapMaterialContext = {};\r\n        }\r\n        for (let j = 0; j < transparentSubMeshes.length; j++) {\r\n            const material = transparentSubMeshes.data[j].getMaterial();\r\n            let previousShaderHotSwapping = true;\r\n            let previousBFC = false;\r\n\r\n            const subMesh = transparentSubMeshes.data[j];\r\n            let drawWrapper: DrawWrapper | undefined;\r\n            let firstDraw = false;\r\n\r\n            if (this._useRenderPasses) {\r\n                drawWrapper = subMesh._getDrawWrapper();\r\n                firstDraw = !drawWrapper;\r\n            }\r\n\r\n            if (material) {\r\n                previousShaderHotSwapping = material.allowShaderHotSwapping;\r\n                previousBFC = material.backFaceCulling;\r\n                material.allowShaderHotSwapping = false;\r\n                material.backFaceCulling = false;\r\n            }\r\n\r\n            subMesh.render(false);\r\n\r\n            if (firstDraw) {\r\n                // first time we draw this submesh: we replace the material context\r\n                drawWrapper = subMesh._getDrawWrapper()!; // we are sure it is now non empty as we just rendered the submesh\r\n                if (drawWrapper.materialContext) {\r\n                    let newMaterialContext = mapMaterialContext![drawWrapper.materialContext.uniqueId];\r\n                    if (!newMaterialContext) {\r\n                        newMaterialContext = mapMaterialContext![drawWrapper.materialContext.uniqueId] = this._engine.createMaterialContext();\r\n                    }\r\n                    subMesh._getDrawWrapper()!.materialContext = newMaterialContext;\r\n                }\r\n            }\r\n\r\n            if (material) {\r\n                material.allowShaderHotSwapping = previousShaderHotSwapping;\r\n                material.backFaceCulling = previousBFC;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _finalCompose(writeId: number) {\r\n        const output = this._scene.prePassRenderer?.setCustomOutput(this._outputRT);\r\n        if (output) {\r\n            this._engine.bindFramebuffer(this._outputRT.renderTarget!);\r\n        } else {\r\n            this._engine.restoreDefaultFramebuffer();\r\n        }\r\n\r\n        this._engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n        this._engine.applyStates();\r\n\r\n        this._engine.enableEffect(this._finalEffectWrapper.drawWrapper);\r\n        this._finalEffectWrapper.effect.setTexture(\"uFrontColor\", this._thinTextures[writeId * 3 + 1]);\r\n        this._finalEffectWrapper.effect.setTexture(\"uBackColor\", this._thinTextures[6]);\r\n        this._effectRenderer.render(this._finalEffectWrapper);\r\n    }\r\n\r\n    /**\r\n     * Checks if the depth peeling renderer is ready to render transparent meshes\r\n     * @returns true if the depth peeling renderer is ready to render the transparent meshes\r\n     */\r\n    public isReady() {\r\n        return (\r\n            this._blendBackEffectWrapper.effect.isReady() &&\r\n            this._blendBackEffectWrapperPingPong.effect.isReady() &&\r\n            this._finalEffectWrapper.effect.isReady() &&\r\n            this._updateTextures()\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Renders transparent submeshes with depth peeling\r\n     * @param transparentSubMeshes List of transparent meshes to render\r\n     * @returns The array of submeshes that could not be handled by this renderer\r\n     */\r\n    public render(transparentSubMeshes: SmartArray<SubMesh>): SmartArray<SubMesh> {\r\n        this._candidateSubMeshes.length = 0;\r\n        this._excludedSubMeshes.length = 0;\r\n        if (!this.isReady()) {\r\n            return this._excludedSubMeshes;\r\n        }\r\n\r\n        if (this._scene.activeCamera) {\r\n            this._engine.setViewport(this._scene.activeCamera.viewport);\r\n        }\r\n\r\n        for (let i = 0; i < transparentSubMeshes.length; i++) {\r\n            const subMesh = transparentSubMeshes.data[i];\r\n            const material = subMesh.getMaterial();\r\n            const fillMode = material && subMesh.getRenderingMesh()._getRenderingFillMode(material.fillMode);\r\n\r\n            if (\r\n                material &&\r\n                (fillMode === Material.TriangleFanDrawMode || fillMode === Material.TriangleFillMode || fillMode === Material.TriangleStripDrawMode) &&\r\n                this._excludedMeshes.indexOf(subMesh.getMesh().uniqueId) === -1\r\n            ) {\r\n                this._candidateSubMeshes.push(subMesh);\r\n            } else {\r\n                this._excludedSubMeshes.push(subMesh);\r\n            }\r\n        }\r\n\r\n        if (!this._candidateSubMeshes.length) {\r\n            this._engine.bindFramebuffer(this._colorMrts[1].renderTarget!);\r\n            this._engine.bindAttachments(this._layoutCache[1]);\r\n            this._engine.clear(this._colorCache[2], true, false, false);\r\n            this._engine.unBindFramebuffer(this._colorMrts[1].renderTarget!);\r\n\r\n            this._finalCompose(1);\r\n            return this._excludedSubMeshes;\r\n        }\r\n\r\n        const currentRenderPassId = this._engine.currentRenderPassId;\r\n\r\n        (this._scene.prePassRenderer! as any)._enabled = false;\r\n\r\n        if (this._useRenderPasses) {\r\n            this._engine.currentRenderPassId = this._renderPassIds[0];\r\n        }\r\n\r\n        // Clears\r\n        this._engine.bindFramebuffer(this._depthMrts[0].renderTarget!);\r\n        this._engine.bindAttachments(this._layoutCache[0]);\r\n        this._engine.clear(this._colorCache[0], true, false, false);\r\n        this._engine.unBindFramebuffer(this._depthMrts[0].renderTarget!);\r\n\r\n        this._engine.bindFramebuffer(this._depthMrts[1].renderTarget!);\r\n        this._engine.bindAttachments(this._layoutCache[0]);\r\n        this._engine.clear(this._colorCache[1], true, false, false);\r\n        this._engine.unBindFramebuffer(this._depthMrts[1].renderTarget!);\r\n\r\n        this._engine.bindFramebuffer(this._colorMrts[0].renderTarget!);\r\n        this._engine.bindAttachments(this._layoutCache[1]);\r\n        this._engine.clear(this._colorCache[2], true, false, false);\r\n        this._engine.unBindFramebuffer(this._colorMrts[0].renderTarget!);\r\n\r\n        this._engine.bindFramebuffer(this._colorMrts[1].renderTarget!);\r\n        this._engine.bindAttachments(this._layoutCache[1]);\r\n        this._engine.clear(this._colorCache[2], true, false, false);\r\n        this._engine.unBindFramebuffer(this._colorMrts[1].renderTarget!);\r\n\r\n        // Draw depth for first pass\r\n        this._engine.bindFramebuffer(this._depthMrts[0].renderTarget!);\r\n        this._engine.bindAttachments(this._layoutCache[0]);\r\n\r\n        this._engine.setAlphaMode(Constants.ALPHA_ONEONE_ONEONE); // in WebGPU, when using MIN or MAX equation, the src / dst color factors should not use SRC_ALPHA and the src / dst alpha factors must be 1 else WebGPU will throw a validation error\r\n        this._engine.setAlphaEquation(Constants.ALPHA_EQUATION_MAX);\r\n        this._engine.depthCullingState.depthMask = false;\r\n        this._engine.depthCullingState.depthTest = true;\r\n        this._engine.applyStates();\r\n\r\n        this._currentPingPongState = 1;\r\n        // Render\r\n        this._renderSubMeshes(this._candidateSubMeshes);\r\n        this._engine.unBindFramebuffer(this._depthMrts[0].renderTarget!);\r\n\r\n        this._scene.resetCachedMaterial();\r\n\r\n        // depth peeling ping-pong\r\n        let readId = 0;\r\n        let writeId = 0;\r\n\r\n        for (let i = 0; i < this._passCount; i++) {\r\n            readId = i % 2;\r\n            writeId = 1 - readId;\r\n            this._currentPingPongState = readId;\r\n\r\n            if (this._useRenderPasses) {\r\n                this._engine.currentRenderPassId = this._renderPassIds[i + 1];\r\n            }\r\n\r\n            if (this._scene.activeCamera) {\r\n                this._engine.setViewport(this._scene.activeCamera.viewport);\r\n            }\r\n\r\n            // Clears\r\n            this._engine.bindFramebuffer(this._depthMrts[writeId].renderTarget!);\r\n            this._engine.bindAttachments(this._layoutCache[0]);\r\n            this._engine.clear(this._colorCache[0], true, false, false);\r\n            this._engine.unBindFramebuffer(this._depthMrts[writeId].renderTarget!);\r\n\r\n            this._engine.bindFramebuffer(this._colorMrts[writeId].renderTarget!);\r\n            this._engine.bindAttachments(this._layoutCache[1]);\r\n            this._engine.clear(this._colorCache[2], true, false, false);\r\n            this._engine.unBindFramebuffer(this._colorMrts[writeId].renderTarget!);\r\n\r\n            this._engine.bindFramebuffer(this._depthMrts[writeId].renderTarget!);\r\n            this._engine.bindAttachments(this._layoutCache[2]);\r\n\r\n            this._engine.setAlphaMode(Constants.ALPHA_ONEONE_ONEONE); // the value does not matter (as MAX operation does not use them) but the src and dst color factors should not use SRC_ALPHA else WebGPU will throw a validation error\r\n            this._engine.setAlphaEquation(Constants.ALPHA_EQUATION_MAX);\r\n            this._engine.depthCullingState.depthTest = false;\r\n            this._engine.applyStates();\r\n\r\n            // Render\r\n            this._renderSubMeshes(this._candidateSubMeshes);\r\n            this._engine.unBindFramebuffer(this._depthMrts[writeId].renderTarget!);\r\n\r\n            this._scene.resetCachedMaterial();\r\n\r\n            // Back color\r\n            this._engine.bindFramebuffer(this._blendBackMrt.renderTarget!);\r\n            this._engine.bindAttachments(this._layoutCache[0]);\r\n            this._engine.setAlphaEquation(Constants.ALPHA_EQUATION_ADD);\r\n            this._engine.setAlphaMode(Constants.ALPHA_LAYER_ACCUMULATE);\r\n            this._engine.applyStates();\r\n\r\n            const blendBackEffectWrapper = writeId === 0 || !this._useRenderPasses ? this._blendBackEffectWrapper : this._blendBackEffectWrapperPingPong;\r\n            this._engine.enableEffect(blendBackEffectWrapper.drawWrapper);\r\n            blendBackEffectWrapper.effect.setTexture(\"uBackColor\", this._thinTextures[writeId * 3 + 2]);\r\n            this._effectRenderer.render(blendBackEffectWrapper);\r\n            this._engine.unBindFramebuffer(this._blendBackMrt.renderTarget!);\r\n        }\r\n\r\n        this._engine.currentRenderPassId = currentRenderPassId;\r\n\r\n        // Final composition on default FB\r\n        this._finalCompose(writeId);\r\n\r\n        (this._scene.prePassRenderer! as any)._enabled = true;\r\n        this._engine.depthCullingState.depthMask = true;\r\n        this._engine.depthCullingState.depthTest = true;\r\n\r\n        return this._excludedSubMeshes;\r\n    }\r\n\r\n    /**\r\n     * Disposes the depth peeling renderer and associated resources\r\n     */\r\n    public dispose() {\r\n        this._disposeTextures();\r\n        this._blendBackEffectWrapper.dispose();\r\n        this._finalEffectWrapper.dispose();\r\n        this._effectRenderer.dispose();\r\n        this._releaseRenderPassIds();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 5306, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/depthPeelingSceneComponent.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/depthPeelingSceneComponent.ts"],"sourcesContent":["import { Constants } from \"../Engines/constants\";\r\nimport { Scene } from \"../scene\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport type { Nullable } from \"../types\";\r\nimport { DepthPeelingRenderer } from \"./depthPeelingRenderer\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /**\r\n         * The depth peeling renderer\r\n         */\r\n        depthPeelingRenderer: Nullable<DepthPeelingRenderer>;\r\n        /** @internal (Backing field) */\r\n        _depthPeelingRenderer: Nullable<DepthPeelingRenderer>;\r\n\r\n        /**\r\n         * Flag to indicate if we want to use order independent transparency, despite the performance hit\r\n         */\r\n        useOrderIndependentTransparency: boolean;\r\n        /** @internal */\r\n        _useOrderIndependentTransparency: boolean;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"depthPeelingRenderer\", {\r\n    get: function (this: Scene) {\r\n        if (!this._depthPeelingRenderer) {\r\n            let component = this._getComponent(SceneComponentConstants.NAME_DEPTHPEELINGRENDERER) as DepthPeelingSceneComponent;\r\n            if (!component) {\r\n                component = new DepthPeelingSceneComponent(this);\r\n                this._addComponent(component);\r\n            }\r\n        }\r\n\r\n        return this._depthPeelingRenderer;\r\n    },\r\n    set: function (this: Scene, value: DepthPeelingRenderer) {\r\n        this._depthPeelingRenderer = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(Scene.prototype, \"useOrderIndependentTransparency\", {\r\n    get: function (this: Scene) {\r\n        return this._useOrderIndependentTransparency;\r\n    },\r\n    set: function (this: Scene, value: boolean) {\r\n        if (this._useOrderIndependentTransparency === value) {\r\n            return;\r\n        }\r\n        this._useOrderIndependentTransparency = value;\r\n        this.markAllMaterialsAsDirty(Constants.MATERIAL_AllDirtyFlag);\r\n        this.prePassRenderer?.markAsDirty();\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\n/**\r\n * Scene component to render order independent transparency with depth peeling\r\n */\r\nexport class DepthPeelingSceneComponent implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_DEPTHPEELINGRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n\r\n        scene.depthPeelingRenderer = new DepthPeelingRenderer(scene);\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {}\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {}\r\n\r\n    /**\r\n     * Disposes the component and the associated resources.\r\n     */\r\n    public dispose(): void {\r\n        this.scene.depthPeelingRenderer?.dispose();\r\n        this.scene.depthPeelingRenderer = null;\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA,OAAO,EAAE,KAAK,EAAE,MAAM,UAAU,CAAC;AAEjC,OAAO,EAAE,uBAAuB,EAAE,MAAM,mBAAmB,CAAC;AAE5D,OAAO,EAAE,oBAAoB,EAAE,MAAM,wBAAwB,CAAC;;;;AAqB9D,MAAM,CAAC,cAAc,CAAC,sNAAK,CAAC,SAAS,EAAE,sBAAsB,EAAE;IAC3D,GAAG,EAAE;QACD,IAAI,CAAC,IAAI,CAAC,qBAAqB,EAAE,CAAC;YAC9B,IAAI,SAAS,GAAG,IAAI,CAAC,aAAa,CAAC,iPAAuB,CAAC,yBAAyB,CAA+B,CAAC;YACpH,IAAI,CAAC,SAAS,EAAE,CAAC;gBACb,SAAS,GAAG,IAAI,0BAA0B,CAAC,IAAI,CAAC,CAAC;gBACjD,IAAI,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;YAClC,CAAC;QACL,CAAC;QAED,OAAO,IAAI,CAAC,qBAAqB,CAAC;IACtC,CAAC;IACD,GAAG,EAAE,SAAuB,KAA2B;QACnD,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;IACvC,CAAC;IACD,UAAU,EAAE,IAAI;IAChB,YAAY,EAAE,IAAI;CACrB,CAAC,CAAC;AAEH,MAAM,CAAC,cAAc,CAAC,sNAAK,CAAC,SAAS,EAAE,iCAAiC,EAAE;IACtE,GAAG,EAAE;QACD,OAAO,IAAI,CAAC,gCAAgC,CAAC;IACjD,CAAC;IACD,GAAG,EAAE,SAAuB,KAAc;QACtC,IAAI,IAAI,CAAC,gCAAgC,KAAK,KAAK,EAAE,CAAC;YAClD,OAAO;QACX,CAAC;QACD,IAAI,CAAC,gCAAgC,GAAG,KAAK,CAAC;QAC9C,IAAI,CAAC,uBAAuB,CAAC,SAAS,CAAC,qBAAqB,CAAC,CAAC;QAC9D,IAAI,CAAC,eAAe,EAAE,WAAW,EAAE,CAAC;IACxC,CAAC;IACD,UAAU,EAAE,IAAI;IAChB,YAAY,EAAE,IAAI;CACrB,CAAC,CAAC;AAKG,MAAO,0BAA0B;IAWnC;;;OAGG,CACH,YAAY,KAAY,CAAA;QAdxB;;WAEG,CACa,IAAA,CAAA,IAAI,GAAG,iPAAuB,CAAC,yBAAyB,CAAC;QAYrE,IAAI,CAAC,KAAK,GAAG,KAAK,CAAC;QAEnB,KAAK,CAAC,oBAAoB,GAAG,IAAI,iQAAoB,CAAC,KAAK,CAAC,CAAC;IACjE,CAAC;IAED;;OAEG,CACI,QAAQ,GAAA,CAAU,CAAC;IAE1B;;;OAGG,CACI,OAAO,GAAA,CAAU,CAAC;IAEzB;;OAEG,CACI,OAAO,GAAA;QACV,IAAI,CAAC,KAAK,CAAC,oBAAoB,EAAE,OAAO,EAAE,CAAC;QAC3C,IAAI,CAAC,KAAK,CAAC,oBAAoB,GAAG,IAAI,CAAC;IAC3C,CAAC;CACJ"}},
    {"offset": {"line": 5377, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/edgesRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/edgesRenderer.ts"],"sourcesContent":["import type { Immutable, Nullable } from \"../types\";\r\nimport { VertexBuffer } from \"../Buffers/buffer\";\r\nimport { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport type { Mesh } from \"../Meshes/mesh\";\r\nimport { LinesMesh, InstancedLinesMesh } from \"../Meshes/linesMesh\";\r\nimport type { Matrix } from \"../Maths/math.vector\";\r\nimport { Vector3, TmpVectors } from \"../Maths/math.vector\";\r\nimport type { IDisposable, Scene } from \"../scene\";\r\nimport type { Observer } from \"../Misc/observable\";\r\nimport { Material } from \"../Materials/material\";\r\nimport { ShaderMaterial } from \"../Materials/shaderMaterial\";\r\nimport { Camera } from \"../Cameras/camera\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { Node } from \"../node\";\r\n\r\nimport type { DataBuffer } from \"../Buffers/dataBuffer\";\r\nimport { SmartArray } from \"../Misc/smartArray\";\r\nimport { DrawWrapper } from \"../Materials/drawWrapper\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal */\r\n        _edgeRenderLineShader: Nullable<ShaderMaterial>;\r\n    }\r\n}\r\n\r\ndeclare module \"../Meshes/abstractMesh\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface AbstractMesh {\r\n        /**\r\n         * Gets the edgesRenderer associated with the mesh\r\n         */\r\n        edgesRenderer: Nullable<EdgesRenderer>;\r\n    }\r\n}\r\nAbstractMesh.prototype.disableEdgesRendering = function (): AbstractMesh {\r\n    if (this._edgesRenderer) {\r\n        this._edgesRenderer.dispose();\r\n        this._edgesRenderer = null;\r\n    }\r\n    return this;\r\n};\r\n\r\nAbstractMesh.prototype.enableEdgesRendering = function (epsilon = 0.95, checkVerticesInsteadOfIndices = false, options?: IEdgesRendererOptions): AbstractMesh {\r\n    this.disableEdgesRendering();\r\n    this._edgesRenderer = new EdgesRenderer(this, epsilon, checkVerticesInsteadOfIndices, true, options);\r\n    return this;\r\n};\r\n\r\nObject.defineProperty(AbstractMesh.prototype, \"edgesRenderer\", {\r\n    get: function (this: AbstractMesh) {\r\n        return this._edgesRenderer;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\ndeclare module \"../Meshes/linesMesh\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface LinesMesh {\r\n        /**\r\n         * Enables the edge rendering mode on the mesh.\r\n         * This mode makes the mesh edges visible\r\n         * @param epsilon defines the maximal distance between two angles to detect a face\r\n         * @param checkVerticesInsteadOfIndices indicates that we should check vertex list directly instead of faces\r\n         * @returns the currentAbstractMesh\r\n         * @see https://www.babylonjs-playground.com/#19O9TU#0\r\n         */\r\n        enableEdgesRendering(epsilon?: number, checkVerticesInsteadOfIndices?: boolean): AbstractMesh;\r\n    }\r\n}\r\nLinesMesh.prototype.enableEdgesRendering = function (epsilon = 0.95, checkVerticesInsteadOfIndices = false): AbstractMesh {\r\n    this.disableEdgesRendering();\r\n    this._edgesRenderer = new LineEdgesRenderer(this, epsilon, checkVerticesInsteadOfIndices);\r\n    return this;\r\n};\r\n\r\ndeclare module \"../Meshes/linesMesh\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface InstancedLinesMesh {\r\n        /**\r\n         * Enables the edge rendering mode on the mesh.\r\n         * This mode makes the mesh edges visible\r\n         * @param epsilon defines the maximal distance between two angles to detect a face\r\n         * @param checkVerticesInsteadOfIndices indicates that we should check vertex list directly instead of faces\r\n         * @returns the current InstancedLinesMesh\r\n         * @see https://www.babylonjs-playground.com/#19O9TU#0\r\n         */\r\n        enableEdgesRendering(epsilon?: number, checkVerticesInsteadOfIndices?: boolean): InstancedLinesMesh;\r\n    }\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\nInstancedLinesMesh.prototype.enableEdgesRendering = function (epsilon = 0.95, checkVerticesInsteadOfIndices = false): InstancedLinesMesh {\r\n    LinesMesh.prototype.enableEdgesRendering.apply(this, arguments);\r\n    return this;\r\n};\r\n\r\n/**\r\n * FaceAdjacencies Helper class to generate edges\r\n */\r\nclass FaceAdjacencies {\r\n    public edges: number[] = [];\r\n    public p0: Vector3;\r\n    public p1: Vector3;\r\n    public p2: Vector3;\r\n    public edgesConnectedCount = 0;\r\n}\r\n\r\n/**\r\n * Defines the minimum contract an Edges renderer should follow.\r\n */\r\nexport interface IEdgesRenderer extends IDisposable {\r\n    /**\r\n     * Gets or sets a boolean indicating if the edgesRenderer is active\r\n     */\r\n    isEnabled: boolean;\r\n\r\n    /**\r\n     * Renders the edges of the attached mesh,\r\n     */\r\n    render(): void;\r\n\r\n    /**\r\n     * Checks whether or not the edges renderer is ready to render.\r\n     * @returns true if ready, otherwise false.\r\n     */\r\n    isReady(): boolean;\r\n\r\n    /**\r\n     * List of instances to render in case the source mesh has instances\r\n     */\r\n    customInstances: SmartArray<Matrix>;\r\n}\r\n\r\n/**\r\n * Defines the additional options of the edges renderer\r\n */\r\nexport interface IEdgesRendererOptions {\r\n    /**\r\n     * Gets or sets a boolean indicating that the alternate edge finder algorithm must be used\r\n     * If not defined, the default value is true\r\n     */\r\n    useAlternateEdgeFinder?: boolean;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that the vertex merger fast processing must be used.\r\n     * If not defined, the default value is true.\r\n     * You should normally leave it undefined (or set it to true), except if you see some artifacts in the edges rendering (can happen with complex geometries)\r\n     * This option is used only if useAlternateEdgeFinder = true\r\n     */\r\n    useFastVertexMerger?: boolean;\r\n\r\n    /**\r\n     * During edges processing, the vertices are merged if they are close enough: epsilonVertexMerge is the limit within which vertices are considered to be equal.\r\n     * The default value is 1e-6\r\n     * This option is used only if useAlternateEdgeFinder = true\r\n     */\r\n    epsilonVertexMerge?: number;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that tessellation should be applied before finding the edges. You may need to activate this option if your geometry is a bit\r\n     * unusual, like having a vertex of a triangle in-between two vertices of an edge of another triangle. It happens often when using CSG to construct meshes.\r\n     * This option is used only if useAlternateEdgeFinder = true\r\n     */\r\n    applyTessellation?: boolean;\r\n\r\n    /**\r\n     * The limit under which 3 vertices are considered to be aligned. 3 vertices PQR are considered aligned if distance(PQ) + distance(QR) - distance(PR) < epsilonVertexAligned\r\n     * The default value is 1e-6\r\n     * This option is used only if useAlternateEdgeFinder = true\r\n     */\r\n    epsilonVertexAligned?: number;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that degenerated triangles should not be processed.\r\n     * Degenerated triangles are triangles that have 2 or 3 vertices with the same coordinates\r\n     */\r\n    removeDegeneratedTriangles?: boolean;\r\n}\r\n\r\n/**\r\n * This class is used to generate edges of the mesh that could then easily be rendered in a scene.\r\n */\r\nexport class EdgesRenderer implements IEdgesRenderer {\r\n    /**\r\n     * Define the size of the edges with an orthographic camera\r\n     */\r\n    public edgesWidthScalerForOrthographic = 1000.0;\r\n\r\n    /**\r\n     * Define the size of the edges with a perspective camera\r\n     */\r\n    public edgesWidthScalerForPerspective = 50.0;\r\n\r\n    protected _source: AbstractMesh;\r\n    protected _linesPositions = new Array<number>();\r\n    protected _linesNormals = new Array<number>();\r\n    protected _linesIndices = new Array<number>();\r\n    protected _epsilon: number;\r\n    protected _indicesCount: number;\r\n    protected _drawWrapper?: DrawWrapper;\r\n\r\n    protected _lineShader: ShaderMaterial;\r\n    protected _ib: DataBuffer;\r\n    protected _buffers: { [key: string]: Nullable<VertexBuffer> } = {};\r\n    protected _buffersForInstances: { [key: string]: Nullable<VertexBuffer> } = {};\r\n    protected _checkVerticesInsteadOfIndices = false;\r\n    protected _options: Nullable<IEdgesRendererOptions>;\r\n\r\n    private _meshRebuildObserver: Nullable<Observer<AbstractMesh>>;\r\n    private _meshDisposeObserver: Nullable<Observer<Node>>;\r\n\r\n    /** Gets or sets a boolean indicating if the edgesRenderer is active */\r\n    public isEnabled = true;\r\n\r\n    /** Gets the vertices generated by the edge renderer */\r\n    public get linesPositions(): Immutable<Array<number>> {\r\n        return this._linesPositions;\r\n    }\r\n\r\n    /** Gets the normals generated by the edge renderer */\r\n    public get linesNormals(): Immutable<Array<number>> {\r\n        return this._linesNormals;\r\n    }\r\n\r\n    /** Gets the indices generated by the edge renderer */\r\n    public get linesIndices(): Immutable<Array<number>> {\r\n        return this._linesIndices;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets the shader used to draw the lines\r\n     */\r\n    public get lineShader(): ShaderMaterial {\r\n        return this._lineShader;\r\n    }\r\n\r\n    public set lineShader(shader: ShaderMaterial) {\r\n        this._lineShader = shader;\r\n    }\r\n\r\n    /**\r\n     * List of instances to render in case the source mesh has instances\r\n     */\r\n    public customInstances = new SmartArray<Matrix>(32);\r\n\r\n    private static _GetShader(scene: Scene, shaderLanguage: ShaderLanguage): ShaderMaterial {\r\n        if (!scene._edgeRenderLineShader) {\r\n            const shader = new ShaderMaterial(\r\n                \"lineShader\",\r\n                scene,\r\n                \"line\",\r\n                {\r\n                    attributes: [\"position\", \"normal\"],\r\n                    uniforms: [\"world\", \"viewProjection\", \"color\", \"width\", \"aspectRatio\"],\r\n                    uniformBuffers: [\"Scene\", \"Mesh\"],\r\n                    shaderLanguage: shaderLanguage,\r\n                    extraInitializationsAsync: async () => {\r\n                        if (shaderLanguage === ShaderLanguage.WGSL) {\r\n                            await Promise.all([import(\"../ShadersWGSL/line.vertex\"), import(\"../ShadersWGSL/line.fragment\")]);\r\n                        } else {\r\n                            await Promise.all([import(\"../Shaders/line.vertex\"), import(\"../Shaders/line.fragment\")]);\r\n                        }\r\n                    },\r\n                },\r\n                false\r\n            );\r\n\r\n            shader.disableDepthWrite = true;\r\n            shader.backFaceCulling = false;\r\n            shader.checkReadyOnEveryCall = scene.getEngine().isWebGPU;\r\n\r\n            scene._edgeRenderLineShader = shader;\r\n\r\n            scene.onDisposeObservable.add(() => {\r\n                scene._edgeRenderLineShader!.dispose();\r\n                scene._edgeRenderLineShader = null;\r\n            });\r\n        }\r\n\r\n        return scene._edgeRenderLineShader;\r\n    }\r\n\r\n    /** Shader language used*/\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used.\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Creates an instance of the EdgesRenderer. It is primarily use to display edges of a mesh.\r\n     * Beware when you use this class with complex objects as the adjacencies computation can be really long\r\n     * @param  source Mesh used to create edges\r\n     * @param  epsilon sum of angles in adjacency to check for edge\r\n     * @param  checkVerticesInsteadOfIndices bases the edges detection on vertices vs indices. Note that this parameter is not used if options.useAlternateEdgeFinder = true\r\n     * @param  generateEdgesLines - should generate Lines or only prepare resources.\r\n     * @param  options The options to apply when generating the edges\r\n     */\r\n    constructor(source: AbstractMesh, epsilon = 0.95, checkVerticesInsteadOfIndices = false, generateEdgesLines = true, options?: IEdgesRendererOptions) {\r\n        this._source = source;\r\n        this._checkVerticesInsteadOfIndices = checkVerticesInsteadOfIndices;\r\n        this._options = options ?? null;\r\n\r\n        this._epsilon = epsilon;\r\n        const engine = this._source.getScene().getEngine();\r\n        if (engine.isWebGPU) {\r\n            this._drawWrapper = new DrawWrapper(engine);\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n        }\r\n\r\n        this._prepareResources();\r\n        if (generateEdgesLines) {\r\n            if (options?.useAlternateEdgeFinder ?? true) {\r\n                this._generateEdgesLinesAlternate();\r\n            } else {\r\n                this._generateEdgesLines();\r\n            }\r\n        }\r\n\r\n        this._meshRebuildObserver = this._source.onRebuildObservable.add(() => {\r\n            this._rebuild();\r\n        });\r\n\r\n        this._meshDisposeObserver = this._source.onDisposeObservable.add(() => {\r\n            this.dispose();\r\n        });\r\n    }\r\n\r\n    protected _prepareResources(): void {\r\n        if (this._lineShader) {\r\n            return;\r\n        }\r\n\r\n        this._lineShader = EdgesRenderer._GetShader(this._source.getScene(), this._shaderLanguage);\r\n    }\r\n\r\n    /** @internal */\r\n    public _rebuild(): void {\r\n        let buffer = this._buffers[VertexBuffer.PositionKind];\r\n        if (buffer) {\r\n            buffer._rebuild();\r\n        }\r\n\r\n        buffer = this._buffers[VertexBuffer.NormalKind];\r\n        if (buffer) {\r\n            buffer._rebuild();\r\n        }\r\n\r\n        const scene = this._source.getScene();\r\n        const engine = scene.getEngine();\r\n        this._ib = engine.createIndexBuffer(this._linesIndices);\r\n    }\r\n\r\n    /**\r\n     * Releases the required resources for the edges renderer\r\n     */\r\n    public dispose(): void {\r\n        this._source.onRebuildObservable.remove(this._meshRebuildObserver);\r\n        this._source.onDisposeObservable.remove(this._meshDisposeObserver);\r\n\r\n        let buffer = this._buffers[VertexBuffer.PositionKind];\r\n        if (buffer) {\r\n            buffer.dispose();\r\n            this._buffers[VertexBuffer.PositionKind] = null;\r\n        }\r\n        buffer = this._buffers[VertexBuffer.NormalKind];\r\n        if (buffer) {\r\n            buffer.dispose();\r\n            this._buffers[VertexBuffer.NormalKind] = null;\r\n        }\r\n\r\n        if (this._ib) {\r\n            this._source.getScene().getEngine()._releaseBuffer(this._ib);\r\n        }\r\n\r\n        this._drawWrapper?.dispose();\r\n    }\r\n\r\n    protected _processEdgeForAdjacencies(pa: number, pb: number, p0: number, p1: number, p2: number): number {\r\n        if ((pa === p0 && pb === p1) || (pa === p1 && pb === p0)) {\r\n            return 0;\r\n        }\r\n\r\n        if ((pa === p1 && pb === p2) || (pa === p2 && pb === p1)) {\r\n            return 1;\r\n        }\r\n\r\n        if ((pa === p2 && pb === p0) || (pa === p0 && pb === p2)) {\r\n            return 2;\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    protected _processEdgeForAdjacenciesWithVertices(pa: Vector3, pb: Vector3, p0: Vector3, p1: Vector3, p2: Vector3): number {\r\n        const eps = 1e-10;\r\n        if ((pa.equalsWithEpsilon(p0, eps) && pb.equalsWithEpsilon(p1, eps)) || (pa.equalsWithEpsilon(p1, eps) && pb.equalsWithEpsilon(p0, eps))) {\r\n            return 0;\r\n        }\r\n\r\n        if ((pa.equalsWithEpsilon(p1, eps) && pb.equalsWithEpsilon(p2, eps)) || (pa.equalsWithEpsilon(p2, eps) && pb.equalsWithEpsilon(p1, eps))) {\r\n            return 1;\r\n        }\r\n\r\n        if ((pa.equalsWithEpsilon(p2, eps) && pb.equalsWithEpsilon(p0, eps)) || (pa.equalsWithEpsilon(p0, eps) && pb.equalsWithEpsilon(p2, eps))) {\r\n            return 2;\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    /**\r\n     * Checks if the pair of p0 and p1 is en edge\r\n     * @param faceIndex\r\n     * @param edge\r\n     * @param faceNormals\r\n     * @param  p0\r\n     * @param  p1\r\n     * @private\r\n     */\r\n    protected _checkEdge(faceIndex: number, edge: number, faceNormals: Array<Vector3>, p0: Vector3, p1: Vector3): void {\r\n        let needToCreateLine;\r\n\r\n        if (edge === undefined) {\r\n            needToCreateLine = true;\r\n        } else {\r\n            const dotProduct = Vector3.Dot(faceNormals[faceIndex], faceNormals[edge]);\r\n\r\n            needToCreateLine = dotProduct < this._epsilon;\r\n        }\r\n\r\n        if (needToCreateLine) {\r\n            this.createLine(p0, p1, this._linesPositions.length / 3);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * push line into the position, normal and index buffer\r\n     * @param p0\r\n     * @param p1\r\n     * @param offset\r\n     * @protected\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    protected createLine(p0: Vector3, p1: Vector3, offset: number) {\r\n        // Positions\r\n        this._linesPositions.push(p0.x, p0.y, p0.z, p0.x, p0.y, p0.z, p1.x, p1.y, p1.z, p1.x, p1.y, p1.z);\r\n\r\n        // Normals\r\n        this._linesNormals.push(p1.x, p1.y, p1.z, -1, p1.x, p1.y, p1.z, 1, p0.x, p0.y, p0.z, -1, p0.x, p0.y, p0.z, 1);\r\n\r\n        // Indices\r\n        this._linesIndices.push(offset, offset + 1, offset + 2, offset, offset + 2, offset + 3);\r\n    }\r\n\r\n    /**\r\n     * See https://playground.babylonjs.com/#R3JR6V#1 for a visual display of the algorithm\r\n     * @param edgePoints\r\n     * @param indexTriangle\r\n     * @param indices\r\n     * @param remapVertexIndices\r\n     */\r\n    private _tessellateTriangle(edgePoints: Array<Array<[number, number]>>, indexTriangle: number, indices: Array<number>, remapVertexIndices: Array<number>): void {\r\n        const makePointList = (edgePoints: Array<[number, number]>, pointIndices: Array<number>, firstIndex: number) => {\r\n            if (firstIndex >= 0) {\r\n                pointIndices.push(firstIndex);\r\n            }\r\n\r\n            for (let i = 0; i < edgePoints.length; ++i) {\r\n                pointIndices.push(edgePoints[i][0]);\r\n            }\r\n        };\r\n\r\n        let startEdge = 0;\r\n\r\n        if (edgePoints[1].length >= edgePoints[0].length && edgePoints[1].length >= edgePoints[2].length) {\r\n            startEdge = 1;\r\n        } else if (edgePoints[2].length >= edgePoints[0].length && edgePoints[2].length >= edgePoints[1].length) {\r\n            startEdge = 2;\r\n        }\r\n\r\n        for (let e = 0; e < 3; ++e) {\r\n            if (e === startEdge) {\r\n                edgePoints[e].sort((a, b) => (a[1] < b[1] ? -1 : a[1] > b[1] ? 1 : 0));\r\n            } else {\r\n                edgePoints[e].sort((a, b) => (a[1] > b[1] ? -1 : a[1] < b[1] ? 1 : 0));\r\n            }\r\n        }\r\n\r\n        const mainPointIndices: Array<number> = [],\r\n            otherPointIndices: Array<number> = [];\r\n\r\n        makePointList(edgePoints[startEdge], mainPointIndices, -1);\r\n\r\n        const numMainPoints = mainPointIndices.length;\r\n\r\n        for (let i = startEdge + 2; i >= startEdge + 1; --i) {\r\n            makePointList(edgePoints[i % 3], otherPointIndices, i !== startEdge + 2 ? remapVertexIndices[indices[indexTriangle + ((i + 1) % 3)]] : -1);\r\n        }\r\n\r\n        const numOtherPoints = otherPointIndices.length;\r\n\r\n        const idxMain = 0;\r\n        const idxOther = 0;\r\n\r\n        indices.push(remapVertexIndices[indices[indexTriangle + startEdge]], mainPointIndices[0], otherPointIndices[0]);\r\n        indices.push(remapVertexIndices[indices[indexTriangle + ((startEdge + 1) % 3)]], otherPointIndices[numOtherPoints - 1], mainPointIndices[numMainPoints - 1]);\r\n\r\n        const bucketIsMain = numMainPoints <= numOtherPoints;\r\n\r\n        const bucketStep = bucketIsMain ? numMainPoints : numOtherPoints;\r\n        const bucketLimit = bucketIsMain ? numOtherPoints : numMainPoints;\r\n        const bucketIdxLimit = bucketIsMain ? numMainPoints - 1 : numOtherPoints - 1;\r\n        const winding = bucketIsMain ? 0 : 1;\r\n\r\n        let numTris = numMainPoints + numOtherPoints - 2;\r\n\r\n        let bucketIdx = bucketIsMain ? idxMain : idxOther;\r\n        let nbucketIdx = bucketIsMain ? idxOther : idxMain;\r\n        const bucketPoints = bucketIsMain ? mainPointIndices : otherPointIndices;\r\n        const nbucketPoints = bucketIsMain ? otherPointIndices : mainPointIndices;\r\n\r\n        let bucket = 0;\r\n\r\n        while (numTris-- > 0) {\r\n            if (winding) {\r\n                indices.push(bucketPoints[bucketIdx], nbucketPoints[nbucketIdx]);\r\n            } else {\r\n                indices.push(nbucketPoints[nbucketIdx], bucketPoints[bucketIdx]);\r\n            }\r\n\r\n            bucket += bucketStep;\r\n\r\n            let lastIdx;\r\n\r\n            if (bucket >= bucketLimit && bucketIdx < bucketIdxLimit) {\r\n                lastIdx = bucketPoints[++bucketIdx];\r\n                bucket -= bucketLimit;\r\n            } else {\r\n                lastIdx = nbucketPoints[++nbucketIdx];\r\n            }\r\n\r\n            indices.push(lastIdx);\r\n        }\r\n\r\n        indices[indexTriangle + 0] = indices[indices.length - 3];\r\n        indices[indexTriangle + 1] = indices[indices.length - 2];\r\n        indices[indexTriangle + 2] = indices[indices.length - 1];\r\n\r\n        indices.length = indices.length - 3;\r\n    }\r\n\r\n    private _generateEdgesLinesAlternate(): void {\r\n        const positions = this._source.getVerticesData(VertexBuffer.PositionKind);\r\n        let indices = this._source.getIndices();\r\n\r\n        if (!indices || !positions) {\r\n            return;\r\n        }\r\n\r\n        if (!Array.isArray(indices)) {\r\n            indices = Array.from(indices);\r\n        }\r\n\r\n        /**\r\n         * Find all vertices that are at the same location (with an epsilon) and remapp them on the same vertex\r\n         */\r\n        const useFastVertexMerger = this._options?.useFastVertexMerger ?? true;\r\n        const epsVertexMerge = useFastVertexMerger ? Math.round(-Math.log(this._options?.epsilonVertexMerge ?? 1e-6) / Math.log(10)) : (this._options?.epsilonVertexMerge ?? 1e-6);\r\n        const remapVertexIndices: Array<number> = [];\r\n        const uniquePositions: Array<number> = []; // list of unique index of vertices - needed for tessellation\r\n\r\n        if (useFastVertexMerger) {\r\n            const mapVertices: { [key: string]: number } = {};\r\n            for (let v1 = 0; v1 < positions.length; v1 += 3) {\r\n                const x1 = positions[v1 + 0],\r\n                    y1 = positions[v1 + 1],\r\n                    z1 = positions[v1 + 2];\r\n\r\n                const key = x1.toFixed(epsVertexMerge) + \"|\" + y1.toFixed(epsVertexMerge) + \"|\" + z1.toFixed(epsVertexMerge);\r\n\r\n                if (mapVertices[key] !== undefined) {\r\n                    remapVertexIndices.push(mapVertices[key]);\r\n                } else {\r\n                    const idx = v1 / 3;\r\n                    mapVertices[key] = idx;\r\n                    remapVertexIndices.push(idx);\r\n                    uniquePositions.push(idx);\r\n                }\r\n            }\r\n        } else {\r\n            for (let v1 = 0; v1 < positions.length; v1 += 3) {\r\n                const x1 = positions[v1 + 0],\r\n                    y1 = positions[v1 + 1],\r\n                    z1 = positions[v1 + 2];\r\n                let found = false;\r\n                for (let v2 = 0; v2 < v1 && !found; v2 += 3) {\r\n                    const x2 = positions[v2 + 0],\r\n                        y2 = positions[v2 + 1],\r\n                        z2 = positions[v2 + 2];\r\n\r\n                    if (Math.abs(x1 - x2) < epsVertexMerge && Math.abs(y1 - y2) < epsVertexMerge && Math.abs(z1 - z2) < epsVertexMerge) {\r\n                        remapVertexIndices.push(v2 / 3);\r\n                        found = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                if (!found) {\r\n                    remapVertexIndices.push(v1 / 3);\r\n                    uniquePositions.push(v1 / 3);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (this._options?.applyTessellation) {\r\n            /**\r\n             * Tessellate triangles if necessary:\r\n             *\r\n             *               A\r\n             *               +\r\n             *               |\\\r\n             *               | \\\r\n             *               |  \\\r\n             *             E +   \\\r\n             *              /|    \\\r\n             *             / |     \\\r\n             *            /  |      \\\r\n             *           +---+-------+ B\r\n             *           D   C\r\n             *\r\n             * For the edges to be rendered correctly, the ABC triangle has to be split into ABE and BCE, else AC is considered to be an edge, whereas only AE should be.\r\n             *\r\n             * The tessellation process looks for the vertices like E that are in-between two other vertices making of an edge and create new triangles as necessary\r\n             */\r\n\r\n            // First step: collect the triangles to tessellate\r\n            const epsVertexAligned = this._options?.epsilonVertexAligned ?? 1e-6;\r\n            const mustTesselate: Array<{ index: number; edgesPoints: Array<Array<[number, number]>> }> = []; // liste of triangles that must be tessellated\r\n\r\n            for (let index = 0; index < indices.length; index += 3) {\r\n                // loop over all triangles\r\n                let triangleToTessellate: { index: number; edgesPoints: Array<Array<[number, number]>> } | undefined;\r\n\r\n                for (let i = 0; i < 3; ++i) {\r\n                    // loop over the 3 edges of the triangle\r\n                    const p0Index = remapVertexIndices[indices[index + i]];\r\n                    const p1Index = remapVertexIndices[indices[index + ((i + 1) % 3)]];\r\n                    const p2Index = remapVertexIndices[indices[index + ((i + 2) % 3)]];\r\n\r\n                    if (p0Index === p1Index) {\r\n                        continue;\r\n                    } // degenerated triangle - don't process\r\n\r\n                    const p0x = positions[p0Index * 3 + 0],\r\n                        p0y = positions[p0Index * 3 + 1],\r\n                        p0z = positions[p0Index * 3 + 2];\r\n                    const p1x = positions[p1Index * 3 + 0],\r\n                        p1y = positions[p1Index * 3 + 1],\r\n                        p1z = positions[p1Index * 3 + 2];\r\n\r\n                    const p0p1 = Math.sqrt((p1x - p0x) * (p1x - p0x) + (p1y - p0y) * (p1y - p0y) + (p1z - p0z) * (p1z - p0z));\r\n\r\n                    for (let v = 0; v < uniquePositions.length - 1; v++) {\r\n                        // loop over all (unique) vertices and look for the ones that would be in-between p0 and p1\r\n                        const vIndex = uniquePositions[v];\r\n\r\n                        if (vIndex === p0Index || vIndex === p1Index || vIndex === p2Index) {\r\n                            continue;\r\n                        } // don't handle the vertex if it is a vertex of the current triangle\r\n\r\n                        const x = positions[vIndex * 3 + 0],\r\n                            y = positions[vIndex * 3 + 1],\r\n                            z = positions[vIndex * 3 + 2];\r\n\r\n                        const p0p = Math.sqrt((x - p0x) * (x - p0x) + (y - p0y) * (y - p0y) + (z - p0z) * (z - p0z));\r\n                        const pp1 = Math.sqrt((x - p1x) * (x - p1x) + (y - p1y) * (y - p1y) + (z - p1z) * (z - p1z));\r\n\r\n                        if (Math.abs(p0p + pp1 - p0p1) < epsVertexAligned) {\r\n                            // vertices are aligned and p in-between p0 and p1 if distance(p0, p) + distance (p, p1) ~ distance(p0, p1)\r\n                            if (!triangleToTessellate) {\r\n                                triangleToTessellate = {\r\n                                    index: index,\r\n                                    edgesPoints: [[], [], []],\r\n                                };\r\n                                mustTesselate.push(triangleToTessellate);\r\n                            }\r\n                            triangleToTessellate.edgesPoints[i].push([vIndex, p0p]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Second step: tesselate the triangles\r\n            for (let t = 0; t < mustTesselate.length; ++t) {\r\n                const triangle = mustTesselate[t];\r\n\r\n                this._tessellateTriangle(triangle.edgesPoints, triangle.index, indices, remapVertexIndices);\r\n            }\r\n\r\n            mustTesselate.length = 0;\r\n        }\r\n\r\n        /**\r\n         * Collect the edges to render\r\n         */\r\n        const edges: { [key: string]: { normal: Vector3; done: boolean; index: number; i: number } } = {};\r\n\r\n        for (let index = 0; index < indices.length; index += 3) {\r\n            let faceNormal;\r\n            for (let i = 0; i < 3; ++i) {\r\n                let p0Index = remapVertexIndices[indices[index + i]];\r\n                let p1Index = remapVertexIndices[indices[index + ((i + 1) % 3)]];\r\n                const p2Index = remapVertexIndices[indices[index + ((i + 2) % 3)]];\r\n\r\n                if (p0Index === p1Index || ((p0Index === p2Index || p1Index === p2Index) && this._options?.removeDegeneratedTriangles)) {\r\n                    continue;\r\n                }\r\n\r\n                TmpVectors.Vector3[0].copyFromFloats(positions[p0Index * 3 + 0], positions[p0Index * 3 + 1], positions[p0Index * 3 + 2]);\r\n                TmpVectors.Vector3[1].copyFromFloats(positions[p1Index * 3 + 0], positions[p1Index * 3 + 1], positions[p1Index * 3 + 2]);\r\n                TmpVectors.Vector3[2].copyFromFloats(positions[p2Index * 3 + 0], positions[p2Index * 3 + 1], positions[p2Index * 3 + 2]);\r\n\r\n                if (!faceNormal) {\r\n                    TmpVectors.Vector3[1].subtractToRef(TmpVectors.Vector3[0], TmpVectors.Vector3[3]);\r\n                    TmpVectors.Vector3[2].subtractToRef(TmpVectors.Vector3[1], TmpVectors.Vector3[4]);\r\n                    faceNormal = Vector3.Cross(TmpVectors.Vector3[3], TmpVectors.Vector3[4]);\r\n                    faceNormal.normalize();\r\n                }\r\n\r\n                if (p0Index > p1Index) {\r\n                    const tmp = p0Index;\r\n                    p0Index = p1Index;\r\n                    p1Index = tmp;\r\n                }\r\n\r\n                const key = p0Index + \"_\" + p1Index;\r\n                const ei = edges[key];\r\n\r\n                if (ei) {\r\n                    if (!ei.done) {\r\n                        const dotProduct = Vector3.Dot(faceNormal, ei.normal);\r\n\r\n                        if (dotProduct < this._epsilon) {\r\n                            this.createLine(TmpVectors.Vector3[0], TmpVectors.Vector3[1], this._linesPositions.length / 3);\r\n                        }\r\n\r\n                        ei.done = true;\r\n                    }\r\n                } else {\r\n                    edges[key] = { normal: faceNormal, done: false, index: index, i: i };\r\n                }\r\n            }\r\n        }\r\n\r\n        for (const key in edges) {\r\n            const ei = edges[key];\r\n            if (!ei.done) {\r\n                // Orphaned edge - we must display it\r\n                const p0Index = remapVertexIndices[indices[ei.index + ei.i]];\r\n                const p1Index = remapVertexIndices[indices[ei.index + ((ei.i + 1) % 3)]];\r\n\r\n                TmpVectors.Vector3[0].copyFromFloats(positions[p0Index * 3 + 0], positions[p0Index * 3 + 1], positions[p0Index * 3 + 2]);\r\n                TmpVectors.Vector3[1].copyFromFloats(positions[p1Index * 3 + 0], positions[p1Index * 3 + 1], positions[p1Index * 3 + 2]);\r\n\r\n                this.createLine(TmpVectors.Vector3[0], TmpVectors.Vector3[1], this._linesPositions.length / 3);\r\n            }\r\n        }\r\n\r\n        /**\r\n         * Merge into a single mesh\r\n         */\r\n        const engine = this._source.getScene().getEngine();\r\n\r\n        this._buffers[VertexBuffer.PositionKind] = new VertexBuffer(engine, this._linesPositions, VertexBuffer.PositionKind, false);\r\n        this._buffers[VertexBuffer.NormalKind] = new VertexBuffer(engine, this._linesNormals, VertexBuffer.NormalKind, false, false, 4);\r\n\r\n        this._buffersForInstances[VertexBuffer.PositionKind] = this._buffers[VertexBuffer.PositionKind];\r\n        this._buffersForInstances[VertexBuffer.NormalKind] = this._buffers[VertexBuffer.NormalKind];\r\n\r\n        this._ib = engine.createIndexBuffer(this._linesIndices);\r\n\r\n        this._indicesCount = this._linesIndices.length;\r\n    }\r\n\r\n    /**\r\n     * Generates lines edges from adjacencjes\r\n     * @private\r\n     */\r\n    _generateEdgesLines(): void {\r\n        const positions = this._source.getVerticesData(VertexBuffer.PositionKind);\r\n        const indices = this._source.getIndices();\r\n\r\n        if (!indices || !positions) {\r\n            return;\r\n        }\r\n\r\n        // First let's find adjacencies\r\n        const adjacencies: FaceAdjacencies[] = [];\r\n        const faceNormals: Vector3[] = [];\r\n        let index: number;\r\n        let faceAdjacencies: FaceAdjacencies;\r\n\r\n        // Prepare faces\r\n        for (index = 0; index < indices.length; index += 3) {\r\n            faceAdjacencies = new FaceAdjacencies();\r\n            const p0Index = indices[index];\r\n            const p1Index = indices[index + 1];\r\n            const p2Index = indices[index + 2];\r\n\r\n            faceAdjacencies.p0 = new Vector3(positions[p0Index * 3], positions[p0Index * 3 + 1], positions[p0Index * 3 + 2]);\r\n            faceAdjacencies.p1 = new Vector3(positions[p1Index * 3], positions[p1Index * 3 + 1], positions[p1Index * 3 + 2]);\r\n            faceAdjacencies.p2 = new Vector3(positions[p2Index * 3], positions[p2Index * 3 + 1], positions[p2Index * 3 + 2]);\r\n            const faceNormal = Vector3.Cross(faceAdjacencies.p1.subtract(faceAdjacencies.p0), faceAdjacencies.p2.subtract(faceAdjacencies.p1));\r\n\r\n            faceNormal.normalize();\r\n\r\n            faceNormals.push(faceNormal);\r\n            adjacencies.push(faceAdjacencies);\r\n        }\r\n\r\n        // Scan\r\n        for (index = 0; index < adjacencies.length; index++) {\r\n            faceAdjacencies = adjacencies[index];\r\n\r\n            for (let otherIndex = index + 1; otherIndex < adjacencies.length; otherIndex++) {\r\n                const otherFaceAdjacencies = adjacencies[otherIndex];\r\n\r\n                if (faceAdjacencies.edgesConnectedCount === 3) {\r\n                    // Full\r\n                    break;\r\n                }\r\n\r\n                if (otherFaceAdjacencies.edgesConnectedCount === 3) {\r\n                    // Full\r\n                    continue;\r\n                }\r\n\r\n                const otherP0 = indices[otherIndex * 3];\r\n                const otherP1 = indices[otherIndex * 3 + 1];\r\n                const otherP2 = indices[otherIndex * 3 + 2];\r\n\r\n                for (let edgeIndex = 0; edgeIndex < 3; edgeIndex++) {\r\n                    let otherEdgeIndex: number = 0;\r\n\r\n                    if (faceAdjacencies.edges[edgeIndex] !== undefined) {\r\n                        continue;\r\n                    }\r\n\r\n                    switch (edgeIndex) {\r\n                        case 0:\r\n                            if (this._checkVerticesInsteadOfIndices) {\r\n                                otherEdgeIndex = this._processEdgeForAdjacenciesWithVertices(\r\n                                    faceAdjacencies.p0,\r\n                                    faceAdjacencies.p1,\r\n                                    otherFaceAdjacencies.p0,\r\n                                    otherFaceAdjacencies.p1,\r\n                                    otherFaceAdjacencies.p2\r\n                                );\r\n                            } else {\r\n                                otherEdgeIndex = this._processEdgeForAdjacencies(indices[index * 3], indices[index * 3 + 1], otherP0, otherP1, otherP2);\r\n                            }\r\n                            break;\r\n                        case 1:\r\n                            if (this._checkVerticesInsteadOfIndices) {\r\n                                otherEdgeIndex = this._processEdgeForAdjacenciesWithVertices(\r\n                                    faceAdjacencies.p1,\r\n                                    faceAdjacencies.p2,\r\n                                    otherFaceAdjacencies.p0,\r\n                                    otherFaceAdjacencies.p1,\r\n                                    otherFaceAdjacencies.p2\r\n                                );\r\n                            } else {\r\n                                otherEdgeIndex = this._processEdgeForAdjacencies(indices[index * 3 + 1], indices[index * 3 + 2], otherP0, otherP1, otherP2);\r\n                            }\r\n                            break;\r\n                        case 2:\r\n                            if (this._checkVerticesInsteadOfIndices) {\r\n                                otherEdgeIndex = this._processEdgeForAdjacenciesWithVertices(\r\n                                    faceAdjacencies.p2,\r\n                                    faceAdjacencies.p0,\r\n                                    otherFaceAdjacencies.p0,\r\n                                    otherFaceAdjacencies.p1,\r\n                                    otherFaceAdjacencies.p2\r\n                                );\r\n                            } else {\r\n                                otherEdgeIndex = this._processEdgeForAdjacencies(indices[index * 3 + 2], indices[index * 3], otherP0, otherP1, otherP2);\r\n                            }\r\n                            break;\r\n                    }\r\n\r\n                    if (otherEdgeIndex === -1) {\r\n                        continue;\r\n                    }\r\n\r\n                    faceAdjacencies.edges[edgeIndex] = otherIndex;\r\n                    otherFaceAdjacencies.edges[otherEdgeIndex] = index;\r\n\r\n                    faceAdjacencies.edgesConnectedCount++;\r\n                    otherFaceAdjacencies.edgesConnectedCount++;\r\n\r\n                    if (faceAdjacencies.edgesConnectedCount === 3) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Create lines\r\n        for (index = 0; index < adjacencies.length; index++) {\r\n            // We need a line when a face has no adjacency on a specific edge or if all the adjacencies has an angle greater than epsilon\r\n            const current = adjacencies[index];\r\n\r\n            this._checkEdge(index, current.edges[0], faceNormals, current.p0, current.p1);\r\n            this._checkEdge(index, current.edges[1], faceNormals, current.p1, current.p2);\r\n            this._checkEdge(index, current.edges[2], faceNormals, current.p2, current.p0);\r\n        }\r\n\r\n        // Merge into a single mesh\r\n        const engine = this._source.getScene().getEngine();\r\n\r\n        this._buffers[VertexBuffer.PositionKind] = new VertexBuffer(engine, this._linesPositions, VertexBuffer.PositionKind, false);\r\n        this._buffers[VertexBuffer.NormalKind] = new VertexBuffer(engine, this._linesNormals, VertexBuffer.NormalKind, false, false, 4);\r\n\r\n        this._buffersForInstances[VertexBuffer.PositionKind] = this._buffers[VertexBuffer.PositionKind];\r\n        this._buffersForInstances[VertexBuffer.NormalKind] = this._buffers[VertexBuffer.NormalKind];\r\n\r\n        this._ib = engine.createIndexBuffer(this._linesIndices);\r\n\r\n        this._indicesCount = this._linesIndices.length;\r\n    }\r\n\r\n    /**\r\n     * Checks whether or not the edges renderer is ready to render.\r\n     * @returns true if ready, otherwise false.\r\n     */\r\n    public isReady(): boolean {\r\n        return this._lineShader.isReady(this._source, (this._source.hasInstances && this.customInstances.length > 0) || this._source.hasThinInstances);\r\n    }\r\n\r\n    /**\r\n     * Renders the edges of the attached mesh,\r\n     */\r\n    public render(): void {\r\n        const scene = this._source.getScene();\r\n        const floatingOriginOffset = scene.floatingOriginOffset;\r\n\r\n        const currentDrawWrapper = this._lineShader._getDrawWrapper();\r\n        if (this._drawWrapper) {\r\n            this._lineShader._setDrawWrapper(this._drawWrapper);\r\n        }\r\n\r\n        if (!this.isReady() || !scene.activeCamera) {\r\n            this._lineShader._setDrawWrapper(currentDrawWrapper);\r\n            return;\r\n        }\r\n\r\n        const hasInstances = this._source.hasInstances && this.customInstances.length > 0;\r\n        const useBuffersWithInstances = hasInstances || this._source.hasThinInstances;\r\n\r\n        let instanceCount = 0;\r\n\r\n        if (useBuffersWithInstances) {\r\n            this._buffersForInstances[\"world0\"] = (this._source as Mesh).getVertexBuffer(\"world0\");\r\n            this._buffersForInstances[\"world1\"] = (this._source as Mesh).getVertexBuffer(\"world1\");\r\n            this._buffersForInstances[\"world2\"] = (this._source as Mesh).getVertexBuffer(\"world2\");\r\n            this._buffersForInstances[\"world3\"] = (this._source as Mesh).getVertexBuffer(\"world3\");\r\n\r\n            if (hasInstances) {\r\n                const instanceStorage = (this._source as Mesh)._getInstanceDataStorage();\r\n                const isFrozen = (this._source as Mesh)._instanceDataStorage.isFrozen;\r\n\r\n                instanceCount = this.customInstances.length;\r\n\r\n                if (!instanceStorage.instancesData) {\r\n                    if (!this._source.getScene()._activeMeshesFrozen) {\r\n                        this.customInstances.reset();\r\n                    }\r\n                    return;\r\n                }\r\n\r\n                if (!isFrozen) {\r\n                    let offset = 0;\r\n\r\n                    for (let i = 0; i < instanceCount; ++i) {\r\n                        this.customInstances.data[i].copyToArray(instanceStorage.instancesData, offset);\r\n                        instanceStorage.instancesData[offset + 12] -= floatingOriginOffset.x;\r\n                        instanceStorage.instancesData[offset + 13] -= floatingOriginOffset.y;\r\n                        instanceStorage.instancesData[offset + 14] -= floatingOriginOffset.z;\r\n                        offset += 16;\r\n                    }\r\n\r\n                    instanceStorage.instancesBuffer!.updateDirectly(instanceStorage.instancesData, 0, instanceCount);\r\n                }\r\n            } else {\r\n                instanceCount = (this._source as Mesh).thinInstanceCount;\r\n            }\r\n        }\r\n\r\n        const engine = scene.getEngine();\r\n        this._lineShader._preBind();\r\n\r\n        if (this._source.edgesColor.a !== 1) {\r\n            engine.setAlphaMode(Constants.ALPHA_COMBINE);\r\n        } else {\r\n            engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n        }\r\n\r\n        // VBOs\r\n        engine.bindBuffers(useBuffersWithInstances ? this._buffersForInstances : this._buffers, this._ib, this._lineShader.getEffect());\r\n\r\n        scene.resetCachedMaterial();\r\n        this._lineShader.setColor4(\"color\", this._source.edgesColor);\r\n\r\n        if (scene.activeCamera.mode === Camera.ORTHOGRAPHIC_CAMERA) {\r\n            this._lineShader.setFloat(\"width\", this._source.edgesWidth / this.edgesWidthScalerForOrthographic);\r\n        } else {\r\n            this._lineShader.setFloat(\"width\", this._source.edgesWidth / this.edgesWidthScalerForPerspective);\r\n        }\r\n\r\n        this._lineShader.setFloat(\"aspectRatio\", engine.getAspectRatio(scene.activeCamera));\r\n        this._lineShader.bind(this._source.getWorldMatrix(), this._source);\r\n\r\n        // Draw order\r\n        engine.drawElementsType(Material.TriangleFillMode, 0, this._indicesCount, instanceCount);\r\n        this._lineShader.unbind();\r\n\r\n        if (useBuffersWithInstances) {\r\n            engine.unbindInstanceAttributes();\r\n        }\r\n\r\n        if (!this._source.getScene()._activeMeshesFrozen) {\r\n            this.customInstances.reset();\r\n        }\r\n\r\n        this._lineShader._setDrawWrapper(currentDrawWrapper);\r\n    }\r\n}\r\n\r\n/**\r\n * LineEdgesRenderer for LineMeshes to remove unnecessary triangulation\r\n */\r\nexport class LineEdgesRenderer extends EdgesRenderer {\r\n    /**\r\n     * This constructor turns off auto generating edges line in Edges Renderer to make it here.\r\n     * @param  source LineMesh used to generate edges\r\n     * @param  epsilon not important (specified angle for edge detection)\r\n     * @param  checkVerticesInsteadOfIndices not important for LineMesh\r\n     */\r\n    constructor(source: AbstractMesh, epsilon = 0.95, checkVerticesInsteadOfIndices = false) {\r\n        super(source, epsilon, checkVerticesInsteadOfIndices, false);\r\n        this._generateEdgesLines();\r\n    }\r\n\r\n    /**\r\n     * Generate edges for each line in LinesMesh. Every Line should be rendered as edge.\r\n     */\r\n    override _generateEdgesLines(): void {\r\n        const positions = this._source.getVerticesData(VertexBuffer.PositionKind);\r\n        const indices = this._source.getIndices();\r\n\r\n        if (!indices || !positions) {\r\n            return;\r\n        }\r\n\r\n        const p0 = TmpVectors.Vector3[0];\r\n        const p1 = TmpVectors.Vector3[1];\r\n        const len = indices.length - 1;\r\n        for (let i = 0, offset = 0; i < len; i += 2, offset += 4) {\r\n            Vector3.FromArrayToRef(positions, 3 * indices[i], p0);\r\n            Vector3.FromArrayToRef(positions, 3 * indices[i + 1], p1);\r\n            this.createLine(p0, p1, offset);\r\n        }\r\n\r\n        // Merge into a single mesh\r\n        const engine = this._source.getScene().getEngine();\r\n\r\n        this._buffers[VertexBuffer.PositionKind] = new VertexBuffer(engine, this._linesPositions, VertexBuffer.PositionKind, false);\r\n        this._buffers[VertexBuffer.NormalKind] = new VertexBuffer(engine, this._linesNormals, VertexBuffer.NormalKind, false, false, 4);\r\n\r\n        this._ib = engine.createIndexBuffer(this._linesIndices);\r\n\r\n        this._indicesCount = this._linesIndices.length;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6132, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/iblCdfGeneratorSceneComponent.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/iblCdfGeneratorSceneComponent.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport { Scene } from \"../scene\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport { IblCdfGenerator } from \"./iblCdfGenerator\";\r\nimport type { BaseTexture } from \"../Materials/Textures/baseTexture\";\r\nimport type { Observer } from \"../Misc/observable\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _iblCdfGenerator: Nullable<IblCdfGenerator>;\r\n\r\n        /**\r\n         * Gets or Sets the current CDF generator associated to the scene.\r\n         * The CDF (cumulative distribution function) generator creates CDF maps\r\n         * for a given IBL texture that can then be used for more efficient\r\n         * importance sampling.\r\n         */\r\n        iblCdfGenerator: Nullable<IblCdfGenerator>;\r\n\r\n        /**\r\n         * Enables a IblCdfGenerator and associates it with the scene.\r\n         * @returns the IblCdfGenerator\r\n         */\r\n        enableIblCdfGenerator(): Nullable<IblCdfGenerator>;\r\n\r\n        /**\r\n         * Disables the GeometryBufferRender associated with the scene\r\n         */\r\n        disableIblCdfGenerator(): void;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"iblCdfGenerator\", {\r\n    get: function (this: Scene) {\r\n        return this._iblCdfGenerator;\r\n    },\r\n    set: function (this: Scene, value: Nullable<IblCdfGenerator>) {\r\n        if (value) {\r\n            this._iblCdfGenerator = value;\r\n        }\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nScene.prototype.enableIblCdfGenerator = function (): Nullable<IblCdfGenerator> {\r\n    if (this._iblCdfGenerator) {\r\n        return this._iblCdfGenerator;\r\n    }\r\n\r\n    this._iblCdfGenerator = new IblCdfGenerator(this);\r\n    if (!this._iblCdfGenerator.isSupported) {\r\n        this._iblCdfGenerator = null;\r\n        return null;\r\n    }\r\n    if (this.environmentTexture) {\r\n        this._iblCdfGenerator.iblSource = this.environmentTexture;\r\n    }\r\n    return this._iblCdfGenerator;\r\n};\r\n\r\nScene.prototype.disableIblCdfGenerator = function (): void {\r\n    if (!this._iblCdfGenerator) {\r\n        return;\r\n    }\r\n\r\n    this._iblCdfGenerator.dispose();\r\n    this._iblCdfGenerator = null;\r\n};\r\n\r\n/**\r\n * Defines the IBL CDF Generator scene component responsible for generating CDF maps for a given IBL.\r\n */\r\nexport class IblCdfGeneratorSceneComponent implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_IBLCDFGENERATOR;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {\r\n        this._updateIblSource();\r\n        this._newIblObserver = this.scene.onEnvironmentTextureChangedObservable.add(this._updateIblSource.bind(this));\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        // Nothing to do for this component\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources\r\n     */\r\n    public dispose(): void {\r\n        this.scene.onEnvironmentTextureChangedObservable.remove(this._newIblObserver);\r\n    }\r\n\r\n    private _updateIblSource(): void {\r\n        if (this.scene.iblCdfGenerator && this.scene.environmentTexture) {\r\n            this.scene.iblCdfGenerator.iblSource = this.scene.environmentTexture;\r\n        }\r\n    }\r\n\r\n    private _newIblObserver: Nullable<Observer<Nullable<BaseTexture>>> = null;\r\n}\r\n\r\nIblCdfGenerator._SceneComponentInitialization = (scene: Scene) => {\r\n    // Register the CDF generator component to the scene.\r\n    let component = scene._getComponent(SceneComponentConstants.NAME_IBLCDFGENERATOR) as IblCdfGeneratorSceneComponent;\r\n    if (!component) {\r\n        component = new IblCdfGeneratorSceneComponent(scene);\r\n        scene._addComponent(component);\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6221, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/IBLShadows/iblShadowsVoxelRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/IBLShadows/iblShadowsVoxelRenderer.ts"],"sourcesContent":["import { Constants } from \"../../Engines/constants\";\r\nimport { Engine } from \"../../Engines/engine\";\r\nimport { ShaderMaterial } from \"../../Materials/shaderMaterial\";\r\nimport { MultiRenderTarget } from \"../../Materials/Textures/multiRenderTarget\";\r\nimport { RenderTargetTexture } from \"../../Materials/Textures/renderTargetTexture\";\r\nimport type { RenderTargetTextureOptions } from \"../../Materials/Textures/renderTargetTexture\";\r\nimport type { TextureSize } from \"../../Materials/Textures/textureCreationOptions\";\r\nimport { Color4 } from \"../../Maths/math.color\";\r\nimport { Matrix, Vector3, Vector4 } from \"../../Maths/math.vector\";\r\nimport type { Mesh } from \"../../Meshes/mesh\";\r\nimport type { Scene } from \"../../scene\";\r\nimport { Texture } from \"../../Materials/Textures/texture\";\r\nimport { Logger } from \"../../Misc/logger\";\r\nimport { Observable } from \"../../Misc/observable\";\r\nimport { PostProcess } from \"../../PostProcesses/postProcess\";\r\nimport type { PostProcessOptions } from \"../../PostProcesses/postProcess\";\r\nimport { ProceduralTexture } from \"../../Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IProceduralTextureCreationOptions } from \"../../Materials/Textures/Procedurals/proceduralTexture\";\r\nimport { EffectRenderer, EffectWrapper } from \"../../Materials/effectRenderer\";\r\nimport type { IblShadowsRenderPipeline } from \"./iblShadowsRenderPipeline\";\r\nimport type { RenderTargetWrapper } from \"core/Engines\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Voxel-based shadow rendering for IBL's.\r\n * This should not be instanciated directly, as it is part of a scene component\r\n * @internal\r\n * @see https://playground.babylonjs.com/#8R5SSE#222\r\n */\r\nexport class _IblShadowsVoxelRenderer {\r\n    private _scene: Scene;\r\n    private _engine: Engine;\r\n\r\n    // WebGPU, single-pass voxelization.\r\n    // See https://playground.babylonjs.com/#XSNYAU#133\r\n    private _voxelGrid: RenderTargetTexture;\r\n    private _voxelGridRT: RenderTargetTexture;\r\n\r\n    // WebGL voxelization, including tri-planar voxelization.\r\n    private _combinedVoxelGridPT: ProceduralTexture;\r\n    private _voxelGridXaxis: RenderTargetTexture;\r\n    private _voxelGridYaxis: RenderTargetTexture;\r\n    private _voxelGridZaxis: RenderTargetTexture;\r\n    private _voxelMrtsXaxis: MultiRenderTarget[] = [];\r\n    private _voxelMrtsYaxis: MultiRenderTarget[] = [];\r\n    private _voxelMrtsZaxis: MultiRenderTarget[] = [];\r\n\r\n    private _voxelMaterial: ShaderMaterial;\r\n    private _voxelSlabDebugMaterial: ShaderMaterial;\r\n    private _voxelClearColor: Color4 = new Color4(0, 0, 0, 1);\r\n\r\n    /**\r\n     * Return the voxel grid texture.\r\n     * @returns The voxel grid texture.\r\n     */\r\n    public getVoxelGrid(): ProceduralTexture | RenderTargetTexture {\r\n        if (this._engine.isWebGPU) {\r\n            return this._voxelGrid;\r\n        } else if (this._triPlanarVoxelization) {\r\n            return this._combinedVoxelGridPT;\r\n        } else {\r\n            return this._voxelGridZaxis;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Observable that triggers when the voxelization is complete\r\n     */\r\n    public onVoxelizationCompleteObservable: Observable<void> = new Observable<void>();\r\n\r\n    /**\r\n     * The debug pass post process\r\n     * @returns The debug pass post process\r\n     */\r\n    public getDebugPassPP(): PostProcess {\r\n        if (!this._voxelDebugPass) {\r\n            this._createDebugPass();\r\n        }\r\n        return this._voxelDebugPass;\r\n    }\r\n\r\n    private _maxDrawBuffers: number;\r\n    private _renderTargets: RenderTargetTexture[] = [];\r\n\r\n    private _triPlanarVoxelization: boolean = true;\r\n\r\n    /**\r\n     * Whether to use tri-planar voxelization. More expensive, but can help with artifacts.\r\n     */\r\n    public get triPlanarVoxelization(): boolean {\r\n        return this._triPlanarVoxelization;\r\n    }\r\n\r\n    /**\r\n     * Whether to use tri-planar voxelization. More expensive, but can help with artifacts.\r\n     */\r\n    public set triPlanarVoxelization(enabled: boolean) {\r\n        if (this._engine.isWebGPU) {\r\n            // WebGPU only supports tri-planar voxelization.\r\n            this._triPlanarVoxelization = true;\r\n            return;\r\n        }\r\n        if (this._triPlanarVoxelization === enabled) {\r\n            return;\r\n        }\r\n        this._triPlanarVoxelization = enabled;\r\n        this._disposeVoxelTextures();\r\n        this._createTextures();\r\n    }\r\n\r\n    private _voxelizationInProgress: boolean = false;\r\n    private _invWorldScaleMatrix: Matrix = Matrix.Identity();\r\n\r\n    /**\r\n     * Set the matrix to use for scaling the world space to voxel space\r\n     * @param matrix The matrix to use for scaling the world space to voxel space\r\n     */\r\n    public setWorldScaleMatrix(matrix: Matrix) {\r\n        this._invWorldScaleMatrix = matrix;\r\n    }\r\n    /**\r\n     * @returns Whether voxelization is currently happening.\r\n     */\r\n    public isVoxelizationInProgress(): boolean {\r\n        return this._voxelizationInProgress;\r\n    }\r\n\r\n    private _voxelResolution: number = 64;\r\n    private _voxelResolutionExp: number = 6;\r\n\r\n    /**\r\n     * Resolution of the voxel grid. The final resolution will be 2^resolutionExp.\r\n     */\r\n    public get voxelResolutionExp(): number {\r\n        return this._voxelResolutionExp;\r\n    }\r\n\r\n    /**\r\n     * Resolution of the voxel grid. The final resolution will be 2^resolutionExp.\r\n     */\r\n    public set voxelResolutionExp(resolutionExp: number) {\r\n        if (this._voxelResolutionExp === resolutionExp && this._voxelGridZaxis) {\r\n            return;\r\n        }\r\n        this._voxelResolutionExp = Math.round(Math.min(Math.max(resolutionExp, 3), 9));\r\n        this._voxelResolution = Math.pow(2.0, this._voxelResolutionExp);\r\n        this._disposeVoxelTextures();\r\n        this._createTextures();\r\n    }\r\n\r\n    private _copyMipEffectRenderer: EffectRenderer;\r\n    private _copyMipEffectWrapper: EffectWrapper;\r\n    private _mipArray: ProceduralTexture[] = [];\r\n\r\n    private _voxelSlabDebugRT: RenderTargetTexture;\r\n    private _voxelDebugPass: PostProcess;\r\n    private _voxelDebugEnabled: boolean = false;\r\n\r\n    /**\r\n     * Shows only the voxels that were rendered along a particular axis (while using triPlanarVoxelization).\r\n     * If not set, the combined voxel grid will be shown.\r\n     * Note: This only works when the debugMipNumber is set to 0 because we don't generate mips for each axis.\r\n     * @param axis The axis to show (0 = x, 1 = y, 2 = z)\r\n     */\r\n    public set voxelDebugAxis(axis: number) {\r\n        this._voxelDebugAxis = axis;\r\n    }\r\n\r\n    public get voxelDebugAxis(): number {\r\n        return this._voxelDebugAxis;\r\n    }\r\n    private _voxelDebugAxis: number = -1;\r\n    private _debugSizeParams: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n    private _includedMeshes: Mesh[] = [];\r\n\r\n    /**\r\n     * Sets params that control the position and scaling of the debug display on the screen.\r\n     * @param x Screen X offset of the debug display (0-1)\r\n     * @param y Screen Y offset of the debug display (0-1)\r\n     * @param widthScale X scale of the debug display (0-1)\r\n     * @param heightScale Y scale of the debug display (0-1)\r\n     */\r\n    public setDebugDisplayParams(x: number, y: number, widthScale: number, heightScale: number) {\r\n        this._debugSizeParams.set(x, y, widthScale, heightScale);\r\n    }\r\n    private _debugMipNumber: number = 0;\r\n    /**\r\n     * The mip level to show in the debug display\r\n     * @param mipNum The mip level to show in the debug display\r\n     */\r\n    public setDebugMipNumber(mipNum: number) {\r\n        this._debugMipNumber = mipNum;\r\n    }\r\n    private _debugPassName: string = \"Voxelization Debug Pass\";\r\n    /**\r\n     * Sets the name of the debug pass\r\n     */\r\n    public get debugPassName(): string {\r\n        return this._debugPassName;\r\n    }\r\n\r\n    /**\r\n     * Enable or disable the debug view for this pass\r\n     */\r\n    public get voxelDebugEnabled(): boolean {\r\n        return this._voxelDebugEnabled;\r\n    }\r\n\r\n    public set voxelDebugEnabled(enabled: boolean) {\r\n        if (this._voxelDebugEnabled === enabled) {\r\n            return;\r\n        }\r\n        this._voxelDebugEnabled = enabled;\r\n        if (enabled) {\r\n            this._voxelSlabDebugRT = new RenderTargetTexture(\"voxelSlabDebug\", { width: this._engine.getRenderWidth(), height: this._engine.getRenderHeight() }, this._scene, {\r\n                generateDepthBuffer: true,\r\n                generateMipMaps: false,\r\n                type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                format: Constants.TEXTUREFORMAT_RGBA,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            });\r\n            this._voxelSlabDebugRT.noPrePassRenderer = true;\r\n        }\r\n        if (this._voxelSlabDebugRT) {\r\n            this._removeVoxelRTs([this._voxelSlabDebugRT]);\r\n        }\r\n        // Add the slab debug RT if needed.\r\n        if (this._voxelDebugEnabled) {\r\n            this._addRTsForRender([this._voxelSlabDebugRT], this._includedMeshes, this._voxelDebugAxis, 1, true);\r\n            this._setDebugBindingsBound = this._setDebugBindings.bind(this);\r\n            this._scene.onBeforeRenderObservable.add(this._setDebugBindingsBound);\r\n        } else {\r\n            this._scene.onBeforeRenderObservable.removeCallback(this._setDebugBindingsBound);\r\n        }\r\n    }\r\n\r\n    private _setDebugBindingsBound: () => void;\r\n    /**\r\n     * Creates the debug post process effect for this pass\r\n     */\r\n    private _createDebugPass() {\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        if (!this._voxelDebugPass) {\r\n            const debugOptions: PostProcessOptions = {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n                textureFormat: Constants.TEXTUREFORMAT_RGBA,\r\n                textureType: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                uniforms: [\"sizeParams\", \"mipNumber\"],\r\n                samplers: [\"voxelTexture\", \"voxelSlabTexture\"],\r\n                engine: this._engine,\r\n                reusable: false,\r\n                shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n                extraInitializations: (useWebGPU: boolean, list: Promise<any>[]) => {\r\n                    if (useWebGPU) {\r\n                        list.push(import(\"../../ShadersWGSL/iblVoxelGrid3dDebug.fragment\"));\r\n                    } else {\r\n                        list.push(import(\"../../Shaders/iblVoxelGrid3dDebug.fragment\"));\r\n                    }\r\n                },\r\n            };\r\n            this._voxelDebugPass = new PostProcess(this.debugPassName, \"iblVoxelGrid3dDebug\", debugOptions);\r\n            this._voxelDebugPass.onApplyObservable.add((effect) => {\r\n                if (this._voxelDebugAxis === 0) {\r\n                    effect.setTexture(\"voxelTexture\", this._voxelGridXaxis);\r\n                } else if (this._voxelDebugAxis === 1) {\r\n                    effect.setTexture(\"voxelTexture\", this._voxelGridYaxis);\r\n                } else if (this._voxelDebugAxis === 2) {\r\n                    effect.setTexture(\"voxelTexture\", this._voxelGridZaxis);\r\n                } else {\r\n                    effect.setTexture(\"voxelTexture\", this.getVoxelGrid());\r\n                }\r\n                effect.setTexture(\"voxelSlabTexture\", this._voxelSlabDebugRT);\r\n                effect.setVector4(\"sizeParams\", this._debugSizeParams);\r\n                effect.setFloat(\"mipNumber\", this._debugMipNumber);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instanciates the voxel renderer\r\n     * @param scene Scene to attach to\r\n     * @param iblShadowsRenderPipeline The render pipeline this pass is associated with\r\n     * @param resolutionExp Resolution of the voxel grid. The final resolution will be 2^resolutionExp.\r\n     * @param triPlanarVoxelization Whether to use tri-planar voxelization. Only applies to WebGL. Voxelization will take longer but will reduce missing geometry.\r\n     * @returns The voxel renderer\r\n     */\r\n    constructor(scene: Scene, iblShadowsRenderPipeline: IblShadowsRenderPipeline, resolutionExp: number = 6, triPlanarVoxelization: boolean = true) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine() as Engine;\r\n        this._triPlanarVoxelization = this._engine.isWebGPU || triPlanarVoxelization;\r\n        if (!this._engine.getCaps().drawBuffersExtension) {\r\n            Logger.Error(\"Can't do voxel rendering without the draw buffers extension.\");\r\n        }\r\n\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        this._maxDrawBuffers = this._engine.getCaps().maxDrawBuffers || 0;\r\n\r\n        this._copyMipEffectRenderer = new EffectRenderer(this._engine);\r\n        this._copyMipEffectWrapper = new EffectWrapper({\r\n            engine: this._engine,\r\n            fragmentShader: \"copyTexture3DLayerToTexture\",\r\n            useShaderStore: true,\r\n            uniformNames: [\"layerNum\"],\r\n            samplerNames: [\"textureSampler\"],\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await import(\"../../ShadersWGSL/copyTexture3DLayerToTexture.fragment\");\r\n                } else {\r\n                    await import(\"../../Shaders/copyTexture3DLayerToTexture.fragment\");\r\n                }\r\n            },\r\n        });\r\n\r\n        this.voxelResolutionExp = resolutionExp;\r\n    }\r\n\r\n    private _generateMipMaps() {\r\n        const iterations = Math.ceil(Math.log2(this._voxelResolution));\r\n        for (let i = 1; i < iterations + 1; i++) {\r\n            this._generateMipMap(i);\r\n        }\r\n    }\r\n\r\n    private _generateMipMap(lodLevel: number) {\r\n        // Generate a mip map for the given level by triggering the render of the procedural mip texture.\r\n        const mipTarget = this._mipArray[lodLevel - 1];\r\n        if (!mipTarget) {\r\n            return;\r\n        }\r\n        mipTarget.setTexture(\"srcMip\", lodLevel === 1 ? this.getVoxelGrid() : this._mipArray[lodLevel - 2]);\r\n        mipTarget.render();\r\n    }\r\n\r\n    private _copyMipMaps() {\r\n        const iterations = Math.ceil(Math.log2(this._voxelResolution));\r\n        for (let i = 1; i < iterations + 1; i++) {\r\n            this._copyMipMap(i);\r\n        }\r\n    }\r\n\r\n    private _copyMipMap(lodLevel: number) {\r\n        // Now, copy this mip into the mip chain of the voxel grid.\r\n        // TODO - this currently isn't working. \"textureSampler\" isn't being properly set to mipTarget.\r\n        const mipTarget = this._mipArray[lodLevel - 1];\r\n        if (!mipTarget) {\r\n            return;\r\n        }\r\n        const voxelGrid = this.getVoxelGrid();\r\n        let rt: RenderTargetWrapper;\r\n        if (voxelGrid instanceof RenderTargetTexture && voxelGrid.renderTarget) {\r\n            rt = voxelGrid.renderTarget;\r\n        } else {\r\n            rt = (voxelGrid as any)._rtWrapper;\r\n        }\r\n        if (rt) {\r\n            this._copyMipEffectRenderer.saveStates();\r\n            const bindSize = mipTarget.getSize().width;\r\n\r\n            // Render to each layer of the voxel grid.\r\n            for (let layer = 0; layer < bindSize; layer++) {\r\n                this._engine.bindFramebuffer(rt, 0, bindSize, bindSize, true, lodLevel, layer);\r\n                this._copyMipEffectRenderer.applyEffectWrapper(this._copyMipEffectWrapper);\r\n                this._copyMipEffectWrapper.effect.setTexture(\"textureSampler\", mipTarget);\r\n                this._copyMipEffectWrapper.effect.setInt(\"layerNum\", layer);\r\n                this._copyMipEffectRenderer.draw();\r\n                this._engine.unBindFramebuffer(rt, true);\r\n            }\r\n            this._copyMipEffectRenderer.restoreStates();\r\n        }\r\n    }\r\n\r\n    private _computeNumberOfSlabs(): number {\r\n        return Math.ceil(this._voxelResolution / this._maxDrawBuffers);\r\n    }\r\n\r\n    private _createTextures() {\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        const size: TextureSize = {\r\n            width: this._voxelResolution,\r\n            height: this._voxelResolution,\r\n            depth: this._voxelResolution,\r\n        };\r\n        const voxelAxisOptions: RenderTargetTextureOptions = {\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n        };\r\n\r\n        // We can render up to maxDrawBuffers voxel slices of the grid per render.\r\n        // We call this a slab.\r\n        const numSlabs = this._computeNumberOfSlabs();\r\n        const voxelCombinedOptions: IProceduralTextureCreationOptions = {\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: true,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_R,\r\n            samplingMode: Constants.TEXTURE_NEAREST_NEAREST_MIPNEAREST,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await import(\"../../ShadersWGSL/iblCombineVoxelGrids.fragment\");\r\n                } else {\r\n                    await import(\"../../Shaders/iblCombineVoxelGrids.fragment\");\r\n                }\r\n            },\r\n        };\r\n        if (this._engine.isWebGPU) {\r\n            this._voxelGrid = new RenderTargetTexture(\"voxelGrid\", size, this._scene, {\r\n                ...voxelCombinedOptions,\r\n                format: Constants.TEXTUREFORMAT_RGBA,\r\n                creationFlags: Constants.TEXTURE_CREATIONFLAG_STORAGE,\r\n            });\r\n            this._voxelGridRT = new RenderTargetTexture(\r\n                \"voxelGridRT\",\r\n                { width: Math.min(size.width * 2.0, 2048), height: Math.min(size.height * 2.0, 2048) },\r\n                this._scene,\r\n                voxelAxisOptions\r\n            );\r\n        } else if (this._triPlanarVoxelization) {\r\n            this._voxelGridXaxis = new RenderTargetTexture(\"voxelGridXaxis\", size, this._scene, voxelAxisOptions);\r\n            this._voxelGridYaxis = new RenderTargetTexture(\"voxelGridYaxis\", size, this._scene, voxelAxisOptions);\r\n            this._voxelGridZaxis = new RenderTargetTexture(\"voxelGridZaxis\", size, this._scene, voxelAxisOptions);\r\n            this._voxelMrtsXaxis = this._createVoxelMRTs(\"x_axis_\", this._voxelGridXaxis, numSlabs);\r\n            this._voxelMrtsYaxis = this._createVoxelMRTs(\"y_axis_\", this._voxelGridYaxis, numSlabs);\r\n            this._voxelMrtsZaxis = this._createVoxelMRTs(\"z_axis_\", this._voxelGridZaxis, numSlabs);\r\n\r\n            this._combinedVoxelGridPT = new ProceduralTexture(\"combinedVoxelGrid\", size, \"iblCombineVoxelGrids\", this._scene, voxelCombinedOptions, false);\r\n            this._scene.proceduralTextures.splice(this._scene.proceduralTextures.indexOf(this._combinedVoxelGridPT), 1);\r\n            this._combinedVoxelGridPT.setFloat(\"layer\", 0.0);\r\n            this._combinedVoxelGridPT.setTexture(\"voxelXaxisSampler\", this._voxelGridXaxis);\r\n            this._combinedVoxelGridPT.setTexture(\"voxelYaxisSampler\", this._voxelGridYaxis);\r\n            this._combinedVoxelGridPT.setTexture(\"voxelZaxisSampler\", this._voxelGridZaxis);\r\n            // We will render this only after voxelization is completed for the 3 axes.\r\n            this._combinedVoxelGridPT.autoClear = false;\r\n            this._combinedVoxelGridPT.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n            this._combinedVoxelGridPT.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n        } else {\r\n            this._voxelGridZaxis = new RenderTargetTexture(\"voxelGridZaxis\", size, this._scene, voxelCombinedOptions);\r\n            this._voxelMrtsZaxis = this._createVoxelMRTs(\"z_axis_\", this._voxelGridZaxis, numSlabs);\r\n        }\r\n\r\n        const generateVoxelMipOptions: IProceduralTextureCreationOptions = {\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_R,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await import(\"../../ShadersWGSL/iblGenerateVoxelMip.fragment\");\r\n                } else {\r\n                    await import(\"../../Shaders/iblGenerateVoxelMip.fragment\");\r\n                }\r\n            },\r\n        };\r\n        this._mipArray = new Array(Math.ceil(Math.log2(this._voxelResolution)));\r\n        for (let mipIdx = 1; mipIdx <= this._mipArray.length; mipIdx++) {\r\n            const mipDim = this._voxelResolution >> mipIdx;\r\n            const mipSize: TextureSize = { width: mipDim, height: mipDim, depth: mipDim };\r\n            this._mipArray[mipIdx - 1] = new ProceduralTexture(\"voxelMip\" + mipIdx, mipSize, \"iblGenerateVoxelMip\", this._scene, generateVoxelMipOptions, false);\r\n            this._scene.proceduralTextures.splice(this._scene.proceduralTextures.indexOf(this._mipArray[mipIdx - 1]), 1);\r\n\r\n            const mipTarget = this._mipArray[mipIdx - 1];\r\n            mipTarget.autoClear = false;\r\n            mipTarget.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n            mipTarget.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n            mipTarget.setTexture(\"srcMip\", mipIdx > 1 ? this._mipArray[mipIdx - 2] : this.getVoxelGrid());\r\n            mipTarget.setInt(\"layerNum\", 0);\r\n        }\r\n\r\n        this._createVoxelMaterials();\r\n    }\r\n\r\n    private _createVoxelMRTs(name: string, voxelRT: RenderTargetTexture, numSlabs: number): MultiRenderTarget[] {\r\n        voxelRT.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n        voxelRT.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n        voxelRT.noPrePassRenderer = true;\r\n        const mrtArray: MultiRenderTarget[] = [];\r\n        const targetTypes = new Array(this._maxDrawBuffers).fill(Constants.TEXTURE_3D);\r\n\r\n        for (let mrtIndex = 0; mrtIndex < numSlabs; mrtIndex++) {\r\n            let layerIndices = new Array(this._maxDrawBuffers).fill(0);\r\n            layerIndices = layerIndices.map((value, index) => mrtIndex * this._maxDrawBuffers + index);\r\n\r\n            let textureNames = new Array(this._maxDrawBuffers).fill(\"\");\r\n            textureNames = textureNames.map((value, index) => \"voxel_grid_\" + name + (mrtIndex * this._maxDrawBuffers + index));\r\n\r\n            const mrt = new MultiRenderTarget(\r\n                \"mrt_\" + name + mrtIndex,\r\n                { width: this._voxelResolution, height: this._voxelResolution, depth: this._voxelResolution },\r\n                this._maxDrawBuffers, // number of draw buffers\r\n                this._scene,\r\n                {\r\n                    types: new Array(this._maxDrawBuffers).fill(Constants.TEXTURETYPE_UNSIGNED_BYTE),\r\n                    samplingModes: new Array(this._maxDrawBuffers).fill(Constants.TEXTURE_TRILINEAR_SAMPLINGMODE),\r\n                    generateMipMaps: false,\r\n                    targetTypes,\r\n                    formats: new Array(this._maxDrawBuffers).fill(Constants.TEXTUREFORMAT_R),\r\n                    faceIndex: new Array(this._maxDrawBuffers).fill(0),\r\n                    layerIndex: layerIndices,\r\n                    layerCounts: new Array(this._maxDrawBuffers).fill(this._voxelResolution),\r\n                    generateDepthBuffer: false,\r\n                    generateStencilBuffer: false,\r\n                },\r\n                textureNames\r\n            );\r\n\r\n            mrt.clearColor = new Color4(0, 0, 0, 1);\r\n            mrt.noPrePassRenderer = true;\r\n            for (let i = 0; i < this._maxDrawBuffers; i++) {\r\n                mrt.setInternalTexture(voxelRT.getInternalTexture()!, i);\r\n            }\r\n\r\n            mrtArray.push(mrt);\r\n        }\r\n        return mrtArray;\r\n    }\r\n\r\n    private _disposeVoxelTextures() {\r\n        this._stopVoxelization();\r\n        for (let i = 0; i < this._voxelMrtsZaxis.length; i++) {\r\n            if (this._triPlanarVoxelization) {\r\n                this._voxelMrtsXaxis[i].dispose(true);\r\n                this._voxelMrtsYaxis[i].dispose(true);\r\n            }\r\n            this._voxelMrtsZaxis[i].dispose(true);\r\n        }\r\n        if (this._triPlanarVoxelization) {\r\n            this._voxelGridXaxis?.dispose();\r\n            this._voxelGridYaxis?.dispose();\r\n            this._combinedVoxelGridPT?.dispose();\r\n        }\r\n        this._voxelGridZaxis?.dispose();\r\n        for (const mip of this._mipArray) {\r\n            mip.dispose();\r\n        }\r\n        this._voxelMaterial?.dispose();\r\n        this._voxelSlabDebugMaterial?.dispose();\r\n        this._mipArray = [];\r\n        this._voxelMrtsXaxis = [];\r\n        this._voxelMrtsYaxis = [];\r\n        this._voxelMrtsZaxis = [];\r\n    }\r\n\r\n    private _createVoxelMaterials(): void {\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        this._voxelMaterial = new ShaderMaterial(\"voxelization\", this._scene, \"iblVoxelGrid\", {\r\n            uniforms: [\"world\", \"viewMatrix\", \"invTransWorld\", \"invWorldScale\", \"nearPlane\", \"farPlane\", \"stepSize\"],\r\n            defines: [\"MAX_DRAW_BUFFERS \" + this._maxDrawBuffers],\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/iblVoxelGrid.fragment\"), import(\"../../ShadersWGSL/iblVoxelGrid.vertex\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/iblVoxelGrid.fragment\"), import(\"../../Shaders/iblVoxelGrid.vertex\")]);\r\n                }\r\n            },\r\n        });\r\n        this._voxelMaterial.cullBackFaces = false;\r\n        this._voxelMaterial.backFaceCulling = false;\r\n        this._voxelMaterial.depthFunction = Engine.ALWAYS;\r\n\r\n        this._voxelSlabDebugMaterial = new ShaderMaterial(\"voxelSlabDebug\", this._scene, \"iblVoxelSlabDebug\", {\r\n            uniforms: [\"world\", \"viewMatrix\", \"cameraViewMatrix\", \"projection\", \"invWorldScale\", \"nearPlane\", \"farPlane\", \"stepSize\"],\r\n            defines: [\"MAX_DRAW_BUFFERS \" + this._maxDrawBuffers],\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/iblVoxelSlabDebug.fragment\"), import(\"../../ShadersWGSL/iblVoxelSlabDebug.vertex\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/iblVoxelSlabDebug.fragment\"), import(\"../../Shaders/iblVoxelSlabDebug.vertex\")]);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    private _setDebugBindings() {\r\n        this._voxelSlabDebugMaterial.setMatrix(\"projection\", this._scene.activeCamera!.getProjectionMatrix());\r\n        this._voxelSlabDebugMaterial.setMatrix(\"cameraViewMatrix\", this._scene.activeCamera!.getViewMatrix());\r\n    }\r\n\r\n    /**\r\n     * Checks if the voxel renderer is ready to voxelize scene\r\n     * @returns true if the voxel renderer is ready to voxelize scene\r\n     */\r\n    public isReady() {\r\n        let allReady = this.getVoxelGrid().isReady();\r\n        for (let i = 0; i < this._mipArray.length; i++) {\r\n            const mipReady = this._mipArray[i].isReady();\r\n            allReady &&= mipReady;\r\n        }\r\n\r\n        if (!allReady || this._voxelizationInProgress) {\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * If the MRT's are already in the list of render targets, this will\r\n     * remove them so that they don't get rendered again.\r\n     */\r\n    private _stopVoxelization() {\r\n        // If the MRT's are already in the list of render targets, remove them.\r\n        this._removeVoxelRTs(this._voxelMrtsXaxis);\r\n        this._removeVoxelRTs(this._voxelMrtsYaxis);\r\n        this._removeVoxelRTs(this._voxelMrtsZaxis);\r\n        this._removeVoxelRTs([this._voxelGridRT]);\r\n    }\r\n\r\n    private _removeVoxelRTs(rts: RenderTargetTexture[]) {\r\n        // const currentRTs = this._scene.customRenderTargets;\r\n        const rtIdx = this._renderTargets.findIndex((rt) => {\r\n            if (rt === rts[0]) {\r\n                return true;\r\n            }\r\n            return false;\r\n        });\r\n        if (rtIdx >= 0) {\r\n            this._renderTargets.splice(rtIdx, rts.length);\r\n        } else {\r\n            const rtIdx = this._scene.customRenderTargets.findIndex((rt) => {\r\n                if (rt === rts[0]) {\r\n                    return true;\r\n                }\r\n                return false;\r\n            });\r\n            if (rtIdx >= 0) {\r\n                this._scene.customRenderTargets.splice(rtIdx, rts.length);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders voxel grid of scene for IBL shadows\r\n     * @param includedMeshes\r\n     */\r\n    public updateVoxelGrid(includedMeshes: Mesh[]) {\r\n        this._stopVoxelization();\r\n        this._includedMeshes = includedMeshes;\r\n        this._voxelizationInProgress = true;\r\n\r\n        if (this._engine.isWebGPU) {\r\n            this._voxelGridRT.renderList = includedMeshes;\r\n            this._addRTsForRender([this._voxelGridRT], includedMeshes, 0);\r\n        } else if (this._triPlanarVoxelization) {\r\n            this._addRTsForRender(this._voxelMrtsXaxis, includedMeshes, 0);\r\n            this._addRTsForRender(this._voxelMrtsYaxis, includedMeshes, 1);\r\n            this._addRTsForRender(this._voxelMrtsZaxis, includedMeshes, 2);\r\n        } else {\r\n            this._addRTsForRender(this._voxelMrtsZaxis, includedMeshes, 2);\r\n        }\r\n        if (this._voxelDebugEnabled) {\r\n            this._addRTsForRender([this._voxelSlabDebugRT], includedMeshes, this._voxelDebugAxis, 1, true);\r\n        }\r\n        this._renderVoxelGridBound = this._renderVoxelGrid.bind(this);\r\n        this._scene.onAfterRenderObservable.add(this._renderVoxelGridBound);\r\n    }\r\n\r\n    private _renderVoxelGridBound: () => void;\r\n\r\n    private _renderVoxelGrid() {\r\n        if (this._voxelizationInProgress) {\r\n            let allReady = this.getVoxelGrid().isReady();\r\n            for (let i = 0; i < this._mipArray.length; i++) {\r\n                const mipReady = this._mipArray[i].isReady();\r\n                allReady &&= mipReady;\r\n            }\r\n            for (let i = 0; i < this._renderTargets.length; i++) {\r\n                const rttReady = this._renderTargets[i].isReadyForRendering();\r\n                allReady &&= rttReady;\r\n            }\r\n            if (allReady) {\r\n                if (this._engine.isWebGPU) {\r\n                    // Clear the voxel grid storage texture.\r\n                    // Need to clear each layer individually.\r\n                    // Would a compute shader be faster here to clear all layers in one go?\r\n                    if (this._voxelGrid && this._voxelGrid.renderTarget) {\r\n                        for (let layer = 0; layer < this._voxelResolution; layer++) {\r\n                            this._engine.bindFramebuffer(this._voxelGrid.renderTarget, 0, undefined, undefined, true, 0, layer);\r\n                            this._engine.clear(this._voxelClearColor, true, false, false);\r\n                            this._engine.unBindFramebuffer(this._voxelGrid.renderTarget, true);\r\n                        }\r\n                    }\r\n                }\r\n                for (const rt of this._renderTargets) {\r\n                    rt.render();\r\n                }\r\n                this._stopVoxelization();\r\n\r\n                if (this._triPlanarVoxelization && !this._engine.isWebGPU) {\r\n                    this._combinedVoxelGridPT.render();\r\n                }\r\n                this._generateMipMaps();\r\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises, github/no-then\r\n                this._copyMipEffectWrapper.effect.whenCompiledAsync().then(() => {\r\n                    this._copyMipMaps();\r\n                    this._scene.onAfterRenderObservable.removeCallback(this._renderVoxelGridBound);\r\n                    this._voxelizationInProgress = false;\r\n                    this.onVoxelizationCompleteObservable.notifyObservers();\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    private _addRTsForRender(mrts: RenderTargetTexture[], includedMeshes: Mesh[], axis: number, shaderType: number = 0, continuousRender: boolean = false) {\r\n        const slabSize = 1.0 / this._computeNumberOfSlabs();\r\n        let voxelMaterial: ShaderMaterial;\r\n        if (shaderType === 0) {\r\n            voxelMaterial = this._voxelMaterial;\r\n        } else {\r\n            voxelMaterial = this._voxelSlabDebugMaterial;\r\n        }\r\n\r\n        // We need to update the world scale uniform for every mesh being rendered to the voxel grid.\r\n        for (let mrtIndex = 0; mrtIndex < mrts.length; mrtIndex++) {\r\n            const mrt = mrts[mrtIndex];\r\n            mrt.renderList = [];\r\n            const nearPlane = mrtIndex * slabSize;\r\n            const farPlane = (mrtIndex + 1) * slabSize;\r\n            const stepSize = slabSize / this._maxDrawBuffers;\r\n\r\n            const cameraPosition = new Vector3(0, 0, 0);\r\n            let targetPosition = new Vector3(0, 0, 1);\r\n            if (axis === 0) {\r\n                targetPosition = new Vector3(1, 0, 0);\r\n            } else if (axis === 1) {\r\n                targetPosition = new Vector3(0, 1, 0);\r\n            }\r\n            let upDirection = new Vector3(0, 1, 0);\r\n            if (axis === 1) {\r\n                upDirection = new Vector3(1, 0, 0);\r\n            }\r\n            mrt.onBeforeRenderObservable.add(() => {\r\n                voxelMaterial.setMatrix(\"viewMatrix\", Matrix.LookAtLH(cameraPosition, targetPosition, upDirection));\r\n                voxelMaterial.setMatrix(\"invWorldScale\", this._invWorldScaleMatrix);\r\n                voxelMaterial.setFloat(\"nearPlane\", nearPlane);\r\n                voxelMaterial.setFloat(\"farPlane\", farPlane);\r\n                voxelMaterial.setFloat(\"stepSize\", stepSize);\r\n                if (this._engine.isWebGPU) {\r\n                    this._voxelMaterial.useVertexPulling = true;\r\n                    this._voxelMaterial.setTexture(\"voxel_storage\", this.getVoxelGrid());\r\n                }\r\n            });\r\n\r\n            // Set this material on every mesh in the scene (for this RT)\r\n            if (includedMeshes.length === 0) {\r\n                return;\r\n            }\r\n            for (const mesh of includedMeshes) {\r\n                if (mesh) {\r\n                    if (mesh.subMeshes && mesh.subMeshes.length > 0) {\r\n                        mrt.renderList?.push(mesh);\r\n                        mrt.setMaterialForRendering(mesh, voxelMaterial);\r\n                    }\r\n                    const meshes = mesh.getChildMeshes();\r\n                    for (const childMesh of meshes) {\r\n                        if (childMesh.subMeshes && childMesh.subMeshes.length > 0) {\r\n                            mrt.renderList?.push(childMesh);\r\n                            mrt.setMaterialForRendering(childMesh, voxelMaterial);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Add the MRT's to render.\r\n        if (continuousRender) {\r\n            for (const mrt of mrts) {\r\n                if (this._scene.customRenderTargets.indexOf(mrt) === -1) {\r\n                    this._scene.customRenderTargets.push(mrt);\r\n                }\r\n            }\r\n        } else {\r\n            this._renderTargets = this._renderTargets.concat(mrts);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Called by the pipeline to resize resources.\r\n     */\r\n    public resize() {\r\n        this._voxelSlabDebugRT?.resize({ width: this._scene.getEngine().getRenderWidth(), height: this._scene.getEngine().getRenderHeight() });\r\n    }\r\n\r\n    /**\r\n     * Disposes the voxel renderer and associated resources\r\n     */\r\n    public dispose() {\r\n        this._disposeVoxelTextures();\r\n        if (this._voxelSlabDebugRT) {\r\n            this._removeVoxelRTs([this._voxelSlabDebugRT]);\r\n            this._voxelSlabDebugRT.dispose();\r\n        }\r\n        if (this._voxelDebugPass) {\r\n            this._voxelDebugPass.dispose();\r\n        }\r\n        // TODO - dispose all created voxel materials.\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 6984, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/IBLShadows/iblShadowsVoxelTracingPass.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/IBLShadows/iblShadowsVoxelTracingPass.ts"],"sourcesContent":["import { Constants } from \"../../Engines/constants\";\r\nimport type { AbstractEngine } from \"../../Engines/abstractEngine\";\r\nimport type { Scene } from \"../../scene\";\r\nimport { Matrix, Vector4 } from \"../../Maths/math.vector\";\r\nimport { PostProcess } from \"../../PostProcesses/postProcess\";\r\nimport type { PostProcessOptions } from \"../../PostProcesses/postProcess\";\r\nimport type { IblShadowsRenderPipeline } from \"./iblShadowsRenderPipeline\";\r\nimport type { Camera } from \"../../Cameras/camera\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { GeometryBufferRenderer } from \"../../Rendering/geometryBufferRenderer\";\r\nimport { ProceduralTexture } from \"core/Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IProceduralTextureCreationOptions } from \"core/Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { CubeTexture } from \"../../Materials/Textures/cubeTexture\";\r\nimport { Logger } from \"../../Misc/logger\";\r\nimport type { EventState } from \"../../Misc/observable\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/**\r\n * Build cdf maps for IBL importance sampling during IBL shadow computation.\r\n * This should not be instantiated directly, as it is part of a scene component\r\n * @internal\r\n */\r\nexport class _IblShadowsVoxelTracingPass {\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n    private _renderPipeline: IblShadowsRenderPipeline;\r\n    private _voxelShadowOpacity: number = 1.0;\r\n    /**\r\n     * The opacity of the shadow cast from the voxel grid\r\n     */\r\n    public get voxelShadowOpacity(): number {\r\n        return this._voxelShadowOpacity;\r\n    }\r\n    /**\r\n     * The opacity of the shadow cast from the voxel grid\r\n     */\r\n    public set voxelShadowOpacity(value: number) {\r\n        this._voxelShadowOpacity = value;\r\n    }\r\n    private _sssSamples: number = 16;\r\n    private _sssStride: number = 8;\r\n    private _sssMaxDist: number = 0.05;\r\n    private _sssThickness: number = 0.5;\r\n\r\n    private _ssShadowOpacity: number = 1.0;\r\n    /**\r\n     * The opacity of the screen-space shadow\r\n     */\r\n    public get ssShadowOpacity(): number {\r\n        return this._ssShadowOpacity;\r\n    }\r\n    /**\r\n     * The opacity of the screen-space shadow\r\n     */\r\n    public set ssShadowOpacity(value: number) {\r\n        this._ssShadowOpacity = value;\r\n    }\r\n\r\n    /**\r\n     * The number of samples used in the screen space shadow pass.\r\n     */\r\n    public get sssSamples(): number {\r\n        return this._sssSamples;\r\n    }\r\n\r\n    /**\r\n     * The number of samples used in the screen space shadow pass.\r\n     */\r\n    public set sssSamples(value: number) {\r\n        this._sssSamples = value;\r\n    }\r\n\r\n    /**\r\n     * The stride used in the screen space shadow pass. This controls the distance between samples.\r\n     */\r\n    public get sssStride(): number {\r\n        return this._sssStride;\r\n    }\r\n\r\n    /**\r\n     * The stride used in the screen space shadow pass. This controls the distance between samples.\r\n     */\r\n    public set sssStride(value: number) {\r\n        this._sssStride = value;\r\n    }\r\n\r\n    /**\r\n     * The maximum distance that the screen-space shadow will be able to occlude.\r\n     */\r\n    public get sssMaxDist(): number {\r\n        return this._sssMaxDist;\r\n    }\r\n\r\n    /**\r\n     * The maximum distance that the screen-space shadow will be able to occlude.\r\n     */\r\n    public set sssMaxDist(value: number) {\r\n        this._sssMaxDist = value;\r\n    }\r\n\r\n    /**\r\n     * The thickness of the screen-space shadow\r\n     */\r\n    public get sssThickness(): number {\r\n        return this._sssThickness;\r\n    }\r\n\r\n    /**\r\n     * The thickness of the screen-space shadow\r\n     */\r\n    public set sssThickness(value: number) {\r\n        this._sssThickness = value;\r\n    }\r\n\r\n    private _outputTexture: ProceduralTexture;\r\n    private _cameraInvView: Matrix = Matrix.Identity();\r\n    private _cameraInvProj: Matrix = Matrix.Identity();\r\n    private _invWorldScaleMatrix: Matrix = Matrix.Identity();\r\n    private _frameId: number = 0;\r\n    private _sampleDirections: number = 4;\r\n    private _shadowParameters: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n    private _sssParameters: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n    private _opacityParameters: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n    private _voxelBiasParameters: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n    private _voxelNormalBias: number = 1.4;\r\n    /**\r\n     * The bias to apply to the voxel sampling in the direction of the surface normal of the geometry.\r\n     */\r\n    public get voxelNormalBias(): number {\r\n        return this._voxelNormalBias;\r\n    }\r\n    public set voxelNormalBias(value: number) {\r\n        this._voxelNormalBias = value;\r\n    }\r\n\r\n    private _voxelDirectionBias: number = 1.75;\r\n    /**\r\n     * The bias to apply to the voxel sampling in the direction of the light.\r\n     */\r\n    public get voxelDirectionBias(): number {\r\n        return this._voxelDirectionBias;\r\n    }\r\n    public set voxelDirectionBias(value: number) {\r\n        this._voxelDirectionBias = value;\r\n    }\r\n\r\n    /**\r\n     * Is the effect enabled\r\n     */\r\n    public enabled: boolean = true;\r\n\r\n    /**\r\n     * The number of directions to sample for the voxel tracing.\r\n     */\r\n    public get sampleDirections(): number {\r\n        return this._sampleDirections;\r\n    }\r\n\r\n    /**\r\n     * The number of directions to sample for the voxel tracing.\r\n     */\r\n    public set sampleDirections(value: number) {\r\n        this._sampleDirections = value;\r\n    }\r\n\r\n    /**\r\n     * The current rotation of the environment map, in radians.\r\n     */\r\n    public get envRotation(): number {\r\n        return this._envRotation;\r\n    }\r\n\r\n    /**\r\n     * The current rotation of the environment map, in radians.\r\n     */\r\n    public set envRotation(value: number) {\r\n        this._envRotation = value;\r\n    }\r\n\r\n    /** Enable the debug view for this pass */\r\n    public debugEnabled: boolean = false;\r\n\r\n    /**\r\n     * Returns the output texture of the pass.\r\n     * @returns The output texture.\r\n     */\r\n    public getOutputTexture(): ProceduralTexture {\r\n        return this._outputTexture;\r\n    }\r\n\r\n    /**\r\n     * Gets the debug pass post process. This will create the resources for the pass\r\n     * if they don't already exist.\r\n     * @returns The post process\r\n     */\r\n    public getDebugPassPP(): PostProcess {\r\n        if (!this._debugPassPP) {\r\n            this._createDebugPass();\r\n        }\r\n        return this._debugPassPP;\r\n    }\r\n\r\n    private _debugPassName: string = \"Voxel Tracing Debug Pass\";\r\n\r\n    /**\r\n     * The name of the debug pass\r\n     */\r\n    public get debugPassName(): string {\r\n        return this._debugPassName;\r\n    }\r\n\r\n    /** The default rotation of the environment map will align the shadows with the default lighting orientation */\r\n    private _envRotation: number = 0.0;\r\n\r\n    /**\r\n     * Set the matrix to use for scaling the world space to voxel space\r\n     * @param matrix The matrix to use for scaling the world space to voxel space\r\n     */\r\n    public setWorldScaleMatrix(matrix: Matrix) {\r\n        this._invWorldScaleMatrix = matrix;\r\n    }\r\n\r\n    /**\r\n     * Render the shadows in color rather than black and white.\r\n     * This is slightly more expensive than black and white shadows but can be much\r\n     * more accurate when the strongest lights in the IBL are non-white.\r\n     */\r\n    public set coloredShadows(value: boolean) {\r\n        this._coloredShadows = value;\r\n    }\r\n    public get coloredShadows(): boolean {\r\n        return this._coloredShadows;\r\n    }\r\n    private _coloredShadows: boolean = false;\r\n\r\n    private _debugVoxelMarchEnabled: boolean = false;\r\n    private _debugPassPP: PostProcess;\r\n    private _debugSizeParams: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    /**\r\n     * Sets params that control the position and scaling of the debug display on the screen.\r\n     * @param x Screen X offset of the debug display (0-1)\r\n     * @param y Screen Y offset of the debug display (0-1)\r\n     * @param widthScale X scale of the debug display (0-1)\r\n     * @param heightScale Y scale of the debug display (0-1)\r\n     */\r\n    public setDebugDisplayParams(x: number, y: number, widthScale: number, heightScale: number) {\r\n        this._debugSizeParams.set(x, y, widthScale, heightScale);\r\n    }\r\n\r\n    /**\r\n     * Creates the debug post process effect for this pass\r\n     */\r\n    private _createDebugPass() {\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        if (!this._debugPassPP) {\r\n            const debugOptions: PostProcessOptions = {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n                uniforms: [\"sizeParams\"],\r\n                samplers: [\"debugSampler\"],\r\n                engine: this._engine,\r\n                reusable: true,\r\n                shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n                extraInitializations: (useWebGPU: boolean, list: Promise<any>[]) => {\r\n                    if (useWebGPU) {\r\n                        list.push(import(\"../../ShadersWGSL/iblShadowDebug.fragment\"));\r\n                    } else {\r\n                        list.push(import(\"../../Shaders/iblShadowDebug.fragment\"));\r\n                    }\r\n                },\r\n            };\r\n            this._debugPassPP = new PostProcess(this.debugPassName, \"iblShadowDebug\", debugOptions);\r\n            this._debugPassPP.autoClear = false;\r\n            this._debugPassPP.onApplyObservable.add((effect) => {\r\n                // update the caustic texture with what we just rendered.\r\n                effect.setTexture(\"debugSampler\", this._outputTexture);\r\n                effect.setVector4(\"sizeParams\", this._debugSizeParams);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instantiates the shadow voxel-tracing pass\r\n     * @param scene Scene to attach to\r\n     * @param iblShadowsRenderPipeline The IBL shadows render pipeline\r\n     * @returns The shadow voxel-tracing pass\r\n     */\r\n    constructor(scene: Scene, iblShadowsRenderPipeline: IblShadowsRenderPipeline) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._renderPipeline = iblShadowsRenderPipeline;\r\n        this._createTextures();\r\n    }\r\n\r\n    private _createTextures() {\r\n        const defines = this._createDefines();\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        const textureOptions: IProceduralTextureCreationOptions = {\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            generateDepthBuffer: false,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/iblShadowVoxelTracing.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/iblShadowVoxelTracing.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n        this._outputTexture = new ProceduralTexture(\r\n            \"voxelTracingPass\",\r\n            {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n            },\r\n            \"iblShadowVoxelTracing\",\r\n            this._scene,\r\n            textureOptions\r\n        );\r\n        this._outputTexture.refreshRate = -1;\r\n        this._outputTexture.autoClear = false;\r\n        this._outputTexture.defines = defines;\r\n        // Need to set all the textures first so that the effect gets created with the proper uniforms.\r\n        this._setBindings(this._scene.activeCamera!);\r\n        this._renderWhenGBufferReady = this._render.bind(this);\r\n        // Don't start rendering until the first vozelization is done.\r\n        this._renderPipeline.onVoxelizationCompleteObservable.addOnce(() => {\r\n            this._scene.geometryBufferRenderer!.getGBuffer().onAfterRenderObservable.add(this._renderWhenGBufferReady);\r\n        });\r\n    }\r\n\r\n    private _createDefines(): string {\r\n        let defines = \"\";\r\n        if (this._scene.useRightHandedSystem) {\r\n            defines += \"#define RIGHT_HANDED\\n\";\r\n        }\r\n        if (this._debugVoxelMarchEnabled) {\r\n            defines += \"#define VOXEL_MARCH_DIAGNOSTIC_INFO_OPTION 1u\\n\";\r\n        }\r\n        if (this._coloredShadows) {\r\n            defines += \"#define COLOR_SHADOWS 1u\\n\";\r\n        }\r\n        return defines;\r\n    }\r\n\r\n    private _setBindings(camera: Camera): boolean {\r\n        this._outputTexture.defines = this._createDefines();\r\n        this._outputTexture.setMatrix(\"viewMtx\", camera.getViewMatrix());\r\n        this._outputTexture.setMatrix(\"projMtx\", camera.getProjectionMatrix());\r\n        camera.getProjectionMatrix().invertToRef(this._cameraInvProj);\r\n        camera.getViewMatrix().invertToRef(this._cameraInvView);\r\n        this._outputTexture.setMatrix(\"invProjMtx\", this._cameraInvProj);\r\n        this._outputTexture.setMatrix(\"invViewMtx\", this._cameraInvView);\r\n        this._outputTexture.setMatrix(\"wsNormalizationMtx\", this._invWorldScaleMatrix);\r\n\r\n        this._frameId++;\r\n\r\n        let rotation = 0.0;\r\n        if (this._scene.environmentTexture) {\r\n            rotation = (this._scene.environmentTexture as CubeTexture).rotationY ?? 0;\r\n        }\r\n        rotation = this._scene.useRightHandedSystem ? -(rotation + 0.5 * Math.PI) : rotation - 0.5 * Math.PI;\r\n        rotation = rotation % (2.0 * Math.PI);\r\n        this._shadowParameters.set(this._sampleDirections, this._frameId, 1.0, rotation);\r\n        this._outputTexture.setVector4(\"shadowParameters\", this._shadowParameters);\r\n        const voxelGrid = this._renderPipeline._getVoxelGridTexture();\r\n        const highestMip = Math.floor(Math.log2(voxelGrid.getSize().width));\r\n        this._voxelBiasParameters.set(this._voxelNormalBias, this._voxelDirectionBias, highestMip, 0.0);\r\n        this._outputTexture.setVector4(\"voxelBiasParameters\", this._voxelBiasParameters);\r\n\r\n        // SSS Options.\r\n        this._sssParameters.set(this._sssSamples, this._sssStride, this._sssMaxDist, this._sssThickness);\r\n        this._outputTexture.setVector4(\"sssParameters\", this._sssParameters);\r\n        this._opacityParameters.set(this._voxelShadowOpacity, this._ssShadowOpacity, 0.0, 0.0);\r\n        this._outputTexture.setVector4(\"shadowOpacity\", this._opacityParameters);\r\n        this._outputTexture.setTexture(\"voxelGridSampler\", voxelGrid);\r\n        this._outputTexture.setTexture(\"blueNoiseSampler\", this._renderPipeline._getNoiseTexture());\r\n        const cdfGenerator = this._scene.iblCdfGenerator;\r\n        if (!cdfGenerator) {\r\n            Logger.Warn(\"IBLShadowsVoxelTracingPass: Can't bind for render because iblCdfGenerator is not enabled.\");\r\n            return false;\r\n        }\r\n        this._outputTexture.setTexture(\"icdfSampler\", cdfGenerator.getIcdfTexture());\r\n        if (this._coloredShadows && this._scene.environmentTexture) {\r\n            this._outputTexture.setTexture(\"iblSampler\", this._scene.environmentTexture);\r\n        }\r\n\r\n        const geometryBufferRenderer = this._scene.geometryBufferRenderer;\r\n        if (!geometryBufferRenderer) {\r\n            Logger.Warn(\"IBLShadowsVoxelTracingPass: Can't bind for render because GeometryBufferRenderer is not enabled.\");\r\n            return false;\r\n        }\r\n        const depthIndex = geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE);\r\n        this._outputTexture.setTexture(\"depthSampler\", geometryBufferRenderer.getGBuffer().textures[depthIndex]);\r\n        const wnormalIndex = geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE);\r\n        this._outputTexture.setTexture(\"worldNormalSampler\", geometryBufferRenderer.getGBuffer().textures[wnormalIndex]);\r\n        return true;\r\n    }\r\n\r\n    private _render() {\r\n        if (this.enabled && this._outputTexture.isReady() && this._outputTexture.getEffect()?.isReady()) {\r\n            if (this._setBindings(this._scene.activeCamera!)) {\r\n                this._outputTexture.render();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _renderWhenGBufferReady: Nullable<(eventData: number, eventState: EventState) => void> = null;\r\n\r\n    /**\r\n     * Called by render pipeline when canvas resized.\r\n     * @param scaleFactor The factor by which to scale the canvas size.\r\n     */\r\n    public resize(scaleFactor: number = 1.0) {\r\n        const newSize = {\r\n            width: Math.max(1.0, Math.floor(this._engine.getRenderWidth() * scaleFactor)),\r\n            height: Math.max(1.0, Math.floor(this._engine.getRenderHeight() * scaleFactor)),\r\n        };\r\n        // Don't resize if the size is the same as the current size.\r\n        if (this._outputTexture.getSize().width === newSize.width && this._outputTexture.getSize().height === newSize.height) {\r\n            return;\r\n        }\r\n        this._outputTexture.resize(newSize, false);\r\n    }\r\n\r\n    /**\r\n     * Checks if the pass is ready\r\n     * @returns true if the pass is ready\r\n     */\r\n    public isReady() {\r\n        return (\r\n            this._outputTexture.isReady() &&\r\n            !(this._debugPassPP && !this._debugPassPP.isReady()) &&\r\n            this._scene.iblCdfGenerator &&\r\n            this._scene.iblCdfGenerator.getIcdfTexture().isReady() &&\r\n            this._renderPipeline._getVoxelGridTexture().isReady()\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Disposes the associated resources\r\n     */\r\n    public dispose() {\r\n        if (this._scene.geometryBufferRenderer && this._renderWhenGBufferReady) {\r\n            const gBuffer = this._scene.geometryBufferRenderer.getGBuffer();\r\n            gBuffer.onAfterRenderObservable.removeCallback(this._renderWhenGBufferReady);\r\n        }\r\n        this._outputTexture.dispose();\r\n        if (this._debugPassPP) {\r\n            this._debugPassPP.dispose();\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7355, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/IBLShadows/iblShadowsSpatialBlurPass.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/IBLShadows/iblShadowsSpatialBlurPass.ts"],"sourcesContent":["import { Constants } from \"../../Engines/constants\";\r\nimport type { AbstractEngine } from \"../../Engines/abstractEngine\";\r\nimport type { Scene } from \"../../scene\";\r\nimport { Vector4 } from \"../../Maths/math.vector\";\r\nimport { PostProcess } from \"../../PostProcesses/postProcess\";\r\nimport type { PostProcessOptions } from \"../../PostProcesses/postProcess\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { GeometryBufferRenderer } from \"../../Rendering/geometryBufferRenderer\";\r\nimport { ProceduralTexture } from \"core/Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IProceduralTextureCreationOptions } from \"core/Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IblShadowsRenderPipeline } from \"./iblShadowsRenderPipeline\";\r\nimport type { EventState } from \"../../Misc/observable\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/**\r\n * This should not be instanciated directly, as it is part of a scene component\r\n * @internal\r\n */\r\nexport class _IblShadowsSpatialBlurPass {\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n    private _renderPipeline: IblShadowsRenderPipeline;\r\n    private _outputTexture: ProceduralTexture;\r\n    private _worldScale: number = 1.0;\r\n    private _blurParameters: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    /**\r\n     * Is the effect enabled\r\n     */\r\n    public enabled: boolean = true;\r\n\r\n    /**\r\n     * Returns the output texture of the pass.\r\n     * @returns The output texture.\r\n     */\r\n    public getOutputTexture(): ProceduralTexture {\r\n        return this._outputTexture;\r\n    }\r\n\r\n    /**\r\n     * Gets the debug pass post process\r\n     * @returns The post process\r\n     */\r\n    public getDebugPassPP(): PostProcess {\r\n        if (!this._debugPassPP) {\r\n            this._createDebugPass();\r\n        }\r\n        return this._debugPassPP;\r\n    }\r\n    private _debugPassName: string = \"Spatial Blur Debug Pass\";\r\n    /**\r\n     * Sets the name of the debug pass\r\n     */\r\n    public get debugPassName(): string {\r\n        return this._debugPassName;\r\n    }\r\n\r\n    /**\r\n     * The scale of the voxel grid in world space. This is used to scale the blur radius in world space.\r\n     * @param scale The scale of the voxel grid in world space.\r\n     */\r\n    public setWorldScale(scale: number) {\r\n        this._worldScale = scale;\r\n    }\r\n\r\n    /** Enable the debug view for this pass */\r\n    public debugEnabled: boolean = false;\r\n    private _debugPassPP: PostProcess;\r\n    private _debugSizeParams: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    /**\r\n     * Sets params that control the position and scaling of the debug display on the screen.\r\n     * @param x Screen X offset of the debug display (0-1)\r\n     * @param y Screen Y offset of the debug display (0-1)\r\n     * @param widthScale X scale of the debug display (0-1)\r\n     * @param heightScale Y scale of the debug display (0-1)\r\n     */\r\n    public setDebugDisplayParams(x: number, y: number, widthScale: number, heightScale: number) {\r\n        this._debugSizeParams.set(x, y, widthScale, heightScale);\r\n    }\r\n\r\n    /**\r\n     * Creates the debug post process effect for this pass\r\n     */\r\n    private _createDebugPass() {\r\n        if (!this._debugPassPP) {\r\n            const isWebGPU = this._engine.isWebGPU;\r\n            const debugOptions: PostProcessOptions = {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n                textureFormat: Constants.TEXTUREFORMAT_RGBA,\r\n                textureType: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                uniforms: [\"sizeParams\"],\r\n                samplers: [\"debugSampler\"],\r\n                engine: this._engine,\r\n                reusable: false,\r\n                shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n                extraInitializations: (useWebGPU: boolean, list: Promise<any>[]) => {\r\n                    if (useWebGPU) {\r\n                        list.push(import(\"../../ShadersWGSL/iblShadowDebug.fragment\"));\r\n                    } else {\r\n                        list.push(import(\"../../Shaders/iblShadowDebug.fragment\"));\r\n                    }\r\n                },\r\n            };\r\n            this._debugPassPP = new PostProcess(this.debugPassName, \"iblShadowDebug\", debugOptions);\r\n            this._debugPassPP.autoClear = false;\r\n            this._debugPassPP.onApplyObservable.add((effect) => {\r\n                // update the caustic texture with what we just rendered.\r\n                effect.setTexture(\"debugSampler\", this._outputTexture);\r\n                effect.setVector4(\"sizeParams\", this._debugSizeParams);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instanciates the importance sampling renderer\r\n     * @param scene Scene to attach to\r\n     * @param iblShadowsRenderPipeline The IBL shadows render pipeline\r\n     * @returns The importance sampling renderer\r\n     */\r\n    constructor(scene: Scene, iblShadowsRenderPipeline: IblShadowsRenderPipeline) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._renderPipeline = iblShadowsRenderPipeline;\r\n        this._createTextures();\r\n    }\r\n\r\n    private _createTextures() {\r\n        const isWebGPU = this._engine.isWebGPU;\r\n        const textureOptions: IProceduralTextureCreationOptions = {\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/iblShadowSpatialBlur.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/iblShadowSpatialBlur.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n        this._outputTexture = new ProceduralTexture(\r\n            \"spatialBlurPass\",\r\n            {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n            },\r\n            \"iblShadowSpatialBlur\",\r\n            this._scene,\r\n            textureOptions,\r\n            false,\r\n            false,\r\n            Constants.TEXTURETYPE_UNSIGNED_BYTE\r\n        );\r\n        this._outputTexture.refreshRate = -1;\r\n        this._outputTexture.autoClear = false;\r\n\r\n        // Need to set all the textures first so that the effect gets created with the proper uniforms.\r\n        this._setBindings();\r\n\r\n        this._renderWhenGBufferReady = this._render.bind(this);\r\n        // Don't start rendering until the first vozelization is done.\r\n        this._renderPipeline.onVoxelizationCompleteObservable.addOnce(() => {\r\n            this._scene.geometryBufferRenderer!.getGBuffer().onAfterRenderObservable.add(this._renderWhenGBufferReady);\r\n        });\r\n    }\r\n\r\n    private _setBindings(): boolean {\r\n        this._outputTexture.setTexture(\"voxelTracingSampler\", this._renderPipeline._getVoxelTracingTexture());\r\n        const iterationCount = 1;\r\n        this._blurParameters.set(iterationCount, this._worldScale, 0.0, 0.0);\r\n        this._outputTexture.setVector4(\"blurParameters\", this._blurParameters);\r\n        const geometryBufferRenderer = this._scene.geometryBufferRenderer;\r\n        if (!geometryBufferRenderer) {\r\n            return false;\r\n        }\r\n        const depthIndex = geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE);\r\n        this._outputTexture.setTexture(\"depthSampler\", geometryBufferRenderer.getGBuffer().textures[depthIndex]);\r\n        const wnormalIndex = geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE);\r\n        this._outputTexture.setTexture(\"worldNormalSampler\", geometryBufferRenderer.getGBuffer().textures[wnormalIndex]);\r\n        return true;\r\n    }\r\n\r\n    private _render() {\r\n        if (this.enabled && this._outputTexture.isReady() && this._outputTexture.getEffect()?.isReady()) {\r\n            if (this._setBindings()) {\r\n                this._outputTexture.render();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _renderWhenGBufferReady: Nullable<(eventData: number, eventState: EventState) => void> = null;\r\n\r\n    /**\r\n     * Called by render pipeline when canvas resized.\r\n     * @param scaleFactor The factor by which to scale the canvas size.\r\n     */\r\n    public resize(scaleFactor: number = 1.0) {\r\n        const newSize = {\r\n            width: Math.max(1.0, Math.floor(this._engine.getRenderWidth() * scaleFactor)),\r\n            height: Math.max(1.0, Math.floor(this._engine.getRenderHeight() * scaleFactor)),\r\n        };\r\n        // Don't resize if the size is the same as the current size.\r\n        if (this._outputTexture.getSize().width === newSize.width && this._outputTexture.getSize().height === newSize.height) {\r\n            return;\r\n        }\r\n        this._outputTexture.resize(newSize, false);\r\n    }\r\n\r\n    /**\r\n     * Checks if the pass is ready\r\n     * @returns true if the pass is ready\r\n     */\r\n    public isReady() {\r\n        return this._outputTexture.isReady() && !(this._debugPassPP && !this._debugPassPP.isReady());\r\n    }\r\n\r\n    /**\r\n     * Disposes the associated resources\r\n     */\r\n    public dispose() {\r\n        if (this._scene.geometryBufferRenderer && this._renderWhenGBufferReady) {\r\n            const gBuffer = this._scene.geometryBufferRenderer.getGBuffer();\r\n            gBuffer.onAfterRenderObservable.removeCallback(this._renderWhenGBufferReady);\r\n        }\r\n        this._outputTexture.dispose();\r\n        if (this._debugPassPP) {\r\n            this._debugPassPP.dispose();\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAGA,OAAO,EAAE,OAAO,EAAE,MAAM,yBAAyB,CAAC;AAClD,OAAO,EAAE,WAAW,EAAE,MAAM,iCAAiC,CAAC;AAG9D,OAAO,EAAE,sBAAsB,EAAE,MAAM,wCAAwC,CAAC;AAChF,OAAO,EAAE,iBAAiB,EAAE,kEAA8D;;;;;AAUpF,MAAO,0BAA0B;IAanC;;;OAGG,CACI,gBAAgB,GAAA;QACnB,OAAO,IAAI,CAAC,cAAc,CAAC;IAC/B,CAAC;IAED;;;OAGG,CACI,cAAc,GAAA;QACjB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;YACrB,IAAI,CAAC,gBAAgB,EAAE,CAAC;QAC5B,CAAC;QACD,OAAO,IAAI,CAAC,YAAY,CAAC;IAC7B,CAAC;IAED;;OAEG,CACH,IAAW,aAAa,GAAA;QACpB,OAAO,IAAI,CAAC,cAAc,CAAC;IAC/B,CAAC;IAED;;;OAGG,CACI,aAAa,CAAC,KAAa,EAAA;QAC9B,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC;IAC7B,CAAC;IAOD;;;;;;OAMG,CACI,qBAAqB,CAAC,CAAS,EAAE,CAAS,EAAE,UAAkB,EAAE,WAAmB,EAAA;QACtF,IAAI,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC,EAAE,CAAC,EAAE,UAAU,EAAE,WAAW,CAAC,CAAC;IAC7D,CAAC;IAED;;OAEG,CACK,gBAAgB,GAAA;QACpB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE,CAAC;YACrB,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;YACvC,MAAM,YAAY,GAAuB;gBACrC,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE;gBACpC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE;gBACtC,aAAa,EAAE,SAAS,CAAC,kBAAkB;gBAC3C,WAAW,EAAE,SAAS,CAAC,yBAAyB;gBAChD,YAAY,EAAE,SAAS,CAAC,4BAA4B;gBACpD,QAAQ,EAAE;oBAAC,YAAY;iBAAC;gBACxB,QAAQ,EAAE;oBAAC,cAAc;iBAAC;gBAC1B,MAAM,EAAE,IAAI,CAAC,OAAO;gBACpB,QAAQ,EAAE,KAAK;gBACf,cAAc,EAAE,QAAQ,CAAC,CAAC,CAAA,EAAA,uBAAA,GAAqB,CAAC,EAAA,EAAA,uBAAA,EAAoB;gBACpE,oBAAoB,EAAE,CAAC,SAAkB,EAAE,IAAoB,EAAE,EAAE;oBAC/D,IAAI,SAAS,EAAE,CAAC;wBACZ,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,2CAA2C,CAAC,CAAC,CAAC;oBACnE,CAAC,MAAM,CAAC;wBACJ,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,uCAAuC,CAAC,CAAC,CAAC;oBAC/D,CAAC;gBACL,CAAC;aACJ,CAAC;YACF,IAAI,CAAC,YAAY,GAAG,IAAI,mPAAW,CAAC,IAAI,CAAC,aAAa,EAAE,gBAAgB,EAAE,YAAY,CAAC,CAAC;YACxF,IAAI,CAAC,YAAY,CAAC,SAAS,GAAG,KAAK,CAAC;YACpC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,EAAE;gBAC/C,yDAAyD;gBACzD,MAAM,CAAC,UAAU,CAAC,cAAc,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;gBACvD,MAAM,CAAC,UAAU,CAAC,YAAY,EAAE,IAAI,CAAC,gBAAgB,CAAC,CAAC;YAC3D,CAAC,CAAC,CAAC;QACP,CAAC;IACL,CAAC;IAED;;;;;OAKG,CACH,YAAY,KAAY,EAAE,wBAAkD,CAAA;QAnGpE,IAAA,CAAA,WAAW,GAAW,GAAG,CAAC;QAC1B,IAAA,CAAA,eAAe,GAAY,IAAI,0OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAEnE;;WAEG,CACI,IAAA,CAAA,OAAO,GAAY,IAAI,CAAC;QAoBvB,IAAA,CAAA,cAAc,GAAW,yBAAyB,CAAC;QAgB3D,wCAAA,EAA0C,CACnC,IAAA,CAAA,YAAY,GAAY,KAAK,CAAC;QAE7B,IAAA,CAAA,gBAAgB,GAAY,IAAI,0OAAO,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QAgI5D,IAAA,CAAA,uBAAuB,GAAkE,IAAI,CAAC;QAzElG,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC,SAAS,EAAE,CAAC;QACjC,IAAI,CAAC,eAAe,GAAG,wBAAwB,CAAC;QAChD,IAAI,CAAC,eAAe,EAAE,CAAC;IAC3B,CAAC;IAEO,eAAe,GAAA;QACnB,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;QACvC,MAAM,cAAc,GAAsC;YACtD,IAAI,EAAE,SAAS,CAAC,yBAAyB;YACzC,MAAM,EAAE,SAAS,CAAC,kBAAkB;YACpC,YAAY,EAAE,SAAS,CAAC,4BAA4B;YACpD,mBAAmB,EAAE,KAAK;YAC1B,eAAe,EAAE,KAAK;YACtB,cAAc,EAAE,QAAQ,CAAC,CAAC,CAAA,EAAA,uBAAA,GAAqB,CAAC,EAAA,EAAA,uBAAA,EAAoB;YACpE,yBAAyB,EAAE,KAAK,IAAI,EAAE;gBAClC,IAAI,QAAQ,EAAE,CAAC;oBACX,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,iDAAiD,CAAC,CAAC,CAAC,CAAC;;qBAAA;gBACnF,CAAC,MAAM,CAAC;oBACJ,MAAM,OAAO,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,6CAA6C,CAAC,CAAC,CAAC,CAAC;;qBAAA;gBAC/E,CAAC;YACL,CAAC;SACJ,CAAC;QACF,IAAI,CAAC,cAAc,GAAG,IAAI,sRAAiB,CACvC,iBAAiB,EACjB;YACI,KAAK,EAAE,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE;YACpC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE;SACzC,EACD,sBAAsB,EACtB,IAAI,CAAC,MAAM,EACX,cAAc,EACd,KAAK,EACL,KAAK,EACL,SAAS,CAAC,yBAAyB,CACtC,CAAC;QACF,IAAI,CAAC,cAAc,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC;QACrC,IAAI,CAAC,cAAc,CAAC,SAAS,GAAG,KAAK,CAAC;QAEtC,+FAA+F;QAC/F,IAAI,CAAC,YAAY,EAAE,CAAC;QAEpB,IAAI,CAAC,uBAAuB,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACvD,8DAA8D;QAC9D,IAAI,CAAC,eAAe,CAAC,gCAAgC,CAAC,OAAO,CAAC,GAAG,EAAE;YAC/D,IAAI,CAAC,MAAM,CAAC,sBAAuB,CAAC,UAAU,EAAE,CAAC,uBAAuB,CAAC,GAAG,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QAC/G,CAAC,CAAC,CAAC;IACP,CAAC;IAEO,YAAY,GAAA;QAChB,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,qBAAqB,EAAE,IAAI,CAAC,eAAe,CAAC,uBAAuB,EAAE,CAAC,CAAC;QACtG,MAAM,cAAc,GAAG,CAAC,CAAC;QACzB,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,WAAW,EAAE,GAAG,EAAE,GAAG,CAAC,CAAC;QACrE,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,gBAAgB,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACvE,MAAM,sBAAsB,GAAG,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC;QAClE,IAAI,CAAC,sBAAsB,EAAE,CAAC;YAC1B,OAAO,KAAK,CAAC;QACjB,CAAC;QACD,MAAM,UAAU,GAAG,sBAAsB,CAAC,eAAe,CAAC,qQAAsB,CAAC,8BAA8B,CAAC,CAAC;QACjH,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,cAAc,EAAE,sBAAsB,CAAC,UAAU,EAAE,CAAC,QAAQ,CAAC,UAAU,CAAC,CAAC,CAAC;QACzG,MAAM,YAAY,GAAG,sBAAsB,CAAC,eAAe,CAAC,qQAAsB,CAAC,mBAAmB,CAAC,CAAC;QACxG,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,oBAAoB,EAAE,sBAAsB,CAAC,UAAU,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,CAAC,CAAC;QACjH,OAAO,IAAI,CAAC;IAChB,CAAC;IAEO,OAAO,GAAA;QACX,IAAI,IAAI,CAAC,OAAO,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,IAAI,IAAI,CAAC,cAAc,CAAC,SAAS,EAAE,EAAE,OAAO,EAAE,EAAE,CAAC;YAC9F,IAAI,IAAI,CAAC,YAAY,EAAE,EAAE,CAAC;gBACtB,IAAI,CAAC,cAAc,CAAC,MAAM,EAAE,CAAC;YACjC,CAAC;QACL,CAAC;IACL,CAAC;IAID;;;OAGG,CACI,MAAM,CAAC,cAAsB,GAAG,EAAA;QACnC,MAAM,OAAO,GAAG;YACZ,KAAK,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,cAAc,EAAE,GAAG,WAAW,CAAC,CAAC;YAC7E,MAAM,EAAE,IAAI,CAAC,GAAG,CAAC,GAAG,EAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,eAAe,EAAE,GAAG,WAAW,CAAC,CAAC;SAClF,CAAC;QACF,4DAA4D;QAC5D,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC,KAAK,KAAK,OAAO,CAAC,KAAK,IAAI,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC,MAAM,KAAK,OAAO,CAAC,MAAM,EAAE,CAAC;YACnH,OAAO;QACX,CAAC;QACD,IAAI,CAAC,cAAc,CAAC,MAAM,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;IAC/C,CAAC;IAED;;;OAGG,CACI,OAAO,GAAA;QACV,OAAO,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,YAAY,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,CAAC;IACjG,CAAC;IAED;;OAEG,CACI,OAAO,GAAA;QACV,IAAI,IAAI,CAAC,MAAM,CAAC,sBAAsB,IAAI,IAAI,CAAC,uBAAuB,EAAE,CAAC;YACrE,MAAM,OAAO,GAAG,IAAI,CAAC,MAAM,CAAC,sBAAsB,CAAC,UAAU,EAAE,CAAC;YAChE,OAAO,CAAC,uBAAuB,CAAC,cAAc,CAAC,IAAI,CAAC,uBAAuB,CAAC,CAAC;QACjF,CAAC;QACD,IAAI,CAAC,cAAc,CAAC,OAAO,EAAE,CAAC;QAC9B,IAAI,IAAI,CAAC,YAAY,EAAE,CAAC;YACpB,IAAI,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC;QAChC,CAAC;IACL,CAAC;CACJ"}},
    {"offset": {"line": 7554, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/IBLShadows/iblShadowsAccumulationPass.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/IBLShadows/iblShadowsAccumulationPass.ts"],"sourcesContent":["import { Constants } from \"../../Engines/constants\";\r\nimport type { AbstractEngine } from \"../../Engines/abstractEngine\";\r\nimport type { Scene } from \"../../scene\";\r\nimport { Vector4 } from \"../../Maths/math.vector\";\r\nimport { PostProcess } from \"../../PostProcesses/postProcess\";\r\nimport type { PostProcessOptions } from \"../../PostProcesses/postProcess\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { GeometryBufferRenderer } from \"../../Rendering/geometryBufferRenderer\";\r\nimport { ProceduralTexture } from \"core/Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IProceduralTextureCreationOptions } from \"core/Materials/Textures/Procedurals/proceduralTexture\";\r\nimport type { IblShadowsRenderPipeline } from \"./iblShadowsRenderPipeline\";\r\nimport { Observable } from \"../../Misc/observable\";\r\nimport type { EventState } from \"../../Misc/observable\";\r\nimport type { Nullable } from \"../../types\";\r\n\r\n/**\r\n * This should not be instantiated directly, as it is part of a scene component\r\n * @internal\r\n */\r\nexport class _IblShadowsAccumulationPass {\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n    private _renderPipeline: IblShadowsRenderPipeline;\r\n\r\n    // First, render the accumulation pass with both position buffers, motion buffer, shadow buffer, and the previous accumulation buffer\r\n    private _outputTexture: ProceduralTexture;\r\n    private _oldAccumulationCopy: ProceduralTexture;\r\n    private _oldPositionCopy: ProceduralTexture;\r\n    private _accumulationParams: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    /** Enable the debug view for this pass */\r\n    public debugEnabled: boolean = false;\r\n\r\n    /**\r\n     * Is the effect enabled\r\n     */\r\n    public enabled: boolean = true;\r\n\r\n    /**\r\n     * Returns the output texture of the pass.\r\n     * @returns The output texture.\r\n     */\r\n    public getOutputTexture(): ProceduralTexture {\r\n        return this._outputTexture;\r\n    }\r\n\r\n    /**\r\n     * Observable that triggers when the accumulation texture is ready\r\n     */\r\n    public onReadyObservable: Observable<void> = new Observable<void>();\r\n\r\n    /**\r\n     * Gets the debug pass post process\r\n     * @returns The post process\r\n     */\r\n    public getDebugPassPP(): PostProcess {\r\n        if (!this._debugPassPP) {\r\n            this._createDebugPass();\r\n        }\r\n        return this._debugPassPP;\r\n    }\r\n\r\n    private _debugPassName: string = \"Shadow Accumulation Debug Pass\";\r\n\r\n    /**\r\n     * Gets the name of the debug pass\r\n     * @returns The name of the debug pass\r\n     */\r\n    public get debugPassName(): string {\r\n        return this._debugPassName;\r\n    }\r\n\r\n    /**\r\n     * A value that controls how much of the previous frame's accumulation to keep.\r\n     * The higher the value, the faster the shadows accumulate but the more potential ghosting you'll see.\r\n     */\r\n    public get remanence(): number {\r\n        return this._remanence;\r\n    }\r\n\r\n    /**\r\n     * A value that controls how much of the previous frame's accumulation to keep.\r\n     * The higher the value, the faster the shadows accumulate but the more potential ghosting you'll see.\r\n     */\r\n    public set remanence(value: number) {\r\n        this._remanence = value;\r\n    }\r\n    private _remanence: number = 0.9;\r\n\r\n    /**\r\n     * Reset the accumulation.\r\n     */\r\n    public get reset(): boolean {\r\n        return this._reset;\r\n    }\r\n    /**\r\n     * Reset the accumulation.\r\n     */\r\n    public set reset(value: boolean) {\r\n        this._reset = value;\r\n    }\r\n    private _reset: boolean = true;\r\n\r\n    /**\r\n     * Tell the pass that the camera is moving. This will cause the accumulation\r\n     * rate to change.\r\n     */\r\n    public set isMoving(value: boolean) {\r\n        this._isMoving = value;\r\n    }\r\n    private _isMoving: boolean = false;\r\n\r\n    private _debugPassPP: PostProcess;\r\n    private _debugSizeParams: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    /**\r\n     * Sets params that control the position and scaling of the debug display on the screen.\r\n     * @param x Screen X offset of the debug display (0-1)\r\n     * @param y Screen Y offset of the debug display (0-1)\r\n     * @param widthScale X scale of the debug display (0-1)\r\n     * @param heightScale Y scale of the debug display (0-1)\r\n     */\r\n    public setDebugDisplayParams(x: number, y: number, widthScale: number, heightScale: number) {\r\n        this._debugSizeParams.set(x, y, widthScale, heightScale);\r\n    }\r\n\r\n    /**\r\n     * Creates the debug post process effect for this pass\r\n     */\r\n    private _createDebugPass() {\r\n        if (!this._debugPassPP) {\r\n            const isWebGPU = this._engine.isWebGPU;\r\n            const debugOptions: PostProcessOptions = {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n                textureFormat: Constants.TEXTUREFORMAT_RGBA,\r\n                textureType: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                uniforms: [\"sizeParams\"],\r\n                samplers: [\"debugSampler\"],\r\n                engine: this._engine,\r\n                reusable: false,\r\n                shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n                extraInitializations: (useWebGPU: boolean, list: Promise<any>[]) => {\r\n                    if (useWebGPU) {\r\n                        list.push(import(\"../../ShadersWGSL/iblShadowDebug.fragment\"));\r\n                    } else {\r\n                        list.push(import(\"../../Shaders/iblShadowDebug.fragment\"));\r\n                    }\r\n                },\r\n            };\r\n            this._debugPassPP = new PostProcess(this.debugPassName, \"iblShadowDebug\", debugOptions);\r\n            this._debugPassPP.autoClear = false;\r\n            this._debugPassPP.onApplyObservable.add((effect) => {\r\n                // update the caustic texture with what we just rendered.\r\n                effect.setTexture(\"debugSampler\", this._outputTexture);\r\n                effect.setVector4(\"sizeParams\", this._debugSizeParams);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Instantiates the accumulation pass\r\n     * @param scene Scene to attach to\r\n     * @param iblShadowsRenderPipeline The IBL shadows render pipeline\r\n     * @returns The accumulation pass\r\n     */\r\n    constructor(scene: Scene, iblShadowsRenderPipeline: IblShadowsRenderPipeline) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._renderPipeline = iblShadowsRenderPipeline;\r\n        this._createTextures();\r\n    }\r\n\r\n    private _createTextures() {\r\n        const isWebGPU = this._engine.isWebGPU;\r\n\r\n        const outputTextureOptions: IProceduralTextureCreationOptions = {\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/iblShadowAccumulation.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/iblShadowAccumulation.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n        this._outputTexture = new ProceduralTexture(\r\n            \"shadowAccumulationPass\",\r\n            {\r\n                width: this._engine.getRenderWidth(),\r\n                height: this._engine.getRenderHeight(),\r\n            },\r\n            \"iblShadowAccumulation\",\r\n            this._scene,\r\n            outputTextureOptions\r\n        );\r\n        this._outputTexture.refreshRate = 1;\r\n        this._outputTexture.autoClear = false;\r\n        this._outputTexture.onGeneratedObservable.addOnce(() => {\r\n            this.onReadyObservable.notifyObservers();\r\n        });\r\n\r\n        // Need to set all the textures first so that the effect gets created with the proper uniforms.\r\n        this._setOutputTextureBindings();\r\n\r\n        this._renderWhenGBufferReady = this._render.bind(this);\r\n        // Don't start rendering until the first vozelization is done.\r\n        this._renderPipeline.onVoxelizationCompleteObservable.addOnce(() => {\r\n            this._scene.geometryBufferRenderer!.getGBuffer().onAfterRenderObservable.add(this._renderWhenGBufferReady);\r\n        });\r\n\r\n        // Create the accumulation texture for the previous frame.\r\n        // We'll copy the output of the accumulation pass to this texture at the start of every frame.\r\n        const accumulationOptions: IProceduralTextureCreationOptions = {\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/pass.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/pass.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n\r\n        this._oldAccumulationCopy = new ProceduralTexture(\r\n            \"oldAccumulationRT\",\r\n            { width: this._engine.getRenderWidth(), height: this._engine.getRenderHeight() },\r\n            \"pass\",\r\n            this._scene,\r\n            accumulationOptions,\r\n            false\r\n        );\r\n\r\n        this._oldAccumulationCopy.autoClear = false;\r\n        this._oldAccumulationCopy.refreshRate = 1;\r\n        this._oldAccumulationCopy.onBeforeGenerationObservable.add(this._setAccumulationCopyBindings.bind(this));\r\n        this._setAccumulationCopyBindings();\r\n\r\n        // Create the local position texture for the previous frame.\r\n        // We'll copy the previous local position texture to this texture at the start of every frame.\r\n        const localPositionOptions: IProceduralTextureCreationOptions = {\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            generateDepthBuffer: false,\r\n            generateMipMaps: false,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializationsAsync: async () => {\r\n                if (isWebGPU) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/pass.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/pass.fragment\")]);\r\n                }\r\n            },\r\n        };\r\n\r\n        this._oldPositionCopy = new ProceduralTexture(\r\n            \"oldLocalPositionRT\",\r\n            { width: this._engine.getRenderWidth(), height: this._engine.getRenderHeight() },\r\n            \"pass\",\r\n            this._scene,\r\n            localPositionOptions,\r\n            false\r\n        );\r\n        this._updatePositionCopy();\r\n        this._oldPositionCopy.autoClear = false;\r\n        this._oldPositionCopy.refreshRate = 1;\r\n        this._oldPositionCopy.onBeforeGenerationObservable.add(this._updatePositionCopy.bind(this));\r\n    }\r\n\r\n    private _setOutputTextureBindings(): boolean {\r\n        const remanence = this._isMoving ? this.remanence : 0.99;\r\n        this._accumulationParams.set(remanence, this.reset ? 1.0 : 0.0, this._renderPipeline.voxelGridSize, 0.0);\r\n        this._outputTexture.setTexture(\"spatialBlurSampler\", this._renderPipeline._getSpatialBlurTexture());\r\n        this._outputTexture.setVector4(\"accumulationParameters\", this._accumulationParams);\r\n        this._outputTexture.setTexture(\"oldAccumulationSampler\", this._oldAccumulationCopy ? this._oldAccumulationCopy : this._renderPipeline._dummyTexture2d);\r\n        this._outputTexture.setTexture(\"prevPositionSampler\", this._oldPositionCopy ? this._oldPositionCopy : this._renderPipeline._dummyTexture2d);\r\n\r\n        const geometryBufferRenderer = this._scene.geometryBufferRenderer;\r\n        if (!geometryBufferRenderer) {\r\n            return false;\r\n        }\r\n        const velocityIndex = geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE);\r\n        this._outputTexture.setTexture(\"motionSampler\", geometryBufferRenderer.getGBuffer().textures[velocityIndex]);\r\n        const wPositionIndex = geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.POSITION_TEXTURE_TYPE);\r\n        this._outputTexture.setTexture(\"positionSampler\", geometryBufferRenderer.getGBuffer().textures[wPositionIndex]);\r\n\r\n        this.reset = false;\r\n        this._isMoving = false;\r\n        return true;\r\n    }\r\n\r\n    private _updatePositionCopy() {\r\n        const geometryBufferRenderer = this._scene.geometryBufferRenderer;\r\n        const index = geometryBufferRenderer!.getTextureIndex(GeometryBufferRenderer.POSITION_TEXTURE_TYPE);\r\n        this._oldPositionCopy.setTexture(\"textureSampler\", geometryBufferRenderer!.getGBuffer().textures[index]);\r\n    }\r\n\r\n    private _setAccumulationCopyBindings() {\r\n        this._oldAccumulationCopy.setTexture(\"textureSampler\", this._outputTexture);\r\n    }\r\n\r\n    private _render() {\r\n        if (this.enabled && this._outputTexture.isReady() && this._outputTexture.getEffect()?.isReady()) {\r\n            if (this._setOutputTextureBindings()) {\r\n                this._outputTexture.render();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _renderWhenGBufferReady: Nullable<(eventData: number, eventState: EventState) => void> = null;\r\n\r\n    /**\r\n     * Called by render pipeline when canvas resized.\r\n     * @param scaleFactor The factor by which to scale the canvas size.\r\n     */\r\n    public resize(scaleFactor: number = 1.0) {\r\n        const newSize = {\r\n            width: Math.max(1.0, Math.floor(this._engine.getRenderWidth() * scaleFactor)),\r\n            height: Math.max(1.0, Math.floor(this._engine.getRenderHeight() * scaleFactor)),\r\n        };\r\n        // Don't resize if the size is the same as the current size.\r\n        if (this._outputTexture.getSize().width === newSize.width && this._outputTexture.getSize().height === newSize.height) {\r\n            return;\r\n        }\r\n        this._outputTexture.resize(newSize, false);\r\n        this._oldAccumulationCopy.resize(newSize, false);\r\n        this._oldPositionCopy.resize({ width: this._engine.getRenderWidth(), height: this._engine.getRenderHeight() }, false);\r\n        this.reset = true;\r\n    }\r\n\r\n    private _disposeTextures() {\r\n        this._oldAccumulationCopy.dispose();\r\n        this._oldPositionCopy.dispose();\r\n        this._outputTexture.dispose();\r\n    }\r\n\r\n    /**\r\n     * Checks if the pass is ready\r\n     * @returns true if the pass is ready\r\n     */\r\n    public isReady() {\r\n        return (\r\n            this._oldAccumulationCopy &&\r\n            this._oldAccumulationCopy.isReady() &&\r\n            this._oldPositionCopy &&\r\n            this._oldPositionCopy.isReady() &&\r\n            this._outputTexture.isReady() &&\r\n            !(this._debugPassPP && !this._debugPassPP.isReady())\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Disposes the associated resources\r\n     */\r\n    public dispose() {\r\n        if (this._scene.geometryBufferRenderer && this._renderWhenGBufferReady) {\r\n            const gBuffer = this._scene.geometryBufferRenderer.getGBuffer();\r\n            gBuffer.onAfterRenderObservable.removeCallback(this._renderWhenGBufferReady);\r\n        }\r\n        this._disposeTextures();\r\n        if (this._debugPassPP) {\r\n            this._debugPassPP.dispose();\r\n        }\r\n        this.onReadyObservable.clear();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 7868, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/IBLShadows/iblShadowsPluginMaterial.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/IBLShadows/iblShadowsPluginMaterial.ts"],"sourcesContent":["import { MaterialDefines } from \"core/Materials/materialDefines\";\r\nimport { MaterialPluginBase } from \"core/Materials/materialPluginBase\";\r\nimport type { InternalTexture } from \"core/Materials/Textures/internalTexture\";\r\nimport type { Material } from \"core/Materials/material\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { StandardMaterial } from \"core/Materials/standardMaterial\";\r\nimport { PBRBaseMaterial } from \"core/Materials/PBR/pbrBaseMaterial\";\r\nimport type { UniformBuffer } from \"core/Materials/uniformBuffer\";\r\nimport { expandToProperty, serialize } from \"core/Misc/decorators\";\r\nimport { RegisterClass } from \"core/Misc/typeStore\";\r\n\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { OpenPBRMaterial } from \"core/Materials/PBR/openpbrMaterial\";\r\n/**\r\n * @internal\r\n */\r\nclass MaterialIBLShadowsRenderDefines extends MaterialDefines {\r\n    public RENDER_WITH_IBL_SHADOWS = false;\r\n    public COLORED_IBL_SHADOWS = false;\r\n}\r\n\r\n/**\r\n * Plugin used to render the contribution from IBL shadows.\r\n */\r\nexport class IBLShadowsPluginMaterial extends MaterialPluginBase {\r\n    /**\r\n     * Defines the name of the plugin.\r\n     */\r\n    public static readonly Name = \"IBLShadowsPluginMaterial\";\r\n\r\n    /**\r\n     * The texture containing the contribution from IBL shadows.\r\n     */\r\n    public iblShadowsTexture: InternalTexture;\r\n\r\n    /**\r\n     * The opacity of the shadows.\r\n     */\r\n    @serialize()\r\n    public shadowOpacity: number = 1.0;\r\n\r\n    private _isEnabled = false;\r\n    private _isColored = false;\r\n    public get isColored(): boolean {\r\n        return this._isColored;\r\n    }\r\n    public set isColored(value: boolean) {\r\n        if (this._isColored === value) {\r\n            return;\r\n        }\r\n        this._isColored = value;\r\n        this._markAllSubMeshesAsTexturesDirty();\r\n    }\r\n    /**\r\n     * Defines if the plugin is enabled in the material.\r\n     */\r\n    @serialize()\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public isEnabled = false;\r\n\r\n    protected _markAllSubMeshesAsTexturesDirty(): void {\r\n        this._enable(this._isEnabled);\r\n        this._internalMarkAllSubMeshesAsTexturesDirty();\r\n    }\r\n\r\n    private _internalMarkAllSubMeshesAsTexturesDirty: () => void;\r\n\r\n    /**\r\n     * Gets a boolean indicating that the plugin is compatible with a give shader language.\r\n     * @returns true if the plugin is compatible with the shader language\r\n     */\r\n    public override isCompatible(): boolean {\r\n        return true;\r\n    }\r\n\r\n    constructor(material: Material | StandardMaterial | PBRBaseMaterial | OpenPBRMaterial) {\r\n        super(material, IBLShadowsPluginMaterial.Name, 310, new MaterialIBLShadowsRenderDefines());\r\n        this._internalMarkAllSubMeshesAsTexturesDirty = material._dirtyCallbacks[Constants.MATERIAL_TextureDirtyFlag];\r\n    }\r\n\r\n    public override prepareDefines(defines: MaterialIBLShadowsRenderDefines) {\r\n        defines.RENDER_WITH_IBL_SHADOWS = this._isEnabled;\r\n        defines.COLORED_IBL_SHADOWS = this.isColored;\r\n    }\r\n\r\n    public override getClassName() {\r\n        return \"IBLShadowsPluginMaterial\";\r\n    }\r\n\r\n    public override getUniforms() {\r\n        return {\r\n            ubo: [\r\n                { name: \"renderTargetSize\", size: 2, type: \"vec2\" },\r\n                { name: \"shadowOpacity\", size: 1, type: \"float\" },\r\n            ],\r\n            fragment: `#ifdef RENDER_WITH_IBL_SHADOWS\r\n                    uniform vec2 renderTargetSize;\r\n                    uniform float shadowOpacity;\r\n                #endif`,\r\n        };\r\n    }\r\n\r\n    public override getSamplers(samplers: string[]) {\r\n        samplers.push(\"iblShadowsTexture\");\r\n    }\r\n\r\n    public override bindForSubMesh(uniformBuffer: UniformBuffer) {\r\n        if (this._isEnabled) {\r\n            uniformBuffer.bindTexture(\"iblShadowsTexture\", this.iblShadowsTexture);\r\n            uniformBuffer.updateFloat2(\"renderTargetSize\", this._material.getScene().getEngine().getRenderWidth(), this._material.getScene().getEngine().getRenderHeight());\r\n            uniformBuffer.updateFloat(\"shadowOpacity\", this.shadowOpacity);\r\n        }\r\n    }\r\n\r\n    public override getCustomCode(shaderType: string, shaderLanguage: ShaderLanguage) {\r\n        let frag: { [name: string]: string };\r\n\r\n        if (shaderLanguage === ShaderLanguage.WGSL) {\r\n            frag = {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_DEFINITIONS: `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    var iblShadowsTextureSampler: sampler;\r\n                    var iblShadowsTexture: texture_2d<f32>;\r\n\r\n                    #ifdef COLORED_IBL_SHADOWS\r\n                        fn computeIndirectShadow() -> vec3f {\r\n                            var uv = fragmentInputs.position.xy / uniforms.renderTargetSize;\r\n                            var shadowValue: vec3f = textureSample(iblShadowsTexture, iblShadowsTextureSampler, uv).rgb;\r\n                            return mix(shadowValue, vec3f(1.0), 1.0 - uniforms.shadowOpacity);\r\n                        }\r\n                    #else\r\n                        fn computeIndirectShadow() -> vec2f {\r\n                            var uv = fragmentInputs.position.xy / uniforms.renderTargetSize;\r\n                            var shadowValue: vec2f = textureSample(iblShadowsTexture, iblShadowsTextureSampler, uv).rg;\r\n                            return mix(shadowValue, vec2f(1.0), 1.0 - uniforms.shadowOpacity);\r\n                        }\r\n                    #endif\r\n                #endif\r\n            `,\r\n            };\r\n\r\n            if (this._material instanceof PBRBaseMaterial) {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\"] = `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    #ifndef UNLIT\r\n                        #ifdef REFLECTION\r\n                            #ifdef COLORED_IBL_SHADOWS\r\n                                var shadowValue: vec3f = computeIndirectShadow();\r\n                                finalIrradiance *= shadowValue;\r\n                                finalRadianceScaled *= mix(vec3f(1.0), shadowValue, roughness);\r\n                            #else\r\n                                var shadowValue: vec2f = computeIndirectShadow();\r\n                                finalIrradiance *= vec3f(shadowValue.x);\r\n                                finalRadianceScaled *= vec3f(mix(pow(shadowValue.y, 4.0), shadowValue.x, roughness));\r\n                            #endif\r\n                        #endif\r\n                    #else\r\n                        finalDiffuse *= computeIndirectShadow().x;\r\n                    #endif\r\n                #endif\r\n            `;\r\n            } else if (this._material instanceof OpenPBRMaterial) {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_IBLLAYERCOMPOSITION\"] = `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    #ifndef UNLIT\r\n                        #ifdef REFLECTION\r\n                            #ifdef COLORED_IBL_SHADOWS\r\n                                var shadowValue: vec3f = computeIndirectShadow();\r\n                                slab_diffuse_ibl *= shadowValue;\r\n                                slab_glossy_ibl *= mix(vec3f(1.0), shadowValue, specularAlphaG);\r\n                            #else\r\n                                var shadowValue: vec2f = computeIndirectShadow();\r\n                                slab_diffuse_ibl *= vec3f(shadowValue.x);\r\n                                slab_glossy_ibl *= vec3f(mix(pow(shadowValue.y, 4.0), shadowValue.x, specularAlphaG));\r\n                            #endif\r\n                        #endif\r\n                    #else\r\n                        slab_diffuse_ibl *= computeIndirectShadow().x;\r\n                    #endif\r\n                #endif\r\n            `;\r\n            } else {\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\"] = `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    #ifdef COLORED_IBL_SHADOWS\r\n                        var shadowValue: vec3f = computeIndirectShadow();\r\n                        color *= toGammaSpace(vec4f(shadowValue, 1.0f));\r\n                    #else\r\n                        var shadowValue: vec2f = computeIndirectShadow();\r\n                        color *= toGammaSpace(vec4f(shadowValue.x, shadowValue.x, shadowValue.x, 1.0f));\r\n                    #endif\r\n                #endif\r\n            `;\r\n            }\r\n        } else {\r\n            frag = {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_DEFINITIONS: `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    uniform sampler2D iblShadowsTexture;\r\n                #ifdef COLORED_IBL_SHADOWS\r\n                    vec3 computeIndirectShadow() {\r\n                        vec2 uv = gl_FragCoord.xy / renderTargetSize;\r\n                        vec3 shadowValue = texture2D(iblShadowsTexture, uv).rgb;\r\n                        return mix(shadowValue.rgb, vec3(1.0), 1.0 - shadowOpacity);\r\n                    }\r\n                #else\r\n                    vec2 computeIndirectShadow() {\r\n                        vec2 uv = gl_FragCoord.xy / renderTargetSize;\r\n                        vec2 shadowValue = texture2D(iblShadowsTexture, uv).rg;\r\n                        return mix(shadowValue.rg, vec2(1.0), 1.0 - shadowOpacity);\r\n                    }\r\n                #endif\r\n                #endif\r\n            `,\r\n            };\r\n\r\n            if (this._material instanceof PBRBaseMaterial) {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION\"] = `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    #ifndef UNLIT\r\n                        #ifdef REFLECTION\r\n                            #ifdef COLORED_IBL_SHADOWS\r\n                                vec3 shadowValue = computeIndirectShadow();\r\n                                finalIrradiance.rgb *= shadowValue.rgb;\r\n                                finalRadianceScaled *= mix(vec3(1.0), shadowValue.rgb, roughness);\r\n                            #else\r\n                                vec2 shadowValue = computeIndirectShadow();\r\n                                finalIrradiance *= shadowValue.x;\r\n                                finalRadianceScaled *= mix(pow(shadowValue.y, 4.0), shadowValue.x, roughness);\r\n                            #endif\r\n                        #endif\r\n                    #else\r\n                        finalDiffuse *= computeIndirectShadow().x;\r\n                    #endif\r\n                #endif\r\n            `;\r\n            } else if (this._material instanceof OpenPBRMaterial) {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_IBLLAYERCOMPOSITION\"] = `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    #ifndef UNLIT\r\n                        #ifdef REFLECTION\r\n                            #ifdef COLORED_IBL_SHADOWS\r\n                                vec3 shadowValue = computeIndirectShadow();\r\n                                slab_diffuse_ibl.rgb *= shadowValue.rgb;\r\n                                slab_glossy_ibl *= mix(vec3(1.0), shadowValue.rgb, specularAlphaG);\r\n                            #else\r\n                                vec2 shadowValue = computeIndirectShadow();\r\n                                slab_diffuse_ibl *= shadowValue.x;\r\n                                slab_glossy_ibl *= mix(pow(shadowValue.y, 4.0), shadowValue.x, specularAlphaG);\r\n                            #endif\r\n                        #endif\r\n                    #else\r\n                        slab_diffuse_ibl *= computeIndirectShadow().x;\r\n                    #endif\r\n                #endif\r\n            `;\r\n            } else {\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\"] = `\r\n                #ifdef RENDER_WITH_IBL_SHADOWS\r\n                    #ifdef COLORED_IBL_SHADOWS\r\n                        vec3 shadowValue = computeIndirectShadow();\r\n                        color.rgb *= toGammaSpace(shadowValue.rgb);\r\n                    #else\r\n                        vec2 shadowValue = computeIndirectShadow();\r\n                        color.rgb *= toGammaSpace(shadowValue.x);\r\n                    #endif\r\n                #endif\r\n            `;\r\n            }\r\n        }\r\n\r\n        return shaderType === \"vertex\" ? null : frag;\r\n    }\r\n}\r\n\r\nRegisterClass(`BABYLON.IBLShadowsPluginMaterial`, IBLShadowsPluginMaterial);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 8142, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/IBLShadows/iblShadowsRenderPipeline.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/IBLShadows/iblShadowsRenderPipeline.ts"],"sourcesContent":["import { Constants } from \"../../Engines/constants\";\r\nimport { EngineStore } from \"../../Engines/engineStore\";\r\nimport { Matrix, Vector3, Vector4, Quaternion } from \"../../Maths/math.vector\";\r\nimport type { Mesh } from \"../../Meshes/mesh\";\r\nimport type { Scene } from \"../../scene\";\r\nimport { Texture } from \"../../Materials/Textures/texture\";\r\nimport { Logger } from \"../../Misc/logger\";\r\nimport { _IblShadowsVoxelRenderer } from \"./iblShadowsVoxelRenderer\";\r\nimport { _IblShadowsVoxelTracingPass } from \"./iblShadowsVoxelTracingPass\";\r\nimport type { WebGPUEngine } from \"../../Engines/webgpuEngine\";\r\nimport { PostProcess } from \"../../PostProcesses/postProcess\";\r\nimport type { PostProcessOptions } from \"../../PostProcesses/postProcess\";\r\nimport { _IblShadowsSpatialBlurPass } from \"./iblShadowsSpatialBlurPass\";\r\nimport { _IblShadowsAccumulationPass } from \"./iblShadowsAccumulationPass\";\r\nimport { PostProcessRenderPipeline } from \"../../PostProcesses/RenderPipeline/postProcessRenderPipeline\";\r\nimport { PostProcessRenderEffect } from \"core/PostProcesses/RenderPipeline/postProcessRenderEffect\";\r\nimport type { Camera } from \"core/Cameras/camera\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport { GeometryBufferRenderer } from \"core/Rendering/geometryBufferRenderer\";\r\nimport { RawTexture } from \"core/Materials/Textures/rawTexture\";\r\nimport { RawTexture3D } from \"core/Materials/Textures/rawTexture3D\";\r\nimport { Engine } from \"core/Engines/engine\";\r\nimport { IBLShadowsPluginMaterial } from \"./iblShadowsPluginMaterial\";\r\nimport { PBRBaseMaterial } from \"core/Materials/PBR/pbrBaseMaterial\";\r\nimport { StandardMaterial } from \"core/Materials/standardMaterial\";\r\nimport type { Material } from \"core/Materials/material\";\r\nimport { Observable } from \"core/Misc/observable\";\r\nimport \"../geometryBufferRendererSceneComponent\";\r\nimport \"../iblCdfGeneratorSceneComponent\";\r\nimport { OpenPBRMaterial } from \"core/Materials/PBR/openpbrMaterial\";\r\nimport { Tools } from \"../../Misc/tools\";\r\n\r\ninterface IIblShadowsSettings {\r\n    /**\r\n     * The exponent of the resolution of the voxel shadow grid. Higher resolutions will result in sharper\r\n     * shadows but are more expensive to compute and require more memory.\r\n     * The resolution is calculated as 2 to the power of this number.\r\n     */\r\n    resolutionExp?: number;\r\n\r\n    /**\r\n     * The number of different directions to sample during the voxel tracing pass. Higher\r\n     * values will result in better quality, more stable shadows but are more expensive to compute.\r\n     */\r\n    sampleDirections?: number;\r\n\r\n    /**\r\n     * How dark the shadows are. 1.0 is full opacity, 0.0 is no shadows.\r\n     */\r\n    shadowOpacity?: number;\r\n\r\n    /**\r\n     * The global Y-axis rotation of the IBL for shadows. This should match the Y-rotation of the environment map applied to materials, skybox, etc.\r\n     */\r\n    envRotation?: number;\r\n\r\n    /**\r\n     * A factor that controls how long the shadows remain in the scene.\r\n     * 0.0 is no persistence, 1.0 is full persistence.\r\n     * This value applies only while the camera is moving. Once stationary, the pipeline\r\n     * increases remanence automatically to help the shadows converge.\r\n     */\r\n    shadowRemanence?: number;\r\n\r\n    /**\r\n     * Render the voxel grid from 3 different axis. This will result in better quality shadows with fewer\r\n     * bits of missing geometry.\r\n     */\r\n    triPlanarVoxelization?: boolean;\r\n\r\n    /**\r\n     * A size multiplier for the internal shadow render targets (default 1.0). A value of 1.0 represents full-resolution.\r\n     * Scaling this below 1.0 will result in blurry shadows and potentially more artifacts but\r\n     * could help increase performance on less powerful GPU's.\r\n     */\r\n    shadowRenderSizeFactor?: number;\r\n\r\n    /**\r\n     * Separate control for the opacity of the voxel shadows.\r\n     */\r\n    voxelShadowOpacity?: number;\r\n\r\n    /**\r\n     * Include screen-space shadows in the IBL shadow pipeline. This adds sharp shadows to small details\r\n     * but only applies close to a shadow-casting object.\r\n     */\r\n    ssShadowsEnabled?: boolean;\r\n\r\n    /**\r\n     * The number of samples used in the screen space shadow pass.\r\n     */\r\n    ssShadowSampleCount?: number;\r\n\r\n    /**\r\n     * The stride of the screen-space shadow pass. This controls the distance between samples\r\n     * in pixels.\r\n     */\r\n    ssShadowStride?: number;\r\n\r\n    /**\r\n     * A scale for the maximum distance a screen-space shadow can be cast in world-space.\r\n     * The maximum distance that screen-space shadows cast is derived from the voxel size\r\n     * and this value so shouldn't need to change if you scale your scene.\r\n     */\r\n    ssShadowDistanceScale?: number;\r\n\r\n    /**\r\n     * Screen-space shadow thickness scale. This value controls the assumed thickness of\r\n     * on-screen surfaces in world-space. It scales with the size of the shadow-casting\r\n     * region so shouldn't need to change if you scale your scene.\r\n     */\r\n    ssShadowThicknessScale?: number;\r\n}\r\n\r\n/**\r\n * Voxel-based shadow rendering for IBL's.\r\n * This should not be instanciated directly, as it is part of a scene component\r\n */\r\nexport class IblShadowsRenderPipeline extends PostProcessRenderPipeline {\r\n    /**\r\n     * The scene that this pipeline is attached to\r\n     */\r\n    public scene: Scene;\r\n\r\n    private _allowDebugPasses: boolean = false;\r\n    private _debugPasses: { pass: PostProcess; enabled: boolean }[] = [];\r\n\r\n    private _geometryBufferRenderer: GeometryBufferRenderer;\r\n\r\n    private _shadowCastingMeshes: Mesh[] = [];\r\n\r\n    private _voxelRenderer: _IblShadowsVoxelRenderer;\r\n    private _voxelTracingPass: _IblShadowsVoxelTracingPass;\r\n    private _spatialBlurPass: _IblShadowsSpatialBlurPass;\r\n    private _accumulationPass: _IblShadowsAccumulationPass;\r\n    private _noiseTexture: Texture;\r\n    /**\r\n     * Raw texture to be used before final data is available.\r\n     * @internal\r\n     */\r\n    public _dummyTexture2d: RawTexture;\r\n    private _dummyTexture3d: RawTexture3D;\r\n    private _shadowOpacity: number = 0.8;\r\n    private _enabled: boolean = true;\r\n    private _coloredShadows: boolean = false;\r\n    private _materialsWithRenderPlugin: Material[] = [];\r\n\r\n    /**\r\n     * Observable that triggers when the shadow renderer is ready\r\n     */\r\n    public onShadowTextureReadyObservable: Observable<void> = new Observable<void>();\r\n\r\n    /**\r\n     * Observable that triggers when a new IBL is set and the importance sampling is ready\r\n     */\r\n    public onNewIblReadyObservable: Observable<void> = new Observable<void>();\r\n\r\n    /**\r\n     * Observable that triggers when the voxelization is complete\r\n     */\r\n    public onVoxelizationCompleteObservable: Observable<void> = new Observable<void>();\r\n\r\n    /**\r\n     * The current world-space size of that the voxel grid covers in the scene.\r\n     */\r\n    public voxelGridSize: number = 1.0;\r\n\r\n    /**\r\n     * Reset the shadow accumulation. This has a similar affect to lowering the remanence for a single frame.\r\n     * This is useful when making a sudden change to the IBL.\r\n     */\r\n    public resetAccumulation(): void {\r\n        this._accumulationPass.reset = true;\r\n    }\r\n\r\n    /**\r\n     * How dark the shadows appear. 1.0 is full opacity, 0.0 is no shadows.\r\n     */\r\n    public get shadowOpacity(): number {\r\n        return this._shadowOpacity;\r\n    }\r\n\r\n    public set shadowOpacity(value: number) {\r\n        this._shadowOpacity = value;\r\n        this._setPluginParameters();\r\n    }\r\n\r\n    /**\r\n     * Render the shadows in color rather than black and white.\r\n     * This is slightly more expensive than black and white shadows but can be much\r\n     * more accurate when the strongest lights in the IBL are non-white.\r\n     */\r\n    public get coloredShadows(): boolean {\r\n        return this._coloredShadows;\r\n    }\r\n\r\n    public set coloredShadows(value: boolean) {\r\n        this._coloredShadows = value;\r\n        this._voxelTracingPass.coloredShadows = value;\r\n        this._setPluginParameters();\r\n    }\r\n\r\n    private _renderSizeFactor: number = 1.0;\r\n\r\n    /**\r\n     * A multiplier for the render size of the shadows. Used for rendering lower-resolution shadows.\r\n     */\r\n    public get shadowRenderSizeFactor(): number {\r\n        return this._renderSizeFactor;\r\n    }\r\n\r\n    public set shadowRenderSizeFactor(value: number) {\r\n        this._renderSizeFactor = Math.max(Math.min(value, 1.0), 0.0);\r\n        this._voxelTracingPass.resize(value);\r\n        this._spatialBlurPass.resize(value);\r\n        this._accumulationPass.resize(value);\r\n        this._setPluginParameters();\r\n    }\r\n\r\n    /**\r\n     * How dark the voxel shadows appear. 1.0 is full opacity, 0.0 is no shadows.\r\n     */\r\n    public get voxelShadowOpacity() {\r\n        return this._voxelTracingPass?.voxelShadowOpacity;\r\n    }\r\n\r\n    public set voxelShadowOpacity(value: number) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.voxelShadowOpacity = value;\r\n    }\r\n\r\n    /**\r\n     * How dark the screen-space shadows appear. 1.0 is full opacity, 0.0 is no shadows.\r\n     */\r\n    public get ssShadowOpacity(): number {\r\n        return this._voxelTracingPass?.ssShadowOpacity;\r\n    }\r\n\r\n    public set ssShadowOpacity(value: number) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.ssShadowOpacity = value;\r\n    }\r\n\r\n    /**\r\n     * The number of samples used in the screen space shadow pass.\r\n     */\r\n    public get ssShadowSampleCount(): number {\r\n        return this._voxelTracingPass?.sssSamples;\r\n    }\r\n\r\n    public set ssShadowSampleCount(value: number) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.sssSamples = value;\r\n    }\r\n\r\n    /**\r\n     * The stride of the screen-space shadow pass. This controls the distance between samples\r\n     * in pixels.\r\n     */\r\n    public get ssShadowStride(): number {\r\n        return this._voxelTracingPass?.sssStride;\r\n    }\r\n\r\n    public set ssShadowStride(value: number) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.sssStride = value;\r\n    }\r\n\r\n    private _sssMaxDistScale: number;\r\n\r\n    /**\r\n     * A scale for the maximum distance a screen-space shadow can be cast in world-space.\r\n     * The maximum distance that screen-space shadows cast is derived from the voxel size\r\n     * and this value so shouldn't need to change if you scale your scene\r\n     */\r\n    public get ssShadowDistanceScale(): number {\r\n        return this._sssMaxDistScale;\r\n    }\r\n\r\n    public set ssShadowDistanceScale(value: number) {\r\n        this._sssMaxDistScale = value;\r\n        this._updateSsShadowParams();\r\n    }\r\n\r\n    private _sssThicknessScale: number;\r\n\r\n    /**\r\n     * Screen-space shadow thickness scale. This value controls the assumed thickness of\r\n     * on-screen surfaces in world-space. It scales with the size of the shadow-casting\r\n     * region so shouldn't need to change if you scale your scene.\r\n     */\r\n    public get ssShadowThicknessScale(): number {\r\n        return this._sssThicknessScale;\r\n    }\r\n\r\n    public set ssShadowThicknessScale(value: number) {\r\n        this._sssThicknessScale = value;\r\n        this._updateSsShadowParams();\r\n    }\r\n\r\n    /**\r\n     * Returns the texture containing the voxel grid data\r\n     * @returns The texture containing the voxel grid data\r\n     * @internal\r\n     */\r\n    public _getVoxelGridTexture(): Texture {\r\n        const tex = this._voxelRenderer?.getVoxelGrid();\r\n        if (tex && tex.isReady()) {\r\n            return tex;\r\n        }\r\n        return this._dummyTexture3d;\r\n    }\r\n\r\n    /**\r\n     * Returns the noise texture.\r\n     * @returns The noise texture.\r\n     * @internal\r\n     */\r\n    public _getNoiseTexture(): Texture {\r\n        const tex = this._noiseTexture;\r\n        if (tex && tex.isReady()) {\r\n            return tex;\r\n        }\r\n        return this._dummyTexture2d;\r\n    }\r\n\r\n    /**\r\n     * Returns the voxel-tracing texture.\r\n     * @returns The voxel-tracing texture.\r\n     * @internal\r\n     */\r\n    public _getVoxelTracingTexture(): Texture {\r\n        const tex = this._voxelTracingPass?.getOutputTexture();\r\n        if (tex && tex.isReady()) {\r\n            return tex;\r\n        }\r\n        return this._dummyTexture2d;\r\n    }\r\n\r\n    /**\r\n     * Returns the spatial blur texture.\r\n     * @returns The spatial blur texture.\r\n     * @internal\r\n     */\r\n    public _getSpatialBlurTexture(): Texture {\r\n        const tex = this._spatialBlurPass.getOutputTexture();\r\n        if (tex && tex.isReady()) {\r\n            return tex;\r\n        }\r\n        return this._dummyTexture2d;\r\n    }\r\n\r\n    /**\r\n     * Returns the accumulated shadow texture.\r\n     * @returns The accumulated shadow texture.\r\n     * @internal\r\n     */\r\n    public _getAccumulatedTexture(): Texture {\r\n        const tex = this._accumulationPass?.getOutputTexture();\r\n        if (tex && tex.isReady()) {\r\n            return tex;\r\n        }\r\n        return this._dummyTexture2d;\r\n    }\r\n\r\n    private _gbufferDebugPass: PostProcess;\r\n    private _gbufferDebugEnabled: boolean = false;\r\n    private _gBufferDebugSizeParams: Vector4 = new Vector4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    /**\r\n     * Turn on or off the debug view of the G-Buffer. This will display only the targets\r\n     * of the g-buffer that are used by the shadow pipeline.\r\n     */\r\n    public get gbufferDebugEnabled(): boolean {\r\n        return this._gbufferDebugEnabled;\r\n    }\r\n\r\n    public set gbufferDebugEnabled(enabled: boolean) {\r\n        if (enabled && !this.allowDebugPasses) {\r\n            Logger.Warn(\"Can't enable G-Buffer debug view without setting allowDebugPasses to true.\");\r\n            return;\r\n        }\r\n        this._gbufferDebugEnabled = enabled;\r\n        if (enabled) {\r\n            this._enableEffect(this._getGBufferDebugPass().name, this.cameras);\r\n        } else {\r\n            this._disableEffect(this._getGBufferDebugPass().name, this.cameras);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Turn on or off the debug view of the CDF importance sampling data\r\n     */\r\n    public get cdfDebugEnabled(): boolean {\r\n        return this.scene.iblCdfGenerator ? this.scene.iblCdfGenerator.debugEnabled : false;\r\n    }\r\n\r\n    /**\r\n     * Turn on or off the debug view of the CDF importance sampling data\r\n     */\r\n    public set cdfDebugEnabled(enabled: boolean) {\r\n        if (!this.scene.iblCdfGenerator) {\r\n            return;\r\n        }\r\n        if (enabled && !this.allowDebugPasses) {\r\n            Logger.Warn(\"Can't enable importance sampling debug view without setting allowDebugPasses to true.\");\r\n            return;\r\n        }\r\n        if (enabled === this.scene.iblCdfGenerator.debugEnabled) {\r\n            return;\r\n        }\r\n        this.scene.iblCdfGenerator.debugEnabled = enabled;\r\n        if (enabled) {\r\n            this._enableEffect(this.scene.iblCdfGenerator.debugPassName, this.cameras);\r\n        } else {\r\n            this._disableEffect(this.scene.iblCdfGenerator.debugPassName, this.cameras);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * This displays the voxel grid in slices spread across the screen.\r\n     * It also displays what slices of the model are stored in each layer\r\n     * of the voxel grid. Each red stripe represents one layer while each gradient\r\n     * (from bright red to black) represents the layers rendered in a single draw call.\r\n     */\r\n    public get voxelDebugEnabled(): boolean {\r\n        return this._voxelRenderer?.voxelDebugEnabled;\r\n    }\r\n\r\n    public set voxelDebugEnabled(enabled: boolean) {\r\n        if (!this._voxelRenderer) {\r\n            return;\r\n        }\r\n        if (enabled && !this.allowDebugPasses) {\r\n            Logger.Warn(\"Can't enable voxel debug view without setting allowDebugPasses to true.\");\r\n            return;\r\n        }\r\n        this._voxelRenderer.voxelDebugEnabled = enabled;\r\n        if (enabled) {\r\n            this._enableEffect(this._voxelRenderer.debugPassName, this.cameras);\r\n        } else {\r\n            this._disableEffect(this._voxelRenderer.debugPassName, this.cameras);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * When using tri-planar voxelization (the default), this value can be used to\r\n     * display only the voxelization result for that axis. z-axis = 0, y-axis = 1, x-axis = 2\r\n     */\r\n    public get voxelDebugAxis(): number {\r\n        return this._voxelRenderer?.voxelDebugAxis;\r\n    }\r\n\r\n    public set voxelDebugAxis(axisNum: number) {\r\n        if (!this._voxelRenderer) {\r\n            return;\r\n        }\r\n        this._voxelRenderer.voxelDebugAxis = axisNum;\r\n    }\r\n\r\n    /**\r\n     * Displays a given mip of the voxel grid. `voxelDebugAxis` must be undefined in this\r\n     * case because we only generate mips for the combined voxel grid.\r\n     */\r\n    public set voxelDebugDisplayMip(mipNum: number) {\r\n        if (!this._voxelRenderer) {\r\n            return;\r\n        }\r\n        this._voxelRenderer.setDebugMipNumber(mipNum);\r\n    }\r\n\r\n    /**\r\n     * Display the debug view for just the shadow samples taken this frame.\r\n     */\r\n    public get voxelTracingDebugEnabled(): boolean {\r\n        return this._voxelTracingPass?.debugEnabled;\r\n    }\r\n\r\n    public set voxelTracingDebugEnabled(enabled: boolean) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        if (enabled && !this.allowDebugPasses) {\r\n            Logger.Warn(\"Can't enable voxel tracing debug view without setting allowDebugPasses to true.\");\r\n            return;\r\n        }\r\n        if (enabled === this._voxelTracingPass.debugEnabled) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.debugEnabled = enabled;\r\n        if (enabled) {\r\n            this._enableEffect(this._voxelTracingPass.debugPassName, this.cameras);\r\n        } else {\r\n            this._disableEffect(this._voxelTracingPass.debugPassName, this.cameras);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Display the debug view for the spatial blur pass\r\n     */\r\n    public get spatialBlurPassDebugEnabled(): boolean {\r\n        return this._spatialBlurPass.debugEnabled;\r\n    }\r\n\r\n    public set spatialBlurPassDebugEnabled(enabled: boolean) {\r\n        if (!this._spatialBlurPass) {\r\n            return;\r\n        }\r\n        if (enabled && !this.allowDebugPasses) {\r\n            Logger.Warn(\"Can't enable spatial blur debug view without setting allowDebugPasses to true.\");\r\n            return;\r\n        }\r\n        if (enabled === this._spatialBlurPass.debugEnabled) {\r\n            return;\r\n        }\r\n        this._spatialBlurPass.debugEnabled = enabled;\r\n        if (enabled) {\r\n            this._enableEffect(this._spatialBlurPass.debugPassName, this.cameras);\r\n        } else {\r\n            this._disableEffect(this._spatialBlurPass.debugPassName, this.cameras);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Display the debug view for the shadows accumulated over time.\r\n     */\r\n    public get accumulationPassDebugEnabled(): boolean {\r\n        return this._accumulationPass?.debugEnabled;\r\n    }\r\n\r\n    public set accumulationPassDebugEnabled(enabled: boolean) {\r\n        if (!this._accumulationPass) {\r\n            return;\r\n        }\r\n        if (enabled && !this.allowDebugPasses) {\r\n            Logger.Warn(\"Can't enable accumulation pass debug view without setting allowDebugPasses to true.\");\r\n            return;\r\n        }\r\n        if (enabled === this._accumulationPass.debugEnabled) {\r\n            return;\r\n        }\r\n        this._accumulationPass.debugEnabled = enabled;\r\n        if (enabled) {\r\n            this._enableEffect(this._accumulationPass.debugPassName, this.cameras);\r\n        } else {\r\n            this._disableEffect(this._accumulationPass.debugPassName, this.cameras);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a mesh to be used for shadow-casting in the IBL shadow pipeline.\r\n     * These meshes will be written to the voxel grid.\r\n     * @param mesh A mesh or list of meshes that you want to cast shadows\r\n     */\r\n    public addShadowCastingMesh(mesh: Mesh | Mesh[]): void {\r\n        if (Array.isArray(mesh)) {\r\n            for (const m of mesh) {\r\n                if (m && this._shadowCastingMeshes.indexOf(m) === -1) {\r\n                    this._shadowCastingMeshes.push(m);\r\n                }\r\n            }\r\n        } else {\r\n            if (mesh && this._shadowCastingMeshes.indexOf(mesh) === -1) {\r\n                this._shadowCastingMeshes.push(mesh);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove a mesh from the shadow-casting list. The mesh will no longer be written\r\n     * to the voxel grid and will not cast shadows.\r\n     * @param mesh The mesh or list of meshes that you don't want to cast shadows.\r\n     */\r\n    public removeShadowCastingMesh(mesh: Mesh | Mesh[]): void {\r\n        if (Array.isArray(mesh)) {\r\n            for (const m of mesh) {\r\n                const index = this._shadowCastingMeshes.indexOf(m);\r\n                if (index !== -1) {\r\n                    this._shadowCastingMeshes.splice(index, 1);\r\n                }\r\n            }\r\n        } else {\r\n            const index = this._shadowCastingMeshes.indexOf(mesh);\r\n            if (index !== -1) {\r\n                this._shadowCastingMeshes.splice(index, 1);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the list of shadow-casting meshes. This will remove all meshes from the list\r\n     */\r\n    public clearShadowCastingMeshes(): void {\r\n        this._shadowCastingMeshes.length = 0;\r\n    }\r\n\r\n    /**\r\n     * The exponent of the resolution of the voxel shadow grid. Higher resolutions will result in sharper\r\n     * shadows but are more expensive to compute and require more memory.\r\n     * The resolution is calculated as 2 to the power of this number.\r\n     */\r\n    public get resolutionExp() {\r\n        return this._voxelRenderer.voxelResolutionExp;\r\n    }\r\n\r\n    public set resolutionExp(newResolution: number) {\r\n        if (newResolution === this._voxelRenderer.voxelResolutionExp) {\r\n            return;\r\n        }\r\n        if (this._voxelRenderer.isVoxelizationInProgress()) {\r\n            Logger.Warn(\"Can't change the resolution of the voxel grid while voxelization is in progress.\");\r\n            return;\r\n        }\r\n        this._voxelRenderer.voxelResolutionExp = Math.max(1, Math.min(newResolution, 8));\r\n        this._accumulationPass.reset = true;\r\n    }\r\n\r\n    /**\r\n     * The number of different directions to sample during the voxel tracing pass\r\n     */\r\n    public get sampleDirections() {\r\n        return this._voxelTracingPass?.sampleDirections;\r\n    }\r\n\r\n    /**\r\n     * The number of different directions to sample during the voxel tracing pass\r\n     */\r\n    public set sampleDirections(value: number) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.sampleDirections = value;\r\n    }\r\n\r\n    /**\r\n     * The decree to which the shadows persist between frames. 0.0 is no persistence, 1.0 is full persistence.\r\n     **/\r\n    public get shadowRemanence(): number {\r\n        return this._accumulationPass?.remanence;\r\n    }\r\n\r\n    /**\r\n     * The decree to which the shadows persist between frames. 0.0 is no persistence, 1.0 is full persistence.\r\n     **/\r\n    public set shadowRemanence(value: number) {\r\n        if (!this._accumulationPass) {\r\n            return;\r\n        }\r\n        this._accumulationPass.remanence = value;\r\n    }\r\n\r\n    /**\r\n     * The global Y-axis rotation of the IBL for shadows. This should match the Y-rotation of the environment map applied to materials, skybox, etc.\r\n     */\r\n    public get envRotation() {\r\n        return this._voxelTracingPass?.envRotation;\r\n    }\r\n\r\n    /**\r\n     * The global Y-axis rotation of the IBL for shadows. This should match the Y-rotation of the environment map applied to materials, skybox, etc.\r\n     */\r\n    public set envRotation(value: number) {\r\n        if (!this._voxelTracingPass) {\r\n            return;\r\n        }\r\n        this._voxelTracingPass.envRotation = value;\r\n        this._accumulationPass.reset = true;\r\n    }\r\n\r\n    /**\r\n     * Allow debug passes to be enabled. Default is false.\r\n     */\r\n    public get allowDebugPasses(): boolean {\r\n        return this._allowDebugPasses;\r\n    }\r\n\r\n    /**\r\n     * Allow debug passes to be enabled. Default is false.\r\n     */\r\n    public set allowDebugPasses(value: boolean) {\r\n        if (this._allowDebugPasses === value) {\r\n            return;\r\n        }\r\n        this._allowDebugPasses = value;\r\n        if (value && this.scene.iblCdfGenerator) {\r\n            if (this.scene.iblCdfGenerator.isReady()) {\r\n                this._createDebugPasses();\r\n            } else {\r\n                this.scene.iblCdfGenerator.onGeneratedObservable.addOnce(() => {\r\n                    this._createDebugPasses();\r\n                });\r\n            }\r\n        } else {\r\n            this._disposeDebugPasses();\r\n        }\r\n    }\r\n\r\n    /**\r\n     *  Support test.\r\n     */\r\n    public static get IsSupported(): boolean {\r\n        const engine = EngineStore.LastCreatedEngine;\r\n        if (!engine) {\r\n            return false;\r\n        }\r\n        return engine._features.supportIBLShadows;\r\n    }\r\n\r\n    /**\r\n     * Toggle the shadow tracing on or off\r\n     * @param enabled Toggle the shadow tracing on or off\r\n     */\r\n    public toggleShadow(enabled: boolean) {\r\n        this._enabled = enabled;\r\n        this._voxelTracingPass.enabled = enabled;\r\n        this._spatialBlurPass.enabled = enabled;\r\n        this._accumulationPass.enabled = enabled;\r\n        for (const mat of this._materialsWithRenderPlugin) {\r\n            if (mat.pluginManager) {\r\n                const plugin = mat.pluginManager.getPlugin(IBLShadowsPluginMaterial.Name) as IBLShadowsPluginMaterial;\r\n                plugin.isEnabled = enabled;\r\n            }\r\n        }\r\n        this._setPluginParameters();\r\n    }\r\n\r\n    /**\r\n     * Trigger the scene to be re-voxelized. This should be run when any shadow-casters have been added, removed or moved.\r\n     */\r\n    public updateVoxelization() {\r\n        if (this._shadowCastingMeshes.length === 0) {\r\n            Logger.Warn(\"IBL Shadows: updateVoxelization called with no shadow-casting meshes to voxelize.\");\r\n            return;\r\n        }\r\n        this._voxelRenderer.updateVoxelGrid(this._shadowCastingMeshes);\r\n        this._voxelRenderer.onVoxelizationCompleteObservable.addOnce(() => {\r\n            this.onVoxelizationCompleteObservable.notifyObservers();\r\n        });\r\n        this._updateSsShadowParams();\r\n    }\r\n\r\n    /**\r\n     * Trigger the scene bounds of shadow-casters to be calculated. This is the world size that the voxel grid will cover and will always be a cube.\r\n     */\r\n    public updateSceneBounds() {\r\n        const bounds: { min: Vector3; max: Vector3 } = {\r\n            min: new Vector3(Number.MAX_VALUE, Number.MAX_VALUE, Number.MAX_VALUE),\r\n            max: new Vector3(-Number.MAX_VALUE, -Number.MAX_VALUE, -Number.MAX_VALUE),\r\n        };\r\n        for (const mesh of this._shadowCastingMeshes) {\r\n            const localBounds = mesh.getHierarchyBoundingVectors(true);\r\n            bounds.min = Vector3.Minimize(bounds.min, localBounds.min);\r\n            bounds.max = Vector3.Maximize(bounds.max, localBounds.max);\r\n        }\r\n\r\n        const size = bounds.max.subtract(bounds.min);\r\n        this.voxelGridSize = Math.max(size.x, size.y, size.z);\r\n        if (this._shadowCastingMeshes.length === 0 || !isFinite(this.voxelGridSize) || this.voxelGridSize === 0) {\r\n            Logger.Warn(\"IBL Shadows: Scene size is invalid. Can't update bounds.\");\r\n            this.voxelGridSize = 1.0;\r\n            return;\r\n        }\r\n        const halfSize = this.voxelGridSize / 2.0;\r\n        const centre = bounds.max.add(bounds.min).multiplyByFloats(-0.5, -0.5, -0.5);\r\n        const invWorldScaleMatrix = Matrix.Compose(new Vector3(1.0 / halfSize, 1.0 / halfSize, 1.0 / halfSize), new Quaternion(), new Vector3(0, 0, 0));\r\n        const invTranslationMatrix = Matrix.Compose(new Vector3(1.0, 1.0, 1.0), new Quaternion(), centre);\r\n        invTranslationMatrix.multiplyToRef(invWorldScaleMatrix, invWorldScaleMatrix);\r\n        this._voxelTracingPass.setWorldScaleMatrix(invWorldScaleMatrix);\r\n        this._voxelRenderer.setWorldScaleMatrix(invWorldScaleMatrix);\r\n        // Set world scale for spatial blur.\r\n        this._spatialBlurPass.setWorldScale(halfSize * 2.0);\r\n        this._updateSsShadowParams();\r\n    }\r\n\r\n    /**\r\n     * @param name The rendering pipeline name\r\n     * @param scene The scene linked to this pipeline\r\n     * @param options Options to configure the pipeline\r\n     * @param cameras Cameras to apply the pipeline to.\r\n     */\r\n    constructor(name: string, scene: Scene, options: Partial<IIblShadowsSettings> = {}, cameras?: Camera[]) {\r\n        super(scene.getEngine(), name);\r\n        this.scene = scene;\r\n        this._cameras = cameras || [scene.activeCamera!];\r\n        // Create the dummy textures to be used when the pipeline is not ready\r\n        const blackPixels = new Uint8Array([0, 0, 0, 255]);\r\n        this._dummyTexture2d = new RawTexture(blackPixels, 1, 1, Engine.TEXTUREFORMAT_RGBA, scene, false);\r\n        this._dummyTexture3d = new RawTexture3D(blackPixels, 1, 1, 1, Engine.TEXTUREFORMAT_RGBA, scene, false);\r\n\r\n        // Setup the geometry buffer target formats\r\n        const textureTypesAndFormats: { [key: number]: { textureType: number; textureFormat: number } } = {};\r\n        textureTypesAndFormats[GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE] = { textureFormat: Constants.TEXTUREFORMAT_R, textureType: Constants.TEXTURETYPE_FLOAT };\r\n        textureTypesAndFormats[GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE] = { textureFormat: Constants.TEXTUREFORMAT_RG, textureType: Constants.TEXTURETYPE_HALF_FLOAT };\r\n        textureTypesAndFormats[GeometryBufferRenderer.POSITION_TEXTURE_TYPE] = { textureFormat: Constants.TEXTUREFORMAT_RGBA, textureType: Constants.TEXTURETYPE_HALF_FLOAT };\r\n        textureTypesAndFormats[GeometryBufferRenderer.NORMAL_TEXTURE_TYPE] = { textureFormat: Constants.TEXTUREFORMAT_RGBA, textureType: Constants.TEXTURETYPE_HALF_FLOAT };\r\n        const geometryBufferRenderer = scene.enableGeometryBufferRenderer(undefined, Constants.TEXTUREFORMAT_DEPTH32_FLOAT, textureTypesAndFormats);\r\n        if (!geometryBufferRenderer) {\r\n            Logger.Error(\"Geometry buffer renderer is required for IBL shadows to work.\");\r\n            return;\r\n        }\r\n        this._geometryBufferRenderer = geometryBufferRenderer;\r\n        this._geometryBufferRenderer.enableScreenspaceDepth = true;\r\n        this._geometryBufferRenderer.enableVelocityLinear = true;\r\n        this._geometryBufferRenderer.enablePosition = true;\r\n        this._geometryBufferRenderer.enableNormal = true;\r\n        this._geometryBufferRenderer.generateNormalsInWorldSpace = true;\r\n        this.scene.enableIblCdfGenerator();\r\n        this.shadowOpacity = options.shadowOpacity || 0.8;\r\n        this._voxelRenderer = new _IblShadowsVoxelRenderer(\r\n            this.scene,\r\n            this,\r\n            options ? options.resolutionExp : 6,\r\n            options.triPlanarVoxelization !== undefined ? options.triPlanarVoxelization : true\r\n        );\r\n        this._voxelTracingPass = new _IblShadowsVoxelTracingPass(this.scene, this);\r\n        this._spatialBlurPass = new _IblShadowsSpatialBlurPass(this.scene, this);\r\n        this._accumulationPass = new _IblShadowsAccumulationPass(this.scene, this);\r\n        this._accumulationPass.onReadyObservable.addOnce(() => {\r\n            this.onShadowTextureReadyObservable.notifyObservers();\r\n        });\r\n        this.sampleDirections = options.sampleDirections || 2;\r\n        this.voxelShadowOpacity = options.voxelShadowOpacity ?? 1.0;\r\n        this.envRotation = options.envRotation ?? 0.0;\r\n        this.shadowRenderSizeFactor = options.shadowRenderSizeFactor || 1.0;\r\n        this.ssShadowOpacity = options.ssShadowsEnabled === undefined || options.ssShadowsEnabled ? 1.0 : 0.0;\r\n        this.ssShadowDistanceScale = options.ssShadowDistanceScale || 1.25;\r\n        this.ssShadowSampleCount = options.ssShadowSampleCount || 16;\r\n        this.ssShadowStride = options.ssShadowStride || 8;\r\n        this.ssShadowThicknessScale = options.ssShadowThicknessScale || 1.0;\r\n        this.shadowRemanence = options.shadowRemanence ?? 0.75;\r\n        this._noiseTexture = new Texture(\r\n            Tools.GetAssetUrl(\"https://assets.babylonjs.com/core/blue_noise/blue_noise_rgb.png\"),\r\n            this.scene,\r\n            false,\r\n            true,\r\n            Constants.TEXTURE_NEAREST_SAMPLINGMODE\r\n        );\r\n\r\n        scene.postProcessRenderPipelineManager.addPipeline(this);\r\n\r\n        this.scene.onActiveCameraChanged.add(this._listenForCameraChanges.bind(this));\r\n        this.scene.onBeforeRenderObservable.add(this._updateBeforeRender.bind(this));\r\n\r\n        this._listenForCameraChanges();\r\n        this.scene.getEngine().onResizeObservable.add(this._handleResize.bind(this));\r\n\r\n        // Assigning the shadow texture to the materials needs to be done after the RT's are created.\r\n        if (this.scene.iblCdfGenerator) {\r\n            this.scene.iblCdfGenerator.onGeneratedObservable.add(() => {\r\n                this._setPluginParameters();\r\n                this.onNewIblReadyObservable.notifyObservers();\r\n            });\r\n        }\r\n    }\r\n\r\n    private _handleResize() {\r\n        this._voxelRenderer.resize();\r\n        this._voxelTracingPass.resize(this.shadowRenderSizeFactor);\r\n        this._spatialBlurPass.resize(this.shadowRenderSizeFactor);\r\n        this._accumulationPass.resize(this.shadowRenderSizeFactor);\r\n        this._setPluginParameters();\r\n    }\r\n\r\n    private _getGBufferDebugPass(): PostProcess {\r\n        if (this._gbufferDebugPass) {\r\n            return this._gbufferDebugPass;\r\n        }\r\n        const isWebGPU = this.engine.isWebGPU;\r\n        const textureNames: string[] = [\"depthSampler\", \"normalSampler\", \"positionSampler\", \"velocitySampler\"];\r\n\r\n        const options: PostProcessOptions = {\r\n            width: this.scene.getEngine().getRenderWidth(),\r\n            height: this.scene.getEngine().getRenderHeight(),\r\n            samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            engine: this.scene.getEngine(),\r\n            textureType: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            textureFormat: Constants.TEXTUREFORMAT_RGBA,\r\n            uniforms: [\"sizeParams\"],\r\n            samplers: textureNames,\r\n            reusable: false,\r\n            shaderLanguage: isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n            extraInitializations: (useWebGPU: boolean, list: Promise<any>[]) => {\r\n                if (useWebGPU) {\r\n                    list.push(import(\"../../ShadersWGSL/iblShadowGBufferDebug.fragment\"));\r\n                } else {\r\n                    list.push(import(\"../../Shaders/iblShadowGBufferDebug.fragment\"));\r\n                }\r\n            },\r\n        };\r\n        this._gbufferDebugPass = new PostProcess(\"iblShadowGBufferDebug\", \"iblShadowGBufferDebug\", options);\r\n        if (this.engine.isWebGPU) {\r\n            this._gbufferDebugPass.samples = (this.engine as WebGPUEngine).currentSampleCount ?? 1;\r\n        }\r\n        this._gbufferDebugPass.autoClear = false;\r\n        this._gbufferDebugPass.onApplyObservable.add((effect) => {\r\n            const depthIndex = this._geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.SCREENSPACE_DEPTH_TEXTURE_TYPE);\r\n            effect.setTexture(\"depthSampler\", this._geometryBufferRenderer.getGBuffer().textures[depthIndex]);\r\n            const normalIndex = this._geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE);\r\n            effect.setTexture(\"normalSampler\", this._geometryBufferRenderer.getGBuffer().textures[normalIndex]);\r\n            const positionIndex = this._geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.POSITION_TEXTURE_TYPE);\r\n            effect.setTexture(\"positionSampler\", this._geometryBufferRenderer.getGBuffer().textures[positionIndex]);\r\n            const velocityIndex = this._geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.VELOCITY_LINEAR_TEXTURE_TYPE);\r\n            effect.setTexture(\"velocitySampler\", this._geometryBufferRenderer.getGBuffer().textures[velocityIndex]);\r\n            effect.setVector4(\"sizeParams\", this._gBufferDebugSizeParams);\r\n            if (this.scene.activeCamera) {\r\n                effect.setFloat(\"maxDepth\", this.scene.activeCamera.maxZ);\r\n            }\r\n        });\r\n        return this._gbufferDebugPass;\r\n    }\r\n\r\n    private _createDebugPasses() {\r\n        if (this.scene.iblCdfGenerator) {\r\n            this._debugPasses = [{ pass: this.scene.iblCdfGenerator.getDebugPassPP(), enabled: this.cdfDebugEnabled }];\r\n        } else {\r\n            this._debugPasses = [];\r\n        }\r\n\r\n        this._debugPasses.push(\r\n            { pass: this._voxelRenderer.getDebugPassPP(), enabled: this.voxelDebugEnabled },\r\n            { pass: this._voxelTracingPass.getDebugPassPP(), enabled: this.voxelTracingDebugEnabled },\r\n            { pass: this._spatialBlurPass.getDebugPassPP(), enabled: this.spatialBlurPassDebugEnabled },\r\n            { pass: this._accumulationPass.getDebugPassPP(), enabled: this.accumulationPassDebugEnabled },\r\n            { pass: this._getGBufferDebugPass(), enabled: this.gbufferDebugEnabled }\r\n        );\r\n        for (let i = 0; i < this._debugPasses.length; i++) {\r\n            if (!this._debugPasses[i].pass) {\r\n                continue;\r\n            }\r\n            this.addEffect(\r\n                new PostProcessRenderEffect(\r\n                    this.scene.getEngine(),\r\n                    this._debugPasses[i].pass.name,\r\n                    () => {\r\n                        return this._debugPasses[i].pass;\r\n                    },\r\n                    true\r\n                )\r\n            );\r\n        }\r\n        const cameras = this.cameras.slice();\r\n        this.scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this.name, this.cameras);\r\n        this.scene.postProcessRenderPipelineManager.attachCamerasToRenderPipeline(this.name, cameras);\r\n        for (let i = 0; i < this._debugPasses.length; i++) {\r\n            if (!this._debugPasses[i].pass) {\r\n                continue;\r\n            }\r\n            if (this._debugPasses[i].enabled) {\r\n                this._enableEffect(this._debugPasses[i].pass.name, this.cameras);\r\n            } else {\r\n                this._disableEffect(this._debugPasses[i].pass.name, this.cameras);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _disposeEffectPasses() {\r\n        this.scene.postProcessRenderPipelineManager.detachCamerasFromRenderPipeline(this.name, this.cameras);\r\n        this._disposeDebugPasses();\r\n        this._reset();\r\n    }\r\n\r\n    private _disposeDebugPasses() {\r\n        for (let i = 0; i < this._debugPasses.length; i++) {\r\n            this._disableEffect(this._debugPasses[i].pass.name, this.cameras);\r\n            this._debugPasses[i].pass.dispose();\r\n        }\r\n        this._debugPasses = [];\r\n    }\r\n\r\n    private _updateDebugPasses() {\r\n        let count = 0;\r\n        if (this._gbufferDebugEnabled) {\r\n            count++;\r\n        }\r\n        if (this.cdfDebugEnabled) {\r\n            count++;\r\n        }\r\n        if (this.voxelDebugEnabled) {\r\n            count++;\r\n        }\r\n        if (this.voxelTracingDebugEnabled) {\r\n            count++;\r\n        }\r\n        if (this.spatialBlurPassDebugEnabled) {\r\n            count++;\r\n        }\r\n        if (this.accumulationPassDebugEnabled) {\r\n            count++;\r\n        }\r\n\r\n        const rows = Math.ceil(Math.sqrt(count));\r\n        const cols = Math.ceil(count / rows);\r\n        const width = 1.0 / cols;\r\n        const height = 1.0 / rows;\r\n        let x = 0;\r\n        let y = 0;\r\n        if (this.gbufferDebugEnabled) {\r\n            this._gBufferDebugSizeParams.set(x, y, cols, rows);\r\n            x -= width;\r\n            if (x <= -1) {\r\n                x = 0;\r\n                y -= height;\r\n            }\r\n        }\r\n\r\n        if (this.cdfDebugEnabled && this.scene.iblCdfGenerator) {\r\n            this.scene.iblCdfGenerator.setDebugDisplayParams(x, y, cols, rows);\r\n            x -= width;\r\n            if (x <= -1) {\r\n                x = 0;\r\n                y -= height;\r\n            }\r\n        }\r\n        if (this.voxelDebugEnabled) {\r\n            this._voxelRenderer.setDebugDisplayParams(x, y, cols, rows);\r\n            x -= width;\r\n            if (x <= -1) {\r\n                x = 0;\r\n                y -= height;\r\n            }\r\n        }\r\n        if (this.voxelTracingDebugEnabled) {\r\n            this._voxelTracingPass.setDebugDisplayParams(x, y, cols, rows);\r\n            x -= width;\r\n            if (x <= -1) {\r\n                x = 0;\r\n                y -= height;\r\n            }\r\n        }\r\n        if (this.spatialBlurPassDebugEnabled) {\r\n            this._spatialBlurPass.setDebugDisplayParams(x, y, cols, rows);\r\n            x -= width;\r\n            if (x <= -1) {\r\n                x = 0;\r\n                y -= height;\r\n            }\r\n        }\r\n        if (this.accumulationPassDebugEnabled) {\r\n            this._accumulationPass.setDebugDisplayParams(x, y, cols, rows);\r\n            x -= width;\r\n            if (x <= -1) {\r\n                x = 0;\r\n                y -= height;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Update the SS shadow max distance and thickness based on the voxel grid size and resolution.\r\n     * The max distance should be just a little larger than the world size of a single voxel.\r\n     */\r\n    private _updateSsShadowParams(): void {\r\n        this._voxelTracingPass.sssMaxDist = (this._sssMaxDistScale * this.voxelGridSize) / (1 << this.resolutionExp);\r\n        this._voxelTracingPass.sssThickness = this._sssThicknessScale * 0.005 * this.voxelGridSize;\r\n    }\r\n\r\n    /**\r\n     * Apply the shadows to a material or array of materials. If no material is provided, all\r\n     * materials in the scene will be added.\r\n     * @param material Material that will be affected by the shadows. If not provided, all materials of the scene will be affected.\r\n     */\r\n    public addShadowReceivingMaterial(material?: Material | Material[]) {\r\n        if (material) {\r\n            if (Array.isArray(material)) {\r\n                for (const m of material) {\r\n                    this._addShadowSupportToMaterial(m);\r\n                }\r\n            } else {\r\n                this._addShadowSupportToMaterial(material);\r\n            }\r\n        } else {\r\n            for (const mat of this.scene.materials) {\r\n                this._addShadowSupportToMaterial(mat);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Remove a material from the list of materials that receive shadows. If no material\r\n     * is provided, all materials in the scene will be removed.\r\n     * @param material The material or array of materials that will no longer receive shadows\r\n     */\r\n    public removeShadowReceivingMaterial(material: Material | Material[]) {\r\n        if (Array.isArray(material)) {\r\n            for (const m of material) {\r\n                const matIndex = this._materialsWithRenderPlugin.indexOf(m);\r\n                if (matIndex !== -1) {\r\n                    this._materialsWithRenderPlugin.splice(matIndex, 1);\r\n                    // eslint-disable-next-line @typescript-eslint/no-non-null-asserted-optional-chain\r\n                    const plugin = m.pluginManager?.getPlugin<IBLShadowsPluginMaterial>(IBLShadowsPluginMaterial.Name)!;\r\n                    plugin.isEnabled = false;\r\n                }\r\n            }\r\n        } else {\r\n            const matIndex = this._materialsWithRenderPlugin.indexOf(material);\r\n            if (matIndex !== -1) {\r\n                this._materialsWithRenderPlugin.splice(matIndex, 1);\r\n                const plugin = material.pluginManager!.getPlugin<IBLShadowsPluginMaterial>(IBLShadowsPluginMaterial.Name)!;\r\n                plugin.isEnabled = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clear the list of materials that receive shadows. This will remove all materials from the list\r\n     */\r\n    public clearShadowReceivingMaterials() {\r\n        for (const mat of this._materialsWithRenderPlugin) {\r\n            const plugin = mat.pluginManager?.getPlugin<IBLShadowsPluginMaterial>(IBLShadowsPluginMaterial.Name);\r\n            if (plugin) {\r\n                plugin.isEnabled = false;\r\n            }\r\n        }\r\n        this._materialsWithRenderPlugin.length = 0;\r\n    }\r\n\r\n    protected _addShadowSupportToMaterial(material: Material) {\r\n        if (!(material instanceof PBRBaseMaterial) && !(material instanceof StandardMaterial) && !(material instanceof OpenPBRMaterial)) {\r\n            return;\r\n        }\r\n        let plugin = material.pluginManager?.getPlugin<IBLShadowsPluginMaterial>(IBLShadowsPluginMaterial.Name);\r\n        if (!plugin) {\r\n            plugin = new IBLShadowsPluginMaterial(material);\r\n        }\r\n        if (this._materialsWithRenderPlugin.indexOf(material) !== -1) {\r\n            return;\r\n        }\r\n\r\n        if (this._enabled) {\r\n            plugin.iblShadowsTexture = this._getAccumulatedTexture().getInternalTexture()!;\r\n            plugin.shadowOpacity = this.shadowOpacity;\r\n        }\r\n\r\n        plugin.isEnabled = this._enabled;\r\n        plugin.isColored = this._coloredShadows;\r\n\r\n        this._materialsWithRenderPlugin.push(material);\r\n    }\r\n\r\n    protected _setPluginParameters() {\r\n        if (!this._enabled) {\r\n            return;\r\n        }\r\n\r\n        for (const mat of this._materialsWithRenderPlugin) {\r\n            if (mat.pluginManager) {\r\n                const plugin = mat.pluginManager.getPlugin<IBLShadowsPluginMaterial>(IBLShadowsPluginMaterial.Name)!;\r\n                plugin.iblShadowsTexture = this._getAccumulatedTexture().getInternalTexture()!;\r\n                plugin.shadowOpacity = this.shadowOpacity;\r\n                plugin.isColored = this._coloredShadows;\r\n            }\r\n        }\r\n    }\r\n\r\n    private _updateBeforeRender() {\r\n        this._updateDebugPasses();\r\n    }\r\n\r\n    private _listenForCameraChanges() {\r\n        // We want to listen for camera changes and change settings while the camera is moving.\r\n        this.scene.activeCamera?.onViewMatrixChangedObservable.add(() => {\r\n            this._accumulationPass.isMoving = true;\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Checks if the IBL shadow pipeline is ready to render shadows\r\n     * @returns true if the IBL shadow pipeline is ready to render the shadows\r\n     */\r\n    public isReady() {\r\n        return (\r\n            this._noiseTexture.isReady() &&\r\n            this._voxelRenderer.isReady() &&\r\n            this.scene.iblCdfGenerator &&\r\n            this.scene.iblCdfGenerator.isReady() &&\r\n            (!this._voxelTracingPass || this._voxelTracingPass.isReady()) &&\r\n            (!this._spatialBlurPass || this._spatialBlurPass.isReady()) &&\r\n            (!this._accumulationPass || this._accumulationPass.isReady())\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Get the class name\r\n     * @returns \"IBLShadowsRenderPipeline\"\r\n     */\r\n    public override getClassName(): string {\r\n        return \"IBLShadowsRenderPipeline\";\r\n    }\r\n\r\n    /**\r\n     * Disposes the IBL shadow pipeline and associated resources\r\n     */\r\n    public override dispose() {\r\n        const materials = this._materialsWithRenderPlugin.splice(0);\r\n        for (const mat of materials) {\r\n            this.removeShadowReceivingMaterial(mat);\r\n        }\r\n        this._disposeEffectPasses();\r\n        this._noiseTexture.dispose();\r\n        this._voxelRenderer.dispose();\r\n        this._voxelTracingPass.dispose();\r\n        this._spatialBlurPass.dispose();\r\n        this._accumulationPass.dispose();\r\n        this._dummyTexture2d.dispose();\r\n        this._dummyTexture3d.dispose();\r\n        this.onNewIblReadyObservable.clear();\r\n        this.onShadowTextureReadyObservable.clear();\r\n        this.onVoxelizationCompleteObservable.clear();\r\n        super.dispose();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9140, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/prePassRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/prePassRenderer.ts"],"sourcesContent":["import { PrePassRenderTarget } from \"../Materials/Textures/prePassRenderTarget\";\r\nimport type { Scene } from \"../scene\";\r\nimport type { AbstractEngine } from \"../Engines/abstractEngine\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { PostProcess } from \"../PostProcesses/postProcess\";\r\nimport type { Effect } from \"../Materials/effect\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport { Color4 } from \"../Maths/math.color\";\r\nimport type { Nullable } from \"../types\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport { Material } from \"../Materials/material\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport { GeometryBufferRenderer } from \"../Rendering/geometryBufferRenderer\";\r\n\r\nimport \"../Engines/Extensions/engine.multiRender\";\r\n\r\n/**\r\n * Renders a pre pass of the scene\r\n * This means every mesh in the scene will be rendered to a render target texture\r\n * And then this texture will be composited to the rendering canvas with post processes\r\n * It is necessary for effects like subsurface scattering or deferred shading\r\n */\r\nexport class PrePassRenderer {\r\n    /**\r\n     * @internal\r\n     */\r\n    public static _SceneComponentInitialization: (scene: Scene) => void = (_) => {\r\n        throw _WarnImport(\"PrePassRendererSceneComponent\");\r\n    };\r\n\r\n    /**\r\n     * To save performance, we can excluded skinned meshes from the prepass\r\n     */\r\n    public excludedSkinnedMesh: AbstractMesh[] = [];\r\n\r\n    /**\r\n     * Force material to be excluded from the prepass\r\n     * Can be useful when `useGeometryBufferFallback` is set to `true`\r\n     * and you don't want a material to show in the effect.\r\n     */\r\n    public excludedMaterials: Material[] = [];\r\n\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n\r\n    /**\r\n     * Number of textures in the multi render target texture where the scene is directly rendered\r\n     */\r\n    public mrtCount: number = 0;\r\n\r\n    private _mrtTypes: number[] = [];\r\n    private _mrtFormats: number[] = [];\r\n    private _mrtLayout: number[] = [];\r\n    private _mrtNames: string[] = [];\r\n    private _textureIndices: number[] = [];\r\n\r\n    private _multiRenderAttachments: number[];\r\n    private _defaultAttachments: number[];\r\n    private _clearAttachments: number[];\r\n    private _clearDepthAttachments: number[];\r\n    private _generateNormalsInWorldSpace = false;\r\n\r\n    /**\r\n     * Indicates if the prepass renderer is generating normals in world space or camera space (default: camera space)\r\n     */\r\n    public get generateNormalsInWorldSpace() {\r\n        return this._generateNormalsInWorldSpace;\r\n    }\r\n\r\n    public set generateNormalsInWorldSpace(value: boolean) {\r\n        if (this._generateNormalsInWorldSpace === value) {\r\n            return;\r\n        }\r\n\r\n        this._generateNormalsInWorldSpace = value;\r\n        this._markAllMaterialsAsPrePassDirty();\r\n    }\r\n\r\n    /**\r\n     * Returns the index of a texture in the multi render target texture array.\r\n     * @param type Texture type\r\n     * @returns The index\r\n     */\r\n    public getIndex(type: number): number {\r\n        return this._textureIndices[type];\r\n    }\r\n\r\n    /**\r\n     * How many samples are used for MSAA of the scene render target\r\n     */\r\n    public get samples() {\r\n        return this.defaultRT.samples;\r\n    }\r\n\r\n    public set samples(n: number) {\r\n        this.defaultRT.samples = n;\r\n    }\r\n\r\n    private _useSpecificClearForDepthTexture = false;\r\n\r\n    /**\r\n     * If set to true (default: false), the depth texture will be cleared with the depth value corresponding to the far plane (1 in normal mode, 0 in reverse depth buffer mode)\r\n     * If set to false, the depth texture is always cleared with 0.\r\n     */\r\n    public get useSpecificClearForDepthTexture() {\r\n        return this._useSpecificClearForDepthTexture;\r\n    }\r\n\r\n    public set useSpecificClearForDepthTexture(value: boolean) {\r\n        if (this._useSpecificClearForDepthTexture === value) {\r\n            return;\r\n        }\r\n\r\n        this._useSpecificClearForDepthTexture = value;\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Describes the types and formats of the textures used by the pre-pass renderer\r\n     */\r\n    public static TextureFormats = [\r\n        {\r\n            purpose: Constants.PREPASS_IRRADIANCE_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Irradiance\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_POSITION_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Position\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_VELOCITY_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Velocity\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Reflectivity\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_COLOR_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Color\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_DEPTH_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_R,\r\n            name: \"prePass_Depth\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_NORMAL_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Normal\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_Albedo\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_WORLD_NORMAL_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_WorldNormal\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_LOCAL_POSITION_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_LocalPosition\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_SCREENSPACE_DEPTH_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_R,\r\n            name: \"prePass_ScreenDepth\",\r\n        },\r\n        {\r\n            purpose: Constants.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE,\r\n            type: Constants.TEXTURETYPE_HALF_FLOAT,\r\n            format: Constants.TEXTUREFORMAT_RGBA,\r\n            name: \"prePass_VelocityLinear\",\r\n        },\r\n    ];\r\n\r\n    private _isDirty: boolean = true;\r\n\r\n    /**\r\n     * The render target where the scene is directly rendered\r\n     */\r\n    public defaultRT: PrePassRenderTarget;\r\n\r\n    /**\r\n     * Configuration for prepass effects\r\n     */\r\n    private _effectConfigurations: PrePassEffectConfiguration[] = [];\r\n\r\n    /**\r\n     * @returns the prepass render target for the rendering pass.\r\n     * If we are currently rendering a render target, it returns the PrePassRenderTarget\r\n     * associated with that render target. Otherwise, it returns the scene default PrePassRenderTarget\r\n     */\r\n    public getRenderTarget(): PrePassRenderTarget {\r\n        return this._currentTarget;\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * Managed by the scene component\r\n     * @param prePassRenderTarget\r\n     */\r\n    public _setRenderTarget(prePassRenderTarget: Nullable<PrePassRenderTarget>): void {\r\n        if (prePassRenderTarget) {\r\n            this._currentTarget = prePassRenderTarget;\r\n        } else {\r\n            this._currentTarget = this.defaultRT;\r\n            this._engine.currentRenderPassId = this._scene.activeCamera?.renderPassId ?? this._currentTarget.renderPassId;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Returns true if the currently rendered prePassRenderTarget is the one\r\n     * associated with the scene.\r\n     */\r\n    public get currentRTisSceneRT(): boolean {\r\n        return this._currentTarget === this.defaultRT;\r\n    }\r\n\r\n    private _geometryBuffer: Nullable<GeometryBufferRenderer>;\r\n\r\n    /**\r\n     * Prevents the PrePassRenderer from using the GeometryBufferRenderer as a fallback\r\n     */\r\n    public doNotUseGeometryRendererFallback = true;\r\n\r\n    private _refreshGeometryBufferRendererLink() {\r\n        if (!this.doNotUseGeometryRendererFallback) {\r\n            this._geometryBuffer = this._scene.enableGeometryBufferRenderer();\r\n\r\n            if (!this._geometryBuffer) {\r\n                // Not supported\r\n                this.doNotUseGeometryRendererFallback = true;\r\n                return;\r\n            }\r\n\r\n            this._geometryBuffer._linkPrePassRenderer(this);\r\n        } else {\r\n            if (this._geometryBuffer) {\r\n                this._geometryBuffer._unlinkPrePassRenderer();\r\n            }\r\n            this._geometryBuffer = null;\r\n            this._scene.disableGeometryBufferRenderer();\r\n        }\r\n    }\r\n\r\n    private _currentTarget: PrePassRenderTarget;\r\n\r\n    /**\r\n     * All the render targets generated by prepass\r\n     */\r\n    public renderTargets: PrePassRenderTarget[] = [];\r\n\r\n    private readonly _clearColor = new Color4(0, 0, 0, 0);\r\n    private readonly _clearDepthColor = new Color4(0, 0, 0, 1); //  // sets an invalid value by default - depth in the depth texture is view.z, so 0 is not possible because view.z can't be less than camera.minZ\r\n\r\n    private _enabled: boolean = false;\r\n\r\n    private _needsCompositionForThisPass = false;\r\n    private _postProcessesSourceForThisPass: Nullable<PostProcess>[];\r\n\r\n    /**\r\n     * Indicates if the prepass is enabled\r\n     */\r\n    public get enabled() {\r\n        return this._enabled;\r\n    }\r\n\r\n    /**\r\n     * Set to true to disable gamma transform in PrePass.\r\n     * Can be useful in case you already proceed to gamma transform on a material level\r\n     * and your post processes don't need to be in linear color space.\r\n     */\r\n    public disableGammaTransform = false;\r\n\r\n    /**\r\n     * Instantiates a prepass renderer\r\n     * @param scene The scene\r\n     */\r\n    constructor(scene: Scene) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n\r\n        let type = Constants.TEXTURETYPE_UNSIGNED_BYTE;\r\n        if (this._engine._caps.textureFloat && this._engine._caps.textureFloatLinearFiltering) {\r\n            type = Constants.TEXTURETYPE_FLOAT;\r\n        } else if (this._engine._caps.textureHalfFloat && this._engine._caps.textureHalfFloatLinearFiltering) {\r\n            type = Constants.TEXTURETYPE_HALF_FLOAT;\r\n        }\r\n\r\n        for (let i = 0; i < PrePassRenderer.TextureFormats.length; ++i) {\r\n            const format = PrePassRenderer.TextureFormats[i].format;\r\n            if (PrePassRenderer.TextureFormats[i].type === Constants.TEXTURETYPE_FLOAT) {\r\n                PrePassRenderer.TextureFormats[i].type = type;\r\n                if (\r\n                    type === Constants.TEXTURETYPE_FLOAT &&\r\n                    (format === Constants.TEXTUREFORMAT_R || format === Constants.TEXTUREFORMAT_RG || format === Constants.TEXTUREFORMAT_RGBA) &&\r\n                    !this._engine._caps.supportFloatTexturesResolve\r\n                ) {\r\n                    // We don't know in advance if the texture will be used as a resolve target, so we revert to half_float if the extension to resolve full float textures is not supported\r\n                    PrePassRenderer.TextureFormats[i].type = Constants.TEXTURETYPE_HALF_FLOAT;\r\n                }\r\n            }\r\n        }\r\n\r\n        PrePassRenderer._SceneComponentInitialization(this._scene);\r\n        this.defaultRT = this._createRenderTarget(\"sceneprePassRT\", null);\r\n        this._currentTarget = this.defaultRT;\r\n    }\r\n\r\n    /**\r\n     * Creates a new PrePassRenderTarget\r\n     * This should be the only way to instantiate a `PrePassRenderTarget`\r\n     * @param name Name of the `PrePassRenderTarget`\r\n     * @param renderTargetTexture RenderTarget the `PrePassRenderTarget` will be attached to.\r\n     * Can be `null` if the created `PrePassRenderTarget` is attached to the scene (default framebuffer).\r\n     * @internal\r\n     */\r\n    public _createRenderTarget(name: string, renderTargetTexture: Nullable<RenderTargetTexture>): PrePassRenderTarget {\r\n        const rt = new PrePassRenderTarget(name, renderTargetTexture, { width: this._engine.getRenderWidth(), height: this._engine.getRenderHeight() }, 0, this._scene, {\r\n            generateMipMaps: false,\r\n            generateStencilBuffer: this._engine.isStencilEnable,\r\n            defaultType: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            types: [],\r\n            drawOnlyOnFirstAttachmentByDefault: true,\r\n        });\r\n\r\n        this.renderTargets.push(rt);\r\n\r\n        if (this._enabled) {\r\n            // The pre-pass renderer is already enabled, so make sure we create the render target with the correct number of textures\r\n            this._update();\r\n        }\r\n\r\n        return rt;\r\n    }\r\n\r\n    /**\r\n     * Indicates if rendering a prepass is supported\r\n     */\r\n    public get isSupported() {\r\n        return this._scene.getEngine().getCaps().drawBuffersExtension;\r\n    }\r\n\r\n    /**\r\n     * Sets the proper output textures to draw in the engine.\r\n     * @param effect The effect that is drawn. It can be or not be compatible with drawing to several output textures.\r\n     * @param subMesh Submesh on which the effect is applied\r\n     */\r\n    public bindAttachmentsForEffect(effect: Effect, subMesh: SubMesh) {\r\n        const material = subMesh.getMaterial();\r\n        const isPrePassCapable = material && material.isPrePassCapable;\r\n        const excluded = material && this.excludedMaterials.indexOf(material) !== -1;\r\n\r\n        if (this.enabled && this._currentTarget.enabled) {\r\n            if (effect._multiTarget && isPrePassCapable && !excluded) {\r\n                this._engine.bindAttachments(this._multiRenderAttachments);\r\n            } else {\r\n                if (this._engine._currentRenderTarget) {\r\n                    this._engine.bindAttachments(this._defaultAttachments);\r\n                } else {\r\n                    this._engine.restoreSingleAttachment();\r\n                }\r\n\r\n                if (this._geometryBuffer && this.currentRTisSceneRT && !excluded) {\r\n                    this._geometryBuffer.renderList!.push(subMesh.getRenderingMesh());\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    private _reinitializeAttachments() {\r\n        const multiRenderLayout = [];\r\n        const clearLayout = [false];\r\n        const clearDepthLayout = [false];\r\n        const defaultLayout = [true];\r\n\r\n        for (let i = 0; i < this.mrtCount; i++) {\r\n            multiRenderLayout.push(true);\r\n\r\n            if (i > 0) {\r\n                if (this._useSpecificClearForDepthTexture && this._mrtLayout[i] === Constants.PREPASS_DEPTH_TEXTURE_TYPE) {\r\n                    clearLayout.push(false);\r\n                    clearDepthLayout.push(true);\r\n                } else {\r\n                    clearLayout.push(true);\r\n                    clearDepthLayout.push(false);\r\n                }\r\n                defaultLayout.push(false);\r\n            }\r\n        }\r\n\r\n        this._multiRenderAttachments = this._engine.buildTextureLayout(multiRenderLayout);\r\n        this._clearAttachments = this._engine.buildTextureLayout(clearLayout);\r\n        this._clearDepthAttachments = this._engine.buildTextureLayout(clearDepthLayout);\r\n        this._defaultAttachments = this._engine.buildTextureLayout(defaultLayout);\r\n    }\r\n\r\n    private _resetLayout() {\r\n        for (let i = 0; i < PrePassRenderer.TextureFormats.length; i++) {\r\n            this._textureIndices[PrePassRenderer.TextureFormats[i].purpose] = -1;\r\n        }\r\n\r\n        this._textureIndices[Constants.PREPASS_COLOR_TEXTURE_TYPE] = 0;\r\n        this._mrtLayout = [Constants.PREPASS_COLOR_TEXTURE_TYPE];\r\n        this._mrtTypes = [PrePassRenderer.TextureFormats[Constants.PREPASS_COLOR_TEXTURE_TYPE].type];\r\n        this._mrtFormats = [PrePassRenderer.TextureFormats[Constants.PREPASS_COLOR_TEXTURE_TYPE].format];\r\n        this._mrtNames = [PrePassRenderer.TextureFormats[Constants.PREPASS_COLOR_TEXTURE_TYPE].name];\r\n        this.mrtCount = 1;\r\n    }\r\n\r\n    private _updateGeometryBufferLayout() {\r\n        this._refreshGeometryBufferRendererLink();\r\n\r\n        if (this._geometryBuffer) {\r\n            this._geometryBuffer._resetLayout();\r\n\r\n            const texturesActivated = [];\r\n\r\n            for (let i = 0; i < this._mrtLayout.length; i++) {\r\n                texturesActivated.push(false);\r\n            }\r\n\r\n            this._geometryBuffer._linkInternalTexture(this.defaultRT.getInternalTexture()!);\r\n\r\n            const matches = [\r\n                {\r\n                    prePassConstant: Constants.PREPASS_DEPTH_TEXTURE_TYPE,\r\n                    geometryBufferConstant: GeometryBufferRenderer.DEPTH_TEXTURE_TYPE,\r\n                },\r\n                {\r\n                    prePassConstant: Constants.PREPASS_NORMAL_TEXTURE_TYPE,\r\n                    geometryBufferConstant: GeometryBufferRenderer.NORMAL_TEXTURE_TYPE,\r\n                },\r\n                {\r\n                    prePassConstant: Constants.PREPASS_POSITION_TEXTURE_TYPE,\r\n                    geometryBufferConstant: GeometryBufferRenderer.POSITION_TEXTURE_TYPE,\r\n                },\r\n                {\r\n                    prePassConstant: Constants.PREPASS_REFLECTIVITY_TEXTURE_TYPE,\r\n                    geometryBufferConstant: GeometryBufferRenderer.REFLECTIVITY_TEXTURE_TYPE,\r\n                },\r\n                {\r\n                    prePassConstant: Constants.PREPASS_VELOCITY_TEXTURE_TYPE,\r\n                    geometryBufferConstant: GeometryBufferRenderer.VELOCITY_TEXTURE_TYPE,\r\n                },\r\n            ];\r\n\r\n            // replace textures in the geometryBuffer RT\r\n            for (let i = 0; i < matches.length; i++) {\r\n                const index = this._mrtLayout.indexOf(matches[i].prePassConstant);\r\n                if (index !== -1) {\r\n                    this._geometryBuffer._forceTextureType(matches[i].geometryBufferConstant, index);\r\n                    texturesActivated[index] = true;\r\n                }\r\n            }\r\n\r\n            this._geometryBuffer._setAttachments(this._engine.buildTextureLayout(texturesActivated));\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Restores attachments for single texture draw.\r\n     */\r\n    public restoreAttachments() {\r\n        if (this.enabled && this._currentTarget.enabled && this._defaultAttachments) {\r\n            if (this._engine._currentRenderTarget) {\r\n                this._engine.bindAttachments(this._defaultAttachments);\r\n            } else {\r\n                this._engine.restoreSingleAttachment();\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    public _beforeDraw(camera?: Camera, faceIndex?: number, layer?: number) {\r\n        // const previousEnabled = this._enabled && this._currentTarget.enabled;\r\n\r\n        if (this._isDirty) {\r\n            this._update();\r\n        }\r\n\r\n        if (!this._enabled || !this._currentTarget.enabled) {\r\n            return;\r\n        }\r\n\r\n        if (this._geometryBuffer) {\r\n            this._geometryBuffer.renderList = [];\r\n        }\r\n\r\n        this._setupOutputForThisPass(this._currentTarget, camera);\r\n    }\r\n\r\n    private _prepareFrame(prePassRenderTarget: PrePassRenderTarget, faceIndex?: number, layer?: number) {\r\n        if (prePassRenderTarget.renderTargetTexture) {\r\n            prePassRenderTarget.renderTargetTexture._prepareFrame(this._scene, faceIndex, layer, prePassRenderTarget.renderTargetTexture.useCameraPostProcesses);\r\n        } else if (this._postProcessesSourceForThisPass.length) {\r\n            this._scene.postProcessManager._prepareFrame();\r\n        } else {\r\n            this._engine.restoreDefaultFramebuffer();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Sets an intermediary texture between prepass and postprocesses. This texture\r\n     * will be used as input for post processes\r\n     * @param rt The render target texture to use\r\n     * @returns true if there are postprocesses that will use this texture,\r\n     * false if there is no postprocesses - and the function has no effect\r\n     */\r\n    public setCustomOutput(rt: RenderTargetTexture) {\r\n        const firstPP = this._postProcessesSourceForThisPass[0];\r\n        if (!firstPP) {\r\n            return false;\r\n        }\r\n\r\n        firstPP.inputTexture = rt.renderTarget!;\r\n\r\n        return true;\r\n    }\r\n\r\n    private _renderPostProcesses(prePassRenderTarget: PrePassRenderTarget, faceIndex?: number) {\r\n        const firstPP = this._postProcessesSourceForThisPass[0];\r\n        const outputTexture = firstPP ? firstPP.inputTexture : prePassRenderTarget.renderTargetTexture ? prePassRenderTarget.renderTargetTexture.renderTarget : null;\r\n\r\n        // Build post process chain for this prepass post draw\r\n        let postProcessChain = this._currentTarget._beforeCompositionPostProcesses;\r\n\r\n        if (this._needsCompositionForThisPass) {\r\n            postProcessChain = postProcessChain.concat([this._currentTarget.imageProcessingPostProcess]);\r\n        }\r\n\r\n        // Activates and renders the chain\r\n        if (postProcessChain.length) {\r\n            this._scene.postProcessManager._prepareFrame(this._currentTarget.renderTarget?.texture, postProcessChain);\r\n            this._scene.postProcessManager.directRender(postProcessChain, outputTexture, false, faceIndex);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _afterDraw(faceIndex?: number, layer?: number) {\r\n        if (this._enabled && this._currentTarget.enabled) {\r\n            this._prepareFrame(this._currentTarget, faceIndex, layer);\r\n            this._renderPostProcesses(this._currentTarget, faceIndex);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clears the current prepass render target (in the sense of settings pixels to the scene clear color value)\r\n     * @internal\r\n     */\r\n    public _clear() {\r\n        if (this._isDirty) {\r\n            this._update();\r\n        }\r\n\r\n        if (this._enabled && this._currentTarget.enabled) {\r\n            this._bindFrameBuffer();\r\n\r\n            // Clearing other attachment with 0 on all other attachments\r\n            this._engine.bindAttachments(this._clearAttachments);\r\n            this._engine.clear(this._clearColor, true, false, false);\r\n            if (this._useSpecificClearForDepthTexture) {\r\n                this._engine.bindAttachments(this._clearDepthAttachments);\r\n                this._engine.clear(this._clearDepthColor, true, false, false);\r\n            }\r\n            // Regular clear color with the scene clear color of the 1st attachment\r\n            this._engine.bindAttachments(this._defaultAttachments);\r\n        }\r\n    }\r\n\r\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n    private _bindFrameBuffer() {\r\n        if (this._enabled && this._currentTarget.enabled) {\r\n            this._currentTarget._checkSize();\r\n            const internalTexture = this._currentTarget.renderTarget;\r\n            if (internalTexture) {\r\n                this._engine.bindFramebuffer(internalTexture);\r\n            }\r\n        }\r\n    }\r\n\r\n    private _setEnabled(enabled: boolean) {\r\n        this._enabled = enabled;\r\n    }\r\n\r\n    private _setRenderTargetEnabled(prePassRenderTarget: PrePassRenderTarget, enabled: boolean) {\r\n        prePassRenderTarget.enabled = enabled;\r\n        if (!enabled) {\r\n            this._unlinkInternalTexture(prePassRenderTarget);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds an effect configuration to the prepass render target.\r\n     * If an effect has already been added, it won't add it twice and will return the configuration\r\n     * already present.\r\n     * @param cfg the effect configuration\r\n     * @returns the effect configuration now used by the prepass\r\n     */\r\n    public addEffectConfiguration(cfg: PrePassEffectConfiguration): PrePassEffectConfiguration {\r\n        // Do not add twice\r\n        for (let i = 0; i < this._effectConfigurations.length; i++) {\r\n            if (this._effectConfigurations[i].name === cfg.name) {\r\n                return this._effectConfigurations[i];\r\n            }\r\n        }\r\n\r\n        this._effectConfigurations.push(cfg);\r\n        if (cfg.clearColor) {\r\n            this._clearColor.copyFrom(cfg.clearColor);\r\n        }\r\n        return cfg;\r\n    }\r\n\r\n    /**\r\n     * Retrieves an effect configuration by name\r\n     * @param name the name of the effect configuration\r\n     * @returns the effect configuration, or null if not present\r\n     */\r\n    public getEffectConfiguration(name: string): Nullable<PrePassEffectConfiguration> {\r\n        for (let i = 0; i < this._effectConfigurations.length; i++) {\r\n            if (this._effectConfigurations[i].name === name) {\r\n                return this._effectConfigurations[i];\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    private _enable() {\r\n        const previousMrtCount = this.mrtCount;\r\n\r\n        for (let i = 0; i < this._effectConfigurations.length; i++) {\r\n            if (this._effectConfigurations[i].enabled) {\r\n                this._enableTextures(this._effectConfigurations[i].texturesRequired);\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.renderTargets.length; i++) {\r\n            if (this.mrtCount !== previousMrtCount || this.renderTargets[i].count !== this.mrtCount) {\r\n                this.renderTargets[i].updateCount(this.mrtCount, { types: this._mrtTypes, formats: this._mrtFormats }, this._mrtNames.concat(\"prePass_DepthBuffer\"));\r\n            }\r\n\r\n            this.renderTargets[i]._resetPostProcessChain();\r\n\r\n            for (let j = 0; j < this._effectConfigurations.length; j++) {\r\n                if (this._effectConfigurations[j].enabled) {\r\n                    // TODO : subsurface scattering has 1 scene-wide effect configuration\r\n                    // solution : do not stock postProcess on effectConfiguration, but in the prepassRenderTarget (hashmap configuration => postProcess)\r\n                    // And call createPostProcess whenever the post process does not exist in the RT\r\n                    if (!this._effectConfigurations[j].postProcess && this._effectConfigurations[j].createPostProcess) {\r\n                        this._effectConfigurations[j].createPostProcess!();\r\n                    }\r\n\r\n                    if (this._effectConfigurations[j].postProcess) {\r\n                        this.renderTargets[i]._beforeCompositionPostProcesses.push(this._effectConfigurations[j].postProcess!);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this._reinitializeAttachments();\r\n        this._setEnabled(true);\r\n        this._updateGeometryBufferLayout();\r\n    }\r\n\r\n    private _disable() {\r\n        this._setEnabled(false);\r\n\r\n        for (let i = 0; i < this.renderTargets.length; i++) {\r\n            this._setRenderTargetEnabled(this.renderTargets[i], false);\r\n        }\r\n\r\n        this._resetLayout();\r\n\r\n        for (let i = 0; i < this._effectConfigurations.length; i++) {\r\n            this._effectConfigurations[i].enabled = false;\r\n        }\r\n    }\r\n\r\n    private _getPostProcessesSource(prePassRenderTarget: PrePassRenderTarget, camera?: Camera): Nullable<PostProcess>[] {\r\n        if (camera) {\r\n            return camera._postProcesses;\r\n        } else if (prePassRenderTarget.renderTargetTexture) {\r\n            if (prePassRenderTarget.renderTargetTexture.useCameraPostProcesses) {\r\n                const camera = prePassRenderTarget.renderTargetTexture.activeCamera ? prePassRenderTarget.renderTargetTexture.activeCamera : this._scene.activeCamera;\r\n                return camera ? camera._postProcesses : [];\r\n            } else if (prePassRenderTarget.renderTargetTexture.postProcesses) {\r\n                return prePassRenderTarget.renderTargetTexture.postProcesses;\r\n            } else {\r\n                return [];\r\n            }\r\n        } else {\r\n            return this._scene.activeCamera ? this._scene.activeCamera._postProcesses : [];\r\n        }\r\n    }\r\n\r\n    private _setupOutputForThisPass(prePassRenderTarget: PrePassRenderTarget, camera?: Camera) {\r\n        // Order is : draw ===> prePassRenderTarget._postProcesses ==> ipp ==> camera._postProcesses\r\n        const secondaryCamera = camera && this._scene.activeCameras && !!this._scene.activeCameras.length && this._scene.activeCameras.indexOf(camera) !== 0;\r\n        this._postProcessesSourceForThisPass = this._getPostProcessesSource(prePassRenderTarget, camera);\r\n        this._postProcessesSourceForThisPass = this._postProcessesSourceForThisPass.filter((pp) => {\r\n            return pp != null;\r\n        });\r\n        this._scene.autoClear = true;\r\n\r\n        const cameraHasImageProcessing = this._hasImageProcessing(this._postProcessesSourceForThisPass);\r\n        this._needsCompositionForThisPass = !cameraHasImageProcessing && !this.disableGammaTransform && this._needsImageProcessing() && !secondaryCamera;\r\n\r\n        const firstCameraPP = this._getFirstPostProcess(this._postProcessesSourceForThisPass);\r\n        const firstPrePassPP = prePassRenderTarget._beforeCompositionPostProcesses && prePassRenderTarget._beforeCompositionPostProcesses[0];\r\n        let firstPP = null;\r\n\r\n        // Setting the scene-wide post process configuration\r\n        this._scene.imageProcessingConfiguration.applyByPostProcess = this._needsCompositionForThisPass || cameraHasImageProcessing;\r\n\r\n        // Create composition effect if needed\r\n        if (this._needsCompositionForThisPass && !prePassRenderTarget.imageProcessingPostProcess) {\r\n            prePassRenderTarget._createCompositionEffect();\r\n        }\r\n\r\n        // Setting the prePassRenderTarget as input texture of the first PP\r\n        if (firstPrePassPP) {\r\n            firstPP = firstPrePassPP;\r\n        } else if (this._needsCompositionForThisPass) {\r\n            firstPP = prePassRenderTarget.imageProcessingPostProcess;\r\n        } else if (firstCameraPP) {\r\n            firstPP = firstCameraPP;\r\n        }\r\n\r\n        this._bindFrameBuffer();\r\n        this._linkInternalTexture(prePassRenderTarget, firstPP);\r\n    }\r\n\r\n    private _linkInternalTexture(prePassRenderTarget: PrePassRenderTarget, postProcess: Nullable<PostProcess>) {\r\n        if (postProcess) {\r\n            postProcess.autoClear = false;\r\n            postProcess.inputTexture = prePassRenderTarget.renderTarget!;\r\n        }\r\n\r\n        if (prePassRenderTarget._outputPostProcess !== postProcess) {\r\n            if (prePassRenderTarget._outputPostProcess) {\r\n                this._unlinkInternalTexture(prePassRenderTarget);\r\n            }\r\n            prePassRenderTarget._outputPostProcess = postProcess;\r\n        }\r\n\r\n        if (prePassRenderTarget._internalTextureDirty) {\r\n            this._updateGeometryBufferLayout();\r\n            prePassRenderTarget._internalTextureDirty = false;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     */\r\n    public _unlinkInternalTexture(prePassRenderTarget: PrePassRenderTarget) {\r\n        if (prePassRenderTarget._outputPostProcess) {\r\n            prePassRenderTarget._outputPostProcess.autoClear = true;\r\n            prePassRenderTarget._outputPostProcess.restoreDefaultInputTexture();\r\n            prePassRenderTarget._outputPostProcess = null;\r\n        }\r\n    }\r\n\r\n    private _needsImageProcessing(): boolean {\r\n        for (let i = 0; i < this._effectConfigurations.length; i++) {\r\n            if (this._effectConfigurations[i].enabled && this._effectConfigurations[i].needsImageProcessing) {\r\n                return true;\r\n            }\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    private _hasImageProcessing(postProcesses: Nullable<PostProcess>[]): boolean {\r\n        let isIPPAlreadyPresent = false;\r\n        if (postProcesses) {\r\n            for (let i = 0; i < postProcesses.length; i++) {\r\n                if (postProcesses[i]?.getClassName() === \"ImageProcessingPostProcess\") {\r\n                    isIPPAlreadyPresent = true;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        return isIPPAlreadyPresent;\r\n    }\r\n\r\n    /**\r\n     * Internal, gets the first post proces.\r\n     * @param postProcesses\r\n     * @returns the first post process to be run on this camera.\r\n     */\r\n    private _getFirstPostProcess(postProcesses: Nullable<PostProcess>[]): Nullable<PostProcess> {\r\n        for (let ppIndex = 0; ppIndex < postProcesses.length; ppIndex++) {\r\n            if (postProcesses[ppIndex] !== null) {\r\n                return postProcesses[ppIndex];\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * Marks the prepass renderer as dirty, triggering a check if the prepass is necessary for the next rendering.\r\n     */\r\n    public markAsDirty() {\r\n        this._isDirty = true;\r\n    }\r\n\r\n    /**\r\n     * Enables a texture on the MultiRenderTarget for prepass\r\n     * @param types\r\n     */\r\n    private _enableTextures(types: number[]) {\r\n        // For velocity : enable storage of previous matrices for instances\r\n        this._scene.needsPreviousWorldMatrices = false;\r\n\r\n        for (let i = 0; i < types.length; i++) {\r\n            const type = types[i];\r\n\r\n            if (this._textureIndices[type] === -1) {\r\n                this._textureIndices[type] = this._mrtLayout.length;\r\n                this._mrtLayout.push(type);\r\n\r\n                this._mrtTypes.push(PrePassRenderer.TextureFormats[type].type);\r\n                this._mrtFormats.push(PrePassRenderer.TextureFormats[type].format);\r\n                this._mrtNames.push(PrePassRenderer.TextureFormats[type].name);\r\n                this.mrtCount++;\r\n            }\r\n\r\n            if (type === Constants.PREPASS_VELOCITY_TEXTURE_TYPE || type === Constants.PREPASS_VELOCITY_LINEAR_TEXTURE_TYPE) {\r\n                this._scene.needsPreviousWorldMatrices = true;\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Makes sure that the prepass renderer is up to date if it has been dirtified.\r\n     */\r\n    public update() {\r\n        if (this._isDirty) {\r\n            this._update();\r\n        }\r\n    }\r\n\r\n    private _update() {\r\n        this._disable();\r\n        let enablePrePass = false;\r\n        this._scene.imageProcessingConfiguration.applyByPostProcess = false;\r\n\r\n        if (this._scene._depthPeelingRenderer && this._scene.useOrderIndependentTransparency) {\r\n            this._scene._depthPeelingRenderer.setPrePassRenderer(this);\r\n            enablePrePass = true;\r\n        }\r\n\r\n        for (let i = 0; i < this._scene.materials.length; i++) {\r\n            if (this._scene.materials[i].setPrePassRenderer(this)) {\r\n                enablePrePass = true;\r\n            }\r\n        }\r\n\r\n        if (enablePrePass) {\r\n            this._setRenderTargetEnabled(this.defaultRT, true);\r\n        }\r\n\r\n        let postProcesses;\r\n\r\n        for (let i = 0; i < this.renderTargets.length; i++) {\r\n            if (this.renderTargets[i].renderTargetTexture) {\r\n                postProcesses = this._getPostProcessesSource(this.renderTargets[i]);\r\n            } else {\r\n                // When there are multiple active cameras, we have to choose one. We assume it's the first one and not scene.activeCamera, because in a number of cases,\r\n                // _update() will be called from an async method, meaning the active camera will be the last one in the list of active cameras,\r\n                // which is generally not the right camera to use for the prepass setup.\r\n                const camera = this._scene.activeCameras && this._scene.activeCameras.length > 0 ? this._scene.activeCameras[0] : this._scene.activeCamera;\r\n                if (!camera) {\r\n                    continue;\r\n                }\r\n\r\n                postProcesses = camera._postProcesses;\r\n            }\r\n\r\n            if (!postProcesses) {\r\n                continue;\r\n            }\r\n\r\n            postProcesses = <Nullable<PostProcess[]>>postProcesses.filter((pp) => {\r\n                return pp != null;\r\n            });\r\n\r\n            if (postProcesses) {\r\n                for (let j = 0; j < postProcesses.length; j++) {\r\n                    if (postProcesses[j].setPrePassRenderer(this)) {\r\n                        this._setRenderTargetEnabled(this.renderTargets[i], true);\r\n                        enablePrePass = true;\r\n                    }\r\n                }\r\n\r\n                if (this._hasImageProcessing(postProcesses)) {\r\n                    this._scene.imageProcessingConfiguration.applyByPostProcess = true;\r\n                }\r\n            }\r\n        }\r\n\r\n        this._markAllMaterialsAsPrePassDirty();\r\n        this._isDirty = false;\r\n\r\n        if (enablePrePass) {\r\n            this._enable();\r\n        }\r\n    }\r\n\r\n    private _markAllMaterialsAsPrePassDirty() {\r\n        const materials = this._scene.materials;\r\n\r\n        for (let i = 0; i < materials.length; i++) {\r\n            materials[i].markAsDirty(Material.PrePassDirtyFlag);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disposes the prepass renderer.\r\n     */\r\n    public dispose() {\r\n        for (let i = this.renderTargets.length - 1; i >= 0; i--) {\r\n            this.renderTargets[i].dispose();\r\n        }\r\n\r\n        for (let i = 0; i < this._effectConfigurations.length; i++) {\r\n            if (this._effectConfigurations[i].dispose) {\r\n                this._effectConfigurations[i].dispose!();\r\n            }\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 9931, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/prePassRendererSceneComponent.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/prePassRendererSceneComponent.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport { Scene } from \"../scene\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport { PrePassRenderer } from \"./prePassRenderer\";\r\nimport { Logger } from \"../Misc/logger\";\r\nimport type { AbstractMesh } from \"../Meshes/abstractMesh\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport type { _InstancesBatch } from \"../Meshes/mesh\";\r\nimport type { Effect } from \"../Materials/effect\";\r\nimport type { Camera } from \"../Cameras/camera\";\r\nimport type { RenderTargetTexture } from \"../Materials/Textures/renderTargetTexture\";\r\nimport type { PrePassRenderTarget } from \"../Materials/Textures/prePassRenderTarget\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _prePassRenderer: Nullable<PrePassRenderer>;\r\n\r\n        /**\r\n         * Gets or Sets the current prepass renderer associated to the scene.\r\n         */\r\n        prePassRenderer: Nullable<PrePassRenderer>;\r\n\r\n        /**\r\n         * Enables the prepass and associates it with the scene\r\n         * @returns the PrePassRenderer\r\n         */\r\n        enablePrePassRenderer(): Nullable<PrePassRenderer>;\r\n\r\n        /**\r\n         * Disables the prepass associated with the scene\r\n         */\r\n        disablePrePassRenderer(): void;\r\n    }\r\n}\r\n\r\ndeclare module \"../Materials/Textures/renderTargetTexture\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface RenderTargetTexture {\r\n        /**\r\n         * Gets or sets a boolean indicating that the prepass renderer should not be used with this render target\r\n         */\r\n        noPrePassRenderer: boolean;\r\n        /** @internal */\r\n        _prePassRenderTarget: Nullable<PrePassRenderTarget>;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"prePassRenderer\", {\r\n    get: function (this: Scene) {\r\n        return this._prePassRenderer;\r\n    },\r\n    set: function (this: Scene, value: Nullable<PrePassRenderer>) {\r\n        if (value && value.isSupported) {\r\n            this._prePassRenderer = value;\r\n        }\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nScene.prototype.enablePrePassRenderer = function (): Nullable<PrePassRenderer> {\r\n    if (this._prePassRenderer) {\r\n        return this._prePassRenderer;\r\n    }\r\n\r\n    this._prePassRenderer = new PrePassRenderer(this);\r\n\r\n    if (!this._prePassRenderer.isSupported) {\r\n        this._prePassRenderer = null;\r\n        Logger.Error(\"PrePassRenderer needs WebGL 2 support.\\n\" + \"Maybe you tried to use the following features that need the PrePassRenderer :\\n\" + \" + Subsurface Scattering\");\r\n    }\r\n\r\n    return this._prePassRenderer;\r\n};\r\n\r\nScene.prototype.disablePrePassRenderer = function (): void {\r\n    if (!this._prePassRenderer) {\r\n        return;\r\n    }\r\n\r\n    this._prePassRenderer.dispose();\r\n    this._prePassRenderer = null;\r\n};\r\n\r\n/**\r\n * Defines the Geometry Buffer scene component responsible to manage a G-Buffer useful\r\n * in several rendering techniques.\r\n */\r\nexport class PrePassRendererSceneComponent implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_PREPASSRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {\r\n        this.scene._beforeCameraDrawStage.registerStep(SceneComponentConstants.STEP_BEFORECAMERADRAW_PREPASS, this, this._beforeCameraDraw);\r\n        this.scene._afterCameraDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_PREPASS, this, this._afterCameraDraw);\r\n        this.scene._beforeRenderTargetDrawStage.registerStep(SceneComponentConstants.STEP_BEFORERENDERTARGETDRAW_PREPASS, this, this._beforeRenderTargetDraw);\r\n        this.scene._afterRenderTargetDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_PREPASS, this, this._afterRenderTargetDraw);\r\n\r\n        this.scene._beforeClearStage.registerStep(SceneComponentConstants.STEP_BEFORECLEAR_PREPASS, this, this._beforeClearStage);\r\n        this.scene._beforeRenderTargetClearStage.registerStep(SceneComponentConstants.STEP_BEFORERENDERTARGETCLEAR_PREPASS, this, this._beforeRenderTargetClearStage);\r\n\r\n        this.scene._beforeRenderingMeshStage.registerStep(SceneComponentConstants.STEP_BEFORERENDERINGMESH_PREPASS, this, this._beforeRenderingMeshStage);\r\n        this.scene._afterRenderingMeshStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERINGMESH_PREPASS, this, this._afterRenderingMeshStage);\r\n    }\r\n\r\n    private _beforeRenderTargetDraw(renderTarget: RenderTargetTexture, faceIndex?: number, layer?: number) {\r\n        if (this.scene.prePassRenderer && !renderTarget.noPrePassRenderer) {\r\n            this.scene.prePassRenderer._setRenderTarget(renderTarget._prePassRenderTarget);\r\n            this.scene.prePassRenderer._beforeDraw(undefined, faceIndex, layer);\r\n        }\r\n    }\r\n\r\n    private _afterRenderTargetDraw(renderTarget: RenderTargetTexture, faceIndex?: number, layer?: number) {\r\n        if (this.scene.prePassRenderer && !renderTarget.noPrePassRenderer) {\r\n            this.scene.prePassRenderer._afterDraw(faceIndex, layer);\r\n        }\r\n    }\r\n\r\n    private _beforeRenderTargetClearStage(renderTarget: RenderTargetTexture) {\r\n        if (this.scene.prePassRenderer && !renderTarget.noPrePassRenderer) {\r\n            if (!renderTarget._prePassRenderTarget) {\r\n                renderTarget._prePassRenderTarget = this.scene.prePassRenderer._createRenderTarget(renderTarget.name + \"_prePassRTT\", renderTarget);\r\n            }\r\n            this.scene.prePassRenderer._setRenderTarget(renderTarget._prePassRenderTarget);\r\n            this.scene.prePassRenderer._clear();\r\n        }\r\n    }\r\n\r\n    private _beforeCameraDraw(camera: Camera) {\r\n        if (this.scene.prePassRenderer) {\r\n            this.scene.prePassRenderer._setRenderTarget(null);\r\n            this.scene.prePassRenderer._beforeDraw(camera);\r\n        }\r\n    }\r\n\r\n    private _afterCameraDraw() {\r\n        if (this.scene.prePassRenderer) {\r\n            this.scene.prePassRenderer._afterDraw();\r\n        }\r\n    }\r\n\r\n    private _beforeClearStage() {\r\n        if (this.scene.prePassRenderer) {\r\n            this.scene.prePassRenderer._setRenderTarget(null);\r\n            this.scene.prePassRenderer._clear();\r\n        }\r\n    }\r\n\r\n    private _beforeRenderingMeshStage(mesh: AbstractMesh, subMesh: SubMesh, batch: _InstancesBatch, effect: Nullable<Effect>) {\r\n        if (!effect) {\r\n            return;\r\n        }\r\n\r\n        // Render to MRT\r\n        const scene = mesh.getScene();\r\n        if (scene.prePassRenderer) {\r\n            scene.prePassRenderer.bindAttachmentsForEffect(effect, subMesh);\r\n        }\r\n    }\r\n\r\n    private _afterRenderingMeshStage(mesh: AbstractMesh) {\r\n        const scene = mesh.getScene();\r\n\r\n        if (scene.prePassRenderer) {\r\n            scene.prePassRenderer.restoreAttachments();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        // Nothing to do for this component\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources\r\n     */\r\n    public dispose(): void {\r\n        this.scene.disablePrePassRenderer();\r\n    }\r\n}\r\n\r\nPrePassRenderer._SceneComponentInitialization = (scene: Scene) => {\r\n    // Register the G Buffer component to the scene.\r\n    let component = scene._getComponent(SceneComponentConstants.NAME_PREPASSRENDERER) as PrePassRendererSceneComponent;\r\n    if (!component) {\r\n        component = new PrePassRendererSceneComponent(scene);\r\n        scene._addComponent(component);\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10072, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/subSurfaceConfiguration.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/subSurfaceConfiguration.ts"],"sourcesContent":["import { Logger } from \"../Misc/logger\";\r\nimport type { Scene } from \"../scene\";\r\nimport { Color3, Color4 } from \"../Maths/math.color\";\r\nimport { SubSurfaceScatteringPostProcess } from \"../PostProcesses/subSurfaceScatteringPostProcess\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport type { PrePassEffectConfiguration } from \"./prePassEffectConfiguration\";\r\nimport { _WarnImport } from \"../Misc/devTools\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Contains all parameters needed for the prepass to perform\r\n * screen space subsurface scattering\r\n */\r\nexport class SubSurfaceConfiguration implements PrePassEffectConfiguration {\r\n    /**\r\n     * @internal\r\n     */\r\n    public static _SceneComponentInitialization: (scene: Scene) => void = (_) => {\r\n        throw _WarnImport(\"SubSurfaceSceneComponent\");\r\n    };\r\n\r\n    private _ssDiffusionS: number[] = [];\r\n    private _ssFilterRadii: number[] = [];\r\n    private _ssDiffusionD: number[] = [];\r\n\r\n    /**\r\n     * Post process to attach for screen space subsurface scattering\r\n     */\r\n    public postProcess: SubSurfaceScatteringPostProcess;\r\n\r\n    /**\r\n     * Diffusion profile color for subsurface scattering\r\n     */\r\n    public get ssDiffusionS() {\r\n        return this._ssDiffusionS;\r\n    }\r\n\r\n    /**\r\n     * Diffusion profile max color channel value for subsurface scattering\r\n     */\r\n    public get ssDiffusionD() {\r\n        return this._ssDiffusionD;\r\n    }\r\n\r\n    /**\r\n     * Diffusion profile filter radius for subsurface scattering\r\n     */\r\n    public get ssFilterRadii() {\r\n        return this._ssFilterRadii;\r\n    }\r\n\r\n    /**\r\n     * Is subsurface enabled\r\n     */\r\n    public enabled = false;\r\n\r\n    /**\r\n     * Does the output of this prepass need to go through imageprocessing\r\n     */\r\n    public needsImageProcessing = true;\r\n\r\n    /**\r\n     * Name of the configuration\r\n     */\r\n    public name = SceneComponentConstants.NAME_SUBSURFACE;\r\n\r\n    /**\r\n     * Diffusion profile colors for subsurface scattering\r\n     * You can add one diffusion color using `addDiffusionProfile` on `scene.prePassRenderer`\r\n     * See ...\r\n     * Note that you can only store up to 5 of them\r\n     */\r\n    public ssDiffusionProfileColors: Color3[] = [];\r\n\r\n    /**\r\n     * Defines the ratio real world => scene units.\r\n     * Used for subsurface scattering\r\n     */\r\n    public metersPerUnit: number = 1;\r\n\r\n    /**\r\n     * Textures that should be present in the MRT for this effect to work\r\n     */\r\n    public readonly texturesRequired: number[] = [\r\n        Constants.PREPASS_DEPTH_TEXTURE_TYPE,\r\n        Constants.PREPASS_ALBEDO_SQRT_TEXTURE_TYPE,\r\n        Constants.PREPASS_COLOR_TEXTURE_TYPE,\r\n        Constants.PREPASS_IRRADIANCE_TEXTURE_TYPE,\r\n    ];\r\n\r\n    /**\r\n     * The clear color of the render targets.\r\n     * We need 1 for the alpha channel of the irradiance texture so that we early exit from the SSS post-process if the pixel should not be processed\r\n     */\r\n    public clearColor = new Color4(0, 0, 0, 1);\r\n\r\n    private _scene: Scene;\r\n\r\n    /**\r\n     * Builds a subsurface configuration object\r\n     * @param scene The scene\r\n     */\r\n    constructor(scene: Scene) {\r\n        // Adding default diffusion profile\r\n        this.addDiffusionProfile(new Color3(1, 1, 1));\r\n        this._scene = scene;\r\n\r\n        SubSurfaceConfiguration._SceneComponentInitialization(this._scene);\r\n    }\r\n\r\n    /**\r\n     * Adds a new diffusion profile.\r\n     * Useful for more realistic subsurface scattering on diverse materials.\r\n     * @param color The color of the diffusion profile. Should be the average color of the material.\r\n     * @returns The index of the diffusion profile for the material subsurface configuration\r\n     */\r\n    public addDiffusionProfile(color: Color3): number {\r\n        if (this.ssDiffusionD.length >= 5) {\r\n            // We only suppport 5 diffusion profiles\r\n            Logger.Error(\"You already reached the maximum number of diffusion profiles.\");\r\n            return 0; // default profile\r\n        }\r\n\r\n        // Do not add doubles\r\n        for (let i = 0; i < this._ssDiffusionS.length / 3; i++) {\r\n            if (this._ssDiffusionS[i * 3] === color.r && this._ssDiffusionS[i * 3 + 1] === color.g && this._ssDiffusionS[i * 3 + 2] === color.b) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        this._ssDiffusionS.push(color.r, color.b, color.g);\r\n        this._ssDiffusionD.push(Math.max(Math.max(color.r, color.b), color.g));\r\n        this._ssFilterRadii.push(this.getDiffusionProfileParameters(color));\r\n        this.ssDiffusionProfileColors.push(color);\r\n\r\n        return this._ssDiffusionD.length - 1;\r\n    }\r\n\r\n    /**\r\n     * Creates the sss post process\r\n     * @returns The created post process\r\n     */\r\n    public createPostProcess(): SubSurfaceScatteringPostProcess {\r\n        this.postProcess = new SubSurfaceScatteringPostProcess(\"subSurfaceScattering\", this._scene, {\r\n            size: 1,\r\n            engine: this._scene.getEngine(),\r\n            shaderLanguage: this._scene.getEngine().isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL,\r\n        });\r\n        this.postProcess.autoClear = false;\r\n\r\n        return this.postProcess;\r\n    }\r\n\r\n    /**\r\n     * Deletes all diffusion profiles.\r\n     * Note that in order to render subsurface scattering, you should have at least 1 diffusion profile.\r\n     */\r\n    public clearAllDiffusionProfiles() {\r\n        this._ssDiffusionD = [];\r\n        this._ssDiffusionS = [];\r\n        this._ssFilterRadii = [];\r\n        this.ssDiffusionProfileColors = [];\r\n    }\r\n\r\n    /**\r\n     * Disposes this object\r\n     */\r\n    public dispose() {\r\n        this.clearAllDiffusionProfiles();\r\n        if (this.postProcess) {\r\n            this.postProcess.dispose();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * @internal\r\n     * https://zero-radiance.github.io/post/sampling-diffusion/\r\n     *\r\n     * Importance sample the normalized diffuse reflectance profile for the computed value of 's'.\r\n     * ------------------------------------------------------------------------------------\r\n     * R[r, phi, s]   = s * (Exp[-r * s] + Exp[-r * s / 3]) / (8 * Pi * r)\r\n     * PDF[r, phi, s] = r * R[r, phi, s]\r\n     * CDF[r, s]      = 1 - 1/4 * Exp[-r * s] - 3/4 * Exp[-r * s / 3]\r\n     * ------------------------------------------------------------------------------------\r\n     * We importance sample the color channel with the widest scattering distance.\r\n     */\r\n    public getDiffusionProfileParameters(color: Color3) {\r\n        const cdf = 0.997;\r\n        const maxScatteringDistance = Math.max(color.r, color.g, color.b);\r\n\r\n        return this._sampleBurleyDiffusionProfile(cdf, maxScatteringDistance);\r\n    }\r\n\r\n    /**\r\n     * Performs sampling of a Normalized Burley diffusion profile in polar coordinates.\r\n     * 'u' is the random number (the value of the CDF): [0, 1).\r\n     * rcp(s) = 1 / ShapeParam = ScatteringDistance.\r\n     * Returns the sampled radial distance, s.t. (u = 0 -> r = 0) and (u = 1 -> r = Inf).\r\n     * @param u\r\n     * @param rcpS\r\n     * @returns The sampled radial distance\r\n     */\r\n    private _sampleBurleyDiffusionProfile(u: number, rcpS: number) {\r\n        u = 1 - u; // Convert CDF to CCDF\r\n\r\n        const g = 1 + 4 * u * (2 * u + Math.sqrt(1 + 4 * u * u));\r\n        const n = Math.pow(g, -1.0 / 3.0); // g^(-1/3)\r\n        const p = g * n * n; // g^(+1/3)\r\n        const c = 1 + p + n; // 1 + g^(+1/3) + g^(-1/3)\r\n        const x = 3 * Math.log(c / (4 * u));\r\n\r\n        return x * rcpS;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10240, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/subSurfaceSceneComponent.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/subSurfaceSceneComponent.ts"],"sourcesContent":["import type { Nullable } from \"../types\";\r\nimport { Scene } from \"../scene\";\r\nimport type { ISceneSerializableComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport { SubSurfaceConfiguration } from \"./subSurfaceConfiguration\";\r\nimport { Color3 } from \"../Maths/math.color\";\r\nimport { AddParser } from \"core/Loading/Plugins/babylonFileParser.function\";\r\n\r\n// Adds the parser to the scene parsers.\r\nAddParser(SceneComponentConstants.NAME_SUBSURFACE, (parsedData: any, scene: Scene) => {\r\n    // Diffusion profiles\r\n    if (parsedData.ssDiffusionProfileColors !== undefined && parsedData.ssDiffusionProfileColors !== null) {\r\n        scene.enableSubSurfaceForPrePass();\r\n        if (scene.subSurfaceConfiguration) {\r\n            for (let index = 0, cache = parsedData.ssDiffusionProfileColors.length; index < cache; index++) {\r\n                const color = parsedData.ssDiffusionProfileColors[index];\r\n                scene.subSurfaceConfiguration.addDiffusionProfile(new Color3(color.r, color.g, color.b));\r\n            }\r\n        }\r\n    }\r\n});\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _subSurfaceConfiguration: Nullable<SubSurfaceConfiguration>;\r\n\r\n        /**\r\n         * Gets or Sets the current prepass renderer associated to the scene.\r\n         */\r\n        subSurfaceConfiguration: Nullable<SubSurfaceConfiguration>;\r\n\r\n        /**\r\n         * Enables the subsurface effect for prepass\r\n         * @returns the SubSurfaceConfiguration\r\n         */\r\n        enableSubSurfaceForPrePass(): Nullable<SubSurfaceConfiguration>;\r\n\r\n        /**\r\n         * Disables the subsurface effect for prepass\r\n         */\r\n        disableSubSurfaceForPrePass(): void;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"subSurfaceConfiguration\", {\r\n    get: function (this: Scene) {\r\n        return this._subSurfaceConfiguration;\r\n    },\r\n    set: function (this: Scene, value: Nullable<SubSurfaceConfiguration>) {\r\n        if (value) {\r\n            if (this.enablePrePassRenderer()) {\r\n                this._subSurfaceConfiguration = value;\r\n            }\r\n        }\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nScene.prototype.enableSubSurfaceForPrePass = function (): Nullable<SubSurfaceConfiguration> {\r\n    if (this._subSurfaceConfiguration) {\r\n        return this._subSurfaceConfiguration;\r\n    }\r\n\r\n    const prePassRenderer = this.enablePrePassRenderer();\r\n    if (prePassRenderer) {\r\n        this._subSurfaceConfiguration = new SubSurfaceConfiguration(this);\r\n        prePassRenderer.addEffectConfiguration(this._subSurfaceConfiguration);\r\n        return this._subSurfaceConfiguration;\r\n    }\r\n\r\n    return null;\r\n};\r\n\r\nScene.prototype.disableSubSurfaceForPrePass = function (): void {\r\n    if (!this._subSurfaceConfiguration) {\r\n        return;\r\n    }\r\n\r\n    this._subSurfaceConfiguration.dispose();\r\n    this._subSurfaceConfiguration = null;\r\n};\r\n\r\n/**\r\n * Defines the Geometry Buffer scene component responsible to manage a G-Buffer useful\r\n * in several rendering techniques.\r\n */\r\nexport class SubSurfaceSceneComponent implements ISceneSerializableComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_PREPASSRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {}\r\n\r\n    /**\r\n     * Serializes the component data to the specified json object\r\n     * @param serializationObject The object to serialize to\r\n     */\r\n    public serialize(serializationObject: any): void {\r\n        if (!this.scene.subSurfaceConfiguration) {\r\n            return;\r\n        }\r\n\r\n        const ssDiffusionProfileColors = this.scene.subSurfaceConfiguration.ssDiffusionProfileColors;\r\n        serializationObject.ssDiffusionProfileColors = [];\r\n\r\n        for (let i = 0; i < ssDiffusionProfileColors.length; i++) {\r\n            serializationObject.ssDiffusionProfileColors.push({\r\n                r: ssDiffusionProfileColors[i].r,\r\n                g: ssDiffusionProfileColors[i].g,\r\n                b: ssDiffusionProfileColors[i].b,\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds all the elements from the container to the scene\r\n     */\r\n    public addFromContainer(): void {\r\n        // Nothing to do\r\n    }\r\n\r\n    /**\r\n     * Removes all the elements in the container from the scene\r\n     */\r\n    public removeFromContainer(): void {\r\n        // Make sure nothing will be serialized\r\n        if (!this.scene.prePassRenderer) {\r\n            return;\r\n        }\r\n\r\n        if (this.scene.subSurfaceConfiguration) {\r\n            this.scene.subSurfaceConfiguration.clearAllDiffusionProfiles();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        // Nothing to do for this component\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources\r\n     */\r\n    public dispose(): void {\r\n        // Nothing to do for this component\r\n    }\r\n}\r\n\r\nSubSurfaceConfiguration._SceneComponentInitialization = (scene: Scene) => {\r\n    // Register the G Buffer component to the scene.\r\n    let component = scene._getComponent(SceneComponentConstants.NAME_SUBSURFACE) as SubSurfaceSceneComponent;\r\n    if (!component) {\r\n        component = new SubSurfaceSceneComponent(scene);\r\n        scene._addComponent(component);\r\n    }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10370, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/outlineRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/outlineRenderer.ts"],"sourcesContent":["import { VertexBuffer } from \"../Buffers/buffer\";\r\nimport type { SubMesh } from \"../Meshes/subMesh\";\r\nimport type { _InstancesBatch } from \"../Meshes/mesh\";\r\nimport { Mesh } from \"../Meshes/mesh\";\r\nimport { Scene } from \"../scene\";\r\nimport type { AbstractEngine } from \"../Engines/abstractEngine\";\r\nimport { Constants } from \"../Engines/constants\";\r\nimport type { ISceneComponent } from \"../sceneComponent\";\r\nimport { SceneComponentConstants } from \"../sceneComponent\";\r\nimport { DrawWrapper } from \"../Materials/drawWrapper\";\r\n\r\nimport { AddClipPlaneUniforms, BindClipPlane, PrepareStringDefinesForClipPlanes } from \"core/Materials/clipPlaneMaterialHelper\";\r\nimport { BindBonesParameters, BindMorphTargetParameters, PrepareDefinesAndAttributesForMorphTargets, PushAttributesForInstances } from \"../Materials/materialHelper.functions\";\r\nimport { EffectFallbacks } from \"core/Materials/effectFallbacks\";\r\nimport type { IEffectCreationOptions } from \"core/Materials/effect\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\ndeclare module \"../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal */\r\n        _outlineRenderer: OutlineRenderer;\r\n\r\n        /**\r\n         * Gets the outline renderer associated with the scene\r\n         * @returns a OutlineRenderer\r\n         */\r\n        getOutlineRenderer(): OutlineRenderer;\r\n    }\r\n}\r\n\r\n/**\r\n * Gets the outline renderer associated with the scene\r\n * @returns a OutlineRenderer\r\n */\r\nScene.prototype.getOutlineRenderer = function (): OutlineRenderer {\r\n    if (!this._outlineRenderer) {\r\n        this._outlineRenderer = new OutlineRenderer(this);\r\n    }\r\n    return this._outlineRenderer;\r\n};\r\n\r\ndeclare module \"../Meshes/abstractMesh\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface AbstractMesh {\r\n        /** @internal (Backing field) */\r\n        _renderOutline: boolean;\r\n        /**\r\n         * Gets or sets a boolean indicating if the outline must be rendered as well\r\n         * @see https://www.babylonjs-playground.com/#10WJ5S#3\r\n         */\r\n        renderOutline: boolean;\r\n\r\n        /** @internal (Backing field) */\r\n        _renderOverlay: boolean;\r\n        /**\r\n         * Gets or sets a boolean indicating if the overlay must be rendered as well\r\n         * @see https://www.babylonjs-playground.com/#10WJ5S#2\r\n         */\r\n        renderOverlay: boolean;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Mesh.prototype, \"renderOutline\", {\r\n    get: function (this: Mesh) {\r\n        return this._renderOutline;\r\n    },\r\n    set: function (this: Mesh, value: boolean) {\r\n        if (value) {\r\n            // Lazy Load the component.\r\n            this.getScene().getOutlineRenderer();\r\n        }\r\n        this._renderOutline = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nObject.defineProperty(Mesh.prototype, \"renderOverlay\", {\r\n    get: function (this: Mesh) {\r\n        return this._renderOverlay;\r\n    },\r\n    set: function (this: Mesh, value: boolean) {\r\n        if (value) {\r\n            // Lazy Load the component.\r\n            this.getScene().getOutlineRenderer();\r\n        }\r\n        this._renderOverlay = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\n/**\r\n * This class is responsible to draw the outline/overlay of meshes.\r\n * It should not be used directly but through the available method on mesh.\r\n */\r\nexport class OutlineRenderer implements ISceneComponent {\r\n    /**\r\n     * Stencil value used to avoid outline being seen within the mesh when the mesh is transparent\r\n     */\r\n    private static _StencilReference = 0x04;\r\n    /**\r\n     * The name of the component. Each component must have a unique name.\r\n     */\r\n    public name = SceneComponentConstants.NAME_OUTLINERENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Defines a zOffset default Factor to prevent zFighting between the overlay and the mesh.\r\n     */\r\n    public zOffset = 1;\r\n\r\n    /**\r\n     * Defines a zOffset default Unit to prevent zFighting between the overlay and the mesh.\r\n     */\r\n    public zOffsetUnits = 4; // 4 to account for projection a bit by default\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if the renderer is enabled\r\n     */\r\n    public enabled = true;\r\n\r\n    private _engine: AbstractEngine;\r\n    private _savedDepthWrite: boolean;\r\n    private _passIdForDrawWrapper: number[];\r\n\r\n    /** Shader language used by the Outline renderer. */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in the Outline renderer.\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Instantiates a new outline renderer. (There could be only one per scene).\r\n     * @param scene Defines the scene it belongs to\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this.scene._addComponent(this);\r\n        this._passIdForDrawWrapper = [];\r\n        for (let i = 0; i < 4; ++i) {\r\n            this._passIdForDrawWrapper[i] = this._engine.createRenderPassId(`Outline Renderer (${i})`);\r\n        }\r\n\r\n        const engine = this._engine;\r\n        if (engine.isWebGPU) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Register the component to one instance of a scene.\r\n     */\r\n    public register(): void {\r\n        this.scene._beforeRenderingMeshStage.registerStep(SceneComponentConstants.STEP_BEFORERENDERINGMESH_OUTLINE, this, this._beforeRenderingMesh);\r\n        this.scene._afterRenderingMeshStage.registerStep(SceneComponentConstants.STEP_AFTERRENDERINGMESH_OUTLINE, this, this._afterRenderingMesh);\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        // Nothing to do here.\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources.\r\n     */\r\n    public dispose(): void {\r\n        for (let i = 0; i < this._passIdForDrawWrapper.length; ++i) {\r\n            this._engine.releaseRenderPassId(this._passIdForDrawWrapper[i]);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Renders the outline in the canvas.\r\n     * @param subMesh Defines the sumesh to render\r\n     * @param batch Defines the batch of meshes in case of instances\r\n     * @param useOverlay Defines if the rendering is for the overlay or the outline\r\n     * @param renderPassId Render pass id to use to render the mesh\r\n     */\r\n    public render(subMesh: SubMesh, batch: _InstancesBatch, useOverlay: boolean = false, renderPassId?: number): void {\r\n        renderPassId = renderPassId ?? this._passIdForDrawWrapper[0];\r\n\r\n        const scene = this.scene;\r\n        const engine = scene.getEngine();\r\n\r\n        const hardwareInstancedRendering =\r\n            engine.getCaps().instancedArrays &&\r\n            ((batch.visibleInstances[subMesh._id] !== null && batch.visibleInstances[subMesh._id] !== undefined) || subMesh.getRenderingMesh().hasThinInstances);\r\n\r\n        if (!this.isReady(subMesh, hardwareInstancedRendering, renderPassId)) {\r\n            return;\r\n        }\r\n\r\n        const ownerMesh = subMesh.getMesh();\r\n        const replacementMesh = ownerMesh._internalAbstractMeshDataInfo._actAsRegularMesh ? ownerMesh : null;\r\n        const renderingMesh = subMesh.getRenderingMesh();\r\n        const effectiveMesh = replacementMesh ? replacementMesh : renderingMesh;\r\n        const material = subMesh.getMaterial();\r\n\r\n        if (!material || !scene.activeCamera) {\r\n            return;\r\n        }\r\n\r\n        const drawWrapper = subMesh._getDrawWrapper(renderPassId)!;\r\n        const effect = DrawWrapper.GetEffect(drawWrapper)!;\r\n\r\n        engine.enableEffect(drawWrapper);\r\n\r\n        // Logarithmic depth\r\n        if ((<any>material).useLogarithmicDepth) {\r\n            effect.setFloat(\"logarithmicDepthConstant\", 2.0 / (Math.log(scene.activeCamera.maxZ + 1.0) / Math.LN2));\r\n        }\r\n\r\n        effect.setFloat(\"offset\", useOverlay ? 0 : renderingMesh.outlineWidth);\r\n        effect.setColor4(\"color\", useOverlay ? renderingMesh.overlayColor : renderingMesh.outlineColor, useOverlay ? renderingMesh.overlayAlpha : material.alpha);\r\n        effect.setMatrix(\"viewProjection\", scene.getTransformMatrix());\r\n        effect.setMatrix(\"world\", effectiveMesh.getWorldMatrix());\r\n\r\n        // Bones\r\n        BindBonesParameters(renderingMesh, effect);\r\n\r\n        // Morph targets\r\n        BindMorphTargetParameters(renderingMesh, effect);\r\n        if (renderingMesh.morphTargetManager && renderingMesh.morphTargetManager.isUsingTextureForTargets) {\r\n            renderingMesh.morphTargetManager._bind(effect);\r\n        }\r\n\r\n        if (!hardwareInstancedRendering) {\r\n            renderingMesh._bind(subMesh, effect, material.fillMode);\r\n        }\r\n\r\n        // Baked vertex animations\r\n        const bvaManager = subMesh.getMesh().bakedVertexAnimationManager;\r\n        if (bvaManager && bvaManager.isEnabled) {\r\n            bvaManager.bind(effect, hardwareInstancedRendering);\r\n        }\r\n\r\n        // Alpha test\r\n        if (material && material.needAlphaTestingForMesh(effectiveMesh)) {\r\n            const alphaTexture = material.getAlphaTestTexture();\r\n            if (alphaTexture) {\r\n                effect.setTexture(\"diffuseSampler\", alphaTexture);\r\n                effect.setMatrix(\"diffuseMatrix\", alphaTexture.getTextureMatrix());\r\n            }\r\n        }\r\n\r\n        // Clip plane\r\n        BindClipPlane(effect, material, scene);\r\n\r\n        engine.setZOffset(-this.zOffset);\r\n        engine.setZOffsetUnits(-this.zOffsetUnits);\r\n\r\n        renderingMesh._processRendering(effectiveMesh, subMesh, effect, material.fillMode, batch, hardwareInstancedRendering, (isInstance, world) => {\r\n            effect.setMatrix(\"world\", world);\r\n        });\r\n\r\n        engine.setZOffset(0);\r\n        engine.setZOffsetUnits(0);\r\n    }\r\n\r\n    /**\r\n     * Returns whether or not the outline renderer is ready for a given submesh.\r\n     * All the dependencies e.g. submeshes, texture, effect... mus be ready\r\n     * @param subMesh Defines the submesh to check readiness for\r\n     * @param useInstances Defines whether wee are trying to render instances or not\r\n     * @param renderPassId Render pass id to use to render the mesh\r\n     * @returns true if ready otherwise false\r\n     */\r\n    public isReady(subMesh: SubMesh, useInstances: boolean, renderPassId?: number): boolean {\r\n        renderPassId = renderPassId ?? this._passIdForDrawWrapper[0];\r\n\r\n        const defines = [];\r\n        const attribs = [VertexBuffer.PositionKind, VertexBuffer.NormalKind];\r\n\r\n        const mesh = subMesh.getMesh();\r\n        const material = subMesh.getMaterial();\r\n\r\n        if (!material) {\r\n            return false;\r\n        }\r\n\r\n        const scene = mesh.getScene();\r\n\r\n        let uv1 = false;\r\n        let uv2 = false;\r\n        const color = false;\r\n\r\n        // Alpha test\r\n        if (material.needAlphaTestingForMesh(mesh)) {\r\n            defines.push(\"#define ALPHATEST\");\r\n            if (mesh.isVerticesDataPresent(VertexBuffer.UVKind)) {\r\n                attribs.push(VertexBuffer.UVKind);\r\n                defines.push(\"#define UV1\");\r\n                uv1 = true;\r\n            }\r\n            if (mesh.isVerticesDataPresent(VertexBuffer.UV2Kind)) {\r\n                attribs.push(VertexBuffer.UV2Kind);\r\n                defines.push(\"#define UV2\");\r\n                uv2 = true;\r\n            }\r\n        }\r\n        //Logarithmic depth\r\n        if ((<any>material).useLogarithmicDepth) {\r\n            defines.push(\"#define LOGARITHMICDEPTH\");\r\n        }\r\n        // Clip planes\r\n        PrepareStringDefinesForClipPlanes(material, scene, defines);\r\n\r\n        // Bones\r\n        const fallbacks = new EffectFallbacks();\r\n        if (mesh.useBones && mesh.computeBonesUsingShaders && mesh.skeleton) {\r\n            attribs.push(VertexBuffer.MatricesIndicesKind);\r\n            attribs.push(VertexBuffer.MatricesWeightsKind);\r\n            if (mesh.numBoneInfluencers > 4) {\r\n                attribs.push(VertexBuffer.MatricesIndicesExtraKind);\r\n                attribs.push(VertexBuffer.MatricesWeightsExtraKind);\r\n            }\r\n            const skeleton = mesh.skeleton;\r\n            defines.push(\"#define NUM_BONE_INFLUENCERS \" + mesh.numBoneInfluencers);\r\n            if (mesh.numBoneInfluencers > 0) {\r\n                fallbacks.addCPUSkinningFallback(0, mesh);\r\n            }\r\n\r\n            if (skeleton.isUsingTextureForMatrices) {\r\n                defines.push(\"#define BONETEXTURE\");\r\n            } else {\r\n                defines.push(\"#define BonesPerMesh \" + (skeleton.bones.length + 1));\r\n            }\r\n        } else {\r\n            defines.push(\"#define NUM_BONE_INFLUENCERS 0\");\r\n        }\r\n\r\n        // Morph targets\r\n        const numMorphInfluencers = mesh.morphTargetManager\r\n            ? PrepareDefinesAndAttributesForMorphTargets(\r\n                  mesh.morphTargetManager,\r\n                  defines,\r\n                  attribs,\r\n                  mesh,\r\n                  true, // usePositionMorph\r\n                  true, // useNormalMorph\r\n                  false, // useTangentMorph\r\n                  uv1, // useUVMorph\r\n                  uv2, // useUV2Morph\r\n                  color // useColorMorph\r\n              )\r\n            : 0;\r\n\r\n        // Instances\r\n        if (useInstances) {\r\n            defines.push(\"#define INSTANCES\");\r\n            PushAttributesForInstances(attribs);\r\n            if (subMesh.getRenderingMesh().hasThinInstances) {\r\n                defines.push(\"#define THIN_INSTANCES\");\r\n            }\r\n        }\r\n\r\n        // Baked vertex animations\r\n        const bvaManager = mesh.bakedVertexAnimationManager;\r\n        if (bvaManager && bvaManager.isEnabled) {\r\n            defines.push(\"#define BAKED_VERTEX_ANIMATION_TEXTURE\");\r\n            if (useInstances) {\r\n                attribs.push(\"bakedVertexAnimationSettingsInstanced\");\r\n            }\r\n        }\r\n\r\n        // Get correct effect\r\n        const drawWrapper = subMesh._getDrawWrapper(renderPassId, true)!;\r\n        const cachedDefines = drawWrapper.defines;\r\n        const join = defines.join(\"\\n\");\r\n\r\n        if (cachedDefines !== join) {\r\n            const uniforms = [\r\n                \"world\",\r\n                \"mBones\",\r\n                \"viewProjection\",\r\n                \"diffuseMatrix\",\r\n                \"offset\",\r\n                \"color\",\r\n                \"logarithmicDepthConstant\",\r\n                \"morphTargetInfluences\",\r\n                \"boneTextureWidth\",\r\n                \"morphTargetCount\",\r\n                \"morphTargetTextureInfo\",\r\n                \"morphTargetTextureIndices\",\r\n                \"bakedVertexAnimationSettings\",\r\n                \"bakedVertexAnimationTextureSizeInverted\",\r\n                \"bakedVertexAnimationTime\",\r\n                \"bakedVertexAnimationTexture\",\r\n            ];\r\n            const samplers = [\"diffuseSampler\", \"boneSampler\", \"morphTargets\", \"bakedVertexAnimationTexture\"];\r\n\r\n            AddClipPlaneUniforms(uniforms);\r\n\r\n            drawWrapper.setEffect(\r\n                this.scene.getEngine().createEffect(\r\n                    \"outline\",\r\n                    <IEffectCreationOptions>{\r\n                        attributes: attribs,\r\n                        uniformsNames: uniforms,\r\n                        uniformBuffersNames: [],\r\n                        samplers: samplers,\r\n                        defines: join,\r\n                        fallbacks: fallbacks,\r\n                        onCompiled: null,\r\n                        onError: null,\r\n                        indexParameters: { maxSimultaneousMorphTargets: numMorphInfluencers },\r\n                        shaderLanguage: this._shaderLanguage,\r\n                        extraInitializationsAsync: async () => {\r\n                            if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                                await Promise.all([import(\"../ShadersWGSL/outline.fragment\"), import(\"../ShadersWGSL/outline.vertex\")]);\r\n                            } else {\r\n                                await Promise.all([import(\"../Shaders/outline.fragment\"), import(\"../Shaders/outline.vertex\")]);\r\n                            }\r\n                        },\r\n                    },\r\n                    this.scene.getEngine()\r\n                ),\r\n                join\r\n            );\r\n        }\r\n\r\n        return drawWrapper.effect!.isReady();\r\n    }\r\n\r\n    private _beforeRenderingMesh(mesh: Mesh, subMesh: SubMesh, batch: _InstancesBatch): void {\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n\r\n        // Outline - step 1\r\n        this._savedDepthWrite = this._engine.getDepthWrite();\r\n        if (mesh.renderOutline) {\r\n            const material = subMesh.getMaterial();\r\n            if (material && material.needAlphaBlendingForMesh(mesh)) {\r\n                this._engine.cacheStencilState();\r\n                // Draw only to stencil buffer for the original mesh\r\n                // The resulting stencil buffer will be used so the outline is not visible inside the mesh when the mesh is transparent\r\n                this._engine.setDepthWrite(false);\r\n                this._engine.setColorWrite(false);\r\n                this._engine.setStencilBuffer(true);\r\n                this._engine.setStencilOperationPass(Constants.REPLACE);\r\n                this._engine.setStencilFunction(Constants.ALWAYS);\r\n                this._engine.setStencilMask(OutlineRenderer._StencilReference);\r\n                this._engine.setStencilFunctionReference(OutlineRenderer._StencilReference);\r\n                this._engine.stencilStateComposer.useStencilGlobalOnly = true;\r\n                this.render(subMesh, batch, /* This sets offset to 0 */ true, this._passIdForDrawWrapper[1]);\r\n\r\n                this._engine.setColorWrite(true);\r\n                this._engine.setStencilFunction(Constants.NOTEQUAL);\r\n            }\r\n\r\n            // Draw the outline using the above stencil if needed to avoid drawing within the mesh\r\n            this._engine.setDepthWrite(false);\r\n            this.render(subMesh, batch, false, this._passIdForDrawWrapper[0]);\r\n            this._engine.setDepthWrite(this._savedDepthWrite);\r\n\r\n            if (material && material.needAlphaBlendingForMesh(mesh)) {\r\n                this._engine.stencilStateComposer.useStencilGlobalOnly = false;\r\n                this._engine.restoreStencilState();\r\n            }\r\n        }\r\n    }\r\n\r\n    private _afterRenderingMesh(mesh: Mesh, subMesh: SubMesh, batch: _InstancesBatch): void {\r\n        if (!this.enabled) {\r\n            return;\r\n        }\r\n\r\n        // Overlay\r\n        if (mesh.renderOverlay) {\r\n            const currentMode = this._engine.getAlphaMode();\r\n            const alphaBlendState = this._engine.alphaState.alphaBlend;\r\n            this._engine.setAlphaMode(Constants.ALPHA_COMBINE);\r\n            this.render(subMesh, batch, true, this._passIdForDrawWrapper[3]);\r\n            this._engine.setAlphaMode(currentMode);\r\n            this._engine.setDepthWrite(this._savedDepthWrite);\r\n            this._engine.alphaState.setAlphaBlend(alphaBlendState);\r\n        }\r\n\r\n        // Outline - step 2\r\n        if (mesh.renderOutline && this._savedDepthWrite) {\r\n            this._engine.setDepthWrite(true);\r\n            this._engine.setColorWrite(false);\r\n            this.render(subMesh, batch, false, this._passIdForDrawWrapper[2]);\r\n            this._engine.setColorWrite(true);\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10755, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderingObject.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderingObject.ts"],"sourcesContent":["import type { VertexBuffer } from \"core/Buffers/buffer\";\r\nimport type { DataBuffer } from \"core/Buffers/dataBuffer\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { AbstractEngine } from \"core/Engines/abstractEngine\";\r\nimport { EffectWrapper } from \"core/Materials/effectRenderer\";\r\nimport { Observable } from \"core/Misc/observable\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { Nullable } from \"core/types\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Defines the base object used for fluid rendering.\r\n * It is based on a list of vertices (particles)\r\n */\r\nexport abstract class FluidRenderingObject {\r\n    protected _scene: Scene;\r\n    protected _engine: AbstractEngine;\r\n    protected _effectsAreDirty: boolean;\r\n    protected _depthEffectWrapper: Nullable<EffectWrapper>;\r\n    protected _thicknessEffectWrapper: Nullable<EffectWrapper>;\r\n\r\n    /** Defines the priority of the object. Objects will be rendered in ascending order of priority */\r\n    public priority = 0;\r\n\r\n    protected _particleSize = 0.1;\r\n\r\n    /** Observable triggered when the size of the particle is changed */\r\n    public onParticleSizeChanged = new Observable<FluidRenderingObject>();\r\n\r\n    /** Gets or sets the size of the particle */\r\n    public get particleSize() {\r\n        return this._particleSize;\r\n    }\r\n\r\n    public set particleSize(size: number) {\r\n        if (size === this._particleSize) {\r\n            return;\r\n        }\r\n\r\n        this._particleSize = size;\r\n        this.onParticleSizeChanged.notifyObservers(this);\r\n    }\r\n\r\n    /** Defines the alpha value of a particle */\r\n    public particleThicknessAlpha = 0.05;\r\n\r\n    /** Indicates if the object uses instancing or not */\r\n    public get useInstancing() {\r\n        return !this.indexBuffer;\r\n    }\r\n\r\n    private _useVelocity = false;\r\n\r\n    /** Indicates if velocity of particles should be used when rendering the object. The vertex buffer set must contain a \"velocity\" buffer for this to work! */\r\n    public get useVelocity() {\r\n        return this._useVelocity;\r\n    }\r\n\r\n    public set useVelocity(use: boolean) {\r\n        if (this._useVelocity === use || !this._hasVelocity()) {\r\n            return;\r\n        }\r\n\r\n        this._useVelocity = use;\r\n        this._effectsAreDirty = true;\r\n    }\r\n\r\n    private _hasVelocity() {\r\n        return !!this.vertexBuffers?.velocity;\r\n    }\r\n\r\n    /**\r\n     * Gets the vertex buffers\r\n     */\r\n    public abstract get vertexBuffers(): { [key: string]: VertexBuffer };\r\n\r\n    /**\r\n     * Gets the index buffer (or null if the object is using instancing)\r\n     */\r\n    public get indexBuffer(): Nullable<DataBuffer> {\r\n        return null;\r\n    }\r\n\r\n    /**\r\n     * @returns the name of the class\r\n     */\r\n    public getClassName(): string {\r\n        return \"FluidRenderingObject\";\r\n    }\r\n\r\n    /** Shader language used by the object */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this object\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Instantiates a fluid rendering object\r\n     * @param scene The scene the object is part of\r\n     * @param shaderLanguage The shader language to use\r\n     */\r\n    constructor(scene: Scene, shaderLanguage?: ShaderLanguage) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._effectsAreDirty = true;\r\n        this._depthEffectWrapper = null;\r\n        this._thicknessEffectWrapper = null;\r\n        this._shaderLanguage = shaderLanguage ?? (this._engine.isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL);\r\n    }\r\n\r\n    protected _createEffects(): void {\r\n        const uniformNames = [\"view\", \"projection\", \"particleRadius\", \"size\"];\r\n        const attributeNames = [\"position\", \"offset\"];\r\n        const defines: string[] = [];\r\n\r\n        this._effectsAreDirty = false;\r\n\r\n        if (this.useVelocity) {\r\n            attributeNames.push(\"velocity\");\r\n            defines.push(\"#define FLUIDRENDERING_VELOCITY\");\r\n        }\r\n\r\n        if (this._scene.useRightHandedSystem) {\r\n            defines.push(\"#define FLUIDRENDERING_RHS\");\r\n        }\r\n\r\n        this._depthEffectWrapper = new EffectWrapper({\r\n            engine: this._engine,\r\n            useShaderStore: true,\r\n            vertexShader: \"fluidRenderingParticleDepth\",\r\n            fragmentShader: \"fluidRenderingParticleDepth\",\r\n            attributeNames,\r\n            uniformNames,\r\n            samplerNames: [],\r\n            defines,\r\n            shaderLanguage: this._shaderLanguage,\r\n            extraInitializationsAsync: async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/fluidRenderingParticleDepth.vertex\"), import(\"../../ShadersWGSL/fluidRenderingParticleDepth.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/fluidRenderingParticleDepth.vertex\"), import(\"../../Shaders/fluidRenderingParticleDepth.fragment\")]);\r\n                }\r\n            },\r\n        });\r\n\r\n        uniformNames.push(\"particleAlpha\");\r\n\r\n        this._thicknessEffectWrapper = new EffectWrapper({\r\n            engine: this._engine,\r\n            useShaderStore: true,\r\n            vertexShader: \"fluidRenderingParticleThickness\",\r\n            fragmentShader: \"fluidRenderingParticleThickness\",\r\n            attributeNames: [\"position\", \"offset\"],\r\n            uniformNames,\r\n            samplerNames: [],\r\n            shaderLanguage: this._shaderLanguage,\r\n            extraInitializationsAsync: async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await Promise.all([import(\"../../ShadersWGSL/fluidRenderingParticleThickness.vertex\"), import(\"../../ShadersWGSL/fluidRenderingParticleThickness.fragment\")]);\r\n                } else {\r\n                    await Promise.all([import(\"../../Shaders/fluidRenderingParticleThickness.vertex\"), import(\"../../Shaders/fluidRenderingParticleThickness.fragment\")]);\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Indicates if the object is ready to be rendered\r\n     * @returns True if everything is ready for the object to be rendered, otherwise false\r\n     */\r\n    public isReady(): boolean {\r\n        if (this._effectsAreDirty) {\r\n            this._createEffects();\r\n        }\r\n\r\n        if (!this._depthEffectWrapper || !this._thicknessEffectWrapper) {\r\n            return false;\r\n        }\r\n\r\n        const depthEffect = this._depthEffectWrapper.drawWrapper.effect!;\r\n        const thicknessEffect = this._thicknessEffectWrapper.drawWrapper.effect!;\r\n\r\n        return depthEffect.isReady() && thicknessEffect.isReady();\r\n    }\r\n\r\n    /**\r\n     * Gets the number of particles (vertices) of this object\r\n     * @returns The number of particles\r\n     */\r\n    public abstract get numParticles(): number;\r\n\r\n    /**\r\n     * Render the depth texture for this object\r\n     */\r\n    public renderDepthTexture(): void {\r\n        const numParticles = this.numParticles;\r\n\r\n        if (!this._depthEffectWrapper || numParticles === 0) {\r\n            return;\r\n        }\r\n\r\n        const depthDrawWrapper = this._depthEffectWrapper.drawWrapper;\r\n        const depthEffect = depthDrawWrapper.effect!;\r\n\r\n        this._engine.enableEffect(depthDrawWrapper);\r\n        this._engine.bindBuffers(this.vertexBuffers, this.indexBuffer, depthEffect);\r\n\r\n        depthEffect.setMatrix(\"view\", this._scene.getViewMatrix());\r\n        depthEffect.setMatrix(\"projection\", this._scene.getProjectionMatrix());\r\n        depthEffect.setFloat2(\"size\", this._particleSize, this._particleSize);\r\n        depthEffect.setFloat(\"particleRadius\", this._particleSize / 2);\r\n\r\n        if (this.useInstancing) {\r\n            this._engine.drawArraysType(Constants.MATERIAL_TriangleStripDrawMode, 0, 4, numParticles);\r\n        } else {\r\n            this._engine.drawElementsType(Constants.MATERIAL_TriangleFillMode, 0, numParticles);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Render the thickness texture for this object\r\n     */\r\n    public renderThicknessTexture(): void {\r\n        const numParticles = this.numParticles;\r\n\r\n        if (!this._thicknessEffectWrapper || numParticles === 0) {\r\n            return;\r\n        }\r\n\r\n        const thicknessDrawWrapper = this._thicknessEffectWrapper.drawWrapper;\r\n        const thicknessEffect = thicknessDrawWrapper.effect!;\r\n\r\n        this._engine.setAlphaMode(Constants.ALPHA_ONEONE);\r\n        this._engine.setDepthWrite(false);\r\n\r\n        this._engine.enableEffect(thicknessDrawWrapper);\r\n        this._engine.bindBuffers(this.vertexBuffers, this.indexBuffer, thicknessEffect);\r\n\r\n        thicknessEffect.setMatrix(\"view\", this._scene.getViewMatrix());\r\n        thicknessEffect.setMatrix(\"projection\", this._scene.getProjectionMatrix());\r\n        thicknessEffect.setFloat(\"particleAlpha\", this.particleThicknessAlpha);\r\n        thicknessEffect.setFloat2(\"size\", this._particleSize, this._particleSize);\r\n\r\n        if (this.useInstancing) {\r\n            this._engine.drawArraysType(Constants.MATERIAL_TriangleStripDrawMode, 0, 4, numParticles);\r\n        } else {\r\n            this._engine.drawElementsType(Constants.MATERIAL_TriangleFillMode, 0, numParticles);\r\n        }\r\n\r\n        this._engine.setDepthWrite(true);\r\n        this._engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n    }\r\n\r\n    /**\r\n     * Render the diffuse texture for this object\r\n     */\r\n    public renderDiffuseTexture(): void {\r\n        // do nothing by default\r\n    }\r\n\r\n    /**\r\n     * Releases the resources used by the class\r\n     */\r\n    public dispose(): void {\r\n        this._depthEffectWrapper?.dispose(false);\r\n        this._thicknessEffectWrapper?.dispose(false);\r\n        this.onParticleSizeChanged.clear();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 10972, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderingObjectParticleSystem.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderingObjectParticleSystem.ts"],"sourcesContent":["import type { VertexBuffer } from \"core/Buffers/buffer\";\r\nimport type { DataBuffer } from \"core/Buffers/dataBuffer\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { Effect } from \"core/Materials/effect\";\r\nimport type { Observer } from \"core/Misc/observable\";\r\nimport type { IParticleSystem } from \"core/Particles/IParticleSystem\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { Nullable } from \"core/types\";\r\n\r\nimport { FluidRenderingObject } from \"./fluidRenderingObject\";\r\nimport type { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Defines a rendering object based on a particle system\r\n */\r\nexport class FluidRenderingObjectParticleSystem extends FluidRenderingObject {\r\n    private _particleSystem: IParticleSystem;\r\n    private _originalRender: () => number;\r\n    private _blendMode: number;\r\n    private _onBeforeDrawParticleObserver: Nullable<Observer<Nullable<Effect>>>;\r\n    private _updateInAnimate: boolean;\r\n\r\n    /** Gets the particle system */\r\n    public get particleSystem() {\r\n        return this._particleSystem;\r\n    }\r\n\r\n    /**\r\n     * @returns the name of the class\r\n     */\r\n    public override getClassName(): string {\r\n        return \"FluidRenderingObjectParticleSystem\";\r\n    }\r\n\r\n    private _useTrueRenderingForDiffuseTexture = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that the diffuse texture should be generated based on the regular rendering of the particle system (default: true).\r\n     * Sometimes, generating the diffuse texture this way may be sub-optimal. In that case, you can disable this property, in which case the particle system will be\r\n     * rendered using a ALPHA_COMBINE mode instead of the one used by the particle system.\r\n     */\r\n    public get useTrueRenderingForDiffuseTexture() {\r\n        return this._useTrueRenderingForDiffuseTexture;\r\n    }\r\n\r\n    public set useTrueRenderingForDiffuseTexture(use: boolean) {\r\n        if (this._useTrueRenderingForDiffuseTexture === use) {\r\n            return;\r\n        }\r\n\r\n        this._useTrueRenderingForDiffuseTexture = use;\r\n\r\n        if (use) {\r\n            this._particleSystem.blendMode = this._blendMode;\r\n            this._particleSystem.onBeforeDrawParticlesObservable.remove(this._onBeforeDrawParticleObserver);\r\n            this._onBeforeDrawParticleObserver = null;\r\n        } else {\r\n            this._particleSystem.blendMode = -1;\r\n            this._onBeforeDrawParticleObserver = this._particleSystem.onBeforeDrawParticlesObservable.add(() => {\r\n                this._engine.setAlphaMode(Constants.ALPHA_COMBINE);\r\n            });\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the vertex buffers\r\n     */\r\n    public get vertexBuffers(): { [key: string]: VertexBuffer } {\r\n        return this._particleSystem.vertexBuffers as { [key: string]: VertexBuffer };\r\n    }\r\n\r\n    /**\r\n     * Gets the index buffer (or null if the object is using instancing)\r\n     */\r\n    public override get indexBuffer(): Nullable<DataBuffer> {\r\n        return this._particleSystem.indexBuffer;\r\n    }\r\n\r\n    /**\r\n     * Creates a new instance of the class\r\n     * @param scene The scene the particle system is part of\r\n     * @param ps The particle system\r\n     * @param shaderLanguage The shader language to use\r\n     */\r\n    constructor(scene: Scene, ps: IParticleSystem, shaderLanguage?: ShaderLanguage) {\r\n        super(scene, shaderLanguage);\r\n\r\n        this._particleSystem = ps;\r\n\r\n        this._originalRender = ps.render.bind(ps);\r\n        this._blendMode = ps.blendMode;\r\n        this._onBeforeDrawParticleObserver = null;\r\n        this._updateInAnimate = this._particleSystem.updateInAnimate;\r\n        this._particleSystem.updateInAnimate = true;\r\n        this._particleSystem.render = () => 0;\r\n\r\n        this.particleSize = (ps.minSize + ps.maxSize) / 2;\r\n\r\n        this.useTrueRenderingForDiffuseTexture = false;\r\n    }\r\n\r\n    /**\r\n     * Indicates if the object is ready to be rendered\r\n     * @returns True if everything is ready for the object to be rendered, otherwise false\r\n     */\r\n    public override isReady(): boolean {\r\n        return super.isReady() && this._particleSystem.isReady();\r\n    }\r\n\r\n    /**\r\n     * Gets the number of particles in this particle system\r\n     * @returns The number of particles\r\n     */\r\n    public get numParticles(): number {\r\n        return this._particleSystem.getActiveCount();\r\n    }\r\n\r\n    /**\r\n     * Render the diffuse texture for this object\r\n     */\r\n    public override renderDiffuseTexture(): void {\r\n        this._originalRender();\r\n    }\r\n\r\n    /**\r\n     * Releases the resources used by the class\r\n     */\r\n    public override dispose() {\r\n        super.dispose();\r\n\r\n        this._particleSystem.onBeforeDrawParticlesObservable.remove(this._onBeforeDrawParticleObserver);\r\n        this._onBeforeDrawParticleObserver = null;\r\n        this._particleSystem.render = this._originalRender;\r\n        this._particleSystem.blendMode = this._blendMode;\r\n        this._particleSystem.updateInAnimate = this._updateInAnimate;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11070, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderingTextures.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderingTextures.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-misused-promises */\r\nimport type { Camera } from \"core/Cameras/camera\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { AbstractEngine } from \"core/Engines/abstractEngine\";\r\nimport type { RenderTargetWrapper } from \"core/Engines/renderTargetWrapper\";\r\nimport { Texture } from \"core/Materials/Textures/texture\";\r\nimport type { ThinTexture } from \"core/Materials/Textures/thinTexture\";\r\nimport { Vector2 } from \"core/Maths/math.vector\";\r\nimport { PostProcess } from \"core/PostProcesses/postProcess\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { Nullable } from \"core/types\";\r\nimport { Observable } from \"core/Misc/observable\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/** @internal */\r\nexport class FluidRenderingTextures {\r\n    protected _name: string;\r\n    protected _scene: Scene;\r\n    protected _camera: Nullable<Camera>;\r\n    protected _engine: AbstractEngine;\r\n    protected _width: number;\r\n    protected _height: number;\r\n    protected _blurTextureSizeX: number;\r\n    protected _blurTextureSizeY: number;\r\n    protected _textureType: number;\r\n    protected _textureFormat: number;\r\n    protected _blurTextureType: number;\r\n    protected _blurTextureFormat: number;\r\n    protected _useStandardBlur: boolean;\r\n    protected _generateDepthBuffer: boolean;\r\n    protected _samples: number;\r\n    protected _postProcessRunningIndex: number;\r\n\r\n    protected _rt: Nullable<RenderTargetWrapper>;\r\n    protected _texture: Nullable<Texture>;\r\n    protected _rtBlur: Nullable<RenderTargetWrapper>;\r\n    protected _textureBlurred: Nullable<Texture>;\r\n    protected _blurPostProcesses: Nullable<PostProcess[]>;\r\n\r\n    public enableBlur = true;\r\n\r\n    public blurSizeDivisor = 1;\r\n\r\n    public blurFilterSize = 7;\r\n\r\n    private _blurNumIterations = 3;\r\n\r\n    public get blurNumIterations() {\r\n        return this._blurNumIterations;\r\n    }\r\n\r\n    public set blurNumIterations(numIterations: number) {\r\n        if (this._blurNumIterations === numIterations) {\r\n            return;\r\n        }\r\n\r\n        this._blurNumIterations = numIterations;\r\n        if (this._blurPostProcesses !== null) {\r\n            const blurX = this._blurPostProcesses[0];\r\n            const blurY = this._blurPostProcesses[1];\r\n\r\n            this._blurPostProcesses = [];\r\n            for (let i = 0; i < this._blurNumIterations * 2; ++i) {\r\n                this._blurPostProcesses[i] = i & 1 ? blurY : blurX;\r\n            }\r\n        }\r\n    }\r\n\r\n    public blurMaxFilterSize = 100;\r\n\r\n    public blurDepthScale = 10;\r\n\r\n    public particleSize = 0.02;\r\n\r\n    public onDisposeObservable: Observable<FluidRenderingTextures> = new Observable<FluidRenderingTextures>();\r\n\r\n    public get renderTarget() {\r\n        return this._rt;\r\n    }\r\n\r\n    public get renderTargetBlur() {\r\n        return this._rtBlur;\r\n    }\r\n\r\n    public get texture() {\r\n        return this._texture;\r\n    }\r\n\r\n    public get textureBlur() {\r\n        return this._textureBlurred;\r\n    }\r\n\r\n    /** Shader language used by the texture */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in the texture\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    constructor(\r\n        name: string,\r\n        scene: Scene,\r\n        width: number,\r\n        height: number,\r\n        blurTextureSizeX: number,\r\n        blurTextureSizeY: number,\r\n        textureType: number = Constants.TEXTURETYPE_FLOAT,\r\n        textureFormat: number = Constants.TEXTUREFORMAT_R,\r\n        blurTextureType: number = Constants.TEXTURETYPE_FLOAT,\r\n        blurTextureFormat: number = Constants.TEXTUREFORMAT_R,\r\n        useStandardBlur = false,\r\n        camera: Nullable<Camera> = null,\r\n        generateDepthBuffer = true,\r\n        samples = 1,\r\n        shaderLanguage?: ShaderLanguage\r\n    ) {\r\n        this._name = name;\r\n        this._scene = scene;\r\n        this._camera = camera;\r\n        this._engine = scene.getEngine();\r\n        this._width = width;\r\n        this._height = height;\r\n        this._blurTextureSizeX = blurTextureSizeX;\r\n        this._blurTextureSizeY = blurTextureSizeY;\r\n        this._textureType = textureType;\r\n        this._textureFormat = textureFormat;\r\n        this._blurTextureType = blurTextureType;\r\n        this._blurTextureFormat = blurTextureFormat;\r\n        this._useStandardBlur = useStandardBlur;\r\n        this._generateDepthBuffer = generateDepthBuffer;\r\n        this._samples = samples;\r\n        this._postProcessRunningIndex = 0;\r\n        this.enableBlur = blurTextureSizeX !== 0 && blurTextureSizeY !== 0;\r\n\r\n        this._rt = null;\r\n        this._texture = null;\r\n        this._rtBlur = null;\r\n        this._textureBlurred = null;\r\n        this._blurPostProcesses = null;\r\n\r\n        this._shaderLanguage = shaderLanguage ?? (this._engine.isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL);\r\n    }\r\n\r\n    public initialize(): void {\r\n        this.dispose();\r\n\r\n        this._createRenderTarget();\r\n\r\n        if (this.enableBlur && this._texture) {\r\n            const [rtBlur, textureBlurred, blurPostProcesses] = this._createBlurPostProcesses(\r\n                this._texture,\r\n                this._blurTextureType,\r\n                this._blurTextureFormat,\r\n                this.blurSizeDivisor,\r\n                this._name,\r\n                this._useStandardBlur\r\n            );\r\n            this._rtBlur = rtBlur;\r\n            this._textureBlurred = textureBlurred;\r\n            this._blurPostProcesses = blurPostProcesses;\r\n        }\r\n    }\r\n\r\n    public applyBlurPostProcesses(): void {\r\n        if (this.enableBlur && this._blurPostProcesses) {\r\n            this._postProcessRunningIndex = 0;\r\n            this._scene.postProcessManager.directRender(this._blurPostProcesses, this._rtBlur, true);\r\n            this._engine.unBindFramebuffer(this._rtBlur!);\r\n        }\r\n    }\r\n\r\n    protected _createRenderTarget(): void {\r\n        this._rt = this._engine.createRenderTargetTexture(\r\n            { width: this._width, height: this._height },\r\n            {\r\n                generateMipMaps: false,\r\n                type: this._textureType,\r\n                format: this._textureFormat,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                generateDepthBuffer: this._generateDepthBuffer,\r\n                generateStencilBuffer: false,\r\n                samples: this._samples,\r\n                label: `FluidRenderingRTT-${this._name}`,\r\n            }\r\n        );\r\n\r\n        const renderTexture = this._rt.texture!;\r\n\r\n        renderTexture.incrementReferences();\r\n\r\n        this._texture = new Texture(null, this._scene);\r\n        this._texture.name = \"rtt\" + this._name;\r\n        this._texture._texture = renderTexture;\r\n        this._texture.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n        this._texture.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n        this._texture.anisotropicFilteringLevel = 1;\r\n    }\r\n\r\n    protected _createBlurPostProcesses(\r\n        textureBlurSource: ThinTexture,\r\n        textureType: number,\r\n        textureFormat: number,\r\n        blurSizeDivisor: number,\r\n        debugName: string,\r\n        useStandardBlur = false\r\n    ): [RenderTargetWrapper, Texture, PostProcess[]] {\r\n        const engine = this._scene.getEngine();\r\n        const targetSize = new Vector2(Math.floor(this._blurTextureSizeX / blurSizeDivisor), Math.floor(this._blurTextureSizeY / blurSizeDivisor));\r\n        const useBilinearFiltering =\r\n            (textureType === Constants.TEXTURETYPE_FLOAT && engine.getCaps().textureFloatLinearFiltering) ||\r\n            (textureType === Constants.TEXTURETYPE_HALF_FLOAT && engine.getCaps().textureHalfFloatLinearFiltering);\r\n\r\n        const rtBlur = this._engine.createRenderTargetTexture(\r\n            { width: targetSize.x, height: targetSize.y },\r\n            {\r\n                generateMipMaps: false,\r\n                type: textureType,\r\n                format: textureFormat,\r\n                samplingMode: useBilinearFiltering ? Constants.TEXTURE_BILINEAR_SAMPLINGMODE : Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                generateDepthBuffer: false,\r\n                generateStencilBuffer: false,\r\n                samples: this._samples,\r\n                label: `FluidRenderingRTTBlur-${debugName}`,\r\n            }\r\n        );\r\n\r\n        const renderTexture = rtBlur.texture!;\r\n\r\n        renderTexture.incrementReferences();\r\n\r\n        const texture = new Texture(null, this._scene);\r\n        texture.name = \"rttBlurred\" + debugName;\r\n        texture._texture = renderTexture;\r\n        texture.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n        texture.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n        texture.anisotropicFilteringLevel = 1;\r\n\r\n        if (useStandardBlur) {\r\n            const kernelBlurXPostprocess = new PostProcess(\r\n                \"BilateralBlurX\",\r\n                \"fluidRenderingStandardBlur\",\r\n                [\"filterSize\", \"blurDir\"],\r\n                null,\r\n                1,\r\n                null,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                engine,\r\n                true,\r\n                null,\r\n                textureType,\r\n                undefined,\r\n                undefined,\r\n                undefined,\r\n                textureFormat,\r\n                this._shaderLanguage,\r\n                // Keeping this issue for further discussion - extraInitialization should return Promise<void>\r\n                async () => {\r\n                    if (this.shaderLanguage === ShaderLanguage.WGSL) {\r\n                        await import(\"../../ShadersWGSL/fluidRenderingStandardBlur.fragment\");\r\n                    } else {\r\n                        await import(\"../../Shaders/fluidRenderingStandardBlur.fragment\");\r\n                    }\r\n                }\r\n            );\r\n            kernelBlurXPostprocess.samples = this._samples;\r\n            kernelBlurXPostprocess.externalTextureSamplerBinding = true;\r\n            kernelBlurXPostprocess.onApplyObservable.add((effect) => {\r\n                if (this._postProcessRunningIndex === 0) {\r\n                    effect.setTexture(\"textureSampler\", textureBlurSource);\r\n                } else {\r\n                    effect._bindTexture(\"textureSampler\", kernelBlurXPostprocess.inputTexture.texture);\r\n                }\r\n                effect.setInt(\"filterSize\", this.blurFilterSize);\r\n                effect.setFloat2(\"blurDir\", 1 / this._blurTextureSizeX, 0);\r\n                this._postProcessRunningIndex++;\r\n            });\r\n            kernelBlurXPostprocess.onSizeChangedObservable.add(() => {\r\n                kernelBlurXPostprocess._textures.forEach((rt) => {\r\n                    rt.texture!.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n                    rt.texture!.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n                });\r\n            });\r\n            this._fixReusablePostProcess(kernelBlurXPostprocess);\r\n\r\n            const kernelBlurYPostprocess = new PostProcess(\r\n                \"BilateralBlurY\",\r\n                \"fluidRenderingStandardBlur\",\r\n                [\"filterSize\", \"blurDir\"],\r\n                null,\r\n                1,\r\n                null,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                engine,\r\n                true,\r\n                null,\r\n                textureType,\r\n                undefined,\r\n                undefined,\r\n                undefined,\r\n                textureFormat,\r\n                this._shaderLanguage,\r\n                async () => {\r\n                    if (this.shaderLanguage === ShaderLanguage.WGSL) {\r\n                        await import(\"../../ShadersWGSL/fluidRenderingStandardBlur.fragment\");\r\n                    } else {\r\n                        await import(\"../../Shaders/fluidRenderingStandardBlur.fragment\");\r\n                    }\r\n                }\r\n            );\r\n            kernelBlurYPostprocess.samples = this._samples;\r\n            kernelBlurYPostprocess.onApplyObservable.add((effect) => {\r\n                effect.setInt(\"filterSize\", this.blurFilterSize);\r\n                effect.setFloat2(\"blurDir\", 0, 1 / this._blurTextureSizeY);\r\n                this._postProcessRunningIndex++;\r\n            });\r\n            kernelBlurYPostprocess.onSizeChangedObservable.add(() => {\r\n                kernelBlurYPostprocess._textures.forEach((rt) => {\r\n                    rt.texture!.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n                    rt.texture!.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n                });\r\n            });\r\n            this._fixReusablePostProcess(kernelBlurYPostprocess);\r\n\r\n            kernelBlurXPostprocess.autoClear = false;\r\n            kernelBlurYPostprocess.autoClear = false;\r\n\r\n            const blurList = [];\r\n            for (let i = 0; i < this._blurNumIterations * 2; ++i) {\r\n                blurList[i] = i & 1 ? kernelBlurYPostprocess : kernelBlurXPostprocess;\r\n            }\r\n\r\n            return [rtBlur, texture, blurList];\r\n        } else {\r\n            const uniforms: string[] = [\"maxFilterSize\", \"blurDir\", \"projectedParticleConstant\", \"depthThreshold\"];\r\n\r\n            const kernelBlurXPostprocess = new PostProcess(\r\n                \"BilateralBlurX\",\r\n                \"fluidRenderingBilateralBlur\",\r\n                uniforms,\r\n                null,\r\n                1,\r\n                null,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                engine,\r\n                true,\r\n                null,\r\n                textureType,\r\n                undefined,\r\n                undefined,\r\n                undefined,\r\n                textureFormat,\r\n                this._shaderLanguage,\r\n                async () => {\r\n                    if (this.shaderLanguage === ShaderLanguage.WGSL) {\r\n                        await import(\"../../ShadersWGSL/fluidRenderingBilateralBlur.fragment\");\r\n                    } else {\r\n                        await import(\"../../Shaders/fluidRenderingBilateralBlur.fragment\");\r\n                    }\r\n                }\r\n            );\r\n            kernelBlurXPostprocess.samples = this._samples;\r\n            kernelBlurXPostprocess.externalTextureSamplerBinding = true;\r\n            kernelBlurXPostprocess.onApplyObservable.add((effect) => {\r\n                if (this._postProcessRunningIndex === 0) {\r\n                    effect.setTexture(\"textureSampler\", textureBlurSource);\r\n                } else {\r\n                    effect._bindTexture(\"textureSampler\", kernelBlurXPostprocess.inputTexture.texture);\r\n                }\r\n                effect.setInt(\"maxFilterSize\", this.blurMaxFilterSize);\r\n                effect.setFloat2(\"blurDir\", 1 / this._blurTextureSizeX, 0);\r\n                effect.setFloat(\"projectedParticleConstant\", this._getProjectedParticleConstant());\r\n                effect.setFloat(\"depthThreshold\", this._getDepthThreshold());\r\n                this._postProcessRunningIndex++;\r\n            });\r\n            kernelBlurXPostprocess.onSizeChangedObservable.add(() => {\r\n                kernelBlurXPostprocess._textures.forEach((rt) => {\r\n                    rt.texture!.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n                    rt.texture!.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n                });\r\n            });\r\n            this._fixReusablePostProcess(kernelBlurXPostprocess);\r\n\r\n            const kernelBlurYPostprocess = new PostProcess(\r\n                \"BilateralBlurY\",\r\n                \"fluidRenderingBilateralBlur\",\r\n                uniforms,\r\n                null,\r\n                1,\r\n                null,\r\n                Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                engine,\r\n                true,\r\n                null,\r\n                textureType,\r\n                undefined,\r\n                undefined,\r\n                undefined,\r\n                textureFormat,\r\n                this._shaderLanguage,\r\n                async () => {\r\n                    if (this.shaderLanguage === ShaderLanguage.WGSL) {\r\n                        await import(\"../../ShadersWGSL/fluidRenderingBilateralBlur.fragment\");\r\n                    } else {\r\n                        await import(\"../../Shaders/fluidRenderingBilateralBlur.fragment\");\r\n                    }\r\n                }\r\n            );\r\n            kernelBlurYPostprocess.samples = this._samples;\r\n            kernelBlurYPostprocess.onApplyObservable.add((effect) => {\r\n                effect.setInt(\"maxFilterSize\", this.blurMaxFilterSize);\r\n                effect.setFloat2(\"blurDir\", 0, 1 / this._blurTextureSizeY);\r\n                effect.setFloat(\"projectedParticleConstant\", this._getProjectedParticleConstant());\r\n                effect.setFloat(\"depthThreshold\", this._getDepthThreshold());\r\n                this._postProcessRunningIndex++;\r\n            });\r\n            kernelBlurYPostprocess.onSizeChangedObservable.add(() => {\r\n                kernelBlurYPostprocess._textures.forEach((rt) => {\r\n                    rt.texture!.wrapU = Texture.CLAMP_ADDRESSMODE;\r\n                    rt.texture!.wrapV = Texture.CLAMP_ADDRESSMODE;\r\n                });\r\n            });\r\n            this._fixReusablePostProcess(kernelBlurYPostprocess);\r\n\r\n            kernelBlurXPostprocess.autoClear = false;\r\n            kernelBlurYPostprocess.autoClear = false;\r\n\r\n            const blurList = [];\r\n            for (let i = 0; i < this._blurNumIterations * 2; ++i) {\r\n                blurList[i] = i & 1 ? kernelBlurYPostprocess : kernelBlurXPostprocess;\r\n            }\r\n\r\n            return [rtBlur, texture, blurList];\r\n        }\r\n    }\r\n\r\n    private _fixReusablePostProcess(pp: PostProcess) {\r\n        if (!pp.isReusable()) {\r\n            return;\r\n        }\r\n\r\n        pp.onActivateObservable.add(() => {\r\n            // undo what calling activate() does which will make sure we will retrieve the right texture when getting the input for the post process\r\n            pp._currentRenderTextureInd = (pp._currentRenderTextureInd + 1) % 2;\r\n        });\r\n        pp.onApplyObservable.add(() => {\r\n            // now we can advance to the next texture\r\n            pp._currentRenderTextureInd = (pp._currentRenderTextureInd + 1) % 2;\r\n        });\r\n    }\r\n\r\n    private _getProjectedParticleConstant() {\r\n        return (this.blurFilterSize * this.particleSize * 0.05 * (this._height / 2)) / Math.tan((this._camera?.fov ?? (45 * Math.PI) / 180) / 2);\r\n    }\r\n\r\n    private _getDepthThreshold() {\r\n        return (this.particleSize / 2) * this.blurDepthScale;\r\n    }\r\n\r\n    public dispose(): void {\r\n        if (this.onDisposeObservable.hasObservers()) {\r\n            this.onDisposeObservable.notifyObservers(this);\r\n        }\r\n\r\n        this.onDisposeObservable.clear();\r\n\r\n        this._rt?.dispose();\r\n        this._rt = null;\r\n        this._texture?.dispose();\r\n        this._texture = null;\r\n        this._rtBlur?.dispose();\r\n        this._rtBlur = null;\r\n        this._textureBlurred?.dispose();\r\n        this._textureBlurred = null;\r\n        if (this._blurPostProcesses) {\r\n            this._blurPostProcesses[0].dispose();\r\n            this._blurPostProcesses[1].dispose();\r\n        }\r\n        this._blurPostProcesses = null;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 11394, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderingTargetRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderingTargetRenderer.ts"],"sourcesContent":["import type { Camera } from \"core/Cameras/camera\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { AbstractEngine } from \"core/Engines/abstractEngine\";\r\nimport type { BaseTexture } from \"core/Materials/Textures/baseTexture\";\r\nimport type { InternalTexture } from \"core/Materials/Textures/internalTexture\";\r\nimport type { ThinTexture } from \"core/Materials/Textures/thinTexture\";\r\nimport { Color3, Color4 } from \"core/Maths/math.color\";\r\nimport { Matrix, Vector2, Vector3 } from \"core/Maths/math.vector\";\r\nimport { Observable } from \"core/Misc/observable\";\r\nimport { PostProcess } from \"core/PostProcesses/postProcess\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { Nullable } from \"core/types\";\r\n\r\nimport type { FluidRenderingObject } from \"./fluidRenderingObject\";\r\nimport { FluidRenderingTextures } from \"./fluidRenderingTextures\";\r\nimport type { WebGPUEngine } from \"core/Engines/webgpuEngine\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Textures that can be displayed as a debugging tool\r\n */\r\nexport const enum FluidRenderingDebug {\r\n    DepthTexture,\r\n    DepthBlurredTexture,\r\n    ThicknessTexture,\r\n    ThicknessBlurredTexture,\r\n    DiffuseTexture,\r\n    Normals,\r\n    DiffuseRendering,\r\n}\r\n\r\n/**\r\n * Class used to render an object as a fluid thanks to different render target textures (depth, thickness, diffuse)\r\n */\r\nexport class FluidRenderingTargetRenderer {\r\n    protected _scene: Scene;\r\n    protected _camera: Nullable<Camera>;\r\n    protected _engine: AbstractEngine;\r\n\r\n    protected _invProjectionMatrix: Matrix;\r\n    protected _depthClearColor: Color4;\r\n    protected _thicknessClearColor: Color4;\r\n\r\n    protected _needInitialization: boolean;\r\n\r\n    /**\r\n     * Returns true if the class needs to be reinitialized (because of changes in parameterization)\r\n     */\r\n    public get needInitialization() {\r\n        return this._needInitialization;\r\n    }\r\n\r\n    private _generateDiffuseTexture = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that the diffuse texture should be generated and used for the rendering\r\n     */\r\n    public get generateDiffuseTexture() {\r\n        return this._generateDiffuseTexture;\r\n    }\r\n\r\n    public set generateDiffuseTexture(generate: boolean) {\r\n        if (this._generateDiffuseTexture === generate) {\r\n            return;\r\n        }\r\n\r\n        this._generateDiffuseTexture = generate;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    /**\r\n     * Fluid color. Not used if generateDiffuseTexture is true\r\n     */\r\n    public fluidColor = new Color3(0.085, 0.6375, 0.765);\r\n\r\n    /**\r\n     * Density of the fluid (positive number). The higher the value, the more opaque the fluid.\r\n     */\r\n    public density = 2;\r\n\r\n    /**\r\n     * Strength of the refraction (positive number, but generally between 0 and 0.3).\r\n     */\r\n    public refractionStrength = 0.1;\r\n\r\n    /**\r\n     * Strength of the fresnel effect (value between 0 and 1). Lower the value if you want to soften the specular effect\r\n     */\r\n    public fresnelClamp = 1.0;\r\n\r\n    /**\r\n     * Strength of the specular power (positive number). Increase the value to make the specular effect more concentrated\r\n     */\r\n    public specularPower = 250;\r\n\r\n    /**\r\n     * Minimum thickness of the particles (positive number). If useFixedThickness is true, minimumThickness is the thickness used\r\n     */\r\n    public minimumThickness = 0;\r\n\r\n    /**\r\n     * Direction of the light. The fluid is assumed to be lit by a directional light\r\n     */\r\n    public dirLight: Vector3 = new Vector3(-2, -1, 1).normalize();\r\n\r\n    private _debugFeature: FluidRenderingDebug = FluidRenderingDebug.DepthBlurredTexture;\r\n\r\n    /**\r\n     * Gets or sets the feature (texture) to be debugged. Not used if debug is false\r\n     */\r\n    public get debugFeature() {\r\n        return this._debugFeature;\r\n    }\r\n\r\n    public set debugFeature(feature: FluidRenderingDebug) {\r\n        if (this._debugFeature === feature) {\r\n            return;\r\n        }\r\n\r\n        this._needInitialization = true;\r\n        this._debugFeature = feature;\r\n    }\r\n\r\n    private _debug = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if we should display a specific texture (given by debugFeature) for debugging purpose\r\n     */\r\n    public get debug() {\r\n        return this._debug;\r\n    }\r\n\r\n    public set debug(debug: boolean) {\r\n        if (this._debug === debug) {\r\n            return;\r\n        }\r\n\r\n        this._debug = debug;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _environmentMap?: Nullable<BaseTexture>;\r\n\r\n    /**\r\n     * Gets or sets the environment map used for the reflection part of the shading\r\n     * If null, no map will be used. If undefined, the scene.environmentMap will be used (if defined)\r\n     */\r\n    public get environmentMap() {\r\n        return this._environmentMap;\r\n    }\r\n\r\n    public set environmentMap(map: Nullable<BaseTexture> | undefined) {\r\n        if (this._environmentMap === map) {\r\n            return;\r\n        }\r\n\r\n        this._needInitialization = true;\r\n        this._environmentMap = map;\r\n    }\r\n\r\n    private _enableBlurDepth = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that the depth texture should be blurred\r\n     */\r\n    public get enableBlurDepth() {\r\n        return this._enableBlurDepth;\r\n    }\r\n\r\n    public set enableBlurDepth(enable: boolean) {\r\n        if (this._enableBlurDepth === enable) {\r\n            return;\r\n        }\r\n\r\n        this._enableBlurDepth = enable;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _blurDepthSizeDivisor = 1;\r\n\r\n    /**\r\n     * Gets or sets the depth size divisor (positive number, generally between 1 and 4), which is used as a divisor when creating the texture used for blurring the depth\r\n     * For eg. if blurDepthSizeDivisor=2, the texture used to blur the depth will be half the size of the depth texture\r\n     */\r\n    public get blurDepthSizeDivisor() {\r\n        return this._blurDepthSizeDivisor;\r\n    }\r\n\r\n    public set blurDepthSizeDivisor(scale: number) {\r\n        if (this._blurDepthSizeDivisor === scale) {\r\n            return;\r\n        }\r\n\r\n        this._blurDepthSizeDivisor = scale;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _blurDepthFilterSize = 7;\r\n\r\n    /**\r\n     * Size of the kernel used to filter the depth blur texture (positive number, generally between 1 and 20 - higher values will require more processing power from the GPU)\r\n     */\r\n    public get blurDepthFilterSize() {\r\n        return this._blurDepthFilterSize;\r\n    }\r\n\r\n    public set blurDepthFilterSize(filterSize: number) {\r\n        if (this._blurDepthFilterSize === filterSize) {\r\n            return;\r\n        }\r\n\r\n        this._blurDepthFilterSize = filterSize;\r\n        this._setBlurParameters();\r\n    }\r\n\r\n    private _blurDepthNumIterations = 3;\r\n\r\n    /**\r\n     * Number of blurring iterations used to generate the depth blur texture (positive number, generally between 1 and 10 - higher values will require more processing power from the GPU)\r\n     */\r\n    public get blurDepthNumIterations() {\r\n        return this._blurDepthNumIterations;\r\n    }\r\n\r\n    public set blurDepthNumIterations(numIterations: number) {\r\n        if (this._blurDepthNumIterations === numIterations) {\r\n            return;\r\n        }\r\n\r\n        this._blurDepthNumIterations = numIterations;\r\n        this._setBlurParameters();\r\n    }\r\n\r\n    private _blurDepthMaxFilterSize = 100;\r\n\r\n    /**\r\n     * Maximum size of the kernel used to blur the depth texture (positive number, generally between 1 and 200 - higher values will require more processing power from the GPU when the particles are larger on screen)\r\n     */\r\n    public get blurDepthMaxFilterSize() {\r\n        return this._blurDepthMaxFilterSize;\r\n    }\r\n\r\n    public set blurDepthMaxFilterSize(maxFilterSize: number) {\r\n        if (this._blurDepthMaxFilterSize === maxFilterSize) {\r\n            return;\r\n        }\r\n\r\n        this._blurDepthMaxFilterSize = maxFilterSize;\r\n        this._setBlurParameters();\r\n    }\r\n\r\n    private _blurDepthDepthScale = 10;\r\n\r\n    /**\r\n     * Depth weight in the calculation when applying the bilateral blur to generate the depth blur texture (positive number, generally between 0 and 100)\r\n     */\r\n    public get blurDepthDepthScale() {\r\n        return this._blurDepthDepthScale;\r\n    }\r\n\r\n    public set blurDepthDepthScale(scale: number) {\r\n        if (this._blurDepthDepthScale === scale) {\r\n            return;\r\n        }\r\n\r\n        this._blurDepthDepthScale = scale;\r\n        this._setBlurParameters();\r\n    }\r\n\r\n    private _enableBlurThickness = true;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that the thickness texture should be blurred\r\n     */\r\n    public get enableBlurThickness() {\r\n        return this._enableBlurThickness;\r\n    }\r\n\r\n    public set enableBlurThickness(enable: boolean) {\r\n        if (this._enableBlurThickness === enable) {\r\n            return;\r\n        }\r\n\r\n        this._enableBlurThickness = enable;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _blurThicknessSizeDivisor = 1;\r\n\r\n    /**\r\n     * Gets or sets the thickness size divisor (positive number, generally between 1 and 4), which is used as a divisor when creating the texture used for blurring the thickness\r\n     * For eg. if blurThicknessSizeDivisor=2, the texture used to blur the thickness will be half the size of the thickness texture\r\n     */\r\n    public get blurThicknessSizeDivisor() {\r\n        return this._blurThicknessSizeDivisor;\r\n    }\r\n\r\n    public set blurThicknessSizeDivisor(scale: number) {\r\n        if (this._blurThicknessSizeDivisor === scale) {\r\n            return;\r\n        }\r\n\r\n        this._blurThicknessSizeDivisor = scale;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _blurThicknessFilterSize = 5;\r\n\r\n    /**\r\n     * Size of the kernel used to filter the thickness blur texture (positive number, generally between 1 and 20 - higher values will require more processing power from the GPU)\r\n     */\r\n    public get blurThicknessFilterSize() {\r\n        return this._blurThicknessFilterSize;\r\n    }\r\n\r\n    public set blurThicknessFilterSize(filterSize: number) {\r\n        if (this._blurThicknessFilterSize === filterSize) {\r\n            return;\r\n        }\r\n\r\n        this._blurThicknessFilterSize = filterSize;\r\n        this._setBlurParameters();\r\n    }\r\n\r\n    private _blurThicknessNumIterations = 1;\r\n\r\n    /**\r\n     * Number of blurring iterations used to generate the thickness blur texture (positive number, generally between 1 and 10 - higher values will require more processing power from the GPU)\r\n     */\r\n    public get blurThicknessNumIterations() {\r\n        return this._blurThicknessNumIterations;\r\n    }\r\n\r\n    public set blurThicknessNumIterations(numIterations: number) {\r\n        if (this._blurThicknessNumIterations === numIterations) {\r\n            return;\r\n        }\r\n\r\n        this._blurThicknessNumIterations = numIterations;\r\n        this._setBlurParameters();\r\n    }\r\n\r\n    private _useFixedThickness = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that a fixed thickness should be used instead of generating a thickness texture\r\n     */\r\n    public get useFixedThickness() {\r\n        return this._useFixedThickness;\r\n    }\r\n\r\n    public set useFixedThickness(use: boolean) {\r\n        if (this._useFixedThickness === use) {\r\n            return;\r\n        }\r\n\r\n        this._useFixedThickness = use;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    /** @internal */\r\n    public _bgDepthTexture: Nullable<InternalTexture>;\r\n\r\n    /** @internal */\r\n    public _onUseVelocityChanged = new Observable<FluidRenderingTargetRenderer>();\r\n\r\n    private _useVelocity = false;\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating that the velocity should be used when rendering the particles as a fluid.\r\n     * Note: the vertex buffers must contain a \"velocity\" buffer for this to work!\r\n     */\r\n    public get useVelocity() {\r\n        return this._useVelocity;\r\n    }\r\n\r\n    public set useVelocity(use: boolean) {\r\n        if (this._useVelocity === use) {\r\n            return;\r\n        }\r\n\r\n        this._useVelocity = use;\r\n        this._needInitialization = true;\r\n        this._onUseVelocityChanged.notifyObservers(this);\r\n    }\r\n\r\n    private _depthMapSize: Nullable<number> = null;\r\n\r\n    /**\r\n     * Defines the size of the depth texture.\r\n     * If null, the texture will have the size of the screen\r\n     */\r\n    public get depthMapSize() {\r\n        return this._depthMapSize;\r\n    }\r\n\r\n    public set depthMapSize(size: Nullable<number>) {\r\n        if (this._depthMapSize === size) {\r\n            return;\r\n        }\r\n\r\n        this._depthMapSize = size;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _thicknessMapSize: Nullable<number> = null;\r\n\r\n    /**\r\n     * Defines the size of the thickness texture.\r\n     * If null, the texture will have the size of the screen\r\n     */\r\n    public get thicknessMapSize() {\r\n        return this._thicknessMapSize;\r\n    }\r\n\r\n    public set thicknessMapSize(size: Nullable<number>) {\r\n        if (this._thicknessMapSize === size) {\r\n            return;\r\n        }\r\n\r\n        this._thicknessMapSize = size;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _diffuseMapSize: Nullable<number> = null;\r\n\r\n    /**\r\n     * Defines the size of the diffuse texture.\r\n     * If null, the texture will have the size of the screen\r\n     */\r\n    public get diffuseMapSize() {\r\n        return this._diffuseMapSize;\r\n    }\r\n\r\n    public set diffuseMapSize(size: Nullable<number>) {\r\n        if (this._diffuseMapSize === size) {\r\n            return;\r\n        }\r\n\r\n        this._diffuseMapSize = size;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _samples = 1;\r\n\r\n    /**\r\n     * Gets or sets the number of samples used by MSAA\r\n     * Note: changing this value in WebGL does not work because depth/stencil textures can't be created with MSAA (see https://github.com/BabylonJS/Babylon.js/issues/12444)\r\n     */\r\n    public get samples() {\r\n        return this._samples;\r\n    }\r\n\r\n    public set samples(samples: number) {\r\n        if (this._samples === samples) {\r\n            return;\r\n        }\r\n\r\n        this._samples = samples;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    private _compositeMode = false;\r\n\r\n    /**\r\n     * If compositeMode is true (default: false), when the alpha value of the background (the scene rendered without the fluid objects) is 0, the final alpha value of the pixel will be set to the thickness value.\r\n     * This way, it is possible to composite the fluid rendering on top of the HTML background.\r\n     */\r\n    public get compositeMode() {\r\n        return this._compositeMode;\r\n    }\r\n\r\n    public set compositeMode(value: boolean) {\r\n        if (this._compositeMode === value) {\r\n            return;\r\n        }\r\n\r\n        this._compositeMode = value;\r\n        this._needInitialization = true;\r\n    }\r\n\r\n    /**\r\n     * Gets the camera used for the rendering\r\n     */\r\n    public get camera() {\r\n        return this._camera;\r\n    }\r\n\r\n    /** @internal */\r\n    public _renderPostProcess: Nullable<PostProcess>;\r\n\r\n    /** @internal */\r\n    public _depthRenderTarget: Nullable<FluidRenderingTextures>;\r\n\r\n    /** @internal */\r\n    public _diffuseRenderTarget: Nullable<FluidRenderingTextures>;\r\n\r\n    /** @internal */\r\n    public _thicknessRenderTarget: Nullable<FluidRenderingTextures>;\r\n\r\n    /** Shader language used by the renderer */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this renderer\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Creates an instance of the class\r\n     * @param scene Scene used to render the fluid object into\r\n     * @param camera Camera used to render the fluid object. If not provided, use the active camera of the scene instead\r\n     * @param shaderLanguage The shader language to use\r\n     */\r\n    constructor(scene: Scene, camera?: Camera, shaderLanguage?: ShaderLanguage) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._camera = camera ?? scene.activeCamera;\r\n        this._needInitialization = true;\r\n        this._bgDepthTexture = null;\r\n\r\n        this._invProjectionMatrix = new Matrix();\r\n        this._depthClearColor = new Color4(1e6, 1e6, 1e6, 1);\r\n        this._thicknessClearColor = new Color4(0, 0, 0, 1);\r\n\r\n        this._depthRenderTarget = null;\r\n        this._diffuseRenderTarget = null;\r\n        this._thicknessRenderTarget = null;\r\n\r\n        this._renderPostProcess = null;\r\n\r\n        this._shaderLanguage = shaderLanguage ?? (this._engine.isWebGPU ? ShaderLanguage.WGSL : ShaderLanguage.GLSL);\r\n    }\r\n\r\n    /** @internal */\r\n    public _initialize(): void {\r\n        this.dispose();\r\n\r\n        this._needInitialization = false;\r\n\r\n        const depthWidth = this._depthMapSize ?? this._engine.getRenderWidth();\r\n        const depthHeight =\r\n            this._depthMapSize !== null ? Math.round((this._depthMapSize * this._engine.getRenderHeight()) / this._engine.getRenderWidth()) : this._engine.getRenderHeight();\r\n\r\n        this._depthRenderTarget = new FluidRenderingTextures(\r\n            \"Depth\",\r\n            this._scene,\r\n            depthWidth,\r\n            depthHeight,\r\n            depthWidth,\r\n            depthHeight,\r\n            Constants.TEXTURETYPE_FLOAT,\r\n            Constants.TEXTUREFORMAT_RG,\r\n            Constants.TEXTURETYPE_FLOAT,\r\n            Constants.TEXTUREFORMAT_RG,\r\n            false,\r\n            this._camera,\r\n            true,\r\n            this._samples,\r\n            this._shaderLanguage\r\n        );\r\n\r\n        this._initializeRenderTarget(this._depthRenderTarget);\r\n\r\n        if (this.generateDiffuseTexture) {\r\n            const diffuseWidth = this._diffuseMapSize ?? this._engine.getRenderWidth();\r\n            const diffuseHeight =\r\n                this._diffuseMapSize !== null\r\n                    ? Math.round((this._diffuseMapSize * this._engine.getRenderHeight()) / this._engine.getRenderWidth())\r\n                    : this._engine.getRenderHeight();\r\n\r\n            this._diffuseRenderTarget = new FluidRenderingTextures(\r\n                \"Diffuse\",\r\n                this._scene,\r\n                diffuseWidth,\r\n                diffuseHeight,\r\n                0,\r\n                0,\r\n                Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                Constants.TEXTUREFORMAT_RGBA,\r\n                Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                Constants.TEXTUREFORMAT_RGBA,\r\n                true,\r\n                this._camera,\r\n                true,\r\n                this._samples,\r\n                this._shaderLanguage\r\n            );\r\n\r\n            this._initializeRenderTarget(this._diffuseRenderTarget);\r\n        }\r\n\r\n        const thicknessWidth = this._thicknessMapSize ?? this._engine.getRenderWidth();\r\n        const thicknessHeight =\r\n            this._thicknessMapSize !== null\r\n                ? Math.round((this._thicknessMapSize * this._engine.getRenderHeight()) / this._engine.getRenderWidth())\r\n                : this._engine.getRenderHeight();\r\n\r\n        if (!this._useFixedThickness) {\r\n            this._thicknessRenderTarget = new FluidRenderingTextures(\r\n                \"Thickness\",\r\n                this._scene,\r\n                thicknessWidth,\r\n                thicknessHeight,\r\n                thicknessWidth,\r\n                thicknessHeight,\r\n                Constants.TEXTURETYPE_HALF_FLOAT,\r\n                Constants.TEXTUREFORMAT_R,\r\n                Constants.TEXTURETYPE_HALF_FLOAT,\r\n                Constants.TEXTUREFORMAT_R,\r\n                true,\r\n                this._camera,\r\n                false,\r\n                this._samples,\r\n                this._shaderLanguage\r\n            );\r\n\r\n            this._initializeRenderTarget(this._thicknessRenderTarget);\r\n        }\r\n\r\n        this._createLiquidRenderingPostProcess();\r\n    }\r\n\r\n    protected _setBlurParameters(renderTarget: Nullable<FluidRenderingTextures> = null): void {\r\n        if (renderTarget === null || renderTarget === this._depthRenderTarget) {\r\n            this._setBlurDepthParameters();\r\n        }\r\n        if (renderTarget === null || renderTarget === this._thicknessRenderTarget) {\r\n            this._setBlurThicknessParameters();\r\n        }\r\n    }\r\n\r\n    protected _setBlurDepthParameters(): void {\r\n        if (!this._depthRenderTarget) {\r\n            return;\r\n        }\r\n        this._depthRenderTarget.blurFilterSize = this.blurDepthFilterSize;\r\n        this._depthRenderTarget.blurMaxFilterSize = this.blurDepthMaxFilterSize;\r\n        this._depthRenderTarget.blurNumIterations = this.blurDepthNumIterations;\r\n        this._depthRenderTarget.blurDepthScale = this.blurDepthDepthScale;\r\n    }\r\n\r\n    protected _setBlurThicknessParameters(): void {\r\n        if (!this._thicknessRenderTarget) {\r\n            return;\r\n        }\r\n        this._thicknessRenderTarget.blurFilterSize = this.blurThicknessFilterSize;\r\n        this._thicknessRenderTarget.blurNumIterations = this.blurThicknessNumIterations;\r\n    }\r\n\r\n    protected _initializeRenderTarget(renderTarget: FluidRenderingTextures): void {\r\n        if (renderTarget !== this._diffuseRenderTarget) {\r\n            renderTarget.enableBlur = renderTarget === this._depthRenderTarget ? this.enableBlurDepth : this.enableBlurThickness;\r\n            renderTarget.blurSizeDivisor = renderTarget === this._depthRenderTarget ? this.blurDepthSizeDivisor : this.blurThicknessSizeDivisor;\r\n        }\r\n\r\n        this._setBlurParameters(renderTarget);\r\n\r\n        renderTarget.initialize();\r\n    }\r\n\r\n    protected _createLiquidRenderingPostProcess(): void {\r\n        const engine = this._scene.getEngine();\r\n\r\n        const uniformNames = [\r\n            \"viewMatrix\",\r\n            \"projectionMatrix\",\r\n            \"invProjectionMatrix\",\r\n            \"texelSize\",\r\n            \"dirLight\",\r\n            \"cameraFar\",\r\n            \"density\",\r\n            \"refractionStrength\",\r\n            \"fresnelClamp\",\r\n            \"specularPower\",\r\n        ];\r\n        const samplerNames = [\"depthSampler\"];\r\n        const defines = [];\r\n\r\n        this.dispose(true);\r\n\r\n        if (!this._camera) {\r\n            return;\r\n        }\r\n\r\n        const texture = this._depthRenderTarget!.enableBlur ? this._depthRenderTarget!.textureBlur! : this._depthRenderTarget!.texture!;\r\n        const texelSize = new Vector2(1 / texture.getSize().width, 1 / texture.getSize().height);\r\n\r\n        if (this._scene.useRightHandedSystem) {\r\n            defines.push(\"#define FLUIDRENDERING_RHS\");\r\n        }\r\n\r\n        if (this._environmentMap !== null) {\r\n            const envMap = this._environmentMap ?? this._scene.environmentTexture;\r\n            if (envMap) {\r\n                samplerNames.push(\"reflectionSampler\");\r\n                defines.push(\"#define FLUIDRENDERING_ENVIRONMENT\");\r\n            }\r\n        }\r\n\r\n        if (this._diffuseRenderTarget) {\r\n            samplerNames.push(\"diffuseSampler\");\r\n            defines.push(\"#define FLUIDRENDERING_DIFFUSETEXTURE\");\r\n        } else {\r\n            uniformNames.push(\"diffuseColor\");\r\n        }\r\n\r\n        if (this._useVelocity) {\r\n            samplerNames.push(\"velocitySampler\");\r\n            defines.push(\"#define FLUIDRENDERING_VELOCITY\");\r\n        }\r\n\r\n        if (this._useFixedThickness) {\r\n            uniformNames.push(\"thickness\");\r\n            samplerNames.push(\"bgDepthSampler\");\r\n            defines.push(\"#define FLUIDRENDERING_FIXED_THICKNESS\");\r\n        } else {\r\n            uniformNames.push(\"minimumThickness\");\r\n            samplerNames.push(\"thicknessSampler\");\r\n        }\r\n\r\n        if (this._compositeMode) {\r\n            defines.push(\"#define FLUIDRENDERING_COMPOSITE_MODE\");\r\n        }\r\n\r\n        if (this._debug) {\r\n            defines.push(\"#define FLUIDRENDERING_DEBUG\");\r\n            if (this._debugFeature === FluidRenderingDebug.Normals) {\r\n                defines.push(\"#define FLUIDRENDERING_DEBUG_SHOWNORMAL\");\r\n            } else if (this._debugFeature === FluidRenderingDebug.DiffuseRendering) {\r\n                defines.push(\"#define FLUIDRENDERING_DEBUG_DIFFUSERENDERING\");\r\n            } else {\r\n                defines.push(\"#define FLUIDRENDERING_DEBUG_TEXTURE\");\r\n                samplerNames.push(\"debugSampler\");\r\n                if (this._debugFeature === FluidRenderingDebug.DepthTexture || this._debugFeature === FluidRenderingDebug.DepthBlurredTexture) {\r\n                    defines.push(\"#define FLUIDRENDERING_DEBUG_DEPTH\");\r\n                }\r\n            }\r\n        }\r\n\r\n        this._renderPostProcess = new PostProcess(\r\n            \"FluidRendering\",\r\n            \"fluidRenderingRender\",\r\n            uniformNames,\r\n            samplerNames,\r\n            1,\r\n            null,\r\n            Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n            engine,\r\n            false,\r\n            null,\r\n            Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n            undefined,\r\n            undefined,\r\n            true,\r\n            undefined,\r\n            this._shaderLanguage,\r\n            // eslint-disable-next-line @typescript-eslint/no-misused-promises\r\n            async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await import(\"../../ShadersWGSL/fluidRenderingRender.fragment\");\r\n                } else {\r\n                    await import(\"../../Shaders/fluidRenderingRender.fragment\");\r\n                }\r\n            }\r\n        );\r\n        this._renderPostProcess.updateEffect(defines.join(\"\\n\"));\r\n\r\n        this._renderPostProcess.samples = this._samples;\r\n        const engineWebGPU = engine as WebGPUEngine;\r\n        const setTextureSampler = engineWebGPU.setTextureSampler;\r\n        this._renderPostProcess.onApplyObservable.add((effect) => {\r\n            this._invProjectionMatrix.copyFrom(this._scene.getProjectionMatrix());\r\n            this._invProjectionMatrix.invert();\r\n\r\n            if (setTextureSampler) {\r\n                setTextureSampler.call(engineWebGPU, \"textureSamplerSampler\", this._renderPostProcess!.inputTexture.texture);\r\n            }\r\n\r\n            if (!this._depthRenderTarget!.enableBlur) {\r\n                effect.setTexture(\"depthSampler\", this._depthRenderTarget!.texture);\r\n                if (setTextureSampler) {\r\n                    setTextureSampler.call(engineWebGPU, \"depthSamplerSampler\", this._depthRenderTarget!.texture?.getInternalTexture() ?? null);\r\n                }\r\n            } else {\r\n                effect.setTexture(\"depthSampler\", this._depthRenderTarget!.textureBlur);\r\n                if (setTextureSampler) {\r\n                    setTextureSampler.call(engineWebGPU, \"depthSamplerSampler\", this._depthRenderTarget!.textureBlur?.getInternalTexture() ?? null);\r\n                }\r\n            }\r\n            if (this._diffuseRenderTarget) {\r\n                if (!this._diffuseRenderTarget.enableBlur) {\r\n                    effect.setTexture(\"diffuseSampler\", this._diffuseRenderTarget.texture);\r\n                    if (setTextureSampler) {\r\n                        setTextureSampler.call(engineWebGPU, \"diffuseSamplerSampler\", this._diffuseRenderTarget.texture?.getInternalTexture() ?? null);\r\n                    }\r\n                } else {\r\n                    effect.setTexture(\"diffuseSampler\", this._diffuseRenderTarget.textureBlur);\r\n                    if (setTextureSampler) {\r\n                        setTextureSampler.call(engineWebGPU, \"diffuseSamplerSampler\", this._diffuseRenderTarget.textureBlur?.getInternalTexture() ?? null);\r\n                    }\r\n                }\r\n            } else {\r\n                effect.setColor3(\"diffuseColor\", this.fluidColor);\r\n            }\r\n            if (this._useFixedThickness) {\r\n                effect.setFloat(\"thickness\", this.minimumThickness);\r\n                effect._bindTexture(\"bgDepthSampler\", this._bgDepthTexture);\r\n                if (setTextureSampler) {\r\n                    setTextureSampler.call(engineWebGPU, \"bgDepthSamplerSampler\", this._bgDepthTexture ?? null);\r\n                }\r\n            } else {\r\n                if (!this._thicknessRenderTarget!.enableBlur) {\r\n                    effect.setTexture(\"thicknessSampler\", this._thicknessRenderTarget!.texture);\r\n                    if (setTextureSampler) {\r\n                        setTextureSampler.call(engineWebGPU, \"thicknessSamplerSampler\", this._thicknessRenderTarget!.texture?.getInternalTexture() ?? null);\r\n                    }\r\n                } else {\r\n                    effect.setTexture(\"thicknessSampler\", this._thicknessRenderTarget!.textureBlur);\r\n                    if (setTextureSampler) {\r\n                        setTextureSampler.call(engineWebGPU, \"thicknessSamplerSampler\", this._thicknessRenderTarget!.textureBlur?.getInternalTexture() ?? null);\r\n                    }\r\n                }\r\n                effect.setFloat(\"minimumThickness\", this.minimumThickness);\r\n            }\r\n\r\n            if (this._environmentMap !== null) {\r\n                const envMap = this._environmentMap ?? this._scene.environmentTexture;\r\n                if (envMap) {\r\n                    effect.setTexture(\"reflectionSampler\", envMap);\r\n                    if (setTextureSampler) {\r\n                        setTextureSampler.call(engineWebGPU, \"reflectionSamplerSampler\", envMap?.getInternalTexture() ?? null);\r\n                    }\r\n                }\r\n            }\r\n\r\n            effect.setMatrix(\"viewMatrix\", this._scene.getViewMatrix());\r\n            effect.setMatrix(\"invProjectionMatrix\", this._invProjectionMatrix);\r\n            effect.setMatrix(\"projectionMatrix\", this._scene.getProjectionMatrix());\r\n            effect.setVector2(\"texelSize\", texelSize);\r\n            effect.setFloat(\"density\", this.density);\r\n            effect.setFloat(\"refractionStrength\", this.refractionStrength);\r\n            effect.setFloat(\"fresnelClamp\", this.fresnelClamp);\r\n            effect.setFloat(\"specularPower\", this.specularPower);\r\n\r\n            effect.setVector3(\"dirLight\", this.dirLight);\r\n\r\n            effect.setFloat(\"cameraFar\", this._camera!.maxZ);\r\n\r\n            if (this._debug) {\r\n                let texture: Nullable<ThinTexture> = null;\r\n                switch (this._debugFeature) {\r\n                    case FluidRenderingDebug.DepthTexture:\r\n                        texture = this._depthRenderTarget!.texture;\r\n                        break;\r\n                    case FluidRenderingDebug.DepthBlurredTexture:\r\n                        texture = this._depthRenderTarget!.enableBlur ? this._depthRenderTarget!.textureBlur : this._depthRenderTarget!.texture;\r\n                        break;\r\n                    case FluidRenderingDebug.ThicknessTexture:\r\n                        texture = this._thicknessRenderTarget?.texture ?? null;\r\n                        break;\r\n                    case FluidRenderingDebug.ThicknessBlurredTexture:\r\n                        texture = this._thicknessRenderTarget?.enableBlur ? (this._thicknessRenderTarget?.textureBlur ?? null) : (this._thicknessRenderTarget?.texture ?? null);\r\n                        break;\r\n                    case FluidRenderingDebug.DiffuseTexture:\r\n                        if (this._diffuseRenderTarget) {\r\n                            texture = this._diffuseRenderTarget.texture;\r\n                        }\r\n                        break;\r\n                }\r\n                if (this._debugFeature !== FluidRenderingDebug.Normals) {\r\n                    effect.setTexture(\"debugSampler\", texture);\r\n                    if (setTextureSampler) {\r\n                        setTextureSampler.call(engineWebGPU, \"debugSamplerSampler\", texture?.getInternalTexture() ?? null);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    /** @internal */\r\n    public _clearTargets(): void {\r\n        if (this._depthRenderTarget?.renderTarget) {\r\n            this._engine.bindFramebuffer(this._depthRenderTarget.renderTarget);\r\n            this._engine.clear(this._depthClearColor, true, true, false);\r\n            this._engine.unBindFramebuffer(this._depthRenderTarget.renderTarget);\r\n        }\r\n\r\n        if (this._diffuseRenderTarget?.renderTarget) {\r\n            this._engine.bindFramebuffer(this._diffuseRenderTarget.renderTarget);\r\n            this._engine.clear(this._thicknessClearColor, true, true, false);\r\n            this._engine.unBindFramebuffer(this._diffuseRenderTarget.renderTarget);\r\n        }\r\n\r\n        if (this._thicknessRenderTarget?.renderTarget) {\r\n            this._engine.bindFramebuffer(this._thicknessRenderTarget.renderTarget);\r\n            // we don't clear the depth buffer because it is the depth buffer that is coming from the scene and that we reuse in the thickness rendering pass\r\n            this._engine.clear(this._thicknessClearColor, true, false, false);\r\n            this._engine.unBindFramebuffer(this._thicknessRenderTarget.renderTarget);\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _render(fluidObject: FluidRenderingObject): void {\r\n        if (this._needInitialization || !fluidObject.isReady()) {\r\n            return;\r\n        }\r\n\r\n        const currentRenderTarget = this._engine._currentRenderTarget;\r\n\r\n        this._engine.setState(false, undefined, undefined, undefined, true);\r\n        this._engine.setDepthBuffer(true);\r\n        this._engine.setDepthWrite(true);\r\n        this._engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n\r\n        // Render the particles in the depth texture\r\n        if (this._depthRenderTarget?.renderTarget) {\r\n            this._engine.bindFramebuffer(this._depthRenderTarget.renderTarget);\r\n\r\n            fluidObject.renderDepthTexture();\r\n\r\n            this._engine.unbindInstanceAttributes();\r\n            this._engine.unBindFramebuffer(this._depthRenderTarget.renderTarget);\r\n        }\r\n\r\n        // Render the particles in the diffuse texture\r\n        if (this._diffuseRenderTarget?.renderTarget) {\r\n            this._engine.bindFramebuffer(this._diffuseRenderTarget.renderTarget);\r\n\r\n            fluidObject.renderDiffuseTexture();\r\n\r\n            this._engine.unbindInstanceAttributes();\r\n            this._engine.unBindFramebuffer(this._diffuseRenderTarget.renderTarget);\r\n        }\r\n\r\n        // Render the particles in the thickness texture\r\n        if (this._thicknessRenderTarget?.renderTarget) {\r\n            this._engine.bindFramebuffer(this._thicknessRenderTarget.renderTarget);\r\n\r\n            fluidObject.renderThicknessTexture();\r\n\r\n            this._engine.unbindInstanceAttributes();\r\n            this._engine.unBindFramebuffer(this._thicknessRenderTarget.renderTarget);\r\n        }\r\n\r\n        // Run the blur post processes\r\n        this._depthRenderTarget?.applyBlurPostProcesses();\r\n        this._diffuseRenderTarget?.applyBlurPostProcesses();\r\n        this._thicknessRenderTarget?.applyBlurPostProcesses();\r\n\r\n        if (currentRenderTarget) {\r\n            this._engine.bindFramebuffer(currentRenderTarget);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Releases all the resources used by the class\r\n     * @param onlyPostProcesses If true, releases only the resources used by the render post processes\r\n     */\r\n    public dispose(onlyPostProcesses = false): void {\r\n        if (!onlyPostProcesses) {\r\n            this._depthRenderTarget?.dispose();\r\n            this._depthRenderTarget = null;\r\n\r\n            this._diffuseRenderTarget?.dispose();\r\n            this._diffuseRenderTarget = null;\r\n\r\n            this._thicknessRenderTarget?.dispose();\r\n            this._thicknessRenderTarget = null;\r\n        }\r\n\r\n        if (this._renderPostProcess && this._camera) {\r\n            this._camera.detachPostProcess(this._renderPostProcess);\r\n        }\r\n        this._renderPostProcess?.dispose();\r\n        this._renderPostProcess = null;\r\n\r\n        this._onUseVelocityChanged.clear();\r\n\r\n        this._needInitialization = false;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12077, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderingObjectCustomParticles.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderingObjectCustomParticles.ts"],"sourcesContent":["import { VertexBuffer } from \"core/Buffers/buffer\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport { EffectWrapper } from \"core/Materials/effectRenderer\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { FloatArray, Nullable } from \"core/types\";\r\n\r\nimport { FluidRenderingObject } from \"./fluidRenderingObject\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Defines a rendering object based on a list of custom buffers\r\n * The list must contain at least a \"position\" buffer!\r\n */\r\nexport class FluidRenderingObjectCustomParticles extends FluidRenderingObject {\r\n    private _numParticles: number;\r\n    private _diffuseEffectWrapper: Nullable<EffectWrapper>;\r\n    private _vertexBuffers: { [key: string]: VertexBuffer };\r\n\r\n    /**\r\n     * @returns the name of the class\r\n     */\r\n    public override getClassName(): string {\r\n        return \"FluidRenderingObjectCustomParticles\";\r\n    }\r\n\r\n    /**\r\n     * Gets the vertex buffers\r\n     */\r\n    public get vertexBuffers(): { [key: string]: VertexBuffer } {\r\n        return this._vertexBuffers;\r\n    }\r\n\r\n    /**\r\n     * Creates a new instance of the class\r\n     * @param scene The scene the particles should be rendered into\r\n     * @param buffers The list of buffers (must contain at least one \"position\" buffer!). Note that you don't have to pass all (or any!) buffers at once in the constructor, you can use the addBuffers method to add more later.\r\n     * @param numParticles Number of vertices to take into account from the buffers\r\n     * @param shaderLanguage The shader language to use\r\n     */\r\n    constructor(scene: Scene, buffers: { [key: string]: FloatArray }, numParticles: number, shaderLanguage?: ShaderLanguage) {\r\n        super(scene, shaderLanguage);\r\n\r\n        this._numParticles = numParticles;\r\n        this._diffuseEffectWrapper = null;\r\n        this._vertexBuffers = {};\r\n\r\n        this.addBuffers(buffers);\r\n    }\r\n\r\n    /**\r\n     * Add some new buffers\r\n     * @param buffers List of buffers\r\n     */\r\n    public addBuffers(buffers: { [key: string]: FloatArray }) {\r\n        for (const name in buffers) {\r\n            let stride: number | undefined;\r\n            let instanced = true;\r\n\r\n            switch (name) {\r\n                case \"velocity\":\r\n                    stride = 3;\r\n                    break;\r\n                case \"offset\":\r\n                    instanced = false;\r\n                    break;\r\n            }\r\n\r\n            this._vertexBuffers[name] = new VertexBuffer(this._engine, buffers[name], name, true, false, stride, instanced);\r\n        }\r\n    }\r\n\r\n    protected override _createEffects(): void {\r\n        super._createEffects();\r\n\r\n        const uniformNames = [\"view\", \"projection\", \"size\"];\r\n        const attributeNames = [\"position\", \"offset\", \"color\"];\r\n\r\n        this._diffuseEffectWrapper = new EffectWrapper({\r\n            engine: this._engine,\r\n            useShaderStore: true,\r\n            vertexShader: \"fluidRenderingParticleDiffuse\",\r\n            fragmentShader: \"fluidRenderingParticleDiffuse\",\r\n            attributeNames,\r\n            uniformNames,\r\n            samplerNames: [],\r\n            shaderLanguage: this._shaderLanguage,\r\n            extraInitializationsAsync: async () => {\r\n                if (this._shaderLanguage === ShaderLanguage.WGSL) {\r\n                    await import(\"../../ShadersWGSL/fluidRenderingParticleDiffuse.fragment\");\r\n                } else {\r\n                    await import(\"../../Shaders/fluidRenderingParticleDiffuse.fragment\");\r\n                }\r\n            },\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Indicates if the object is ready to be rendered\r\n     * @returns True if everything is ready for the object to be rendered, otherwise false\r\n     */\r\n    public override isReady(): boolean {\r\n        if (!this._vertexBuffers[\"offset\"]) {\r\n            this._vertexBuffers[\"offset\"] = new VertexBuffer(this._engine, [0, 0, 1, 0, 0, 1, 1, 1], \"offset\", false, false, 2);\r\n        }\r\n\r\n        return super.isReady() && (this._diffuseEffectWrapper?.effect!.isReady() ?? false);\r\n    }\r\n\r\n    /**\r\n     * Gets the number of particles in this object\r\n     * @returns The number of particles\r\n     */\r\n    public get numParticles(): number {\r\n        return this._numParticles;\r\n    }\r\n\r\n    /**\r\n     * Sets the number of particles in this object\r\n     * @param num The number of particles to take into account\r\n     */\r\n    public setNumParticles(num: number) {\r\n        this._numParticles = num;\r\n    }\r\n\r\n    /**\r\n     * Render the diffuse texture for this object\r\n     */\r\n    public override renderDiffuseTexture(): void {\r\n        const numParticles = this.numParticles;\r\n\r\n        if (!this._diffuseEffectWrapper || numParticles === 0) {\r\n            return;\r\n        }\r\n\r\n        const diffuseDrawWrapper = this._diffuseEffectWrapper.drawWrapper;\r\n        const diffuseEffect = diffuseDrawWrapper.effect!;\r\n\r\n        this._engine.enableEffect(diffuseDrawWrapper);\r\n        this._engine.bindBuffers(this.vertexBuffers, this.indexBuffer, diffuseEffect);\r\n\r\n        diffuseEffect.setMatrix(\"view\", this._scene.getViewMatrix());\r\n        diffuseEffect.setMatrix(\"projection\", this._scene.getProjectionMatrix());\r\n        if (this._particleSize !== null) {\r\n            diffuseEffect.setFloat2(\"size\", this._particleSize, this._particleSize);\r\n        }\r\n\r\n        if (this.useInstancing) {\r\n            this._engine.drawArraysType(Constants.MATERIAL_TriangleStripDrawMode, 0, 4, numParticles);\r\n        } else {\r\n            this._engine.drawElementsType(Constants.MATERIAL_TriangleFillMode, 0, numParticles);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Releases the resources used by the class\r\n     */\r\n    public override dispose(): void {\r\n        super.dispose();\r\n\r\n        this._diffuseEffectWrapper?.dispose();\r\n\r\n        for (const name in this._vertexBuffers) {\r\n            this._vertexBuffers[name].dispose();\r\n        }\r\n\r\n        this._vertexBuffers = {};\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12226, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderingDepthTextureCopy.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderingDepthTextureCopy.ts"],"sourcesContent":["import { Constants } from \"core/Engines/constants\";\r\nimport type { AbstractEngine } from \"core/Engines/abstractEngine\";\r\nimport type { RenderTargetWrapper } from \"core/Engines/renderTargetWrapper\";\r\nimport type { InternalTexture } from \"core/Materials/Textures/internalTexture\";\r\nimport { CopyTextureToTexture } from \"core/Misc/copyTextureToTexture\";\r\n\r\n/** @internal */\r\nexport class FluidRenderingDepthTextureCopy {\r\n    private _engine: AbstractEngine;\r\n    private _depthRTWrapper: RenderTargetWrapper;\r\n    private _copyTextureToTexture: CopyTextureToTexture;\r\n\r\n    public get depthRTWrapper() {\r\n        return this._depthRTWrapper;\r\n    }\r\n\r\n    constructor(engine: AbstractEngine, width: number, height: number, samples = 1) {\r\n        this._engine = engine;\r\n        this._copyTextureToTexture = new CopyTextureToTexture(engine, true);\r\n\r\n        this._depthRTWrapper = this._engine.createRenderTargetTexture(\r\n            { width, height },\r\n            {\r\n                generateMipMaps: false,\r\n                type: Constants.TEXTURETYPE_UNSIGNED_BYTE,\r\n                format: Constants.TEXTUREFORMAT_R,\r\n                samplingMode: Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n                generateDepthBuffer: true,\r\n                generateStencilBuffer: false,\r\n                samples,\r\n                noColorAttachment: true,\r\n                label: \"FluidRenderingDepthTextureCopyRTT\",\r\n            }\r\n        );\r\n        const depthTexture = this._depthRTWrapper.createDepthStencilTexture(0, false, false, 1, undefined, \"FluidRenderingDepthTextureCopyRTTDepthStencil\");\r\n        depthTexture.label = `FluidDepthTextureCopy${width}x${height}x${samples}`;\r\n    }\r\n\r\n    public copy(source: InternalTexture): boolean {\r\n        return this._copyTextureToTexture.copy(source, this._depthRTWrapper);\r\n    }\r\n\r\n    public dispose() {\r\n        this._depthRTWrapper.dispose();\r\n        this._copyTextureToTexture.dispose();\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAIA,OAAO,EAAE,oBAAoB,EAAE,2CAAuC;;AAGhE,MAAO,8BAA8B;IAKvC,IAAW,cAAc,GAAA;QACrB,OAAO,IAAI,CAAC,eAAe,CAAC;IAChC,CAAC;IAED,YAAY,MAAsB,EAAE,KAAa,EAAE,MAAc,EAAE,OAAO,GAAG,CAAC,CAAA;QAC1E,IAAI,CAAC,OAAO,GAAG,MAAM,CAAC;QACtB,IAAI,CAAC,qBAAqB,GAAG,IAAI,4PAAoB,CAAC,MAAM,EAAE,IAAI,CAAC,CAAC;QAEpE,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,OAAO,CAAC,yBAAyB,CACzD;YAAE,KAAK;YAAE,MAAM;QAAA,CAAE,EACjB;YACI,eAAe,EAAE,KAAK;YACtB,IAAI,EAAE,SAAS,CAAC,yBAAyB;YACzC,MAAM,EAAE,SAAS,CAAC,eAAe;YACjC,YAAY,EAAE,SAAS,CAAC,4BAA4B;YACpD,mBAAmB,EAAE,IAAI;YACzB,qBAAqB,EAAE,KAAK;YAC5B,OAAO;YACP,iBAAiB,EAAE,IAAI;YACvB,KAAK,EAAE,mCAAmC;SAC7C,CACJ,CAAC;QACF,MAAM,YAAY,GAAG,IAAI,CAAC,eAAe,CAAC,yBAAyB,CAAC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,EAAE,SAAS,EAAE,+CAA+C,CAAC,CAAC;QACpJ,YAAY,CAAC,KAAK,GAAG,CAAA,qBAAA,EAAwB,KAAK,CAAA,CAAA,EAAI,MAAM,CAAA,CAAA,EAAI,OAAO,EAAE,CAAC;IAC9E,CAAC;IAEM,IAAI,CAAC,MAAuB,EAAA;QAC/B,OAAO,IAAI,CAAC,qBAAqB,CAAC,IAAI,CAAC,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;IACzE,CAAC;IAEM,OAAO,GAAA;QACV,IAAI,CAAC,eAAe,CAAC,OAAO,EAAE,CAAC;QAC/B,IAAI,CAAC,qBAAqB,CAAC,OAAO,EAAE,CAAC;IACzC,CAAC;CACJ"}},
    {"offset": {"line": 12268, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/fluidRenderer.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/fluidRenderer.ts"],"sourcesContent":["import { Scene } from \"core/scene\";\r\nimport type { AbstractEngine } from \"core/Engines/abstractEngine\";\r\nimport type { FloatArray, Nullable } from \"core/types\";\r\nimport type { Observer } from \"core/Misc/observable\";\r\nimport type { Camera } from \"core/Cameras/camera\";\r\nimport type { IParticleSystem } from \"core/Particles/IParticleSystem\";\r\nimport type { ISceneComponent } from \"core/sceneComponent\";\r\nimport { SceneComponentConstants } from \"core/sceneComponent\";\r\nimport type { SmartArrayNoDuplicate } from \"core/Misc/smartArray\";\r\nimport type { RenderTargetTexture } from \"core/Materials/Textures/renderTargetTexture\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { Buffer } from \"core/Buffers/buffer\";\r\n\r\nimport type { FluidRenderingObject } from \"./fluidRenderingObject\";\r\nimport { FluidRenderingObjectParticleSystem } from \"./fluidRenderingObjectParticleSystem\";\r\nimport { FluidRenderingTargetRenderer } from \"./fluidRenderingTargetRenderer\";\r\nimport { FluidRenderingObjectCustomParticles } from \"./fluidRenderingObjectCustomParticles\";\r\nimport { FluidRenderingDepthTextureCopy } from \"./fluidRenderingDepthTextureCopy\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\ndeclare module \"../../scene\" {\r\n    // eslint-disable-next-line @typescript-eslint/naming-convention\r\n    export interface Scene {\r\n        /** @internal (Backing field) */\r\n        _fluidRenderer: Nullable<FluidRenderer>;\r\n\r\n        /**\r\n         * Gets or Sets the fluid renderer associated to the scene.\r\n         */\r\n        fluidRenderer: Nullable<FluidRenderer>;\r\n\r\n        /**\r\n         * Enables the fluid renderer and associates it with the scene\r\n         * @returns the FluidRenderer\r\n         */\r\n        enableFluidRenderer(): Nullable<FluidRenderer>;\r\n\r\n        /**\r\n         * Disables the fluid renderer associated with the scene\r\n         */\r\n        disableFluidRenderer(): void;\r\n    }\r\n}\r\n\r\nObject.defineProperty(Scene.prototype, \"fluidRenderer\", {\r\n    get: function (this: Scene) {\r\n        return this._fluidRenderer;\r\n    },\r\n    set: function (this: Scene, value: Nullable<FluidRenderer>) {\r\n        this._fluidRenderer = value;\r\n    },\r\n    enumerable: true,\r\n    configurable: true,\r\n});\r\n\r\nScene.prototype.enableFluidRenderer = function (): Nullable<FluidRenderer> {\r\n    if (this._fluidRenderer) {\r\n        return this._fluidRenderer;\r\n    }\r\n\r\n    this._fluidRenderer = new FluidRenderer(this);\r\n\r\n    return this._fluidRenderer;\r\n};\r\n\r\nScene.prototype.disableFluidRenderer = function (): void {\r\n    this._fluidRenderer?.dispose();\r\n    this._fluidRenderer = null;\r\n};\r\n\r\ntype CameraMapForFluidRendering = [Array<FluidRenderingTargetRenderer>, { [key: string]: FluidRenderingDepthTextureCopy }];\r\n\r\nfunction IsParticleSystemObject(obj: FluidRenderingObject): obj is FluidRenderingObjectParticleSystem {\r\n    return !!(obj as FluidRenderingObjectParticleSystem).particleSystem;\r\n}\r\n\r\nfunction IsCustomParticlesObject(obj: FluidRenderingObject): obj is FluidRenderingObjectCustomParticles {\r\n    return !!(obj as FluidRenderingObjectCustomParticles).addBuffers;\r\n}\r\n\r\n/**\r\n * Defines the fluid renderer scene component responsible to render objects as fluids\r\n */\r\nexport class FluidRendererSceneComponent implements ISceneComponent {\r\n    /**\r\n     * The component name helpful to identify the component in the list of scene components.\r\n     */\r\n    public readonly name = SceneComponentConstants.NAME_FLUIDRENDERER;\r\n\r\n    /**\r\n     * The scene the component belongs to.\r\n     */\r\n    public scene: Scene;\r\n\r\n    /**\r\n     * Creates a new instance of the component for the given scene\r\n     * @param scene Defines the scene to register the component in\r\n     */\r\n    constructor(scene: Scene) {\r\n        this.scene = scene;\r\n    }\r\n\r\n    /**\r\n     * Registers the component in a given scene\r\n     */\r\n    public register(): void {\r\n        this.scene._gatherActiveCameraRenderTargetsStage.registerStep(\r\n            SceneComponentConstants.STEP_GATHERACTIVECAMERARENDERTARGETS_FLUIDRENDERER,\r\n            this,\r\n            this._gatherActiveCameraRenderTargets\r\n        );\r\n        this.scene._afterCameraDrawStage.registerStep(SceneComponentConstants.STEP_AFTERCAMERADRAW_FLUIDRENDERER, this, this._afterCameraDraw);\r\n    }\r\n\r\n    private _gatherActiveCameraRenderTargets(_renderTargets: SmartArrayNoDuplicate<RenderTargetTexture>): void {\r\n        this.scene.fluidRenderer?._prepareRendering();\r\n    }\r\n\r\n    private _afterCameraDraw(camera: Camera) {\r\n        this.scene.fluidRenderer?._render(camera);\r\n    }\r\n\r\n    /**\r\n     * Rebuilds the elements related to this component in case of\r\n     * context lost for instance.\r\n     */\r\n    public rebuild(): void {\r\n        const fluidRenderer = this.scene.fluidRenderer;\r\n        if (!fluidRenderer) {\r\n            return;\r\n        }\r\n\r\n        const buffers = new Set<Buffer>();\r\n        for (let i = 0; i < fluidRenderer.renderObjects.length; ++i) {\r\n            const obj = fluidRenderer.renderObjects[i].object;\r\n            if (IsCustomParticlesObject(obj)) {\r\n                const vbuffers = obj.vertexBuffers;\r\n                for (const name in vbuffers) {\r\n                    buffers.add(vbuffers[name].getWrapperBuffer());\r\n                }\r\n            }\r\n        }\r\n\r\n        buffers.forEach((buffer) => {\r\n            buffer._rebuild();\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Disposes the component and the associated resources\r\n     */\r\n    public dispose(): void {\r\n        this.scene.disableFluidRenderer();\r\n    }\r\n}\r\n\r\n/**\r\n * An object rendered as a fluid.\r\n * It consists of the object itself as well as the render target renderer (which is used to generate the textures (render target) needed for fluid rendering)\r\n */\r\nexport interface IFluidRenderingRenderObject {\r\n    /** object rendered as a fluid */\r\n    object: FluidRenderingObject;\r\n    /** target renderer used to render the fluid object */\r\n    targetRenderer: FluidRenderingTargetRenderer;\r\n}\r\n\r\n/**\r\n * Class responsible for fluid rendering.\r\n * It is implementing the method described in https://developer.download.nvidia.com/presentations/2010/gdc/Direct3D_Effects.pdf\r\n */\r\nexport class FluidRenderer {\r\n    /** @internal */\r\n    public static _SceneComponentInitialization(scene: Scene) {\r\n        let component = scene._getComponent(SceneComponentConstants.NAME_FLUIDRENDERER) as FluidRendererSceneComponent;\r\n        if (!component) {\r\n            component = new FluidRendererSceneComponent(scene);\r\n            scene._addComponent(component);\r\n        }\r\n    }\r\n\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n    private _onEngineResizeObserver: Nullable<Observer<AbstractEngine>>;\r\n    private _cameras: Map<Camera, CameraMapForFluidRendering>;\r\n\r\n    /** Retrieves all the render objects managed by the class */\r\n    public readonly renderObjects: Array<IFluidRenderingRenderObject>;\r\n\r\n    /** Retrieves all the render target renderers managed by the class */\r\n    public readonly targetRenderers: FluidRenderingTargetRenderer[];\r\n\r\n    /** Shader language used by the renderer */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /**\r\n     * Gets the shader language used in this renderer\r\n     */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Initializes the class\r\n     * @param scene Scene in which the objects are part of\r\n     */\r\n    constructor(scene: Scene) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._onEngineResizeObserver = null;\r\n        this.renderObjects = [];\r\n        this.targetRenderers = [];\r\n        this._cameras = new Map();\r\n\r\n        FluidRenderer._SceneComponentInitialization(this._scene);\r\n\r\n        this._onEngineResizeObserver = this._engine.onResizeObservable.add(() => {\r\n            this._initialize();\r\n        });\r\n\r\n        const engine = this._engine;\r\n        if (engine.isWebGPU) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Reinitializes the class\r\n     * Can be used if you change the object priority (FluidRenderingObject.priority), to make sure the objects are rendered in the right order\r\n     */\r\n    public recreate(): void {\r\n        this._sortRenderingObjects();\r\n        this._initialize();\r\n    }\r\n\r\n    /**\r\n     * Gets the render object corresponding to a particle system (null if the particle system is not rendered as a fluid)\r\n     * @param ps The particle system\r\n     * @returns the render object corresponding to this particle system if any, otherwise null\r\n     */\r\n    public getRenderObjectFromParticleSystem(ps: IParticleSystem): Nullable<IFluidRenderingRenderObject> {\r\n        const index = this._getParticleSystemIndex(ps);\r\n        return index !== -1 ? this.renderObjects[index] : null;\r\n    }\r\n\r\n    /**\r\n     * Adds a particle system to the fluid renderer.\r\n     * @param ps particle system\r\n     * @param generateDiffuseTexture True if you want to generate a diffuse texture from the particle system and use it as part of the fluid rendering (default: false)\r\n     * @param targetRenderer The target renderer used to display the particle system as a fluid. If not provided, the method will create a new one\r\n     * @param camera The camera used by the target renderer (if the target renderer is created by the method)\r\n     * @returns the render object corresponding to the particle system\r\n     */\r\n    public addParticleSystem(ps: IParticleSystem, generateDiffuseTexture?: boolean, targetRenderer?: FluidRenderingTargetRenderer, camera?: Camera): IFluidRenderingRenderObject {\r\n        const object = new FluidRenderingObjectParticleSystem(this._scene, ps, this._shaderLanguage);\r\n\r\n        object.onParticleSizeChanged.add(() => this._setParticleSizeForRenderTargets());\r\n\r\n        if (!targetRenderer) {\r\n            targetRenderer = new FluidRenderingTargetRenderer(this._scene, camera, this._shaderLanguage);\r\n            this.targetRenderers.push(targetRenderer);\r\n        }\r\n\r\n        if (!targetRenderer._onUseVelocityChanged.hasObservers()) {\r\n            targetRenderer._onUseVelocityChanged.add(() => this._setUseVelocityForRenderObject());\r\n        }\r\n\r\n        if (generateDiffuseTexture !== undefined) {\r\n            targetRenderer.generateDiffuseTexture = generateDiffuseTexture;\r\n        }\r\n\r\n        const renderObject = { object, targetRenderer };\r\n\r\n        this.renderObjects.push(renderObject);\r\n\r\n        this._sortRenderingObjects();\r\n\r\n        this._setParticleSizeForRenderTargets();\r\n\r\n        return renderObject;\r\n    }\r\n\r\n    /**\r\n     * Adds a custom particle set to the fluid renderer.\r\n     * @param buffers The list of buffers (should contain at least a \"position\" buffer!)\r\n     * @param numParticles Number of particles in each buffer\r\n     * @param generateDiffuseTexture True if you want to generate a diffuse texture from buffers and use it as part of the fluid rendering (default: false). For the texture to be generated correctly, you need a \"color\" buffer in the set!\r\n     * @param targetRenderer The target renderer used to display the particle system as a fluid. If not provided, the method will create a new one\r\n     * @param camera The camera used by the target renderer (if the target renderer is created by the method)\r\n     * @returns the render object corresponding to the custom particle set\r\n     */\r\n    public addCustomParticles(\r\n        buffers: { [key: string]: FloatArray },\r\n        numParticles: number,\r\n        generateDiffuseTexture?: boolean,\r\n        targetRenderer?: FluidRenderingTargetRenderer,\r\n        camera?: Camera\r\n    ): IFluidRenderingRenderObject {\r\n        const object = new FluidRenderingObjectCustomParticles(this._scene, buffers, numParticles, this._shaderLanguage);\r\n\r\n        object.onParticleSizeChanged.add(() => this._setParticleSizeForRenderTargets());\r\n\r\n        if (!targetRenderer) {\r\n            targetRenderer = new FluidRenderingTargetRenderer(this._scene, camera, this._shaderLanguage);\r\n            this.targetRenderers.push(targetRenderer);\r\n        }\r\n\r\n        if (!targetRenderer._onUseVelocityChanged.hasObservers()) {\r\n            targetRenderer._onUseVelocityChanged.add(() => this._setUseVelocityForRenderObject());\r\n        }\r\n\r\n        if (generateDiffuseTexture !== undefined) {\r\n            targetRenderer.generateDiffuseTexture = generateDiffuseTexture;\r\n        }\r\n\r\n        const renderObject = { object, targetRenderer };\r\n\r\n        this.renderObjects.push(renderObject);\r\n\r\n        this._sortRenderingObjects();\r\n\r\n        this._setParticleSizeForRenderTargets();\r\n\r\n        return renderObject;\r\n    }\r\n\r\n    /**\r\n     * Removes a render object from the fluid renderer\r\n     * @param renderObject the render object to remove\r\n     * @param removeUnusedTargetRenderer True to remove/dispose of the target renderer if it's not used anymore (default: true)\r\n     * @returns True if the render object has been found and released, else false\r\n     */\r\n    public removeRenderObject(renderObject: IFluidRenderingRenderObject, removeUnusedTargetRenderer = true): boolean {\r\n        const index = this.renderObjects.indexOf(renderObject);\r\n        if (index === -1) {\r\n            return false;\r\n        }\r\n\r\n        renderObject.object.dispose();\r\n\r\n        this.renderObjects.splice(index, 1);\r\n\r\n        if (removeUnusedTargetRenderer && this._removeUnusedTargetRenderers()) {\r\n            this._initialize();\r\n        } else {\r\n            this._setParticleSizeForRenderTargets();\r\n        }\r\n\r\n        return true;\r\n    }\r\n\r\n    private _sortRenderingObjects(): void {\r\n        this.renderObjects.sort((a, b) => {\r\n            return a.object.priority < b.object.priority ? -1 : a.object.priority > b.object.priority ? 1 : 0;\r\n        });\r\n    }\r\n\r\n    private _removeUnusedTargetRenderers(): boolean {\r\n        const indexes: { [id: number]: boolean } = {};\r\n\r\n        for (let i = 0; i < this.renderObjects.length; ++i) {\r\n            const targetRenderer = this.renderObjects[i].targetRenderer;\r\n            indexes[this.targetRenderers.indexOf(targetRenderer)] = true;\r\n        }\r\n\r\n        let removed = false;\r\n        const newList: Array<FluidRenderingTargetRenderer> = [];\r\n        for (let i = 0; i < this.targetRenderers.length; ++i) {\r\n            if (!indexes[i]) {\r\n                this.targetRenderers[i].dispose();\r\n                removed = true;\r\n            } else {\r\n                newList.push(this.targetRenderers[i]);\r\n            }\r\n        }\r\n\r\n        if (removed) {\r\n            this.targetRenderers.length = 0;\r\n            this.targetRenderers.push(...newList);\r\n        }\r\n\r\n        return removed;\r\n    }\r\n\r\n    private _getParticleSystemIndex(ps: IParticleSystem): number {\r\n        for (let i = 0; i < this.renderObjects.length; ++i) {\r\n            const obj = this.renderObjects[i].object;\r\n            if (IsParticleSystemObject(obj) && obj.particleSystem === ps) {\r\n                return i;\r\n            }\r\n        }\r\n\r\n        return -1;\r\n    }\r\n\r\n    private _initialize(): void {\r\n        for (let i = 0; i < this.targetRenderers.length; ++i) {\r\n            this.targetRenderers[i].dispose();\r\n        }\r\n\r\n        const cameras: Map<Camera, CameraMapForFluidRendering> = new Map();\r\n\r\n        for (let i = 0; i < this.targetRenderers.length; ++i) {\r\n            const targetRenderer = this.targetRenderers[i];\r\n\r\n            targetRenderer._initialize();\r\n\r\n            if (targetRenderer.camera && targetRenderer._renderPostProcess) {\r\n                let list = cameras.get(targetRenderer.camera);\r\n                if (!list) {\r\n                    list = [[], {}];\r\n                    cameras.set(targetRenderer.camera, list);\r\n                }\r\n                list[0].push(targetRenderer);\r\n                targetRenderer.camera.attachPostProcess(targetRenderer._renderPostProcess, i);\r\n            }\r\n        }\r\n\r\n        let iterator = cameras.keys();\r\n        for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\r\n            const camera = key.value;\r\n            const list = cameras.get(camera)!;\r\n\r\n            const firstPostProcess = camera._getFirstPostProcess();\r\n            if (!firstPostProcess) {\r\n                continue;\r\n            }\r\n\r\n            const [targetRenderers, copyDepthTextures] = list;\r\n\r\n            firstPostProcess.onSizeChangedObservable.add(() => {\r\n                if (!firstPostProcess.inputTexture.depthStencilTexture) {\r\n                    firstPostProcess.inputTexture.createDepthStencilTexture(\r\n                        0,\r\n                        true,\r\n                        this._engine.isStencilEnable,\r\n                        targetRenderers[0].samples,\r\n                        this._engine.isStencilEnable ? Constants.TEXTUREFORMAT_DEPTH24_STENCIL8 : Constants.TEXTUREFORMAT_DEPTH32_FLOAT,\r\n                        `PostProcessRTTDepthStencil-${firstPostProcess.name}`\r\n                    );\r\n                }\r\n                for (const targetRenderer of targetRenderers) {\r\n                    const thicknessRT = targetRenderer._thicknessRenderTarget?.renderTarget;\r\n                    const thicknessTexture = thicknessRT?.texture;\r\n                    if (thicknessRT && thicknessTexture) {\r\n                        const key = thicknessTexture.width + \"_\" + thicknessTexture.height;\r\n                        let copyDepthTexture = copyDepthTextures[key];\r\n                        if (!copyDepthTexture) {\r\n                            copyDepthTexture = copyDepthTextures[key] = new FluidRenderingDepthTextureCopy(this._engine, thicknessTexture.width, thicknessTexture.height);\r\n                        }\r\n                        copyDepthTexture.depthRTWrapper.shareDepth(thicknessRT);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n\r\n        // Dispose the CopyDepthTexture instances that we don't need anymore\r\n        iterator = this._cameras.keys();\r\n        for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\r\n            const camera = key.value;\r\n            const list = this._cameras.get(camera)!;\r\n\r\n            const copyDepthTextures = list[1];\r\n\r\n            const list2 = cameras.get(camera);\r\n            if (!list2) {\r\n                for (const key in copyDepthTextures) {\r\n                    copyDepthTextures[key].dispose();\r\n                }\r\n            } else {\r\n                for (const key in copyDepthTextures) {\r\n                    if (!list2[1][key]) {\r\n                        copyDepthTextures[key].dispose();\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        this._cameras.clear();\r\n        this._cameras = cameras;\r\n\r\n        this._setParticleSizeForRenderTargets();\r\n    }\r\n\r\n    private _setParticleSizeForRenderTargets(): void {\r\n        const particleSizes = new Map<FluidRenderingTargetRenderer, number>();\r\n\r\n        for (let i = 0; i < this.renderObjects.length; ++i) {\r\n            const renderingObject = this.renderObjects[i];\r\n            let curSize = particleSizes.get(renderingObject.targetRenderer);\r\n            if (curSize === undefined) {\r\n                curSize = 0;\r\n            }\r\n            particleSizes.set(renderingObject.targetRenderer, Math.max(curSize, renderingObject.object.particleSize));\r\n        }\r\n\r\n        particleSizes.forEach((particleSize, targetRenderer) => {\r\n            if (targetRenderer._depthRenderTarget) {\r\n                targetRenderer._depthRenderTarget.particleSize = particleSize;\r\n            }\r\n        });\r\n    }\r\n\r\n    private _setUseVelocityForRenderObject(): void {\r\n        for (const renderingObject of this.renderObjects) {\r\n            renderingObject.object.useVelocity = renderingObject.targetRenderer.useVelocity;\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _prepareRendering(): void {\r\n        for (const renderer of this.targetRenderers) {\r\n            if (renderer.needInitialization) {\r\n                this._initialize();\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    /** @internal */\r\n    public _render(forCamera?: Camera): void {\r\n        for (let i = 0; i < this.targetRenderers.length; ++i) {\r\n            if (!forCamera || this.targetRenderers[i].camera === forCamera) {\r\n                this.targetRenderers[i]._clearTargets();\r\n            }\r\n        }\r\n\r\n        const iterator = this._cameras.keys();\r\n        for (let key = iterator.next(); key.done !== true; key = iterator.next()) {\r\n            const camera = key.value;\r\n            const list = this._cameras.get(camera)!;\r\n            if (forCamera && camera !== forCamera) {\r\n                continue;\r\n            }\r\n\r\n            const firstPostProcess = camera._getFirstPostProcess();\r\n            if (!firstPostProcess) {\r\n                continue;\r\n            }\r\n\r\n            const sourceCopyDepth = firstPostProcess.inputTexture?.depthStencilTexture;\r\n            if (sourceCopyDepth) {\r\n                const [targetRenderers, copyDepthTextures] = list;\r\n                for (const targetRenderer of targetRenderers) {\r\n                    targetRenderer._bgDepthTexture = sourceCopyDepth;\r\n                }\r\n                for (const key in copyDepthTextures) {\r\n                    copyDepthTextures[key].copy(sourceCopyDepth);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let i = 0; i < this.renderObjects.length; ++i) {\r\n            const renderingObject = this.renderObjects[i];\r\n            if (!forCamera || renderingObject.targetRenderer.camera === forCamera) {\r\n                renderingObject.targetRenderer._render(renderingObject.object);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Disposes of all the resources used by the class\r\n     */\r\n    public dispose(): void {\r\n        this._engine.onResizeObservable.remove(this._onEngineResizeObserver);\r\n        this._onEngineResizeObserver = null;\r\n\r\n        for (let i = 0; i < this.renderObjects.length; ++i) {\r\n            this.renderObjects[i].object.dispose();\r\n        }\r\n\r\n        for (let i = 0; i < this.targetRenderers.length; ++i) {\r\n            this.targetRenderers[i].dispose();\r\n        }\r\n\r\n        this._cameras.forEach((list) => {\r\n            const copyDepthTextures = list[1];\r\n            for (const key in copyDepthTextures) {\r\n                copyDepthTextures[key].dispose();\r\n            }\r\n        });\r\n\r\n        this.renderObjects.length = 0;\r\n        this.targetRenderers.length = 0;\r\n        this._cameras.clear();\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 12686, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/fluidRenderer/index.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/fluidRenderer/index.ts"],"sourcesContent":["export * from \"./fluidRenderer\";\r\nexport * from \"./fluidRenderingObject\";\r\nexport * from \"./fluidRenderingObjectParticleSystem\";\r\nexport * from \"./fluidRenderingObjectCustomParticles\";\r\nexport * from \"./fluidRenderingTargetRenderer\";\r\n\r\nexport * from \"../../Shaders/fluidRenderingParticleDepth.vertex\";\r\nexport * from \"../../Shaders/fluidRenderingParticleDepth.fragment\";\r\nexport * from \"../../Shaders/fluidRenderingParticleThickness.vertex\";\r\nexport * from \"../../Shaders/fluidRenderingParticleThickness.fragment\";\r\nexport * from \"../../Shaders/fluidRenderingParticleDiffuse.vertex\";\r\nexport * from \"../../Shaders/fluidRenderingParticleDiffuse.fragment\";\r\nexport * from \"../../Shaders/fluidRenderingBilateralBlur.fragment\";\r\nexport * from \"../../Shaders/fluidRenderingStandardBlur.fragment\";\r\nexport * from \"../../Shaders/fluidRenderingRender.fragment\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingParticleDepth.vertex\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingParticleDepth.fragment\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingParticleThickness.vertex\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingParticleThickness.fragment\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingParticleDiffuse.vertex\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingParticleDiffuse.fragment\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingBilateralBlur.fragment\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingStandardBlur.fragment\";\r\nexport * from \"../../ShadersWGSL/fluidRenderingRender.fragment\";\r\n"],"names":[],"mappings":";AAAA,cAAc,iBAAiB,CAAC;AAChC,cAAc,wBAAwB,CAAC;AACvC,cAAc,sCAAsC,CAAC;AACrD,cAAc,uCAAuC,CAAC;AACtD,cAAc,gCAAgC,CAAC;AAE/C,cAAc,kDAAkD,CAAC;AACjE,cAAc,oDAAoD,CAAC;AACnE,cAAc,sDAAsD,CAAC;AACrE,cAAc,wDAAwD,CAAC;AACvE,cAAc,oDAAoD,CAAC;AACnE,cAAc,sDAAsD,CAAC;AACrE,cAAc,oDAAoD,CAAC;AACnE,cAAc,mDAAmD,CAAC;AAClE,cAAc,6CAA6C,CAAC;AAC5D,cAAc,sDAAsD,CAAC;AACrE,cAAc,wDAAwD,CAAC;AACvE,cAAc,0DAA0D,CAAC;AACzE,cAAc,4DAA4D,CAAC;AAC3E,cAAc,wDAAwD,CAAC;AACvE,cAAc,0DAA0D,CAAC;AACzE,cAAc,wDAAwD,CAAC;AACvE,cAAc,uDAAuD,CAAC;AACtE,cAAc,iDAAiD,CAAC"}},
    {"offset": {"line": 12737, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/reflectiveShadowMap.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/reflectiveShadowMap.ts"],"sourcesContent":["/**\r\n * Reflective Shadow Maps were first described in http://www.klayge.org/material/3_12/GI/rsm.pdf by Carsten Dachsbacher and Marc Stamminger\r\n * The ReflectiveShadowMap class only implements the position / normal / flux texture generation part.\r\n * For the global illumination effect, see the GIRSMManager class.\r\n */\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport { MultiRenderTarget } from \"core/Materials/Textures/multiRenderTarget\";\r\nimport type { UniformBuffer } from \"core/Materials/uniformBuffer\";\r\nimport { Color3, Color4 } from \"core/Maths/math.color\";\r\nimport { Matrix, TmpVectors } from \"core/Maths/math.vector\";\r\nimport type { AbstractMesh } from \"core/Meshes/abstractMesh\";\r\nimport type { Scene } from \"core/scene\";\r\nimport type { WebGPURenderTargetWrapper } from \"core/Engines/WebGPU/webgpuRenderTargetWrapper\";\r\nimport { MaterialPluginBase } from \"core/Materials/materialPluginBase\";\r\nimport type { Material } from \"core/Materials/material\";\r\nimport type { StandardMaterial } from \"core/Materials/standardMaterial\";\r\nimport { MaterialDefines } from \"core/Materials/materialDefines\";\r\nimport type { SpotLight } from \"core/Lights/spotLight\";\r\nimport { PBRBaseMaterial } from \"core/Materials/PBR/pbrBaseMaterial\";\r\nimport { expandToProperty, serialize } from \"core/Misc/decorators\";\r\nimport { RegisterClass } from \"core/Misc/typeStore\";\r\nimport { Light } from \"core/Lights/light\";\r\nimport type { DirectionalLight } from \"core/Lights/directionalLight\";\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\nimport type { Nullable } from \"core/types\";\r\n\r\n/**\r\n * Class used to generate the RSM (Reflective Shadow Map) textures for a given light.\r\n * The textures are: position (in world space), normal (in world space) and flux (light intensity)\r\n */\r\nexport class ReflectiveShadowMap {\r\n    private _scene: Scene;\r\n    private _light: DirectionalLight | SpotLight;\r\n    private _lightTransformMatrix: Matrix = Matrix.Identity();\r\n    private _mrt: MultiRenderTarget;\r\n    private _textureDimensions: { width: number; height: number };\r\n    private _regularMatToMatWithPlugin: Map<Material, Material>;\r\n    private _counters: Array<{ name: string; value: number }>;\r\n\r\n    private _enable = false;\r\n\r\n    /**\r\n     * Enables or disables the RSM generation.\r\n     */\r\n    public get enable() {\r\n        return this._enable;\r\n    }\r\n\r\n    public set enable(value: boolean) {\r\n        if (this._enable === value) {\r\n            return;\r\n        }\r\n\r\n        this._enable = value;\r\n        this._customRenderTarget(value);\r\n    }\r\n\r\n    /**\r\n     * Gets the position texture generated by the RSM process.\r\n     */\r\n    public get positionWorldTexture() {\r\n        return this._mrt.textures[0];\r\n    }\r\n\r\n    /**\r\n     * Gets the normal texture generated by the RSM process.\r\n     */\r\n    public get normalWorldTexture() {\r\n        return this._mrt.textures[1];\r\n    }\r\n\r\n    /**\r\n     * Gets the flux texture generated by the RSM process.\r\n     */\r\n    public get fluxTexture() {\r\n        return this._mrt.textures[2];\r\n    }\r\n\r\n    /**\r\n     * Gets the render list used to generate the RSM textures.\r\n     */\r\n    public get renderList() {\r\n        return this._mrt.renderList;\r\n    }\r\n\r\n    /**\r\n     * Gets the light used to generate the RSM textures.\r\n     */\r\n    public get light() {\r\n        return this._light;\r\n    }\r\n\r\n    /**\r\n     * Gets or sets a boolean indicating if the light parameters should be recomputed even if the light parameters (position, direction) did not change.\r\n     * You should not set this value to true, except for debugging purpose (if you want to see changes from the inspector, for eg).\r\n     * Instead, you should call updateLightParameters() explicitely at the right time (once the light parameters changed).\r\n     */\r\n    public forceUpdateLightParameters = false;\r\n\r\n    /**\r\n     * Creates a new RSM for the given light.\r\n     * @param scene The scene\r\n     * @param light The light to use to generate the RSM textures\r\n     * @param textureDimensions The dimensions of the textures to generate. Default: \\{ width: 512, height: 512 \\}\r\n     */\r\n    constructor(scene: Scene, light: DirectionalLight | SpotLight, textureDimensions = { width: 512, height: 512 }) {\r\n        this._scene = scene;\r\n        this._light = light;\r\n        this._textureDimensions = textureDimensions;\r\n        this._regularMatToMatWithPlugin = new Map();\r\n        this._counters = [{ name: \"RSM Generation \" + light.name, value: 0 }];\r\n\r\n        this._createMultiRenderTarget();\r\n        this._recomputeLightTransformationMatrix();\r\n\r\n        this.enable = true;\r\n    }\r\n\r\n    /**\r\n     * Sets the dimensions of the textures to generate.\r\n     * @param dimensions The dimensions of the textures to generate.\r\n     */\r\n    public setTextureDimensions(dimensions: { width: number; height: number }) {\r\n        const renderList = this._mrt.renderList;\r\n\r\n        this._textureDimensions = dimensions;\r\n        this._disposeMultiRenderTarget();\r\n        this._createMultiRenderTarget();\r\n\r\n        if (renderList) {\r\n            for (const mesh of renderList) {\r\n                this._addMeshToMRT(mesh);\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Adds the given mesh to the render list used to generate the RSM textures.\r\n     * @param mesh The mesh to add to the render list used to generate the RSM textures. If not provided, all scene meshes will be added to the render list.\r\n     */\r\n    public addMesh(mesh?: AbstractMesh) {\r\n        if (mesh) {\r\n            this._addMeshToMRT(mesh);\r\n        } else {\r\n            for (const mesh of this._scene.meshes) {\r\n                this._addMeshToMRT(mesh);\r\n            }\r\n        }\r\n        this._recomputeLightTransformationMatrix();\r\n    }\r\n\r\n    /**\r\n     * Recomputes the light transformation matrix. Call this method if you manually changed the light position / direction / etc. and you want to update the RSM textures accordingly.\r\n     * You should also call this method if you add/remove meshes to/from the render list.\r\n     */\r\n    public updateLightParameters() {\r\n        this._recomputeLightTransformationMatrix();\r\n    }\r\n\r\n    /**\r\n     * Gets the light transformation matrix used to generate the RSM textures.\r\n     */\r\n    public get lightTransformationMatrix() {\r\n        if (this.forceUpdateLightParameters) {\r\n            this.updateLightParameters();\r\n        }\r\n        return this._lightTransformMatrix;\r\n    }\r\n\r\n    /**\r\n     * Gets the GPU time spent to generate the RSM textures.\r\n     */\r\n    public get countersGPU(): Array<{ name: string; value: number }> {\r\n        return this._counters;\r\n    }\r\n\r\n    /**\r\n     * Disposes the RSM.\r\n     */\r\n    public dispose() {\r\n        this._disposeMultiRenderTarget();\r\n    }\r\n\r\n    protected _createMultiRenderTarget() {\r\n        const name = this._light.name;\r\n\r\n        const caps = this._scene.getEngine().getCaps();\r\n\r\n        const fluxTextureType = caps.rg11b10ufColorRenderable ? Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV : Constants.TEXTURETYPE_HALF_FLOAT;\r\n        const fluxTextureFormat = caps.rg11b10ufColorRenderable ? Constants.TEXTUREFORMAT_RGB : Constants.TEXTUREFORMAT_RGBA;\r\n\r\n        this._mrt = new MultiRenderTarget(\r\n            \"RSMmrt_\" + name,\r\n            this._textureDimensions,\r\n            3, // number of RTT - position / normal / flux\r\n            this._scene,\r\n            {\r\n                types: [Constants.TEXTURETYPE_HALF_FLOAT, Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV, fluxTextureType],\r\n                samplingModes: [Constants.TEXTURE_BILINEAR_SAMPLINGMODE, Constants.TEXTURE_BILINEAR_SAMPLINGMODE, Constants.TEXTURE_BILINEAR_SAMPLINGMODE],\r\n                generateMipMaps: false,\r\n                targetTypes: [Constants.TEXTURE_2D, Constants.TEXTURE_2D, Constants.TEXTURE_2D],\r\n                formats: [Constants.TEXTUREFORMAT_RGBA, Constants.TEXTUREFORMAT_RGBA, fluxTextureFormat],\r\n            },\r\n            [\"RSMPosition_\" + name, \"RSMNormal_\" + name, \"RSMFlux_\" + name]\r\n        );\r\n\r\n        this._mrt.renderList = [];\r\n        this._mrt.clearColor = new Color4(0, 0, 0, 1);\r\n        this._mrt.noPrePassRenderer = true;\r\n\r\n        let sceneUBO: UniformBuffer;\r\n        let currentSceneUBO: UniformBuffer;\r\n\r\n        const useUBO = this._scene.getEngine().supportsUniformBuffers;\r\n\r\n        if (useUBO) {\r\n            sceneUBO = this._scene.createSceneUniformBuffer(`Scene for RSM (light \"${name}\")`);\r\n        }\r\n\r\n        let shadowEnabled: boolean;\r\n\r\n        this._mrt.onBeforeBindObservable.add(() => {\r\n            currentSceneUBO = this._scene.getSceneUniformBuffer();\r\n            shadowEnabled = this._light.shadowEnabled;\r\n            this._light.shadowEnabled = false; // we render from the light point of view, so we won't have any shadow anyway!\r\n        });\r\n\r\n        this._mrt.onBeforeRenderObservable.add((faceIndex: number) => {\r\n            if (sceneUBO) {\r\n                this._scene.setSceneUniformBuffer(sceneUBO);\r\n            }\r\n            const viewMatrix = this._light.getViewMatrix(faceIndex);\r\n            const projectionMatrix = this._light.getProjectionMatrix(viewMatrix || undefined, this._mrt.renderList || undefined);\r\n            if (viewMatrix && projectionMatrix) {\r\n                this._scene.setTransformMatrix(viewMatrix, projectionMatrix);\r\n            }\r\n            if (useUBO) {\r\n                this._scene.getSceneUniformBuffer().unbindEffect();\r\n                this._scene.finalizeSceneUbo();\r\n            }\r\n        });\r\n\r\n        this._mrt.onAfterUnbindObservable.add(() => {\r\n            if (sceneUBO) {\r\n                this._scene.setSceneUniformBuffer(currentSceneUBO);\r\n            }\r\n            this._scene.updateTransformMatrix(); // restore the view/projection matrices of the active camera\r\n            this._light.shadowEnabled = shadowEnabled;\r\n            this._counters[0].value = (this._mrt.renderTarget as WebGPURenderTargetWrapper).gpuTimeInFrame?.counter.lastSecAverage ?? 0;\r\n        });\r\n\r\n        this._customRenderTarget(true);\r\n    }\r\n\r\n    protected _customRenderTarget(add: boolean) {\r\n        const idx = this._scene.customRenderTargets.indexOf(this._mrt);\r\n        if (add) {\r\n            if (idx === -1) {\r\n                this._scene.customRenderTargets.push(this._mrt);\r\n            }\r\n        } else if (idx !== -1) {\r\n            this._scene.customRenderTargets.splice(idx, 1);\r\n        }\r\n    }\r\n\r\n    protected _recomputeLightTransformationMatrix() {\r\n        const viewMatrix = this._light.getViewMatrix();\r\n        const projectionMatrix = this._light.getProjectionMatrix(viewMatrix || undefined, this._mrt.renderList || undefined);\r\n        if (viewMatrix && projectionMatrix) {\r\n            viewMatrix.multiplyToRef(projectionMatrix, this._lightTransformMatrix);\r\n        }\r\n    }\r\n\r\n    protected _addMeshToMRT(mesh: AbstractMesh) {\r\n        this._mrt.renderList?.push(mesh);\r\n\r\n        const material = mesh.material;\r\n        if (mesh.getTotalVertices() === 0 || !material) {\r\n            return;\r\n        }\r\n\r\n        let rsmMaterial = this._regularMatToMatWithPlugin.get(material);\r\n        if (!rsmMaterial) {\r\n            rsmMaterial = material.clone(\"RSMCreate_\" + material.name) || undefined;\r\n            if (rsmMaterial) {\r\n                // Disable the prepass renderer for this material\r\n                Object.defineProperty(rsmMaterial, \"canRenderToMRT\", {\r\n                    get: function () {\r\n                        return false;\r\n                    },\r\n                    enumerable: true,\r\n                    configurable: true,\r\n                });\r\n\r\n                (rsmMaterial as any).disableLighting = true;\r\n\r\n                const rsmCreatePlugin = new RSMCreatePluginMaterial(rsmMaterial);\r\n\r\n                rsmCreatePlugin.isEnabled = true;\r\n                rsmCreatePlugin.light = this._light;\r\n\r\n                this._regularMatToMatWithPlugin.set(material, rsmMaterial);\r\n            }\r\n        }\r\n\r\n        this._mrt.setMaterialForRendering(mesh, rsmMaterial);\r\n    }\r\n\r\n    protected _disposeMultiRenderTarget() {\r\n        this._customRenderTarget(false);\r\n        this._mrt.dispose();\r\n    }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nclass MaterialRSMCreateDefines extends MaterialDefines {\r\n    public RSMCREATE = false;\r\n    public RSMCREATE_PROJTEXTURE = false;\r\n    public RSMCREATE_LIGHT_IS_SPOT = false;\r\n}\r\n\r\n/**\r\n * Plugin that implements the creation of the RSM textures\r\n */\r\nexport class RSMCreatePluginMaterial extends MaterialPluginBase {\r\n    private _varAlbedoName: string;\r\n    private _lightColor = new Color3();\r\n    private _hasProjectionTexture = false;\r\n\r\n    /**\r\n     * Defines the name of the plugin.\r\n     */\r\n    public static readonly Name = \"RSMCreate\";\r\n\r\n    /**\r\n     * Defines the light that should be used to generate the RSM textures.\r\n     */\r\n    @serialize()\r\n    public light: DirectionalLight | SpotLight;\r\n\r\n    private _isEnabled = false;\r\n    /**\r\n     * Defines if the plugin is enabled in the material.\r\n     */\r\n    @serialize()\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public isEnabled = false;\r\n\r\n    protected _markAllSubMeshesAsTexturesDirty(): void {\r\n        this._enable(this._isEnabled);\r\n        this._internalMarkAllSubMeshesAsTexturesDirty();\r\n    }\r\n\r\n    private _internalMarkAllSubMeshesAsTexturesDirty: () => void;\r\n\r\n    /**\r\n     * Gets a boolean indicating that the plugin is compatible with a give shader language.\r\n     * @returns true if the plugin is compatible with the shader language\r\n     */\r\n    public override isCompatible(): boolean {\r\n        return true;\r\n    }\r\n\r\n    /**\r\n     * Create a new RSMCreatePluginMaterial\r\n     * @param material Parent material of the plugin\r\n     */\r\n    constructor(material: Material | StandardMaterial | PBRBaseMaterial) {\r\n        super(material, RSMCreatePluginMaterial.Name, 300, new MaterialRSMCreateDefines());\r\n\r\n        this._internalMarkAllSubMeshesAsTexturesDirty = material._dirtyCallbacks[Constants.MATERIAL_TextureDirtyFlag];\r\n\r\n        this._varAlbedoName = material instanceof PBRBaseMaterial ? \"surfaceAlbedo\" : \"baseColor.rgb\";\r\n    }\r\n\r\n    public override prepareDefines(defines: MaterialRSMCreateDefines) {\r\n        defines.RSMCREATE = this._isEnabled;\r\n\r\n        this._hasProjectionTexture = false;\r\n\r\n        const isSpot = this.light.getTypeID() === Light.LIGHTTYPEID_SPOTLIGHT;\r\n        if (isSpot) {\r\n            const spot = this.light as SpotLight;\r\n            this._hasProjectionTexture = spot.projectionTexture ? spot.projectionTexture.isReady() : false;\r\n        }\r\n\r\n        defines.RSMCREATE_PROJTEXTURE = this._hasProjectionTexture;\r\n        defines.RSMCREATE_LIGHT_IS_SPOT = isSpot;\r\n        defines.SCENE_MRT_COUNT = 3;\r\n    }\r\n\r\n    public override getClassName() {\r\n        return \"RSMCreatePluginMaterial\";\r\n    }\r\n\r\n    public override getUniforms() {\r\n        return {\r\n            ubo: [\r\n                { name: \"rsmTextureProjectionMatrix\", size: 16, type: \"mat4\" },\r\n                { name: \"rsmSpotInfo\", size: 4, type: \"vec4\" },\r\n                { name: \"rsmLightColor\", size: 3, type: \"vec3\" },\r\n                { name: \"rsmLightPosition\", size: 3, type: \"vec3\" },\r\n            ],\r\n            fragment: `#ifdef RSMCREATE\r\n                    uniform mat4 rsmTextureProjectionMatrix;\r\n                    uniform vec4 rsmSpotInfo;\r\n                    uniform vec3 rsmLightColor;\r\n                    uniform vec3 rsmLightPosition;\r\n                #endif`,\r\n        };\r\n    }\r\n\r\n    public override getSamplers(samplers: string[]) {\r\n        samplers.push(\"rsmTextureProjectionSampler\");\r\n    }\r\n\r\n    public override bindForSubMesh(uniformBuffer: UniformBuffer) {\r\n        if (!this._isEnabled) {\r\n            return;\r\n        }\r\n\r\n        this.light.diffuse.scaleToRef(this.light.getScaledIntensity(), this._lightColor);\r\n        uniformBuffer.updateColor3(\"rsmLightColor\", this._lightColor);\r\n\r\n        if (this.light.getTypeID() === Light.LIGHTTYPEID_SPOTLIGHT) {\r\n            const spot = this.light as SpotLight;\r\n\r\n            if (this._hasProjectionTexture) {\r\n                uniformBuffer.updateMatrix(\"rsmTextureProjectionMatrix\", spot.projectionTextureMatrix);\r\n                uniformBuffer.setTexture(\"rsmTextureProjectionSampler\", spot.projectionTexture);\r\n            }\r\n\r\n            const normalizeDirection = TmpVectors.Vector3[0];\r\n\r\n            if (spot.computeTransformedInformation()) {\r\n                uniformBuffer.updateFloat3(\"rsmLightPosition\", this.light.transformedPosition.x, this.light.transformedPosition.y, this.light.transformedPosition.z);\r\n                spot.transformedDirection.normalizeToRef(normalizeDirection);\r\n            } else {\r\n                uniformBuffer.updateFloat3(\"rsmLightPosition\", this.light.position.x, this.light.position.y, this.light.position.z);\r\n                spot.direction.normalizeToRef(normalizeDirection);\r\n            }\r\n\r\n            uniformBuffer.updateFloat4(\"rsmSpotInfo\", normalizeDirection.x, normalizeDirection.y, normalizeDirection.z, Math.cos(spot.angle * 0.5));\r\n        }\r\n    }\r\n\r\n    public override getCustomCode(shaderType: string, shaderLanguage: ShaderLanguage): Nullable<{ [pointName: string]: string }> {\r\n        if (shaderType === \"vertex\") {\r\n            return null;\r\n        }\r\n        if (shaderLanguage === ShaderLanguage.WGSL) {\r\n            return {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_DEFINITIONS: `\r\n                #ifdef RSMCREATE\r\n                    #ifdef RSMCREATE_PROJTEXTURE\r\n                        var rsmTextureProjectionSamplerSampler: sampler;\r\n                        var rsmTextureProjectionSampler: texture_2d<f32>;\r\n                    #endif\r\n                #endif\r\n            `,\r\n\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR: `\r\n                #ifdef RSMCREATE\r\n                    var rsmColor = ${this._varAlbedoName} * uniforms.rsmLightColor;\r\n                    #ifdef RSMCREATE_PROJTEXTURE\r\n                    {\r\n                        var strq = uniforms.rsmTextureProjectionMatrix * vec4f(fragmentInputs.vPositionW, 1.0);\r\n                        strq /= strq.w;\r\n                        rsmColor *= textureSample(rsmTextureProjectionSampler, rsmTextureProjectionSamplerSampler, strq.xy).rgb;\r\n                    }\r\n                    #endif\r\n                    #ifdef RSMCREATE_LIGHT_IS_SPOT\r\n                    {\r\n                        var cosAngle = max(0., dot(uniforms.rsmSpotInfo.xyz, normalize(fragmentInputs.vPositionW - uniforms.rsmLightPosition)));\r\n                        rsmColor = sign(cosAngle - uniforms.rsmSpotInfo.w) * rsmColor;\r\n                    }\r\n                    #endif\r\n\r\n                    #define MRT_AND_COLOR\r\n                    fragmentOutputs.fragData0 = vec4f(fragmentInputs.vPositionW, 1.);\r\n                    fragmentOutputs.fragData1 = vec4f(normalize(normalW) * 0.5 + 0.5, 1.);\r\n                    fragmentOutputs.fragData2 = vec4f(rsmColor, 1.);\r\n                #endif\r\n            `,\r\n            };\r\n        }\r\n\r\n        return {\r\n            // eslint-disable-next-line @typescript-eslint/naming-convention\r\n            CUSTOM_FRAGMENT_BEGIN: `\r\n                #ifdef RSMCREATE\r\n                    #extension GL_EXT_draw_buffers : require\r\n                #endif\r\n            `,\r\n\r\n            // eslint-disable-next-line @typescript-eslint/naming-convention\r\n            CUSTOM_FRAGMENT_DEFINITIONS: `\r\n                #ifdef RSMCREATE\r\n                    #ifdef RSMCREATE_PROJTEXTURE\r\n                        uniform highp sampler2D rsmTextureProjectionSampler;                    \r\n                    #endif\r\n                    layout(location = 0) out highp vec4 glFragData[3];\r\n                    vec4 glFragColor;\r\n                #endif\r\n            `,\r\n\r\n            // eslint-disable-next-line @typescript-eslint/naming-convention\r\n            CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR: `\r\n                #ifdef RSMCREATE\r\n                    vec3 rsmColor = ${this._varAlbedoName} * rsmLightColor;\r\n                    #ifdef RSMCREATE_PROJTEXTURE\r\n                    {\r\n                        vec4 strq = rsmTextureProjectionMatrix * vec4(vPositionW, 1.0);\r\n                        strq /= strq.w;\r\n                        rsmColor *= texture2D(rsmTextureProjectionSampler, strq.xy).rgb;\r\n                    }\r\n                    #endif\r\n                    #ifdef RSMCREATE_LIGHT_IS_SPOT\r\n                    {\r\n                        float cosAngle = max(0., dot(rsmSpotInfo.xyz, normalize(vPositionW - rsmLightPosition)));\r\n                        rsmColor = sign(cosAngle - rsmSpotInfo.w) * rsmColor;\r\n                    }\r\n                    #endif\r\n                    glFragData[0] = vec4(vPositionW, 1.);\r\n                    glFragData[1] = vec4(normalize(normalW) * 0.5 + 0.5, 1.);\r\n                    glFragData[2] = vec4(rsmColor, 1.);\r\n                #endif\r\n            `,\r\n        };\r\n    }\r\n}\r\n\r\nRegisterClass(`BABYLON.RSMCreatePluginMaterial`, RSMCreatePluginMaterial);\r\n"],"names":[],"mappings":";;;;;;;AAAA;;;;GAIG,CAEH,OAAO,EAAE,iBAAiB,EAAE,mDAAkD;AAE9E,OAAO,EAAE,MAAM,EAAE,MAAM,EAAE,+BAA8B;AACvD,OAAO,EAAE,MAAM,EAAE,UAAU,EAAE,gCAA+B;AAI5D,OAAO,EAAE,kBAAkB,EAAE,2CAA0C;AAGvE,OAAO,EAAE,eAAe,EAAE,wCAAuC;AAEjE,OAAO,EAAE,eAAe,EAAE,4CAA2C;AACrE,OAAO,EAAE,gBAAgB,EAAE,SAAS,EAAE,8BAA6B;AACnE,OAAO,EAAE,aAAa,EAAE,6BAA4B;AACpD,OAAO,EAAE,KAAK,EAAE,2BAA0B;;;;;;;;;;;AASpC,MAAO,mBAAmB;IAW5B;;OAEG,CACH,IAAW,MAAM,GAAA;QACb,OAAO,IAAI,CAAC,OAAO,CAAC;IACxB,CAAC;IAED,IAAW,MAAM,CAAC,KAAc,EAAA;QAC5B,IAAI,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE,CAAC;YACzB,OAAO;QACX,CAAC;QAED,IAAI,CAAC,OAAO,GAAG,KAAK,CAAC;QACrB,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;IACpC,CAAC;IAED;;OAEG,CACH,IAAW,oBAAoB,GAAA;QAC3B,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACjC,CAAC;IAED;;OAEG,CACH,IAAW,kBAAkB,GAAA;QACzB,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACjC,CAAC;IAED;;OAEG,CACH,IAAW,WAAW,GAAA;QAClB,OAAO,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;IACjC,CAAC;IAED;;OAEG,CACH,IAAW,UAAU,GAAA;QACjB,OAAO,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;IAChC,CAAC;IAED;;OAEG,CACH,IAAW,KAAK,GAAA;QACZ,OAAO,IAAI,CAAC,MAAM,CAAC;IACvB,CAAC;IASD;;;;;OAKG,CACH,YAAY,KAAY,EAAE,KAAmC,EAAE,iBAAiB,GAAG;QAAE,KAAK,EAAE,GAAG;QAAE,MAAM,EAAE,GAAG;IAAA,CAAE,CAAA;QAxEtG,IAAA,CAAA,qBAAqB,GAAW,yOAAM,CAAC,QAAQ,EAAE,CAAC;QAMlD,IAAA,CAAA,OAAO,GAAG,KAAK,CAAC;QAqDxB;;;;WAIG,CACI,IAAA,CAAA,0BAA0B,GAAG,KAAK,CAAC;QAStC,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,MAAM,GAAG,KAAK,CAAC;QACpB,IAAI,CAAC,kBAAkB,GAAG,iBAAiB,CAAC;QAC5C,IAAI,CAAC,0BAA0B,GAAG,IAAI,GAAG,EAAE,CAAC;QAC5C,IAAI,CAAC,SAAS,GAAG;YAAC;gBAAE,IAAI,EAAE,iBAAiB,GAAG,KAAK,CAAC,IAAI;gBAAE,KAAK,EAAE,CAAC;YAAA,CAAE;SAAC,CAAC;QAEtE,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAChC,IAAI,CAAC,mCAAmC,EAAE,CAAC;QAE3C,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC;IACvB,CAAC;IAED;;;OAGG,CACI,oBAAoB,CAAC,UAA6C,EAAA;QACrE,MAAM,UAAU,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC;QAExC,IAAI,CAAC,kBAAkB,GAAG,UAAU,CAAC;QACrC,IAAI,CAAC,yBAAyB,EAAE,CAAC;QACjC,IAAI,CAAC,wBAAwB,EAAE,CAAC;QAEhC,IAAI,UAAU,EAAE,CAAC;YACb,KAAK,MAAM,IAAI,IAAI,UAAU,CAAE,CAAC;gBAC5B,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YAC7B,CAAC;QACL,CAAC;IACL,CAAC;IAED;;;OAGG,CACI,OAAO,CAAC,IAAmB,EAAA;QAC9B,IAAI,IAAI,EAAE,CAAC;YACP,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;QAC7B,CAAC,MAAM,CAAC;YACJ,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,MAAM,CAAC,MAAM,CAAE,CAAC;gBACpC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,CAAC;YAC7B,CAAC;QACL,CAAC;QACD,IAAI,CAAC,mCAAmC,EAAE,CAAC;IAC/C,CAAC;IAED;;;OAGG,CACI,qBAAqB,GAAA;QACxB,IAAI,CAAC,mCAAmC,EAAE,CAAC;IAC/C,CAAC;IAED;;OAEG,CACH,IAAW,yBAAyB,GAAA;QAChC,IAAI,IAAI,CAAC,0BAA0B,EAAE,CAAC;YAClC,IAAI,CAAC,qBAAqB,EAAE,CAAC;QACjC,CAAC;QACD,OAAO,IAAI,CAAC,qBAAqB,CAAC;IACtC,CAAC;IAED;;OAEG,CACH,IAAW,WAAW,GAAA;QAClB,OAAO,IAAI,CAAC,SAAS,CAAC;IAC1B,CAAC;IAED;;OAEG,CACI,OAAO,GAAA;QACV,IAAI,CAAC,yBAAyB,EAAE,CAAC;IACrC,CAAC;IAES,wBAAwB,GAAA;QAC9B,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QAE9B,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,OAAO,EAAE,CAAC;QAE/C,MAAM,eAAe,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,KAAA,IAAS,CAAC,wCAAwC,CAAC,CAAC,CAAC,SAAS,CAAC,sBAAsB,CAAC;QAC9I,MAAM,iBAAiB,GAAG,IAAI,CAAC,wBAAwB,CAAC,CAAC,CAAC,IAAA,KAAS,CAAC,iBAAiB,CAAC,CAAC,CAAC,SAAS,CAAC,kBAAkB,CAAC;QAErH,IAAI,CAAC,IAAI,GAAG,IAAI,uQAAiB,CAC7B,SAAS,GAAG,IAAI,EAChB,IAAI,CAAC,kBAAkB,EACvB,CAAC,EAAE,AACH,IAAI,CAAC,MAAM,EACX,8BAF8C;YAG1C,KAAK,EAAE;gBAAC;gBAAA;gBAAA,EAAS,CAAC;aAAA,SAAsB,EAAE,SAAS,CAAC,uCAAuC,EAAE,eAAe,CAAC;YAC7G,aAAa,EAAE;gBAAC;gBAAA;gBAAA;aAAA,CAAS,CAAC,6BAA6B,EAAE,SAAS,CAAC,6BAA6B,EAAE,SAAS,CAAC,6BAA6B,CAAC;YAC1I,eAAe,EAAE,KAAK;YACtB,WAAW,EAAE;gBAAC;gBAAA,GAAS,CAAC;gBAAA;aAAA,GAAU,EAAE,SAAS,CAAC,UAAU,EAAE,SAAS,CAAC,UAAU,CAAC;YAC/E,OAAO,EAAE;gBAAC;gBAAA;gBAAA,GAAS,CAAC;aAAA,IAAkB,EAAE,SAAS,CAAC,kBAAkB,EAAE,iBAAiB,CAAC;SAC3F,EACD;YAAC,cAAc,GAAG,IAAI;YAAE,YAAY,GAAG,IAAI;YAAE,UAAU,GAAG,IAAI;SAAC,CAClE,CAAC;QAEF,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,EAAE,CAAC;QAC1B,IAAI,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,wOAAM,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;QAC9C,IAAI,CAAC,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC;QAEnC,IAAI,QAAuB,CAAC;QAC5B,IAAI,eAA8B,CAAC;QAEnC,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,CAAC,sBAAsB,CAAC;QAE9D,IAAI,MAAM,EAAE,CAAC;YACT,QAAQ,GAAG,IAAI,CAAC,MAAM,CAAC,wBAAwB,CAAC,CAAA,sBAAA,EAAyB,IAAI,CAAA,EAAA,CAAI,CAAC,CAAC;QACvF,CAAC;QAED,IAAI,aAAsB,CAAC;QAE3B,IAAI,CAAC,IAAI,CAAC,sBAAsB,CAAC,GAAG,CAAC,GAAG,EAAE;YACtC,eAAe,GAAG,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC;YACtD,aAAa,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC;YAC1C,IAAI,CAAC,MAAM,CAAC,aAAa,GAAG,KAAK,CAAC,CAAC,8EAA8E;QACrH,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,IAAI,CAAC,wBAAwB,CAAC,GAAG,CAAC,CAAC,SAAiB,EAAE,EAAE;YACzD,IAAI,QAAQ,EAAE,CAAC;gBACX,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC,QAAQ,CAAC,CAAC;YAChD,CAAC;YACD,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,CAAC,SAAS,CAAC,CAAC;YACxD,MAAM,gBAAgB,GAAG,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,UAAU,IAAI,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,CAAC;YACrH,IAAI,UAAU,IAAI,gBAAgB,EAAE,CAAC;gBACjC,IAAI,CAAC,MAAM,CAAC,kBAAkB,CAAC,UAAU,EAAE,gBAAgB,CAAC,CAAC;YACjE,CAAC;YACD,IAAI,MAAM,EAAE,CAAC;gBACT,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC,YAAY,EAAE,CAAC;gBACnD,IAAI,CAAC,MAAM,CAAC,gBAAgB,EAAE,CAAC;YACnC,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,GAAG,CAAC,GAAG,EAAE;YACvC,IAAI,QAAQ,EAAE,CAAC;gBACX,IAAI,CAAC,MAAM,CAAC,qBAAqB,CAAC,eAAe,CAAC,CAAC;YACvD,CAAC;YACD,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC,CAAC,4DAA4D;YACjG,IAAI,CAAC,MAAM,CAAC,aAAa,GAAG,aAAa,CAAC;YAC1C,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,KAAK,GAAI,IAAI,CAAC,IAAI,CAAC,YAA0C,CAAC,cAAc,EAAE,OAAO,CAAC,cAAc,IAAI,CAAC,CAAC;QAChI,CAAC,CAAC,CAAC;QAEH,IAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,CAAC;IACnC,CAAC;IAES,mBAAmB,CAAC,GAAY,EAAA;QACtC,MAAM,GAAG,GAAG,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QAC/D,IAAI,GAAG,EAAE,CAAC;YACN,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE,CAAC;gBACb,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACpD,CAAC;QACL,CAAC,MAAM,IAAI,GAAG,KAAK,CAAC,CAAC,EAAE,CAAC;YACpB,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,CAAC;QACnD,CAAC;IACL,CAAC;IAES,mCAAmC,GAAA;QACzC,MAAM,UAAU,GAAG,IAAI,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;QAC/C,MAAM,gBAAgB,GAAG,IAAI,CAAC,MAAM,CAAC,mBAAmB,CAAC,UAAU,IAAI,SAAS,EAAE,IAAI,CAAC,IAAI,CAAC,UAAU,IAAI,SAAS,CAAC,CAAC;QACrH,IAAI,UAAU,IAAI,gBAAgB,EAAE,CAAC;YACjC,UAAU,CAAC,aAAa,CAAC,gBAAgB,EAAE,IAAI,CAAC,qBAAqB,CAAC,CAAC;QAC3E,CAAC;IACL,CAAC;IAES,aAAa,CAAC,IAAkB,EAAA;QACtC,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,IAAI,CAAC,IAAI,CAAC,CAAC;QAEjC,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;QAC/B,IAAI,IAAI,CAAC,gBAAgB,EAAE,KAAK,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC;YAC7C,OAAO;QACX,CAAC;QAED,IAAI,WAAW,GAAG,IAAI,CAAC,0BAA0B,CAAC,GAAG,CAAC,QAAQ,CAAC,CAAC;QAChE,IAAI,CAAC,WAAW,EAAE,CAAC;YACf,WAAW,GAAG,QAAQ,CAAC,KAAK,CAAC,YAAY,GAAG,QAAQ,CAAC,IAAI,CAAC,IAAI,SAAS,CAAC;YACxE,IAAI,WAAW,EAAE,CAAC;gBACd,iDAAiD;gBACjD,MAAM,CAAC,cAAc,CAAC,WAAW,EAAE,gBAAgB,EAAE;oBACjD,GAAG,EAAE;wBACD,OAAO,KAAK,CAAC;oBACjB,CAAC;oBACD,UAAU,EAAE,IAAI;oBAChB,YAAY,EAAE,IAAI;iBACrB,CAAC,CAAC;gBAEF,WAAmB,CAAC,eAAe,GAAG,IAAI,CAAC;gBAE5C,MAAM,eAAe,GAAG,IAAI,uBAAuB,CAAC,WAAW,CAAC,CAAC;gBAEjE,eAAe,CAAC,SAAS,GAAG,IAAI,CAAC;gBACjC,eAAe,CAAC,KAAK,GAAG,IAAI,CAAC,MAAM,CAAC;gBAEpC,IAAI,CAAC,0BAA0B,CAAC,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;YAC/D,CAAC;QACL,CAAC;QAED,IAAI,CAAC,IAAI,CAAC,uBAAuB,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;IACzD,CAAC;IAES,yBAAyB,GAAA;QAC/B,IAAI,CAAC,mBAAmB,CAAC,KAAK,CAAC,CAAC;QAChC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,CAAC;IACxB,CAAC;CACJ;AAED;;GAEG,CACH,MAAM,wBAAyB,SAAQ,uPAAe;IAAtD,aAAA;;QACW,IAAA,CAAA,SAAS,GAAG,KAAK,CAAC;QAClB,IAAA,CAAA,qBAAqB,GAAG,KAAK,CAAC;QAC9B,IAAA,CAAA,uBAAuB,GAAG,KAAK,CAAC;IAC3C,CAAC;CAAA;AAKK,MAAO,uBAAwB,SAAQ,6PAAkB;IAwBjD,gCAAgC,GAAA;QACtC,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;QAC9B,IAAI,CAAC,wCAAwC,EAAE,CAAC;IACpD,CAAC;IAID;;;OAGG,CACa,YAAY,GAAA;QACxB,OAAO,IAAI,CAAC;IAChB,CAAC;IAED;;;OAGG,CACH,YAAY,QAAuD,CAAA;QAC/D,KAAK,CAAC,QAAQ,EAAE,uBAAuB,CAAC,IAAI,EAAE,GAAG,EAAE,IAAI,wBAAwB,EAAE,CAAC,CAAC;QA1C/E,IAAA,CAAA,WAAW,GAAG,IAAI,wOAAM,EAAE,CAAC;QAC3B,IAAA,CAAA,qBAAqB,GAAG,KAAK,CAAC;QAa9B,IAAA,CAAA,UAAU,GAAG,KAAK,CAAC;QAC3B;;WAEG,CAGI,IAAA,CAAA,SAAS,GAAG,KAAK,CAAC;QAwBrB,IAAI,CAAC,wCAAwC,GAAG,QAAQ,CAAC,eAAe,CAAC,EAAA,OAAS,CAAC,yBAAyB,CAAC,CAAC;QAE9G,IAAI,CAAC,cAAc,GAAG,QAAQ,YAAY,8PAAe,CAAC,CAAC,CAAC,eAAe,CAAC,CAAC,CAAC,eAAe,CAAC;IAClG,CAAC;IAEe,cAAc,CAAC,OAAiC,EAAA;QAC5D,OAAO,CAAC,SAAS,GAAG,IAAI,CAAC,UAAU,CAAC;QAEpC,IAAI,CAAC,qBAAqB,GAAG,KAAK,CAAC;QAEnC,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,gOAAK,CAAC,qBAAqB,CAAC;QACtE,IAAI,MAAM,EAAE,CAAC;YACT,MAAM,IAAI,GAAG,IAAI,CAAC,KAAkB,CAAC;YACrC,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,iBAAiB,CAAC,CAAC,CAAC,IAAI,CAAC,iBAAiB,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC,KAAK,CAAC;QACnG,CAAC;QAED,OAAO,CAAC,qBAAqB,GAAG,IAAI,CAAC,qBAAqB,CAAC;QAC3D,OAAO,CAAC,uBAAuB,GAAG,MAAM,CAAC;QACzC,OAAO,CAAC,eAAe,GAAG,CAAC,CAAC;IAChC,CAAC;IAEe,YAAY,GAAA;QACxB,OAAO,yBAAyB,CAAC;IACrC,CAAC;IAEe,WAAW,GAAA;QACvB,OAAO;YACH,GAAG,EAAE;gBACD;oBAAE,IAAI,EAAE,4BAA4B;oBAAE,IAAI,EAAE,EAAE;oBAAE,IAAI,EAAE,MAAM;gBAAA,CAAE;gBAC9D;oBAAE,IAAI,EAAE,aAAa;oBAAE,IAAI,EAAE,CAAC;oBAAE,IAAI,EAAE,MAAM;gBAAA,CAAE;gBAC9C;oBAAE,IAAI,EAAE,eAAe;oBAAE,IAAI,EAAE,CAAC;oBAAE,IAAI,EAAE,MAAM;gBAAA,CAAE;gBAChD;oBAAE,IAAI,EAAE,kBAAkB;oBAAE,IAAI,EAAE,CAAC;oBAAE,IAAI,EAAE,MAAM;gBAAA,CAAE;aACtD;YACD,QAAQ,EAAE,CAAA;;;;;uBAKC;SACd,CAAC;IACN,CAAC;IAEe,WAAW,CAAC,QAAkB,EAAA;QAC1C,QAAQ,CAAC,IAAI,CAAC,6BAA6B,CAAC,CAAC;IACjD,CAAC;IAEe,cAAc,CAAC,aAA4B,EAAA;QACvD,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE,CAAC;YACnB,OAAO;QACX,CAAC;QAED,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,KAAK,CAAC,kBAAkB,EAAE,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QACjF,aAAa,CAAC,YAAY,CAAC,eAAe,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;QAE9D,IAAI,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,KAAK,gOAAK,CAAC,qBAAqB,EAAE,CAAC;YACzD,MAAM,IAAI,GAAG,IAAI,CAAC,KAAkB,CAAC;YAErC,IAAI,IAAI,CAAC,qBAAqB,EAAE,CAAC;gBAC7B,aAAa,CAAC,YAAY,CAAC,4BAA4B,EAAE,IAAI,CAAC,uBAAuB,CAAC,CAAC;gBACvF,aAAa,CAAC,UAAU,CAAC,6BAA6B,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YACpF,CAAC;YAED,MAAM,kBAAkB,GAAG,6OAAU,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAEjD,IAAI,IAAI,CAAC,6BAA6B,EAAE,EAAE,CAAC;gBACvC,aAAa,CAAC,YAAY,CAAC,kBAAkB,EAAE,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,CAAC,CAAC,CAAC;gBACrJ,IAAI,CAAC,oBAAoB,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;YACjE,CAAC,MAAM,CAAC;gBACJ,aAAa,CAAC,YAAY,CAAC,kBAAkB,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,EAAE,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gBACpH,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,kBAAkB,CAAC,CAAC;YACtD,CAAC;YAED,aAAa,CAAC,YAAY,CAAC,aAAa,EAAE,kBAAkB,CAAC,CAAC,EAAE,kBAAkB,CAAC,CAAC,EAAE,kBAAkB,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,KAAK,GAAG,GAAG,CAAC,CAAC,CAAC;QAC5I,CAAC;IACL,CAAC;IAEe,aAAa,CAAC,UAAkB,EAAE,cAA8B,EAAA;QAC5E,IAAI,UAAU,KAAK,QAAQ,EAAE,CAAC;YAC1B,OAAO,IAAI,CAAC;QAChB,CAAC;QACD,IAAI,cAAc,KAAA,EAAA,uBAAA,EAAwB,GAAE,CAAC;YACzC,OAAO;gBACH,gEAAgE;gBAChE,2BAA2B,EAAE,CAAA;;;;;;;aAOhC;gBAEG,gEAAgE;gBAChE,gCAAgC,EAAE,CAAA;;qCAEb,IAAI,CAAC,cAAc,CAAA;;;;;;;;;;;;;;;;;;;;aAoB3C;aACA,CAAC;QACN,CAAC;QAED,OAAO;YACH,gEAAgE;YAChE,qBAAqB,EAAE,CAAA;;;;aAItB;YAED,gEAAgE;YAChE,2BAA2B,EAAE,CAAA;;;;;;;;aAQ5B;YAED,gEAAgE;YAChE,gCAAgC,EAAE,CAAA;;sCAER,IAAI,CAAC,cAAc,CAAA;;;;;;;;;;;;;;;;;;aAkB5C;SACJ,CAAC;IACN,CAAC;;AA1MD;;GAEG,CACoB,wBAAA,IAAI,GAAG,WAAW,AAAd,CAAe;IAMnC,kOAAA,EAAA;QADN,uOAAS,EAAE;sDAC+B;IAQpC,kOAAA,EAAA;QAFN,uOAAS,EAAE;QACX,8OAAgB,EAAC,kCAAkC,CAAC;0DAC5B;IA4L7B,0OAAa,EAAC,CAAA,+BAAA,CAAiC,EAAE,uBAAuB,CAAC,CAAC"}},
    {"offset": {"line": 13212, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/GlobalIllumination/giRSM.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/GlobalIllumination/giRSM.ts"],"sourcesContent":["import type { ReflectiveShadowMap } from \"../reflectiveShadowMap\";\r\n\r\n/**\r\n * Class used to store the global illumination parameters for a reflective shadow map.\r\n * Instances of this class are used by the GIRSMManager class to generate global illumination for a scene.\r\n */\r\nexport class GIRSM {\r\n    /**\r\n     * The reflective shadow map used to generate the global illumination for the corresponding light.\r\n     */\r\n    public rsm: ReflectiveShadowMap;\r\n\r\n    /**\r\n     * The number of samples to use to generate the global illumination. Default value is 400.\r\n     */\r\n    public numSamples = 400;\r\n\r\n    /**\r\n     * Radius of the circle in the RSM flux texture to read samples from. Default value is 0.1.\r\n     * Valid values are between 0 and 1.\r\n     */\r\n    public radius = 0.1;\r\n\r\n    /**\r\n     * Intensity of the global illumination effect. Default value is 0.1.\r\n     */\r\n    public intensity = 0.1;\r\n\r\n    /**\r\n     * value used to correct for edge artifacts when calculating the global illumination effect. Default value is 0.1.\r\n     * Will depend on your scene.\r\n     */\r\n    public edgeArtifactCorrection = 0.1;\r\n\r\n    /**\r\n     * Defines if samples should be rotated when generating the global illumination effect. Default value is true.\r\n     * Rotating samples will improve the quality of the global illumination effect by trading banding for noise, at the cost of a bit of performance.\r\n     */\r\n    public rotateSample = true;\r\n\r\n    /**\r\n     * Noise scale factor, only used if rotateSample is true. Default value is 100.\r\n     * Will depend on your scene.\r\n     */\r\n    public noiseFactor = 100;\r\n\r\n    /**\r\n     * Defines if the full texture should be used when generating the global illumination effect. Default value is false.\r\n     * If true, values for numSamples, radius, rotateSample and noiseFactor will be ignored and the full texture will be used to generate the global illumination effect.\r\n     * Be careful to use a RSM texture size small enough to limit the number of samples! For eg. a 32x32 texture will generate 1024 samples per pixel!\r\n     */\r\n    public useFullTexture = false;\r\n\r\n    /**\r\n     * Creates a new GIRSM instance\r\n     * @param rsm The reflective shadow map\r\n     */\r\n    constructor(rsm: ReflectiveShadowMap) {\r\n        this.rsm = rsm;\r\n    }\r\n\r\n    /**\r\n     * Disposes the GIRSM\r\n     */\r\n    public dispose() {\r\n        this.rsm.dispose();\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAEA;;;GAGG;;;;AACG,MAAO,KAAK;IA+Cd;;;OAGG,CACH,YAAY,GAAwB,CAAA;QA7CpC;;WAEG,CACI,IAAA,CAAA,UAAU,GAAG,GAAG,CAAC;QAExB;;;WAGG,CACI,IAAA,CAAA,MAAM,GAAG,GAAG,CAAC;QAEpB;;WAEG,CACI,IAAA,CAAA,SAAS,GAAG,GAAG,CAAC;QAEvB;;;WAGG,CACI,IAAA,CAAA,sBAAsB,GAAG,GAAG,CAAC;QAEpC;;;WAGG,CACI,IAAA,CAAA,YAAY,GAAG,IAAI,CAAC;QAE3B;;;WAGG,CACI,IAAA,CAAA,WAAW,GAAG,GAAG,CAAC;QAEzB;;;;WAIG,CACI,IAAA,CAAA,cAAc,GAAG,KAAK,CAAC;QAO1B,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;IACnB,CAAC;IAED;;OAEG,CACI,OAAO,GAAA;QACV,IAAI,CAAC,GAAG,CAAC,OAAO,EAAE,CAAC;IACvB,CAAC;CACJ"}},
    {"offset": {"line": 13263, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/GlobalIllumination/giRSMManager.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/GlobalIllumination/giRSMManager.ts"],"sourcesContent":["/**\r\n * Reflective Shadow Maps were first described in http://www.klayge.org/material/3_12/GI/rsm.pdf by Carsten Dachsbacher and Marc Stamminger\r\n * Further explanations and implementations can be found in:\r\n * - Jaker video explaining RSM and its implementation: https://www.youtube.com/watch?v=LJQQdBsOYPM\r\n * - C++ implementation by Luis Angel: https://github.com/imyoungmin/RSM\r\n * - Javascript implementation by Erkaman: https://github.com/Erkaman/webgl-rsm\r\n */\r\nimport type { Scene } from \"core/scene\";\r\nimport type { GIRSM } from \"./giRSM\";\r\nimport type { Material } from \"core/Materials/material\";\r\nimport { RawTexture } from \"core/Materials/Textures/rawTexture\";\r\nimport type { Nullable } from \"core/types\";\r\nimport { RenderTargetTexture } from \"core/Materials/Textures/renderTargetTexture\";\r\nimport { PostProcess } from \"core/PostProcesses/postProcess\";\r\nimport { Observable, type Observer } from \"core/Misc/observable\";\r\nimport { Layer } from \"core/Layers/layer\";\r\nimport { Matrix } from \"core/Maths/math.vector\";\r\nimport { Constants } from \"core/Engines/constants\";\r\nimport type { RenderTargetWrapper } from \"core/Engines/renderTargetWrapper\";\r\nimport { MaterialPluginBase } from \"core/Materials/materialPluginBase\";\r\nimport type { InternalTexture } from \"core/Materials/Textures/internalTexture\";\r\nimport type { StandardMaterial } from \"core/Materials/standardMaterial\";\r\nimport { PBRBaseMaterial } from \"core/Materials/PBR/pbrBaseMaterial\";\r\nimport type { UniformBuffer } from \"core/Materials/uniformBuffer\";\r\nimport type { AbstractEngine } from \"core/Engines/abstractEngine\";\r\nimport { GeometryBufferRenderer } from \"../geometryBufferRenderer\";\r\nimport { BaseTexture } from \"core/Materials/Textures/baseTexture\";\r\nimport type { WebGPURenderTargetWrapper } from \"core/Engines/WebGPU/webgpuRenderTargetWrapper\";\r\nimport { expandToProperty, serialize } from \"core/Misc/decorators\";\r\nimport { MaterialDefines } from \"core/Materials/materialDefines\";\r\nimport { RegisterClass } from \"core/Misc/typeStore\";\r\n\r\nimport { ShaderLanguage } from \"core/Materials/shaderLanguage\";\r\n\r\n/**\r\n * Class used to manage the global illumination contribution calculated from reflective shadow maps (RSM).\r\n */\r\nexport class GIRSMManager {\r\n    private _scene: Scene;\r\n    private _engine: AbstractEngine;\r\n    private _giRSM: GIRSM[] = [];\r\n    private _materialsWithRenderPlugin: Material[];\r\n    private _sampleTexture: RawTexture;\r\n    private _maxSamples: number;\r\n    private _blurRTT: Nullable<RenderTargetTexture> = null;\r\n    private _blurPostProcesses: Nullable<PostProcess[]> = null;\r\n    private _blurXPostprocess: Nullable<PostProcess> = null;\r\n    private _blurYPostprocess: Nullable<PostProcess> = null;\r\n    private _upsamplingXPostprocess: Nullable<PostProcess> = null;\r\n    private _upsamplingYPostprocess: Nullable<PostProcess> = null;\r\n    private _ppGlobalIllumination: PostProcess[] = [];\r\n    private _drawPhaseObserver: Observer<Scene>;\r\n    private _debugLayer: Layer;\r\n    private _counters: Array<{ name: string; value: number }>;\r\n    private _countersRTW: Array<RenderTargetWrapper[]>;\r\n    private _firstActivation = true;\r\n    private _geomBufferEnabled = false;\r\n    private _geomBufferEnablePosition = false;\r\n    private _tempMatrix = new Matrix();\r\n\r\n    private _enable = false;\r\n\r\n    /**\r\n     * Defines the default texture types and formats used by the geometry buffer renderer.\r\n     */\r\n    public static GeometryBufferTextureTypesAndFormats: { [key: number]: { textureType: number; textureFormat: number } } = {\r\n        // eslint-disable-next-line @typescript-eslint/naming-convention\r\n        0: { textureType: Constants.TEXTURETYPE_HALF_FLOAT, textureFormat: Constants.TEXTUREFORMAT_R }, // depth\r\n        // eslint-disable-next-line @typescript-eslint/naming-convention\r\n        1: { textureType: Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV, textureFormat: Constants.TEXTUREFORMAT_RGBA }, // normal\r\n        // eslint-disable-next-line @typescript-eslint/naming-convention\r\n        2: { textureType: Constants.TEXTURETYPE_HALF_FLOAT, textureFormat: Constants.TEXTUREFORMAT_RGBA }, // position\r\n    };\r\n\r\n    /**\r\n     * Enables or disables the manager. Default is false.\r\n     * If disabled, the global illumination won't be calculated and the scene will be rendered normally, without any global illumination contribution.\r\n     */\r\n    public get enable() {\r\n        return this._enable;\r\n    }\r\n\r\n    public set enable(enable: boolean) {\r\n        if (this._giRSM.length === 0) {\r\n            enable = false;\r\n        }\r\n\r\n        if (enable === this._enable) {\r\n            return;\r\n        }\r\n\r\n        this._enable = enable;\r\n        this._debugLayer.isEnabled = this._showOnlyGI && enable;\r\n        for (const mat of this._materialsWithRenderPlugin) {\r\n            if (mat.pluginManager) {\r\n                const plugin = mat.pluginManager.getPlugin(GIRSMRenderPluginMaterial.Name) as GIRSMRenderPluginMaterial;\r\n                plugin.isEnabled = enable;\r\n            }\r\n        }\r\n\r\n        this.recreateResources(!enable);\r\n    }\r\n\r\n    /**\r\n     * Defines if the global illumination calculation is paused or not.\r\n     * Use this setting to pause the global illumination calculation when you know that the scene (camera/mesh/light positions) is not changing anymore to save some GPU power.\r\n     * The scene will still be rendered with the latest global illumination contribution.\r\n     */\r\n    public pause = false;\r\n\r\n    private _enableBlur = true;\r\n\r\n    /**\r\n     * Defines if the global illumination contribution should be blurred or not (using a bilateral blur). Default is true.\r\n     */\r\n    public get enableBlur() {\r\n        return this._enableBlur;\r\n    }\r\n\r\n    public set enableBlur(enable: boolean) {\r\n        if (enable === this._enableBlur) {\r\n            return;\r\n        }\r\n\r\n        this._enableBlur = enable;\r\n        this.recreateResources();\r\n    }\r\n\r\n    private _useQualityBlur = false;\r\n\r\n    /**\r\n     * Defines if the blur should be done with a better quality but slower or not. Default is false.\r\n     */\r\n    public get useQualityBlur() {\r\n        return this._useQualityBlur;\r\n    }\r\n\r\n    public set useQualityBlur(enable: boolean) {\r\n        if (enable === this._useQualityBlur) {\r\n            return;\r\n        }\r\n\r\n        this._useQualityBlur = enable;\r\n        this.recreateResources();\r\n    }\r\n\r\n    /**\r\n     * Defines the depth threshold used by the bilateral blur post-processes (also used by the upsampling, if enabled).\r\n     * You may have to change this value, depending on your scene.\r\n     */\r\n    public blurDepthThreshold = 0.05;\r\n\r\n    /**\r\n     * Defines the normal threshold used by the bilateral blur post-processes (also used by the upsampling, if enabled).\r\n     * You may have to change this value, depending on your scene.\r\n     */\r\n    public blurNormalThreshold = 0.25;\r\n\r\n    /**\r\n     * Defines the kernel size used by the bilateral blur post-processes. Default is 12.\r\n     */\r\n    public blurKernel = 12;\r\n\r\n    private _forceFullSizeBlur = false;\r\n\r\n    /**\r\n     * Defines if the blur should be done at full resolution or not. Default is false.\r\n     * If this setting is enabled, upampling will be disabled (ignored) as it is not needed anymore.\r\n     */\r\n    public get fullSizeBlur() {\r\n        return this._forceFullSizeBlur;\r\n    }\r\n\r\n    public set fullSizeBlur(mode: boolean) {\r\n        if (this._forceFullSizeBlur === mode) {\r\n            return;\r\n        }\r\n\r\n        this._forceFullSizeBlur = mode;\r\n        this.recreateResources();\r\n    }\r\n\r\n    private _useQualityUpsampling = false;\r\n\r\n    /**\r\n     * Defines if the upsampling should be done with a better quality but slower or not. Default is false.\r\n     */\r\n    public get useQualityUpsampling() {\r\n        return this._useQualityUpsampling;\r\n    }\r\n\r\n    public set useQualityUpsampling(enable: boolean) {\r\n        if (enable === this._useQualityUpsampling) {\r\n            return;\r\n        }\r\n\r\n        this._useQualityUpsampling = enable;\r\n        this.recreateResources();\r\n    }\r\n\r\n    /**\r\n     * Defines the kernel size used by the bilateral upsampling post-processes. Default is 6.\r\n     */\r\n    public upsamplerKernel = 6;\r\n\r\n    private _showOnlyGI = false;\r\n\r\n    /**\r\n     * Defines if the debug layer should be enabled or not. Default is false.\r\n     * Use this setting for debugging purpose, to show the global illumination contribution only.\r\n     */\r\n    public get showOnlyGI() {\r\n        return this._showOnlyGI;\r\n    }\r\n\r\n    public set showOnlyGI(show) {\r\n        if (this._showOnlyGI === show) {\r\n            return;\r\n        }\r\n\r\n        this._showOnlyGI = show;\r\n        this._debugLayer.isEnabled = show;\r\n    }\r\n\r\n    private _use32BitsDepthBuffer = false;\r\n\r\n    /**\r\n     * Defines if the depth buffer used by the geometry buffer renderer should be 32 bits or not. Default is false (16 bits).\r\n     */\r\n    public get use32BitsDepthBuffer() {\r\n        return this._use32BitsDepthBuffer;\r\n    }\r\n\r\n    public set use32BitsDepthBuffer(enable: boolean) {\r\n        if (this._use32BitsDepthBuffer === enable) {\r\n            return;\r\n        }\r\n\r\n        this._use32BitsDepthBuffer = enable;\r\n        this.recreateResources();\r\n    }\r\n\r\n    private _outputDimensions: { width: number; height: number };\r\n\r\n    /**\r\n     * Sets the output dimensions of the final process. It should normally be the same as the output dimensions of the screen.\r\n     * @param dimensions The dimensions of the output texture (width and height)\r\n     */\r\n    public setOutputDimensions(dimensions: { width: number; height: number }) {\r\n        this._outputDimensions = dimensions;\r\n        this.recreateResources();\r\n    }\r\n\r\n    private _giTextureDimensions: { width: number; height: number };\r\n\r\n    /**\r\n     * Sets the dimensions of the GI texture. Try to use the smallest size possible for better performance.\r\n     * @param dimensions The dimensions of the GI texture (width and height)\r\n     */\r\n    public setGITextureDimensions(dimensions: { width: number; height: number }) {\r\n        this._giTextureDimensions = dimensions;\r\n        this.recreateResources();\r\n    }\r\n\r\n    private _giTextureType: number;\r\n\r\n    /**\r\n     * Gets or sets the texture type used by the GI texture. Default is Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV.\r\n     */\r\n    public get giTextureType() {\r\n        return this._giTextureType;\r\n    }\r\n\r\n    public set giTextureType(textureType: number) {\r\n        if (this._giTextureType === textureType) {\r\n            return;\r\n        }\r\n\r\n        this._giTextureType = textureType;\r\n        this.recreateResources();\r\n    }\r\n\r\n    /** Shader language used by the material */\r\n    protected _shaderLanguage = ShaderLanguage.GLSL;\r\n\r\n    /** Gets the shader language used in this material. */\r\n    public get shaderLanguage(): ShaderLanguage {\r\n        return this._shaderLanguage;\r\n    }\r\n\r\n    /**\r\n     * Gets the list of GIRSM used by the manager.\r\n     */\r\n    public get giRSM() {\r\n        return this._giRSM;\r\n    }\r\n\r\n    /**\r\n     * Adds a (list of) GIRSM to the manager.\r\n     * @param rsm The GIRSM (or array of GIRSM) to add to the manager\r\n     */\r\n    public addGIRSM(rsm: GIRSM | GIRSM[]) {\r\n        if (Array.isArray(rsm)) {\r\n            this._giRSM.push(...rsm);\r\n        } else {\r\n            this._giRSM.push(rsm);\r\n        }\r\n\r\n        this.recreateResources();\r\n    }\r\n\r\n    /**\r\n     * Removes a (list of) GIRSM from the manager.\r\n     * @param rsm The GIRSM (or array of GIRSM) to remove from the manager\r\n     */\r\n    public removeGIRSM(rsm: GIRSM | GIRSM[]) {\r\n        if (Array.isArray(rsm)) {\r\n            for (let i = 0; i < rsm.length; ++i) {\r\n                const idx = this._giRSM.indexOf(rsm[i]);\r\n                if (idx !== -1) {\r\n                    this._giRSM.splice(idx, 1);\r\n                }\r\n            }\r\n        } else {\r\n            const idx = this._giRSM.indexOf(rsm);\r\n            if (idx !== -1) {\r\n                this._giRSM.splice(idx, 1);\r\n            }\r\n        }\r\n\r\n        if (this._giRSM.length === 0) {\r\n            this.enable = false;\r\n        } else {\r\n            this.recreateResources();\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Add a material to the manager. This will enable the global illumination contribution for the material.\r\n     * @param material Material that will be affected by the global illumination contribution. If not provided, all materials of the scene will be affected.\r\n     */\r\n    public addMaterial(material?: Material) {\r\n        if (material) {\r\n            this._addGISupportToMaterial(material);\r\n        } else {\r\n            for (const mesh of this._scene.meshes) {\r\n                if (mesh.getTotalVertices() > 0 && mesh.isEnabled() && mesh.material) {\r\n                    this._addGISupportToMaterial(mesh.material);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Gets the list of GPU counters used by the manager.\r\n     * GPU timing measurements must be enabled for the counters to be filled (engine.enableGPUTimingMeasurements = true).\r\n     * Only available with WebGPU. You will still get the list of counters with other engines but the values will always be 0.\r\n     */\r\n    public get countersGPU(): Array<{ name: string; value: number }> {\r\n        return this._counters;\r\n    }\r\n\r\n    /**\r\n     * Recreates the resources used by the manager.\r\n     * You should normally not have to call this method manually, except if you change the useFullTexture property of a GIRSM, because the manager won't track this change.\r\n     * @param disposeGeometryBufferRenderer Defines if the geometry buffer renderer should be disposed and recreated. Default is false.\r\n     */\r\n    public recreateResources(disposeGeometryBufferRenderer = false) {\r\n        if (!this._shadersLoaded) {\r\n            this._onShaderLoadedObservable.addOnce(() => {\r\n                this.recreateResources(disposeGeometryBufferRenderer);\r\n            });\r\n            return;\r\n        }\r\n\r\n        this._disposePostProcesses(disposeGeometryBufferRenderer);\r\n        this._createPostProcesses();\r\n        this._setPluginParameters();\r\n    }\r\n\r\n    /**\r\n     * Generates the sample texture used by the the global illumination calculation process.\r\n     * @param maxSamples The maximum number of samples to generate in the texture. Default value is 2048. The numSamples property of the GIRSM should be less than or equal to this value!\r\n     */\r\n    public generateSampleTexture(maxSamples: number) {\r\n        this._sampleTexture?.dispose();\r\n\r\n        this._maxSamples = maxSamples;\r\n\r\n        const data = new Float32Array(this._maxSamples * 4);\r\n        for (let i = 0; i < this._maxSamples; i++) {\r\n            const xi1 = Math.random();\r\n            const xi2 = Math.random();\r\n\r\n            const x = xi1 * Math.sin(2 * Math.PI * xi2);\r\n            const y = xi1 * Math.cos(2 * Math.PI * xi2);\r\n\r\n            data[i * 4 + 0] = x;\r\n            data[i * 4 + 1] = y;\r\n            data[i * 4 + 2] = xi1 * xi1;\r\n            data[i * 4 + 3] = 1;\r\n        }\r\n\r\n        this._sampleTexture = new RawTexture(\r\n            data,\r\n            this._maxSamples,\r\n            1,\r\n            Constants.TEXTUREFORMAT_RGBA,\r\n            this._scene,\r\n            false,\r\n            false,\r\n            Constants.TEXTURE_NEAREST_SAMPLINGMODE,\r\n            Constants.TEXTURETYPE_FLOAT\r\n        );\r\n        this._sampleTexture.name = \"GIRSMSamples\";\r\n    }\r\n\r\n    /**\r\n     * Disposes the manager.\r\n     */\r\n    public dispose() {\r\n        this._disposePostProcesses(true);\r\n        this._debugLayer.texture?.dispose();\r\n        this._debugLayer.dispose();\r\n        this._scene.onBeforeDrawPhaseObservable.remove(this._drawPhaseObserver);\r\n        this._onShaderLoadedObservable.clear();\r\n    }\r\n\r\n    /**\r\n     * Creates a new GIRSMManager\r\n     * @param scene The scene\r\n     * @param outputDimensions The dimensions of the output texture (width and height). Should normally be the same as the output dimensions of the screen.\r\n     * @param giTextureDimensions The dimensions of the GI texture (width and height). Try to use the smallest size possible for better performance.\r\n     * @param maxSamples The maximum number of samples to generate in the sample texture. Default value is 2048. The numSamples property of the GIRSM should be less than or equal to this value!\r\n     * @param giTextureType The texture type used by the GI texture. Default is Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV.\r\n     */\r\n    constructor(\r\n        scene: Scene,\r\n        outputDimensions: { width: number; height: number },\r\n        giTextureDimensions = { width: 256, height: 256 },\r\n        maxSamples = 2048,\r\n        giTextureType = Constants.TEXTURETYPE_UNSIGNED_INT_2_10_10_10_REV\r\n    ) {\r\n        this._scene = scene;\r\n        this._engine = scene.getEngine();\r\n        this._outputDimensions = outputDimensions;\r\n        this._giTextureDimensions = giTextureDimensions;\r\n        this._giTextureType = giTextureType;\r\n        this._materialsWithRenderPlugin = [];\r\n        this._maxSamples = maxSamples;\r\n        this._debugLayer = new Layer(\"debug layer\", null, this._scene, false);\r\n        this._debugLayer.isEnabled = false;\r\n        this._counters = [];\r\n        this._countersRTW = [];\r\n\r\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\r\n        this._initShaderSourceAsync();\r\n\r\n        this.generateSampleTexture(maxSamples);\r\n\r\n        this._drawPhaseObserver = this._scene.onBeforeDrawPhaseObservable.add(() => {\r\n            const currentRenderTarget = this._engine._currentRenderTarget;\r\n            let rebindCurrentRenderTarget = false;\r\n\r\n            if (this._enable && this._shadersLoaded) {\r\n                if (!this.pause && this._ppGlobalIllumination.length > 0) {\r\n                    this._scene.postProcessManager.directRender(this._ppGlobalIllumination, this._ppGlobalIllumination[0].inputTexture);\r\n                    this._engine.unBindFramebuffer(this._ppGlobalIllumination[0].inputTexture, true);\r\n\r\n                    this._engine.setAlphaMode(Constants.ALPHA_DISABLE);\r\n\r\n                    rebindCurrentRenderTarget = true;\r\n\r\n                    if (this.enableBlur && this._blurPostProcesses) {\r\n                        this._scene.postProcessManager.directRender(this._blurPostProcesses, this._blurRTT!.renderTarget, true);\r\n                        this._engine.unBindFramebuffer(this._blurRTT!.renderTarget!, true);\r\n                    }\r\n                }\r\n\r\n                for (let i = 0; i < this._counters.length; ++i) {\r\n                    const rtws = this._countersRTW[i];\r\n                    for (let t = 0; t < rtws.length; ++t) {\r\n                        if (t === 0) {\r\n                            this._counters[i].value = this.pause ? 0 : ((rtws[t] as WebGPURenderTargetWrapper).gpuTimeInFrame?.counter.lastSecAverage ?? 0);\r\n                        } else if (!this.pause) {\r\n                            this._counters[i].value += (rtws[t] as WebGPURenderTargetWrapper).gpuTimeInFrame?.counter.lastSecAverage ?? 0;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                if (this._scene.activeCamera) {\r\n                    this._engine.setViewport(this._scene.activeCamera.viewport);\r\n                }\r\n            }\r\n\r\n            if (rebindCurrentRenderTarget && currentRenderTarget) {\r\n                this._engine.bindFramebuffer(currentRenderTarget);\r\n            }\r\n        });\r\n    }\r\n\r\n    private _shadersLoaded = false;\r\n    private _onShaderLoadedObservable = new Observable<void>();\r\n    private async _initShaderSourceAsync() {\r\n        const engine = this._engine;\r\n\r\n        if (engine.isWebGPU) {\r\n            this._shaderLanguage = ShaderLanguage.WGSL;\r\n\r\n            await Promise.all([\r\n                import(\"../../ShadersWGSL/bilateralBlur.fragment\"),\r\n                import(\"../../ShadersWGSL/bilateralBlurQuality.fragment\"),\r\n                import(\"../../ShadersWGSL/rsmGlobalIllumination.fragment\"),\r\n                import(\"../../ShadersWGSL/rsmFullGlobalIllumination.fragment\"),\r\n            ]);\r\n        } else {\r\n            await Promise.all([\r\n                import(\"../../Shaders/bilateralBlur.fragment\"),\r\n                import(\"../../Shaders/bilateralBlurQuality.fragment\"),\r\n                import(\"../../Shaders/rsmGlobalIllumination.fragment\"),\r\n                import(\"../../Shaders/rsmFullGlobalIllumination.fragment\"),\r\n            ]);\r\n        }\r\n        this._shadersLoaded = true;\r\n        this._onShaderLoadedObservable.notifyObservers();\r\n    }\r\n\r\n    protected _disposePostProcesses(disposeGeometryBufferRenderer = false) {\r\n        this._blurRTT?.dispose();\r\n        this._blurRTT = null;\r\n        this._blurPostProcesses = [];\r\n        this._blurXPostprocess?.dispose();\r\n        this._blurXPostprocess = null;\r\n        this._blurYPostprocess?.dispose();\r\n        this._blurYPostprocess = null;\r\n        this._upsamplingXPostprocess?.dispose();\r\n        this._upsamplingXPostprocess = null;\r\n        this._upsamplingYPostprocess?.dispose();\r\n        this._upsamplingYPostprocess = null;\r\n        for (const ppGlobalIllumination of this._ppGlobalIllumination) {\r\n            ppGlobalIllumination.dispose();\r\n        }\r\n        this._ppGlobalIllumination = [];\r\n        if (disposeGeometryBufferRenderer) {\r\n            if (this._geomBufferEnabled) {\r\n                this._scene.enableGeometryBufferRenderer();\r\n                this._scene.geometryBufferRenderer!.enablePosition = this._geomBufferEnablePosition;\r\n            } else {\r\n                this._scene.disableGeometryBufferRenderer();\r\n            }\r\n        }\r\n        this._counters = [];\r\n        this._countersRTW = [];\r\n    }\r\n\r\n    protected _setPluginParameters() {\r\n        if (!this._enable) {\r\n            return;\r\n        }\r\n\r\n        for (const mat of this._materialsWithRenderPlugin) {\r\n            if (mat.pluginManager) {\r\n                const plugin = mat.pluginManager.getPlugin<GIRSMRenderPluginMaterial>(GIRSMRenderPluginMaterial.Name)!;\r\n                plugin.textureGIContrib = this.enableBlur ? this._blurRTT!.renderTarget!.texture! : this._ppGlobalIllumination[0].inputTexture.texture!;\r\n                plugin.outputTextureWidth = this._outputDimensions.width;\r\n                plugin.outputTextureHeight = this._outputDimensions.height;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected _createPostProcesses() {\r\n        if (!this._enable) {\r\n            return;\r\n        }\r\n\r\n        const textureFormat = this._giTextureType === Constants.TEXTURETYPE_UNSIGNED_INT_10F_11F_11F_REV ? Constants.TEXTUREFORMAT_RGB : Constants.TEXTUREFORMAT_RGBA;\r\n\r\n        if (this._firstActivation) {\r\n            this._firstActivation = false;\r\n            this._geomBufferEnabled = !!this._scene.geometryBufferRenderer;\r\n            this._geomBufferEnablePosition = this._scene.geometryBufferRenderer?.enablePosition ?? false;\r\n        }\r\n\r\n        if (!this._geomBufferEnabled) {\r\n            this._scene.disableGeometryBufferRenderer();\r\n        }\r\n\r\n        const geometryBufferRenderer = this._scene.enableGeometryBufferRenderer(\r\n            this._enableBlur ? this._outputDimensions : this._giTextureDimensions,\r\n            this._use32BitsDepthBuffer ? Constants.TEXTUREFORMAT_DEPTH32_FLOAT : Constants.TEXTUREFORMAT_DEPTH16,\r\n            GIRSMManager.GeometryBufferTextureTypesAndFormats\r\n        );\r\n\r\n        if (!geometryBufferRenderer) {\r\n            throw new Error(\"Geometry buffer renderer is not supported but is required for GIRSMManager.\");\r\n        }\r\n\r\n        geometryBufferRenderer.enablePosition = true;\r\n        if (!this._geomBufferEnabled) {\r\n            geometryBufferRenderer.generateNormalsInWorldSpace = true;\r\n        }\r\n\r\n        const decodeGeometryBufferNormals = geometryBufferRenderer.normalsAreUnsigned;\r\n        const normalsAreInWorldSpace = geometryBufferRenderer.generateNormalsInWorldSpace;\r\n\r\n        this._counters.push({ name: \"Geometry buffer renderer\", value: 0 });\r\n        this._countersRTW.push([this._scene.geometryBufferRenderer!.getGBuffer().renderTarget!]);\r\n\r\n        let defines = \"\";\r\n        if (decodeGeometryBufferNormals) {\r\n            defines += \"#define DECODE_NORMAL\\n\";\r\n        }\r\n        if (!normalsAreInWorldSpace) {\r\n            defines += \"#define TRANSFORM_NORMAL\\n\";\r\n        }\r\n\r\n        for (let i = 0; i < this._giRSM.length; ++i) {\r\n            const giRSM = this._giRSM[i];\r\n            const rsm = giRSM.rsm;\r\n\r\n            const ppGlobalIllumination = new PostProcess(\"RSMGlobalIllumination\" + i, giRSM.useFullTexture ? \"rsmFullGlobalIllumination\" : \"rsmGlobalIllumination\", {\r\n                ...this._giTextureDimensions,\r\n                uniforms: [\"rsmLightMatrix\", \"rsmInfo\", \"rsmInfo2\", \"invView\"],\r\n                samplers: [\"normalSampler\", \"rsmPositionW\", \"rsmNormalW\", \"rsmFlux\", \"rsmSamples\"],\r\n                defines,\r\n                samplingMode: Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n                engine: this._engine,\r\n                textureType: this._giTextureType,\r\n                textureFormat,\r\n                shaderLanguage: this._shaderLanguage,\r\n            });\r\n\r\n            this._ppGlobalIllumination.push(ppGlobalIllumination);\r\n\r\n            if (i !== 0) {\r\n                ppGlobalIllumination.shareOutputWith(this._ppGlobalIllumination[0]);\r\n                ppGlobalIllumination.alphaMode = Constants.ALPHA_ADD;\r\n            }\r\n\r\n            ppGlobalIllumination.autoClear = false;\r\n            ppGlobalIllumination.externalTextureSamplerBinding = true;\r\n            ppGlobalIllumination.onApplyObservable.add((effect) => {\r\n                effect.setTexture(\r\n                    \"textureSampler\",\r\n                    geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.POSITION_TEXTURE_TYPE)]\r\n                );\r\n                effect.setTexture(\r\n                    \"normalSampler\",\r\n                    geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE)]\r\n                );\r\n                effect.setTexture(\"rsmPositionW\", rsm.positionWorldTexture);\r\n                effect.setTexture(\"rsmNormalW\", rsm.normalWorldTexture);\r\n                effect.setTexture(\"rsmFlux\", rsm.fluxTexture);\r\n                effect.setMatrix(\"rsmLightMatrix\", rsm.lightTransformationMatrix);\r\n                if (!giRSM.useFullTexture) {\r\n                    effect.setTexture(\"rsmSamples\", this._sampleTexture);\r\n                    effect.setFloat4(\"rsmInfo\", giRSM.numSamples, giRSM.radius, giRSM.intensity, giRSM.edgeArtifactCorrection);\r\n                    effect.setFloat4(\r\n                        \"rsmInfo2\",\r\n                        giRSM.noiseFactor,\r\n                        giRSM.rotateSample ? 1 : 0,\r\n                        rsm.fluxTexture.getInternalTexture()!.width,\r\n                        rsm.fluxTexture.getInternalTexture()!.height\r\n                    );\r\n                } else {\r\n                    effect.setFloat4(\r\n                        \"rsmInfo\",\r\n                        rsm.fluxTexture.getInternalTexture()!.width,\r\n                        rsm.fluxTexture.getInternalTexture()!.height,\r\n                        giRSM.intensity,\r\n                        giRSM.edgeArtifactCorrection\r\n                    );\r\n                }\r\n                if (!normalsAreInWorldSpace) {\r\n                    this._tempMatrix.copyFrom(this._scene.activeCamera!.getViewMatrix());\r\n                    this._tempMatrix.invert();\r\n                    effect.setMatrix(\"invView\", this._tempMatrix);\r\n                }\r\n            });\r\n        }\r\n\r\n        for (const ppGlobalIllumination of this._ppGlobalIllumination) {\r\n            if (!ppGlobalIllumination.inputTexture) {\r\n                ppGlobalIllumination.resize(this._giTextureDimensions.width, this._giTextureDimensions.height);\r\n            }\r\n        }\r\n\r\n        this._counters.push({ name: \"GI generation\", value: 0 });\r\n        this._countersRTW.push([this._ppGlobalIllumination[0].inputTexture]);\r\n\r\n        if (this._enableBlur) {\r\n            const blurTextureSize = this._forceFullSizeBlur ? this._outputDimensions : this._giTextureDimensions;\r\n\r\n            this._blurRTT = new RenderTargetTexture(\"GIRSMContribution\", this._outputDimensions, this._scene, {\r\n                type: this._giTextureType,\r\n                format: textureFormat,\r\n                generateDepthBuffer: false,\r\n            });\r\n            this._blurRTT.wrapU = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n            this._blurRTT.wrapV = Constants.TEXTURE_CLAMP_ADDRESSMODE;\r\n            this._blurRTT.updateSamplingMode(Constants.TEXTURE_NEAREST_SAMPLINGMODE);\r\n            this._blurRTT.skipInitialClear = true;\r\n\r\n            const blurRTWs: RenderTargetWrapper[] = [];\r\n\r\n            this._counters.push({ name: \"GI blur\", value: 0 });\r\n            this._countersRTW.push(blurRTWs);\r\n\r\n            // Bilateral blur\r\n            this._blurXPostprocess = new PostProcess(this._useQualityBlur ? \"BilateralBlur\" : \"BilateralBlurX\", this._useQualityBlur ? \"bilateralBlurQuality\" : \"bilateralBlur\", {\r\n                uniforms: [\"filterSize\", \"blurDir\", \"depthThreshold\", \"normalThreshold\"],\r\n                samplers: [\"depthSampler\", \"normalSampler\"],\r\n                defines: decodeGeometryBufferNormals ? \"#define DECODE_NORMAL\" : undefined,\r\n                size: blurTextureSize,\r\n                samplingMode: Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n                engine: this._engine,\r\n                textureType: this._giTextureType,\r\n                textureFormat,\r\n                shaderLanguage: this._shaderLanguage,\r\n            });\r\n\r\n            this._blurXPostprocess.onApplyObservable.add((effect) => {\r\n                effect._bindTexture(\"textureSampler\", this._ppGlobalIllumination[0].inputTexture.texture);\r\n                effect.setTexture(\"depthSampler\", geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.DEPTH_TEXTURE_TYPE)]);\r\n                effect.setTexture(\r\n                    \"normalSampler\",\r\n                    geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE)]\r\n                );\r\n                effect.setInt(\"filterSize\", this.blurKernel);\r\n                effect.setFloat2(\"blurDir\", 1 / this._giTextureDimensions.width, this._useQualityBlur ? 1 / this._giTextureDimensions.height : 0);\r\n                effect.setFloat(\"depthThreshold\", this.blurDepthThreshold);\r\n                effect.setFloat(\"normalThreshold\", this.blurNormalThreshold);\r\n            });\r\n\r\n            this._blurXPostprocess.externalTextureSamplerBinding = true;\r\n            this._blurXPostprocess.autoClear = false;\r\n\r\n            if (!this._useQualityBlur) {\r\n                this._blurYPostprocess = new PostProcess(\"BilateralBlurY\", \"bilateralBlur\", {\r\n                    uniforms: [\"filterSize\", \"blurDir\", \"depthThreshold\", \"normalThreshold\"],\r\n                    samplers: [\"depthSampler\", \"normalSampler\"],\r\n                    defines: decodeGeometryBufferNormals ? \"#define DECODE_NORMAL\" : undefined,\r\n                    size: blurTextureSize,\r\n                    samplingMode: Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n                    engine: this._engine,\r\n                    textureType: this._giTextureType,\r\n                    textureFormat,\r\n                    shaderLanguage: this._shaderLanguage,\r\n                });\r\n\r\n                this._blurYPostprocess.autoClear = false;\r\n                this._blurYPostprocess.onApplyObservable.add((effect) => {\r\n                    effect.setTexture(\r\n                        \"depthSampler\",\r\n                        geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.DEPTH_TEXTURE_TYPE)]\r\n                    );\r\n                    effect.setTexture(\r\n                        \"normalSampler\",\r\n                        geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE)]\r\n                    );\r\n                    effect.setInt(\"filterSize\", this.blurKernel);\r\n                    effect.setFloat2(\"blurDir\", 0, 1 / this._giTextureDimensions.height);\r\n                    effect.setFloat(\"depthThreshold\", this.blurDepthThreshold);\r\n                    effect.setFloat(\"normalThreshold\", this.blurNormalThreshold);\r\n                });\r\n\r\n                this._blurYPostprocess.resize(blurTextureSize.width, blurTextureSize.height);\r\n\r\n                blurRTWs.push(this._blurYPostprocess.inputTexture);\r\n            }\r\n\r\n            this._blurPostProcesses = [this._blurXPostprocess];\r\n            if (this._blurYPostprocess) {\r\n                this._blurPostProcesses.push(this._blurYPostprocess);\r\n            }\r\n\r\n            // Bilateral upsampling\r\n            const giFullDimensions = this._giTextureDimensions.width >= this._outputDimensions.width && this._giTextureDimensions.height >= this._outputDimensions.height;\r\n\r\n            if (!giFullDimensions && !this._forceFullSizeBlur) {\r\n                const upsamplingRTWs: RenderTargetWrapper[] = [];\r\n\r\n                this._counters.push({ name: \"GI upsampling\", value: 0 });\r\n                this._countersRTW.push(upsamplingRTWs);\r\n\r\n                this._upsamplingXPostprocess = new PostProcess(\r\n                    this._useQualityUpsampling ? \"BilateralUpsampling\" : \"BilateralUpsamplingX\",\r\n                    this._useQualityUpsampling ? \"bilateralBlurQuality\" : \"bilateralBlur\",\r\n                    {\r\n                        uniforms: [\"filterSize\", \"blurDir\", \"depthThreshold\", \"normalThreshold\"],\r\n                        samplers: [\"depthSampler\", \"normalSampler\"],\r\n                        defines: decodeGeometryBufferNormals ? \"#define DECODE_NORMAL\" : undefined,\r\n                        size: blurTextureSize,\r\n                        samplingMode: Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n                        engine: this._engine,\r\n                        textureType: this._giTextureType,\r\n                        textureFormat,\r\n                        shaderLanguage: this._shaderLanguage,\r\n                    }\r\n                );\r\n\r\n                this._upsamplingXPostprocess.autoClear = false;\r\n                this._upsamplingXPostprocess.onApplyObservable.add((effect) => {\r\n                    effect.setTexture(\r\n                        \"depthSampler\",\r\n                        geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.DEPTH_TEXTURE_TYPE)]\r\n                    );\r\n                    effect.setTexture(\r\n                        \"normalSampler\",\r\n                        geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE)]\r\n                    );\r\n                    effect.setInt(\"filterSize\", this.upsamplerKernel);\r\n                    effect.setFloat2(\"blurDir\", 1 / this._outputDimensions.width, this._useQualityUpsampling ? 1 / this._outputDimensions.height : 0);\r\n                    effect.setFloat(\"depthThreshold\", this.blurDepthThreshold);\r\n                    effect.setFloat(\"normalThreshold\", this.blurNormalThreshold);\r\n                });\r\n\r\n                this._upsamplingXPostprocess.resize(blurTextureSize.width, blurTextureSize.height);\r\n\r\n                blurRTWs.push(this._upsamplingXPostprocess.inputTexture);\r\n\r\n                if (!this.useQualityUpsampling) {\r\n                    this._upsamplingYPostprocess = new PostProcess(\"BilateralUpsamplingY\", \"bilateralBlur\", {\r\n                        uniforms: [\"filterSize\", \"blurDir\", \"depthThreshold\", \"normalThreshold\"],\r\n                        samplers: [\"depthSampler\", \"normalSampler\"],\r\n                        defines: decodeGeometryBufferNormals ? \"#define DECODE_NORMAL\" : undefined,\r\n                        size: this._outputDimensions,\r\n                        samplingMode: Constants.TEXTURE_BILINEAR_SAMPLINGMODE,\r\n                        engine: this._engine,\r\n                        textureType: this._giTextureType,\r\n                        textureFormat,\r\n                        shaderLanguage: this._shaderLanguage,\r\n                    });\r\n\r\n                    this._upsamplingYPostprocess.autoClear = false;\r\n                    this._upsamplingYPostprocess.onApplyObservable.add((effect) => {\r\n                        effect.setTexture(\r\n                            \"depthSampler\",\r\n                            geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.DEPTH_TEXTURE_TYPE)]\r\n                        );\r\n                        effect.setTexture(\r\n                            \"normalSampler\",\r\n                            geometryBufferRenderer.getGBuffer().textures[geometryBufferRenderer.getTextureIndex(GeometryBufferRenderer.NORMAL_TEXTURE_TYPE)]\r\n                        );\r\n                        effect.setInt(\"filterSize\", this.upsamplerKernel);\r\n                        effect.setFloat2(\"blurDir\", 0, 1 / this._outputDimensions.height);\r\n                        effect.setFloat(\"depthThreshold\", this.blurDepthThreshold);\r\n                        effect.setFloat(\"normalThreshold\", this.blurNormalThreshold);\r\n                    });\r\n\r\n                    this._upsamplingYPostprocess.resize(this._outputDimensions.width, this._outputDimensions.height);\r\n\r\n                    upsamplingRTWs.push(this._upsamplingYPostprocess.inputTexture);\r\n                }\r\n\r\n                upsamplingRTWs.push(this._blurRTT.renderTarget!);\r\n\r\n                this._blurPostProcesses.push(this._upsamplingXPostprocess);\r\n                if (this._upsamplingYPostprocess) {\r\n                    this._blurPostProcesses.push(this._upsamplingYPostprocess);\r\n                }\r\n            } else {\r\n                blurRTWs.push(this._blurRTT.renderTarget!);\r\n            }\r\n        }\r\n\r\n        this._debugLayer.texture?.dispose();\r\n        this._debugLayer.texture = new BaseTexture(this._scene, this._enableBlur ? this._blurRTT!.renderTarget!.texture : this._ppGlobalIllumination[0].inputTexture.texture);\r\n    }\r\n\r\n    protected _addGISupportToMaterial(material: Material) {\r\n        if (material.pluginManager?.getPlugin(GIRSMRenderPluginMaterial.Name)) {\r\n            return;\r\n        }\r\n\r\n        const plugin = new GIRSMRenderPluginMaterial(material);\r\n\r\n        if (this._enable && this._ppGlobalIllumination.length > 0) {\r\n            plugin.textureGIContrib = this._ppGlobalIllumination[0].inputTexture.texture!;\r\n            plugin.outputTextureWidth = this._outputDimensions.width;\r\n            plugin.outputTextureHeight = this._outputDimensions.height;\r\n        }\r\n\r\n        plugin.isEnabled = this._enable;\r\n\r\n        this._materialsWithRenderPlugin.push(material);\r\n    }\r\n}\r\n\r\n/**\r\n * @internal\r\n */\r\nclass MaterialGIRSMRenderDefines extends MaterialDefines {\r\n    public RENDER_WITH_GIRSM = false;\r\n    public RSMCREATE_PROJTEXTURE = false;\r\n}\r\n\r\n/**\r\n * Plugin used to render the global illumination contribution.\r\n */\r\nexport class GIRSMRenderPluginMaterial extends MaterialPluginBase {\r\n    private _isPBR;\r\n\r\n    /**\r\n     * Defines the name of the plugin.\r\n     */\r\n    public static readonly Name = \"GIRSMRender\";\r\n\r\n    /**\r\n     * The texture containing the global illumination contribution.\r\n     */\r\n    @serialize()\r\n    public textureGIContrib: InternalTexture;\r\n\r\n    /**\r\n     * The width of the output texture.\r\n     */\r\n    @serialize()\r\n    public outputTextureWidth: number;\r\n\r\n    /**\r\n     * The height of the output texture.\r\n     */\r\n    @serialize()\r\n    public outputTextureHeight: number;\r\n\r\n    private _isEnabled = false;\r\n    /**\r\n     * Defines if the plugin is enabled in the material.\r\n     */\r\n    @serialize()\r\n    @expandToProperty(\"_markAllSubMeshesAsTexturesDirty\")\r\n    public isEnabled = false;\r\n\r\n    protected _markAllSubMeshesAsTexturesDirty(): void {\r\n        this._enable(this._isEnabled);\r\n        this._internalMarkAllSubMeshesAsTexturesDirty();\r\n    }\r\n\r\n    private _internalMarkAllSubMeshesAsTexturesDirty: () => void;\r\n\r\n    /**\r\n     * Gets a boolean indicating that the plugin is compatible with a give shader language.\r\n     * @returns true if the plugin is compatible with the shader language\r\n     */\r\n    public override isCompatible(): boolean {\r\n        return true;\r\n    }\r\n\r\n    constructor(material: Material | StandardMaterial | PBRBaseMaterial) {\r\n        super(material, GIRSMRenderPluginMaterial.Name, 310, new MaterialGIRSMRenderDefines());\r\n\r\n        this._internalMarkAllSubMeshesAsTexturesDirty = material._dirtyCallbacks[Constants.MATERIAL_TextureDirtyFlag];\r\n\r\n        this._isPBR = material instanceof PBRBaseMaterial;\r\n    }\r\n\r\n    public override prepareDefines(defines: MaterialGIRSMRenderDefines) {\r\n        defines.RENDER_WITH_GIRSM = this._isEnabled;\r\n    }\r\n\r\n    public override getClassName() {\r\n        return \"GIRSMRenderPluginMaterial\";\r\n    }\r\n\r\n    public override getUniforms() {\r\n        return {\r\n            ubo: [{ name: \"girsmTextureOutputSize\", size: 2, type: \"vec2\" }],\r\n            fragment: `#ifdef RENDER_WITH_GIRSM\r\n                    uniform vec2 girsmTextureOutputSize;\r\n                #endif`,\r\n        };\r\n    }\r\n\r\n    public override getSamplers(samplers: string[]) {\r\n        samplers.push(\"girsmTextureGIContrib\");\r\n    }\r\n\r\n    public override bindForSubMesh(uniformBuffer: UniformBuffer) {\r\n        if (this._isEnabled) {\r\n            uniformBuffer.bindTexture(\"girsmTextureGIContrib\", this.textureGIContrib);\r\n            uniformBuffer.updateFloat2(\"girsmTextureOutputSize\", this.outputTextureWidth, this.outputTextureHeight);\r\n        }\r\n    }\r\n\r\n    public override getCustomCode(shaderType: string, shaderLanguage: ShaderLanguage) {\r\n        let frag: { [name: string]: string };\r\n\r\n        if (shaderLanguage === ShaderLanguage.WGSL) {\r\n            frag = {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_DEFINITIONS: `\r\n                #ifdef RENDER_WITH_GIRSM\r\n                    var girsmTextureGIContribSampler: sampler;\r\n                    var girsmTextureGIContrib: texture_2d<f32>;\r\n\r\n                    fn computeIndirect() -> vec3f {\r\n                        var uv = fragmentInputs.position.xy / uniforms.girsmTextureOutputSize;\r\n                        return textureSample(girsmTextureGIContrib, girsmTextureGIContribSampler, uv).rgb;\r\n                    }\r\n                #endif\r\n            `,\r\n\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION: `\r\n                #ifdef RENDER_WITH_GIRSM\r\n                    finalDiffuse += computeIndirect() * surfaceAlbedo.rgb;\r\n                #endif\r\n            `,\r\n            };\r\n\r\n            if (!this._isPBR) {\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\"] = `\r\n                #ifdef RENDER_WITH_GIRSM\r\n                    color = vec4f(color.rgb + computeIndirect() * baseColor.rgb, color.a);\r\n                #endif\r\n            `;\r\n            }\r\n        } else {\r\n            frag = {\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_DEFINITIONS: `\r\n                #ifdef RENDER_WITH_GIRSM\r\n                    uniform sampler2D girsmTextureGIContrib;\r\n\r\n                    vec3 computeIndirect() {\r\n                        vec2 uv = gl_FragCoord.xy / girsmTextureOutputSize;\r\n                        return texture2D(girsmTextureGIContrib, uv).rgb;\r\n                    }\r\n                #endif\r\n            `,\r\n\r\n                // eslint-disable-next-line @typescript-eslint/naming-convention\r\n                CUSTOM_FRAGMENT_BEFORE_FINALCOLORCOMPOSITION: `\r\n                #ifdef RENDER_WITH_GIRSM\r\n                    finalDiffuse += computeIndirect() * surfaceAlbedo.rgb;\r\n                #endif\r\n            `,\r\n            };\r\n\r\n            if (!this._isPBR) {\r\n                frag[\"CUSTOM_FRAGMENT_BEFORE_FRAGCOLOR\"] = `\r\n                #ifdef RENDER_WITH_GIRSM\r\n                    color.rgb += computeIndirect() * baseColor.rgb;\r\n                #endif\r\n            `;\r\n            }\r\n        }\r\n\r\n        return shaderType === \"vertex\" ? null : frag;\r\n    }\r\n}\r\n\r\nRegisterClass(`BABYLON.GIRSMRenderPluginMaterial`, GIRSMRenderPluginMaterial);\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 14132, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/GlobalIllumination/index.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/GlobalIllumination/index.ts"],"sourcesContent":["export * from \"./giRSM\";\r\nexport * from \"./giRSMManager\";\r\n\r\nexport * from \"../../Shaders/bilateralBlur.fragment\";\r\nexport * from \"../../Shaders/bilateralBlurQuality.fragment\";\r\nexport * from \"../../Shaders/rsmGlobalIllumination.fragment\";\r\nexport * from \"../../Shaders/rsmFullGlobalIllumination.fragment\";\r\nexport * from \"../../ShadersWGSL/bilateralBlur.fragment\";\r\nexport * from \"../../ShadersWGSL/bilateralBlurQuality.fragment\";\r\nexport * from \"../../ShadersWGSL/rsmGlobalIllumination.fragment\";\r\nexport * from \"../../ShadersWGSL/rsmFullGlobalIllumination.fragment\";\r\n"],"names":[],"mappings":";AAAA,cAAc,SAAS,CAAC;AACxB,cAAc,gBAAgB,CAAC;AAE/B,cAAc,sCAAsC,CAAC;AACrD,cAAc,6CAA6C,CAAC;AAC5D,cAAc,8CAA8C,CAAC;AAC7D,cAAc,kDAAkD,CAAC;AACjE,cAAc,0CAA0C,CAAC;AACzD,cAAc,iDAAiD,CAAC;AAChE,cAAc,kDAAkD,CAAC;AACjE,cAAc,sDAAsD,CAAC"}},
    {"offset": {"line": 14157, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/.pnpm/@babylonjs+core@8.39.0/node_modules/@babylonjs/core/Rendering/index.js","sources":["file:///Users/shayanbozorgmanesh/Developer/kitchen-cpq-platform/node_modules/.pnpm/%40babylonjs%2Bcore%408.39.0/dev/core/src/Rendering/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-restricted-imports */\r\nexport * from \"./boundingBoxRenderer\";\r\nexport * from \"./depthRenderer\";\r\nexport * from \"./depthRendererSceneComponent\";\r\nexport * from \"./depthPeelingRenderer\";\r\nexport * from \"./depthPeelingSceneComponent\";\r\nexport * from \"./edgesRenderer\";\r\nexport * from \"./geometryBufferRenderer\";\r\nexport * from \"./geometryBufferRendererSceneComponent\";\r\nexport * from \"./iblCdfGenerator\";\r\nexport * from \"./iblCdfGeneratorSceneComponent\";\r\nexport * from \"./IBLShadows/iblShadowsRenderPipeline\";\r\nexport * from \"./prePassRenderer\";\r\nexport * from \"./prePassRendererSceneComponent\";\r\nexport * from \"./subSurfaceSceneComponent\";\r\nexport * from \"./outlineRenderer\";\r\nexport * from \"./renderingGroup\";\r\nexport * from \"./renderingManager\";\r\nexport * from \"./utilityLayerRenderer\";\r\nexport * from \"./fluidRenderer/index\";\r\nexport * from \"./reflectiveShadowMap\";\r\nexport * from \"./objectRenderer\";\r\nexport * from \"./GlobalIllumination/index\";\r\n\r\n// Depth\r\nexport * from \"../Shaders/depth.fragment\";\r\nexport * from \"../Shaders/depth.vertex\";\r\nexport * from \"../ShadersWGSL/depth.fragment\";\r\nexport * from \"../ShadersWGSL/depth.vertex\";\r\n\r\n// Geometry\r\nexport * from \"../Shaders/geometry.fragment\";\r\nexport * from \"../Shaders/geometry.vertex\";\r\nexport * from \"../ShadersWGSL/geometry.fragment\";\r\nexport * from \"../ShadersWGSL/geometry.vertex\";\r\n\r\n// Bounding Box Renderer\r\nexport * from \"../Shaders/boundingBoxRenderer.fragment\";\r\nexport * from \"../Shaders/boundingBoxRenderer.vertex\";\r\nexport * from \"../ShadersWGSL/boundingBoxRenderer.fragment\";\r\nexport * from \"../ShadersWGSL/boundingBoxRenderer.vertex\";\r\n\r\n// Edges Renderer\r\nexport * from \"../Shaders/line.fragment\";\r\nexport * from \"../Shaders/line.vertex\";\r\nexport * from \"../ShadersWGSL/line.fragment\";\r\nexport * from \"../ShadersWGSL/line.vertex\";\r\n\r\n// Outline Renderer\r\nexport * from \"../Shaders/outline.fragment\";\r\nexport * from \"../Shaders/outline.vertex\";\r\nexport * from \"../ShadersWGSL/outline.fragment\";\r\nexport * from \"../ShadersWGSL/outline.vertex\";\r\n\r\n// IBL Shadows\r\nexport * from \"../Shaders/copyTexture3DLayerToTexture.fragment\";\r\nexport * from \"../ShadersWGSL/copyTexture3DLayerToTexture.fragment\";\r\nexport * from \"../Shaders/iblShadowVoxelTracing.fragment\";\r\nexport * from \"../ShadersWGSL/iblShadowVoxelTracing.fragment\";\r\nexport * from \"../Shaders/iblShadowDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblShadowDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblShadowSpatialBlur.fragment\";\r\nexport * from \"../Shaders/iblShadowSpatialBlur.fragment\";\r\nexport * from \"../ShadersWGSL/iblShadowAccumulation.fragment\";\r\nexport * from \"../Shaders/iblShadowAccumulation.fragment\";\r\nexport * from \"../Shaders/iblShadowsCombine.fragment\";\r\nexport * from \"../ShadersWGSL/iblShadowsCombine.fragment\";\r\nexport * from \"../ShadersWGSL/iblCombineVoxelGrids.fragment\";\r\nexport * from \"../Shaders/iblCombineVoxelGrids.fragment\";\r\nexport * from \"../Shaders/iblGenerateVoxelMip.fragment\";\r\nexport * from \"../ShadersWGSL/iblGenerateVoxelMip.fragment\";\r\nexport * from \"../Shaders/iblShadowGBufferDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblShadowGBufferDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblCdfx.fragment\";\r\nexport * from \"../Shaders/iblCdfx.fragment\";\r\nexport * from \"../ShadersWGSL/iblCdfy.fragment\";\r\nexport * from \"../Shaders/iblCdfy.fragment\";\r\nexport * from \"../ShadersWGSL/iblIcdf.fragment\";\r\nexport * from \"../Shaders/iblIcdf.fragment\";\r\nexport * from \"../ShadersWGSL/iblCdfDebug.fragment\";\r\nexport * from \"../Shaders/iblCdfDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblScaledLuminance.fragment\";\r\nexport * from \"../Shaders/iblScaledLuminance.fragment\";\r\nexport * from \"../ShadersWGSL/iblDominantDirection.fragment\";\r\nexport * from \"../Shaders/iblDominantDirection.fragment\";\r\nexport * from \"../Shaders/iblVoxelGrid2dArrayDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblVoxelGrid2dArrayDebug.fragment\";\r\nexport * from \"../Shaders/iblVoxelGrid.fragment\";\r\nexport * from \"../Shaders/iblVoxelGrid.vertex\";\r\nexport * from \"../ShadersWGSL/iblVoxelGrid.fragment\";\r\nexport * from \"../ShadersWGSL/iblVoxelGrid.vertex\";\r\nexport * from \"../Shaders/iblVoxelGrid3dDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblVoxelGrid3dDebug.fragment\";\r\nexport * from \"../Shaders/iblVoxelSlabDebug.vertex\";\r\nexport * from \"../Shaders/iblVoxelSlabDebug.fragment\";\r\nexport * from \"../ShadersWGSL/iblVoxelSlabDebug.vertex\";\r\nexport * from \"../ShadersWGSL/iblVoxelSlabDebug.fragment\";\r\n\r\n// Depth Peeling Renderer\r\nexport * from \"../Shaders/oitBackBlend.fragment\";\r\nexport * from \"../Shaders/oitFinal.fragment\";\r\nexport * from \"../ShadersWGSL/oitBackBlend.fragment\";\r\nexport * from \"../ShadersWGSL/oitFinal.fragment\";\r\n"],"names":[],"mappings":"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"}}]
}