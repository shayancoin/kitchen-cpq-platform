{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/frontend/src/lib/utils.ts"],"sourcesContent":["export const protocol: 'https' | 'http' =\n  process.env.NODE_ENV === 'production' ? 'https' : 'http';\n\nconst rawRootDomain = (process.env.NEXT_PUBLIC_ROOT_DOMAIN || 'localhost:3000').trim();\nconst rootDomainPattern = /^[a-z0-9.-]+(:[0-9]+)?$/i;\n\nif (!rootDomainPattern.test(rawRootDomain)) {\n  throw new Error(\n    `Invalid NEXT_PUBLIC_ROOT_DOMAIN \"${rawRootDomain}\". Expected hostname like \"example.com\" or \"example.com:3000\".`\n  );\n}\n\nexport const rootDomain: string = rawRootDomain;\n"],"names":[],"mappings":";;;;;;AAAO,MAAM,WACX,sCAAwC,0BAAU;AAEpD,MAAM,gBAAgB,CAAC,QAAQ,GAAG,CAAC,uBAAuB,IAAI,gBAAgB,EAAE,IAAI;AACpF,MAAM,oBAAoB;AAE1B,IAAI,CAAC,kBAAkB,IAAI,CAAC,gBAAgB;IAC1C,MAAM,IAAI,MACR,CAAC,iCAAiC,EAAE,cAAc,8DAA8D,CAAC;AAErH;AAEO,MAAM,aAAqB"}},
    {"offset": {"line": 33, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/apps/frontend/middleware.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from 'next/server';\nimport { rootDomain } from './src/lib/utils';\n\nfunction extractSubdomain(request: NextRequest): string | null {\n  const url = request.url;\n  const host = request.headers.get('host') || '';\n  const hostname = host.split(':')[0];\n\n  if (url.includes('localhost') || url.includes('127.0.0.1')) {\n    const fullUrlMatch = url.match(/https?:\\/\\/([^.]+)\\.localhost/);\n    if (fullUrlMatch && fullUrlMatch[1]) {\n      return fullUrlMatch[1];\n    }\n\n    if (hostname.includes('.localhost')) {\n      return hostname.split('.')[0];\n    }\n\n    return null;\n  }\n\n  const rootDomainFormatted = rootDomain.split(':')[0];\n\n  if (hostname.includes('---') && hostname.endsWith('.vercel.app')) {\n    const parts = hostname.split('---');\n    return parts.length > 0 ? parts[0] : null;\n  }\n\n  const isSubdomain =\n    hostname !== rootDomainFormatted &&\n    hostname !== `www.${rootDomainFormatted}` &&\n    hostname.endsWith(`.${rootDomainFormatted}`);\n\n  return isSubdomain ? hostname.replace(`.${rootDomainFormatted}`, '') : null;\n}\n\nexport function middleware(request: NextRequest) {\n  const { pathname } = request.nextUrl;\n  const subdomain = extractSubdomain(request);\n  const authToken = request.cookies.get('auth_token')?.value;\n  const requiresAuth =\n    pathname.startsWith('/cpq') ||\n    pathname.startsWith('/(dealer)') ||\n    pathname.startsWith('/(admin)');\n\n  if (subdomain) {\n    if (pathname.startsWith('/admin')) {\n      return NextResponse.redirect(new URL('/', request.url));\n    }\n\n    if (pathname === '/') {\n      return NextResponse.rewrite(new URL(`/s/${subdomain}`, request.url));\n    }\n  }\n\n  if (requiresAuth && !authToken && pathname !== '/login') {\n    const loginUrl = new URL('/login', request.url);\n    loginUrl.searchParams.set('next', pathname);\n    return NextResponse.redirect(loginUrl);\n  }\n\n  return NextResponse.next();\n}\n\nexport const config = {\n  matcher: [\n    '/((?!api|_next|[\\\\w-]+\\\\.[\\\\w]+).*)'\n  ]\n};\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;;;AAEA,SAAS,iBAAiB,OAAoB;IAC5C,MAAM,MAAM,QAAQ,GAAG;IACvB,MAAM,OAAO,QAAQ,OAAO,CAAC,GAAG,CAAC,WAAW;IAC5C,MAAM,WAAW,KAAK,KAAK,CAAC,IAAI,CAAC,EAAE;IAEnC,IAAI,IAAI,QAAQ,CAAC,gBAAgB,IAAI,QAAQ,CAAC,cAAc;QAC1D,MAAM,eAAe,IAAI,KAAK,CAAC;QAC/B,IAAI,gBAAgB,YAAY,CAAC,EAAE,EAAE;YACnC,OAAO,YAAY,CAAC,EAAE;QACxB;QAEA,IAAI,SAAS,QAAQ,CAAC,eAAe;YACnC,OAAO,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;QAC/B;QAEA,OAAO;IACT;IAEA,MAAM,sBAAsB,6JAAU,CAAC,KAAK,CAAC,IAAI,CAAC,EAAE;IAEpD,IAAI,SAAS,QAAQ,CAAC,UAAU,SAAS,QAAQ,CAAC,gBAAgB;QAChE,MAAM,QAAQ,SAAS,KAAK,CAAC;QAC7B,OAAO,MAAM,MAAM,GAAG,IAAI,KAAK,CAAC,EAAE,GAAG;IACvC;IAEA,MAAM,cACJ,aAAa,uBACb,aAAa,CAAC,IAAI,EAAE,qBAAqB,IACzC,SAAS,QAAQ,CAAC,CAAC,CAAC,EAAE,qBAAqB;IAE7C,OAAO,cAAc,SAAS,OAAO,CAAC,CAAC,CAAC,EAAE,qBAAqB,EAAE,MAAM;AACzE;AAEO,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,YAAY,iBAAiB;IACnC,MAAM,YAAY,QAAQ,OAAO,CAAC,GAAG,CAAC,eAAe;IACrD,MAAM,eACJ,SAAS,UAAU,CAAC,WACpB,SAAS,UAAU,CAAC,gBACpB,SAAS,UAAU,CAAC;IAEtB,IAAI,WAAW;QACb,IAAI,SAAS,UAAU,CAAC,WAAW;YACjC,OAAO,kZAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;QAEA,IAAI,aAAa,KAAK;YACpB,OAAO,kZAAY,CAAC,OAAO,CAAC,IAAI,IAAI,CAAC,GAAG,EAAE,WAAW,EAAE,QAAQ,GAAG;QACpE;IACF;IAEA,IAAI,gBAAgB,CAAC,aAAa,aAAa,UAAU;QACvD,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,QAAQ;QAClC,OAAO,kZAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,OAAO,kZAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}